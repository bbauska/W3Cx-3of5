<h2 align="center">W3Cx Front-End Web Developer</h2>
<br/>
<!------------------------------------------------------------------------------------------------>
<!------------------------------- readme.md of W3Cx-3of5-HTML5.1x -------------------------------->
<!------------------------------------------------------------------------------------------------>
<!------------------------------------------ w3cx logo ------------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center" width="100%">
<img src="./images/image011.png?raw=true"
   width="35%"
   alt="W3C logo" />
</p>

<h3 align="center">W3Cx-3of5-HTML5.1x - Coding Essentials and Best Practices</h3>
<!------------------------------------------------------------------------------------------------>
<!------------------------------ 01. W3Cx-3of5-HTML5.1x logo (01) -------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center" width="100%">
<img src="./images/image001.png?raw=true"
   width="65%"
   alt="W3Cx HTML 5.1x logo" />
</p>

<!---- :alien:  :sob:  :cold_sweat: :point_up:  :cancer:  :smile:   --->
<!---- right arrow , left arrow , oriental , tilde ---->
<!---- &#955;   &#9658;  &#767;  &#2400;  --->

## [Table of Contents](#table-of-contents)

## [**About W3C and the Web**](#cha)
>### - [**About W3C**](#cha-1)
>### - [**Why accessibility is important**](#cha-2)
>### - [**Why internationalization is important**](#cha-3)
>### - [**W3C tools**](#cha-4)

## [**Course Introduction and Practical Information**](#chb)
>### * [**Course syllabus**](#chb-1)
>### * [**Getting around the course**](#chb-2)
>### * [**Course tools**](#chb-3)

## [**Module 1: HTML5 Basics**](#ch1)
>### 1.1 [**Introduction - Module 1**](#ch1-1-1)
>### 1.2 [**From HTML1.0 to HTML5**](#ch1-2-1)
>### 1.3 [**New structural elements**](#ch1-3-1)
>### 1.4 [**Other elements and attributes**](#ch1-4-1)
>### 1.5 [**Microdata**](#ch1-5-1)
>### 1.6 [**Exercises**](#ch1-6-1)

## [**Module 2: HTML5 Multimedia**](#ch3)
>### 2.1 [**Introduction - Module 2**](#ch2-1-1)
>### 2.2 [**Streaming multimedia content: the video and audio elements**](#ch2-2-1)
>### 2.3 [**Subtitles and closed captions**](#ch2-3-1)
>### 2.4 [**Enhanced HTML5 media players and frameworks**](#ch2-4-1)
>### 2.5 [**Webcam, microphone: the getUserMedia API**](#ch2-5-1)
>### 2.6 [**Exercises - Module 2**](#ch2-6-1)

## [**Module 3: HTML5 Graphics**](#ch3)
>### 3.1 [**Introduction - Module 3**](#ch3-1-1)
>### 3.2 [**Basics of HTML5 canvas**](#ch3-2-1)
>### 3.3 [**Immediate drawing mode: rectangles, text, images**](#ch3-3-1)
>### 3.4 [**Path drawing mode: lines, circles, arcs, curves and other path drawing methods**](#ch3-4-1)
>### 3.5 [**Colors, gradients, patterns, shadows, etc.**](#ch3-5-1)
>### 3.6 [**Exercises - Module 3**](#ch3-6-1)

## [**Module 4: HTML5 Animation**](#ch4)
>### 4.1 [**Introduction - Module 4**](#ch4-1-1)
>### 4.2 [**Basic animation techniques**](#ch4-2-1)
>### 4.3 [**Canvas and user interaction (keyboard, mouse)**](#ch4-3-1)
>### 4.4 [**A glimpse of advanced canvas functionalities**](#ch4-4-1)
>### 4.5 [**Exercises - Module 4**](#ch4-5-1)

## [**Module 5: HTML5 Forms**](#ch5)
>### 5.1 [**Introduction - Module 5**](#ch5-1-1)
>### 5.2 [**Introduction to HTML5 Forms**](#ch5-2-1)
>### 5.3 [**Accessible forms**](#ch5-3-1)
>### 5.4 [**New <input> types**](#ch5-4-1)
>### 5.5 [**New forms attributes**](#ch5-5-1)
>### 5.6 [**New elements related to forms**](#ch5-6-1)
>### 5.7 [**Form validation API**](#ch5-7-1)
>### 5.8 [**Exercises - Module 5**](#ch5-8-1)

## [**Module 6: HTML5 Basic APIs**](#ch6)
>### 6.1 [**Introduction - Module 6**](#ch6-1-1)
>### 6.2 [**Introduction to HTML5 APIs**](#ch6-2-1)
>### 6.3 [**HTML5 Cache**](#ch6-3-1)
>### 6.4 [**The Web Storage API**](#ch6-4-1)
>### 6.5 [**The File API**](#ch6-5-1)
>### 6.6 [**The geolocation API**](#ch6-6-1)

<div align="right">
  <b><a href="#table-of-contents">↥ Back To Top</a></b>
</div>

<h2 id-"cha-1">About W3C and the Web</h2>

<h2>Course information</h2>

<h3>Welcome to "HTML5 Coding Essentials and Best Practices"</h3>
<ul>
<li>Course outline (syllabus)</li>
<li>Course forums</li>
<li>Course tools</li>
<li>About W3C and the Web</li>
</ul>

W3C has designed a <a href="https://www.edx.org/professional-certificate/front-end-web-developer-9">"Front-End Web Developer" (FEWD) Professional Certificate</a> where you learn all of the necessary skills needed to build interactive and responsive user experiences on the Web. This program deepens your knowledge of the 3 foundational languages that power the Web: HTML5, CSS and JavaScript.

The <b>W3C FEWD</b> program is composed of 5 courses:
<ol type="1">
<li>CSS Basics</li>
<li>5.0x HTML5 and CSS Fundamentals</li>
<li>This course: <b><i>5.1x HTML5 Coding Essentials and Best Practices</i></b></li>
<li>5.2x HTML5 Apps and Games</li>
<li>JavaScript Introduction</li>
</ol>

This course is a natural follow up to the <a href="https://www.edx.org/course/css-basics">CSS Basics</a> and <a href="https://www.edx.org/course/html5-and-css-fundamentals">HTML5 & CSS Fundamentals</a> courses.

As such, required prerequisites are:
<ul>
<li>Be comfortable putting together an HTML document,</li>
<li>Have minimal familiarity with CSS,</li>
<li>Basic knowledge of JavaScript and DOM APis is sufficient, and this course will include a recap of basics. You are also more than welcome to follow the <a href="https://www.edx.org/course/javascript-introduction" target="_blank">JavaScript Introduction</a> course (introductory level).</li>
</ul>

During this course, you will learn:
<ul>
<li>Learn the simplified HTML5 tags, and how to use microdata<br/>&nbsp;</li>
<li>Play with the audio and video tags<br/>&nbsp;</li>
<li>Use the Webcam<br/>&nbsp;</li>
<li>Draw and animate fun Web graphics<br/>&nbsp;</li>
<li>Discover HTML5 form features<br/>&nbsp;</li>
<li>Test the basic APIs, such as Web storage and geolocation<br/>&nbsp;</li>
<li>And most of all, practice coding techniques thanks to multiple interactive examples.</li>
</ul>

The HTML5 course team is thrilled to guide you in your learning experience. We are committed to teach you how to code Web pages, and how to do it the correct way. We encourage you to create Web pages and apps and share them in the discussion forums. Have fun!

<h3>Online Code Editors:</h3>

<a href="https://jsbin.com">JS Bin</a>

<a href="https://code.tutsplus.com/tutorials/javascript-tools-of-the-trade-jsbin--net-36843">CodePen Tutorial</a>

<a href="https://codepen.io">CodePen</a>

<a href="https://css-tricks.com/video-screencasts/112-using-codepen/">CodePen CSS Tutorial</a>

<h3>Web Editors:</h3>

While any text editor, like NotePad or TextEdit, can be used to create Web pages, they don't necessarily offer a lot of help towards that end. Other options offer more facilities for error checking, syntax coloring and saving some typing by filling things out for you.

Here are a few possibilities for Web editors:
<ul>
<li><a href="https://notepad-plus-plus.org/">Notepad</a> - on Windows PC's.</li>
<li><a href="https://code.visualstudio.com/">Visual Studio Code</a> - a free open source editor that can run on any operating system. Many developers are already familiar with Visual Studio Code. Many coding videos in this course are demonstrated using Visual Studio Code.</li>
<li><a href="https://developer.apple.com/xcode/">XCode</a> - Mac developers may be familiar with XCode.</li>
<li>TextEdit - this is available on Macs, but be sure you're <a href="https://discussions.apple.com/message/5014514#5014514">saving as plain text</a>, not as a ".rtf" or ".doc" file.</li>
<li><a href="https://www.sublimetext.com/">Sublime Text</a> - it is quite popular with developers, though there can be a bit of a learning curve to use its many features.</li>
<li><a href="http://bluegriffon.org/">BlueGriffon</a> - a WYSIWYG ("What You See Is What You Get") content editor for the World Wide Web. Powered by Gecko, the rendering engine of Firefox, it&apos;s a modern and robust solution to edit Web pages in conformance to the latest Web Standards.</li>
<li><a href="https://atom.io/">Atom</a> - another cross platform editor, created by <a href="https://github.com">GitHub</a>.</li>
<li><a href="https://github.com/">GitHub</a> itself - check <a href="https://towardsdatascience.com/how-to-create-a-free-github-pages-website-53743d7524e1">this resource that explains how to create a Web site using GitHub</a>.</li>
<li><a href="https://www.vim.org/">Vim</a> or <a href="https://www.gnu.org/software/emacs/">Emacs</a> - great editors, but if you&apos;re not already familiar with these, this isn&apos;t the time to try.</li>
</ul>

<div align="right">
  <b><a href="#table-of-contents">↥ Back To Top</a></b>
</div>

<h3>Online Editors:</h3>

To help you practice during the whole duration of the course, we use the following interactive online editors. Pretty much all the course&apos;'s examples actually use these tools.

<!------------------------------------------------------------------------------------------------>
<!------------------------------------- 02. jsbin logo (04) -------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image002.png?raw=true"
   alt="JSBin logo"
   width="15%">
&nbsp;
<br/>
<ul>
<li><a href="https://jsbin.com/">JS Bin</a>.</li>
</ul>
JS Bin is an open source collaborative Web development debugging tool. Most of the examples that are in this course are on JSBin.

Tutorials can be found on the Web (such as <a href="https://code.tutsplus.com/tutorials/javascript-tools-of-the-trade-jsbin--net-36843">this one)</a> or on YouTube. The tool is really simple, just open the link to the provided examples, look at the code, look at the result, etc. And you can modify the examples as you like, you can also modify / clone / save / share them. Keep in mind that it&apos;s always better to be logged in (it&apos;s free) if you do not want to lose your contributions/personal work.

<!------------------------------------------------------------------------------------------------>
<!------------------------------------ 03. codepen logo (04) ------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image003.png?raw=true"
   alt="CodePen logo"
   width="15%">
&nbsp;
<br/>

<ul>
<li><a href="https://codepen.io/">CodePen</a></li><br/>
</ul>

CodePen is an HTML, CSS, and JavaScript code editor that previews/showcases your code bits in your browser.
It helps with cross-device testing, real-time remote pair programming and teaching.

Here&apos;s an article of interest if you use CodePen: [Things you can do with CodePen](https://codepen.io/brentmiller/post/things-you-can-do-with-codepen) &lbrack;Brent Miller, February 6, 2019&rbrack;].

There are many other handy tools such as [JSFiddle](https://jsfiddle.net/), and [Dabblet](https://dabblet.com/). Please share your favorite tool on the discussion forum, and explain why! Share also your own code contributions, such as a nice canvas animation, a great looking HTML5 form, etc.

<div align="right">
  <b><a href="#table-of-contents">↥ Back To Top</a></b>
</div>

<h3>Browser Compatibility:</h3>

The term browser compatibility refers to the ability of a given Web site to appear fully functional on the browsers available in the market.

The most powerful aspect of the Web is what makes it so challenging to build for: its universality. When you create a Web site, you're writing code that needs to be understood by many different browsers on different devices and operating systems!

To make the Web evolve in a sane and sustainable way for both users and developers, browser vendors work together to standardize new features, whether it's a new [HTML element](https://developer.mozilla.org/en-US/docs/Web/HTML/Element), [CSS property](https://developer.mozilla.org/en-US/docs/Web/CSS/Reference#Keyword_index), or [JavaScript API](https://developer.mozilla.org/en-US/docs/Web/API). But different vendors have different priorities, resources, and release cycles --- so it's very unlikely that a new feature will land on all the major browsers at once. As a Web developer, this is something you must consider if you're relying on a feature to build your site.

We are then providing references to the browser support of HTML5 features presented in this course using 2 resources: [Can I Use](https://caniuse.com/) and [Mozilla Developer Network (MDN) Web Docs](https://developer.mozilla.org/en-US/).

<h3>Can I use</h3>

<a href="https://caniuse.com/">Can I Use</a> provides up-to-date tables for support of front-end Web technologies on desktop and mobile Web browsers. Below is a snapshot of what information is given by CanIUse when searching for "CSS3 colors".</a>

Example of a <a href="./images/image004.png">CanIUse browser</a> support table (using CSS3 colors).

<!------------------------------------------------------------------------------------------------>
<!---------------------------------- 04. caniuse example (05) ------------------------------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image004.png?raw=true"
   alt="Example CSS in CanIUse"
   width="65%">
&nbsp;
<br/>

<h3>MDN Web Docs</h3>
<!------------------------------------------------------------------------------------------------>
<!---------------------------------- 05. mdn web docs logo (05) ---------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image005.png?raw=true"
   alt="Logo of MDN Web Docs"
   width="35%">
&nbsp;
<br/>

To help developers make these decisions consciously rather than accidentally, [MDN Web Docs](https://developer.mozilla.org/) provides browser compatibility tables in its documentation pages, so that when looking up a feature you're considering for your project, you know exactly which browsers will support it.

<h3>External resources:</h3>

<ul>
<li><a href="https://hacks.mozilla.org/2018/02/mdn-browser-compatibility-data/" target="_blank">MDN browser compatibility data: Taking the guesswork out of web compatibility</a>.</li><br/>
<li><a href="https://hacks.mozilla.org/2019/09/caniuse-and-mdn-compat-data-collaboration/" target="_blank">Caniuse and MDN compatibility data collaboration</a>.</li><br/>
</ul>

<div align="right">
  <b><a href="#table-of-contents">↥ Back To Top</a></b>
</div>

<h3>W3C Validators: </h3>

For over 15 years, the W3C has been developing and hosting <a href="https://w3c.github.io/developers/" target="_blank">free and open source tools</a> used every day by millions of Web developers and Web designers.

All the tools listed below are Web-based, and are available as downloadable sources or as free services on the <a href="https://w3c.github.io/developers/tools/" target="_blank">W3C Developers tools</a> site.

<h3>W3C Validator</h3>

The <a href="https://validator.w3.org/" target="__blank">W3C validator</a> checks the <a href="https://validator.w3.org/docs/help.html#validation_basics">markup validity</a> of various Web document formats, such as HTML. Note that you are automatically directed to the <a href="https://validator.w3.org/nu/">Nu Html Checker</a> when validating an HTML5 document.

<h3>CSS Validator</h3>

The <a href="https://jigsaw.w3.org/css-validator/" target="_blank">CSS validator</a> checks Cascading Style Sheets (CSS) and (X)HTML documents that use CSS stylesheets.

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 06. laptop showing unicorn validator (06) --------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image006.png?raw=true"
   alt="Laptop Showing Unicorn Validator"
   width="25%" />
</p>

<h3>Unicorn</h3>

<a href="https://validator.w3.org/unicorn/" target="_blank">Unicorn</a> is W3C&apos;'s unified validator, which helps people improve the quality of their Web pages by performing a variety of checks. Unicorn gathers the results of the popular HTML and CSS validators, as well as other useful services, such as Internationalization, RSS/Atom feeds and http headers.

<h3 id="cha-3">Internationalization Checker</h3>

The <a href="https://validator.w3.org/i18n-checker/" target="_blank">W3C Internationalization Checker</a> provides information about various internationalization-related aspects of your page, including the HTTP headers that affect it. It will also report a number of issues and offer advice about how to resolve them.

<h3>Link Checker</h3>

The <a href="https://validator.w3.org/checklink" target="_blank">W3C Link Checker</a> looks for issues in links, anchors and referenced objects in a Web page, CSS style sheet, or recursively on a whole Web site. For best results, it is recommended to first ensure that the documents checked use valid <a href="https://validator.w3.org/" target="_blank">(X)HTML Markup</a> and <a href="https://jigsaw.w3.org/css-validator/" target="_blank">CSS</a>.

<h3>W3C Cheatsheet</h3>

The <a href="https://www.w3.org/2009/cheatsheet/" target="_blank">W3C cheatsheet</a> provides quick access to useful information from a variety of specifications published by W3C. It aims at giving in a very compact and mobile-friendly format a compilation of useful knowledge extracted from W3C specifications, completed by summaries of guidelines developed at W3C, in particular Web accessibility guidelines, the Mobile Web Best Practices, and a number of internationalization tips.

<!------------------------------------------------------------------------------------------------>
<!--------------------------- 07. w3c cheat sheet snapshot image (07) ---------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image007.png?raw=true"
   alt="W3C Cheat Sheet snapshot image"
   width="65%" />
</p>
Its main feature is a lookup search box, where one can start typing a keyword and get a list of matching properties/elements/attributes/functions in the above-mentioned specifications, and further details on those when selecting the one of interest.

<h4>The W3C cheatsheet is only available as a <a href="https://dev.w3.org/2009/cheatsheet/doc/" target="_blank">pure Web application</a>.</h4>

<div align="right">
  <b><a href="#table-of-contents">↥ Back To Top</a></b>
</div>

<h3>Help Build the Web Platform</h3>

Most of the technologies you use when developing Web applications and Web sites are designed and standardized in W3C in a completely open and transparent process.

In fact, all W3C specifications are developed in public <a href="https://github.com/w3c/" target="_blank">GitHub repositories</a>, so if you are familiar with GitHub, you already know how to contribute to W3C specifications! This is all about raising issues (with feedback and suggestions) and/or bringing pull requests to fix identified issues.

<h3>Contribute</h3>

Contributing to this standardization process might be a bit scary or hard to approach at first, but understanding at a deeper level how these technologies are built is a great way to build your expertise.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 08. github (the octocat) logo (07) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image008.png?raw=true"
   alt="Github (the octocat) logo"
   width="15%" />
</p>

If you&apos;re looking to an easy way to dive into this standardization processes, check out which [issues in the W3C GitHub repositories have been marked as &quot;good first issue&quot;](https://github.com/search?q=org%3Aw3c+label%3A%22good+first+issue%22+state%3Aopen&type=Issues) and see if you find anything where you think you would be ready to help.

<h3>Shape the future</h3>

<!------------------------------------------------------------------------------------------------>
<!----------------------- 09. w3c web incubator community group logo (08) ------------------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image009.png?raw=true"
   alt="W3C Web Incubator Community Group logo"
   width="25%" />
</p>

Another approach is to go and bring feedback on ideas for future technologies: the [W3C Web Platform Community Incubator Group](https://wicg.io/) was built as an easy place to get started to provide feedback on new proposals or bring brand-new proposals for consideration.

Happy Web building!

<h3 id="cha-1">What is W3C?</h3>

As steward of global Web standards, W3C&apos;s mission is to safeguard the openness, accessibility, and freedom of the World Wide Web from a technical perspective.

W3C&apos;s primary activity is to develop protocols and guidelines that ensure long-term growth for the Web. The widely adopted Web standards define key parts of what actually makes the World Wide Web work.

<h3>A few history bits</h3>

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 04. Tim Berners-Lee, WWW developer (08) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image004.png?raw=true"
   alt="Tim Berners-Lee at his desk in CERN, Switzerland, 1994"
   width="65%">
&nbsp;
<br/>

Tim Berners-Lee at his desk in CERN, 1994

[Tim Berners-Lee](https://www.w3.org/People/Berners-Lee/) wrote a [proposal](https://www.w3.org/History/1989/proposal.html) in 1989 for a system called the World Wide Web. He then created the first Web browser, server, and Web page. He wrote the first specifications for URLs, HTTP, and HTML.

In October 1994, Tim Berners-Lee founded the World Wide Web Consortium (W3C) at the Massachusetts Institute of Technology, Laboratory for Computer Science &lbrack;MIT/LCS&rbrack; in collaboration with [CERN](https://home.cern/), where the Web originated (see information on the [original CERN Server](https://www.w3.org/Daemon/)), with support from DARPA and the [European Commission](https://ec.europa.eu/index_en.htm).

In April 1995, [Inria](https://www.inria.fr/) became the first European W3C host, followed by [Keio University of Japan](https://www.keio.ac.jp/) (Shonan Fujisawa Campus) in Asia in 1996. In 2003, [ERCIM](https://www.ercim.eu/) took over the role of European W3C Host from Inria. In 2013, W3C announced [Beihang University](https://ev.buaa.edu.cn/) as the fourth Host.

In addition to these four Host locations that employ W3C staff, there are [W3C Offices](https://www.w3.org/Consortium/Offices/staff) around the globe that support the developer communities in their regions and organize local events. Find the one next to your place!

<h3>A few figures</h3>

As of June 2020, W3C:

<ul>
<li>Is a <a href="https://www.w3.org/Consortium/Member/List)-driven">member</a>-driven organization composed of nearly 430 companies, universities, start-ups, etc. from all over the world.</li><br/>
<li>Holds 44 <a href="https://www.w3.org/groups/">technical groups</a>, including Working and Interest Groups where technical specifications are discussed and developed.</li><br/>
<li>Published over 7,181 <a href="https://www.w3.org/TR/">published technical reports</a>, including 430 Web standards (or W3C Recommendations) - since January 1st,1995.</li><br/>
<li>Runs a <a href="https://www.w3.org/Consortium/Translation/">translation program</a> to foster the translation of its specifications: see the <a href="https://www.w3.org/Consortium/Translation/matrix.html">translation matrix</a> currently listing 304 available translations of W3C recommendations.</li><br/>
<li>Hosts 337 <a href="https://www.w3.org/community/groups/">Community and Business Groups</a>, where developers, designers, and anyone passionate about the Web have a place to hold discussions and publish ideas.</li><br/>
<li>Gathers over 12,912 active participants constituting the W3C community.</li><br/>
<li>Has a <a href="https://www.w3.org/People/">technical staff</a> composed of 64 people, spread on all five continents.</li><br/>
</ul>

<div align="right">
  <b><a href="#table-of-contents">↥ Back To Top</a></b>
</div>

<h4>The Web is Amazing!</h4>

People often use the words &quot;Internet&quot; and &quot;Web&quot; interchangeably, but this usage is technically incorrect.

The Web is an application of the Internet. 

The Web is the most popular way of accessing the Internet, but other applications of the Internet are <a href="https://en.wikipedia.org/wiki/Email">e-mail</a> and <a href="https://en.wikipedia.org/wiki/File_Transfer_Protocol">ftp</a> for example. 

One analogy equates the Internet to a road network where the Web is a car, the email is a bicycle, etc.  Read <a href="https://www.lifewire.com/difference-between-the-internet-and-the-web-2483335">this article</a> for more details about the difference between Internet and the Web.

<h4>Internet</h4>

<ul>
<li>A global network of networks and computers.</li><br>
<li>The network infrastructure.</li><br>
<li>Information travels via network protocols.</li><br>
<li>Can access through a variety of ways.</li><br>
</ul>

<h4>Web</h4>

<ul>
<li>A collection of information accessed through the internet.</li><br>
<li>Information travels primarily through HTTP.</li><br>
<li>Uses browsers to access documents and web pages.</li><br>
<li>Navigation to other pages occurs through hyperlinks.</li><br>
</ul>

The internet is a global network of billions of servers, computers, and other <a href="https://www.lifewire.com/computer-hardware-2625895">hardware</a> devices. Each device can connect with any other device as long as both are connected to the internet using a valid <a href="https://www.lifewire.com/what-is-an-ip-address-2625920">IP address</a>. The internet makes the information sharing system known as the web possible.

The web, which is short for <a href="https://www.lifewire.com/around-the-web-4781469">World Wide Web</a>, is one of the ways information is shared on the internet (others include <a href="https://www.lifewire.com/electronic-mail-overview-1164107">email</a>, File Transfer Protocol <a href="https://www.thoughtco.com/ftp-defined-2654479">(FTP)</a>, and <a href="https://www.lifewire.com/what-is-instant-messaging-2483319">instant messaging</a> services. The web is composed of billions of connected digital documents that are viewed in a web browser, such as Chrome, <a href="https://www.lifewire.com/what-is-safari-4173608">Safari</a>, Microsoft Edge, <a href="https://www.lifewire.com/the-history-of-firefox-446233">Firefox</a>, and others.

Think of the internet as a library. Think of the books, magazines, newspapers, DVDs, <a href="https://www.lifewire.com/what-are-audiobooks-2438535">audiobooks</a>, and other media it contains as websites.

Both the internet and the web serve unique purposes but work hand in hand to provide information, entertainment, and other services to the public.

The internet really is the information superhighway. It passes through various kinds of network traffic including, FTP, IRC, and the World Wide Web. Without it, we wouldn&apos;t have our favorite and most common way to access websites.

The internet was born in the 1960s under the name ARPAnet. It was an experiment by the U.S. military to find ways to maintain communications in the case of a nuclear strike. With a decentralized network, communications could be maintained even if parts were taken offline. ARPAnet eventually became a civilian effort, connecting university mainframe computers for academic purposes.

As personal computers became mainstream in the 1980s and 1990s and the internet was opened to commercial interests, it grew exponentially. More and more users plugged their computers into the massive network through dial-up connections, then through faster connections such as ISDN, cable, DSL, and other technologies. Today, the internet has grown into a public spiderweb of interconnected devices and networks.

No single entity owns the internet, and no single government has absolute authority over its operation. Some technical rules, and its hardware and software standards, are agreed upon by invested organizations, groups, businesses, and others. These groups help the internet remain functional and accessible. However, for the most part, the internet is a free and open broadcast medium of networked hardware with no single owner.

Most consumers are familiar with and comfortable with the World Wide Web. With its easy-to-use interface, it&apos;s the best way to get information in a few clicks.

The World Wide Web was born in 1989. Interestingly enough, the web was built by research physicists so that they could share research findings with one another&apos;s computers. Today, that idea has evolved into the greatest collection of human knowledge in history.

The credited inventor of the World Wide Web is Tim Berners-Lee.

You have to access the internet to view the World Wide Web and the web pages or other content it contains. The web is the collective name for all the pages, sites, documents, and other media that are served to visitors.

The web consists of digital documents, referred to as web pages, that are viewable through <a href="https://www.lifewire.com/what-is-a-browser-446234">web browser</a> software on devices like smartphones, tablets, and computers. These pages contain many types of content, including static content like encyclopedia pages, but also dynamic content like <a href="https://www.lifewire.com/a-primer-to-ebay-basics-2483229">eBay</a> sales, stocks, weather, news, and traffic reports.

A collection of connected web pages that are publicly accessible and under a single domain name is referred to as a website.

Web pages are connected using [Hypertext Transfer Protocol](https://www.lifewire.com/hypertext-transfer-protocol-817944) (HTTP), the coding language that allows you to visit any public web page. By clicking a [hyperlink](https://www.lifewire.com/how-do-hyperlinks-work-2483287) or entering a [Uniform Resource Locator](https://www.lifewire.com/what-is-a-url-2626035) (URL), the browser uses this unique address to find and access a web page. [Search engines](https://www.lifewire.com/best-search-engines-2483352) like Google make it easy to filter the billions of web pages now populating the web by locating the articles, videos, and other media you want to find based on your search criteria.

<div align="right">
  <b><a href="#table-of-contents">↥ Back To Top</a></b>
</div>

<h3>Final Verdict: You Can't Have the Web Without the Internet</h3>

Plain and simple, the internet allows access to the World Wide Web. Without it, we have no way of accessing the thousands of websites out there. For most online needs, however, the web is the easiest to use. Each serves an important purpose.

<h3>Why Accessibility is Important</h3>

*The power of the Web is in its universality.*\
*Access by everyone regardless of disability is an essential aspect.*\
**Tim Berners-Lee, W3C Director and inventor of the World Wide Web**

The Web has become an essential aspect of our daily lives, and everyone should have access to this technology. Web accessibility focuses on ensuring equivalent access for people with disabilities. It is increasingly important to many organizations and governments from around the world, and has many business benefits. Access to information, including on the Web, is also recognized by the UN Convention on the Rights of Persons with Disabilities (CRPD).

<h3>Who is impacted?</h3>

Web accessibility addresses all disabilities, including hearing, learning and cognitive, neurological, physical, speech, and visual disabilities. Some examples of Web accessibility features include:
<ul>
<li><i>Captions</i> on audio and multimedia content for people who are hard of hearing;</li>
<li><i>Clear and consistent layout</i> for people with learning and cognitive disabilities;</li>
<li><i>Keyboard support</i> for people with physical disabilities and who do not use a mouse;</li>
<li><i>Text alternatives</i> for people with visual disabilities and who are using screen readers;</li>
</ul>

<h3>Web accessibility benefits people with and w*ithout* disabilities</h3>

Web accessibility features also benefit many more users, such as:
<ul>
<li>People with temporary situational limitations, such as a broken arm;</li>
<li>People using mobile devices, televisions, and other access channels;</li>
<li>People using older computers, with low bandwidth, and other limitations;</li>
<li>People who are new to computers, to the Web, or to your own Web site;</li>
<li>People who are not fluent in the language of your particular Web site;</li>
</ul>

The Web is an increasingly important resource in many aspects of life: education, employment, government, commerce, health care, recreation, and more. When Web pages, Web technologies, Web tools, or Web applications are badly designed, they can create barriers that exclude people from using the Web. More information is available in the [W3C Accessibility](https://www.w3.org/standards/webdesign/accessibility) overview.

<h3>First Steps in Web Accessibility</h3>

There are many simple Web accessibility improvements that you can implement and check right away, even when you are new to this topic.

Remember that when developing or redesigning a website or Web application, it is best to evaluate accessibility early and throughout the development process to identify accessibility problems early, when it is easier to address them.

Two examples are provided below  but you can find more tips and information in these 2 resources:

<ul>
<li><a href="https://www.w3.org/WAI/gettingstarted/tips/">Tips for Getting Started with Web Accessibility]</a></li>
<li><a href="https://www.w3.org/WAI/test-evaluate/preliminary/">Easy Checks - A First Review of Web Accessibility</a></li>
</ul>

<h3>Example #1: page title</h3>

Good page titles are particularly important for orientation --- to help people know where they are and move between pages open in their browser. The first thing screen readers say when the user goes to a different Web page is the page title. In the Web page markup, they are the words &lt;title&gt; within the &lt;head&gt;.

<b><i>Check #1</i>: There is a title that adequately and briefly describes the content of a page, and it distinguishes the page from other Web pages.</b>

<i>Example</i>:

```html5
<head>
...
<title>Web Accessibility Initiative (WAI) - home page</title>
...
</head>
```
<h3>Example 2: image text alternatives ("alt text")</h3>

Text alternatives (&quot;alt text&quot;) are a primary way of making visual information accessible, because they can be rendered through any sensory modality (for example, visual, auditory or tactile) to match the needs of the user. Providing text alternatives allows the information to be rendered in a variety of ways by a variety of user agents. For example, a person who cannot see a picture can have the text alternative read aloud using synthesized speech.

<i><b>Check #2</i>: Every image has alt with appropriate alternative text.</b>

<i>Example</i>: See the W3C logo below. It contains a link that points to the W3C Web site. The text alternative is going to be a brief description of the link target.

<!------------------------------------------------------------------------------------------------>
<!-------------------------------------- 11. W3C logo (13) --------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image011.png?raw=true"
   alt="W3C logo"
   width="15%" />
&nbsp;
<br/>

<p align="center"><a href="https://www.w3.org/Icons/w3c_home">W3C Home</a></p>

```
<a href="https://w3.org">
<img src="https://w3.org/Icons/w3c_home.png" width="72" height="48" alt="World Wide Web Consortium">
</a>
```

<!------------------------------------------------------------------------------------------------>
<!------------------------------------- 12. html5 logo (13) -------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image012.png?raw=true"
   alt="HTML5 logo"
   width="15%">
&nbsp;
<br/>

```
<!DOCTYPE html>
   <html lang="en">
   <head>
   <meta charset="utf-8">
   <title>Page Title</title>
   <link rel="stylesheet" href="style.css">
   <script src="script.js"></script>
   </head>
 <body>
 ... <!-- The rest is content -->
```

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 13. new structural elements in html5 (14) --------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image013.jpeg?raw=true"
   alt="Some of the new structural elements introduced by HTML5: section, article, etc."
   width="55%" />
&nbsp;
<br/>

<h3>History</h3>

As Web site layouts evolve, HTML5 structural elements such as lists, paragraphs, tables, etc. show their limits. Today, many Web sites offer navigation menus, tabbed panels, headers, footers, and so on. The way these &quot;parts&quot;&apos; are implemented relies heavily on &lt;div&gt; and &lt;span&gt; elements with different id and class attributes, lots of CSS and lots of JavaScript code to apply custom styles and behaviors.

However, there are some issues with this approach:

<ul>
<li>id and class names differ from one developer to another, from one country to another, etc,</li><br/>
<li>Even with the same ids and class names, the css rules may be different,</li><br/>
<li>JavaScript libraries have become increasingly heavy over the years,</li><br/>
<li>Web pages have become increasingly heavy over the years!</li><br/>
<li<These elements can not be handled by the Web browser natively...</li><br/>
</ul>

Even if differences exist between ids, classes and css/js implementations, they also share common behaviors, layouts, and &quot;ways of doing things&quot; that could be guessed at first glance by a human.

So various studies have been conducted in order to identify the most popular ids, class names, widgets, etc. used on the Web:

Quoting from this <a href="https://dev.opera.com/articles/new-structural-elements-in-html5/">article: </a>"During the creation of HTML5, Ian Hickson used Google&apos;s tools to mine data from over a billion Web pages, surveying what ids and class names are most commonly used on the real world Web. Opera did a similar study of 3.5 million URLs, calling it MAMA (&quot;Metadata Analysis and Mining Application&quot;). MAMA, as structural Web-paged search engine, had a smaller URL set, but looked at a larger and wider variety of Web page statistics&quot;.

<h3>New elements added to the HTML5 set</h3>

The results of these surveys led to the addition of new structural elements in HTML5. For example, the very popular &lt;div class=&quot;header&quot;&gt; led to the creation of a &lt;header&gt; element, &lt;div class=&quot;aside&quot;&gt; to a &lt;aside&gt; element, etc.

Finally, the 20 most popular ids and class names found in Hickson&apos;s and Opera&apos;s surveys gave birth to these new elements (click on the element&apos;s name to go to 
the W3C specification about this element):

<h4>HTML5 structural element and Description</h4>

[**&lt;header&gt;**](https://www.w3.org/TR/html5/sections.html#the-header-element)                                                                                                              Introduction of &quot;sectioning elements&quot;: an article, a section, the entire document (header page). Typically the header of a Web site that appears on top of each page, or a header of a long &lt;article&gt; or of a long &lt;section&gt;

[**&lt;footer&gt;**](https://www.w3.org/TR/html5/sections.html#the-footer-element)                                                                                                              Contains the footer of a site, a long &lt;article&gt;, or a long &lt;section&gt;

[**&lt;nav&gt;**](https://www.w3.org/TR/html5/sections.html#the-nav-element)                                                                                                                    Section that contains the main navigation links (within the document or to other pages).

[**&lt;article&gt;**](https://www.w3.org/TR/html5/sections.html#the-article-element)                                                                                                            Independent content, which can be individually extracted from the document and syndicated (RSS or equivalent) without penalizing its understanding. Typically a blog post.

[**&lt;section&gt;**](https://www.w3.org/TR/html5/sections.html#the-section-element)                                                                                                            Generic section used to group different articles for different purposes or subjects, or to define the different sections of a single article. Generally used with a header.

[**&lt;time&gt;**](https://www.w3.org/TR/html5/text-level-semantics.html#the-time-element)                                                                                                      Used for marking up times and dates.

[**&lt;aside&gt;**](https://www.w3.org/TR/html5/sections.html#the-aside-element)                                                                                                                Section whose content is not necessarily directly related to the main content that surrounds it, but can provide additional information.

[**&lt;figure&gt;**](https://www.w3.org/TR/html5/grouping-content.html#the-figure-element) and [**&lt;figcaption&gt;**](https://www.w3.org/TR/html5/grouping-content.html#the-figcaption-element)   Used to encapsulate a figure as a single item, and contains a caption for the figure, respectively.

[**&lt;main&gt;**](https://www.w3.org/TR/html5/sections.html#the-aside-element)                                                                                                                 The main element represents the main content of the body of a document or application. The main content area consists of content that is directly related to or expands upon the central topic of a document or central functionality of an application. **There can be only one &lt;main&gt; element in a document.**

And there is no &lt;content&gt; element even though the &lt;div class=&quot;content&quot;&gt; was very popular. Instead, the HTML5 group decided that anything not embedded in one of the elements from the above table is &quot;default content&quot;. If the content is of a type that corresponds to one of the elements from the table, i.e. if the content is an article, it should be embedded between &lt;article&gt; and &lt;/article&gt;.

Read also at the end of this section about the new &lt;main&gt; element. This element is [part of the HTML5 recommendation](https://www.w3.org/TR/html5/grouping-content.html#the-main-element) and  an integral part of the HTML document structure.

<h3>External resources:</h3>
<ul>
<li>A Smashing Magazine article: <a href="https://coding.smashingmagazine.com/2013/01/18/the-importance-of-sections/">Structural Semantics: The Importance Of HTML5 Sectioning Elements.</a></li>
<li>A Dev. Opera article: <a href="https://dev.opera.com/articles/new-structural-elements-in-html5/">New Structural Elements in HTML5.</a></li>
</ul>

<h3>A blog example that uses the structural elements</h3>

Let&apos;s study [an example we put on JsBin](https://jsbin.com/bucokav/edit?html,output) (all examples we have cooked up are available on the jsbin.com Web site and can be modified freely: you can save your own version using the &quot;Bins/create milestone&quot; menu, share your version with others in the forums, etc. Don&apos;t  hesitate to play with the source code, you will never break anything).

<h4>Use a <header> at the top of the blog</h4>

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 14. image 'Simple HTML5 Blog' (16) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image014.jpeg?raw=true"
   alt="Simple HTML5 Blog"
   width="25%">
&nbsp;
<br/>

This is an example of one way to organize a blog. Here, we have designed the HTML page using a &lt;header&gt; element that contains the &quot;Simple HTML5 blog&quot; text that appears on top of the page.

<h4>HTML code:</h4>

```html5
<!DOCTYPE html>
   <html lang="en">
      <head>
         <meta charset="utf-8"/>
         <title>Simple HTML5 blog</title>
      </head>
      <body>
         <header>
            <h1>Simple <span>HTML5</span> blog</h1>
         </header>
...
```

<h4>The CSS rules we used:</h4>

```css
header {
    color: #007e99;
    font-size: 2.5em;
    padding: 20px 50px
}
header span {
    color: #722
}
```

<h4>Use a &lt;nav&gt; for the navigation menu just below the header</h4>

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 15. image of the navigaton menu (17) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image015.jpeg?raw=true"
   alt="Navigation Menu"
   width="35%" />
</p>

The navigation menu just below the header is a &lt;nav&gt; element. For the purpose of this example we haven&apos;t provided any value for the hyperlinks\...

<h4>HTML code:</h4>

```html5
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="utf-8"/>
   <title>Simple HTML5 blog</title>
</head>
<body>
<header>
   <h1>Simple <span>HTML5</span> blog</h1>
</header>
<nav>
    <ul>
       <li><span>Blog</span></li>
       <li><a href="">About</a></li>
       <li><a href="">Contact</a></li>
    </ul>
</nav>
```

<h4>And here is the CSS we used in this example for the <nav> element:</h4>

```css
nav {
    font-size: 1.5em;
    margin: 5px 0;
    padding: 20px 50px
}
nav li {
    display: inline;
    margin: 0 15px
}
nav li:first-child {
    margin-left: 0
}
* html nav ul {
    margin-left: -15px
}
nav span, nav a {
    padding: 3px 15px 4px
}
nav span {
    background: #722;
    color: #fff
}
```

<h4>A &lt;section&gt; for each month and an <article> for each post in the blog</h4>

Now, we have one big &lt;section&gt; element that contains a set of &lt;article&gt; elements...

<!------------------------------------------------------------------------------------------------>
<!----------------------- 16. image of sections that contain articles (xx) ----------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image016.jpeg?raw=true"
   alt="Image of sections that contain articles"
   width="65%" />
</p>

<h4>HTML code:</h4>

```
<section>
   <article>
    ...
   </article>
   <article>
    ...
   </article>
   <article>
    ...
   </article>
</section>
```
<h4>And here is the CSS:</h4>

```
section {
   float: left;
   padding: 35px 0;
   position: relative;
   width: 70%
}
section article {
   margin: 0 50px 40px;
   padding: 25px 0 0;
   position: relative
}
section header {
   font-size: 1em;
   padding: 0;
}
section h2 {
   font-size: 2.3em;
}
```

Note that the H2, article, article header, etc. will be styled using these rules.

<h3>Add a &lt;header&gt; at the beginning of each &lt;article&gt;</h4>

<!------------------------------------------------------------------------------------------------>
<!------------------------- 17. image of header at top of each article --------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image017.jpeg?raw=true"
   alt="Image of the header at the top of each article"
   width="55%">
&nbsp;
<br/>

Next, in each article in the section we have a header (to display the article title), paragraphs (article content), and so on.

Example for the first blog article:

```
<section>
   <article>
     <header>
         <h2><a href="">Information about this example</a></h2>
     </header>
     <p>Try to move the mouse on different elements. The structure will be
     highlighted and you will be able
     to see the different inclusions of elements one in each other. If you
     move the cursor to this sentence, it will be highlighted in dark grey,
     showing the presence of an &lt;article&gt; element, surrounded by a
     &lt;section&gt; element (light grey), etc. So we have some articles in
     a single section element. The page title at the top is a &lt;header&gt;
     element, while the tag cloud on the right is a &lt;aside&gt; element. The
     main menu on top (with Blog, About, Contact) is a &lt;nav&gt; element.</p>
     <figure>
         <img src="HTML5-tags.png"
             alt="Example of HTML5 structural tags" />
         <figcaption>
             Fig. 1 : an example of how new structural elements could
             be used. This page put a &lt;nav&gt; on top, and does not have
             headers and footer for each article, like in this figure,
             but it could... By the way this is a
             &lt;figcaption&gt; inside a &lt;figure&gt; element...
         </figcaption>
    </figure>
   </article>
   ...
</section>
```

<h4>Use &lt;figure&gt; and &lt;figcaption&gt; and embed &lt;img&gt; inside</h4>

Also note the way we included a figure using the new &quot;HTML5&quot; method, using a &lt;figure&gt;..&lt;/figure&gt; element that embedded a &lt;img src=\.../&gt; element together with a &lt;figcaption&gt; element. 

<!------------------------------------------------------------------------------------------------>
<!---------------------------------- 18. figure and figcaption (xx) ------------------------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image018.jpeg?raw=true"
   alt="Image of figure and figure caption that embed an image"
   width="55%">
&nbsp;
<br/>

Here is the CSS for the &lt;figcaption&gt; element we have used in the example (we did not apply any style to the &lt;figure&gt; element):

<h4>HTML code:</h4>

```
1.  <figure>
2.  <img src="HTML5-tags.png"
    a.  alt="Example of HTML5 structural tags" />
3.  <figcaption>
    a.  Fig. 1 : an example of how .....
4.  </figcaption>
5.  </figure>
```

<h4>CSS code:</h4>

```
1.  figcaption {
2.  font-style:italic;
3.  font-size: 0.8em;
4.  width: 100%
5.  }
```

<h4>Use an &lt;aside&gt; element to display a tag cloud on the\... side of the main content</h4>

After the long &lt;section&gt; element that contains all the blog articles displayed in the page, we added the HTML code for the tag cloud that is displayed on the right of the page, &quot;aside&quot;! This is done using - you already guessed it - an &lt;aside&gt; element:

<!------------------------------------------------------------------------------------------------>
<!----------------------- 19. image of tag cloud defined as aside element ------------------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image019.jpeg?raw=true"
   alt="Image of tag cloud defined as aside element"
   width="35%">
&nbsp;
<br/>

```
<section>
.... all <article>... </article> here....
</section>
<aside>
   <h2>Tag cloud</h2>
   <ul class="tag-cloud">
       <li><a href="" rel="tag" class="w2">ajax</a></li>
       <li><a href="" rel="tag" class="w8">apple</a></li>
       <li><a href="" rel="tag" class="w3">css</a></li>
       ...
   </ul>
</aside>
...
```

We are not going to show the complete CSS here as it uses some tricks to display the list as a &quot;real tag cloud&quot; that uses JavaScript for handling events, etc. Those who are curious can look at [the code of the online example](https://jsbin.com/bucokav/edit?html,output).

<h4>Here is the CSS for the &lt;aside&gt; element:</h4>

```
aside {
    float: right;
    padding: 70px 0 30px;
    position: relative;
    width: 25%
}
aside h2 {
    color: #888;
    font-size: 1.8em
}
aside .tag-cloud {
    padding: 15px 35px 10px 0;
    text-align: center
}
...
```

We used a float:right CSS rule to put the tag cloud on the right\... In the following section we will provide several examples that explain how to make a nice layout with the new structural elements, using simple CSS rules.

<h4>Here is the result:</h4>

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 20. the aside tag on the right (xx) ------------------------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image020.jpeg?raw=true"
   alt="The aside tag cloud on the right"
   width="65%">
&nbsp;
<br/>

<h4>Add a &lt;footer&gt; at the end of the blog</h4>
<!------------------------------------------------------------------------------------------------>
<!-------------------------- 21. image of the blog footer (xx) --------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image021.jpeg?raw=true"
   alt="Image of the Blog Footer"
   width="25%" />
</p>

Finally, we added a &lt;footer&gt; element (*lines 12-14* below) after the tag cloud definition, to display a page footer:

```
<html>
...
<body>
...
<section>
...
</section>
<aside>
...
</aside>
<footer>
   <p>&copy; 2009 Some blog</p>
</footer>
</body>
</html>
```

<h4>With this CSS rule:</h4>

```
footer {
    clear: both;
    color: #777;
    padding: 10px 50px
}
```

And here is the result at the bottom of the page:

<!------------------------------------------------------------------------------------------------>
<!------------------- 22. the resulting footer at the bottom of the page (xx) -------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image022.jpeg?raw=true"
   alt="Image of the Blog Footer"
   width="65%" />
</p>

<h4>More on &lt;article&gt; and &lt;section&gt;</h4>

Can an &lt;article&gt; contain a &lt;section&gt;?

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 23. picture of eisher (xx) --------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image023.jpeg?raw=true"
   alt="Picture of Eisher"
   width="25%" />
</p>

It may not be clear whether a &lt;section&gt; may contain one or several &lt;article&gt; elements or if an &lt;article&gt; may contain one or several &lt;section&gt; elements.

The &lt;article&gt; element was designed for stand-alone parts of a document that could eventually be syndicated in RSS streams.

&lt;section&gt; elements are used to cut a logical part into subparts.

<h4>An <article> may be cut into different <section> elements!</h4>

Example of a blog post defined as a long &lt;article&gt;, that is in turn cut into smaller &lt;section&gt; elements:

```
<article id="id1">
   <section id="id1part1">
      <h2>Introduction</h2>
    </section>
    <section id="id1part2">
      <h2&gt;My travel to India</h2>
    </section>
    <section id="id1part3">
      <h2>Return to France</h2&gt;
    </section>
</article>
```

The blog example from the previous part of the course, on the other hand, uses a single &lt;section&gt; that contains several &lt;article&gt; elements.

Indeed, we can also have a &lt;section&gt; that regroups all blog posts per month, each one being an &lt;article&gt; element.

A &lt;section&gt; may be cut into different &lt;article&gt; elements, too!

Can you put a &lt;nav&gt; in an &lt;article&gt;?

Yes you can, in case you would like to propose some navigation links with each blog post, for example:

```
<article>
   <header>
     <h1>Blog post title</h1>
       <p>Author: Michel</p>
   </header>
   <nav>
       <ul>
           <li><a href="...">Next post</a></li>
           <li><a href="...">Previous post</a></li>
           <li><a href="...">Contact author</a>&lt;/li>
       </ul>
   </nav>
   <p>Content...</p>
   <footer>
     <p>Posted by Michel, the <time datetime="2012-02-02">February 2,
     2012</time> </p>
   </footer>
<article>
```

In that case, the &lt;nav&gt; element proposes navigation links to the next or previous blog post, as well as a link to contact the author of the blog post.

Also note that we used in that example a &lt;footer&gt; element in the blog post.

<h3>What about the <div> element? Is it still useful?</h3>

The new elements have been primarily designed to better structure the code of HTML pages such as those generated by blog or CMS software, however do not forget that they add new semantics and will be taken into account by:
<ul>
<li>Browsers natively or browsers extensions, i.e. for automatically generating a table of contents, an outline view of the document, for applying default CSS rules to these elements, etc. See for example the <a href="https://chrome.google.com/webstore/detail/table-of-contents-crx/eeknhipceeelbgdbcmchicoaoalfdnhi?hl=f">table-of-contents-crx extension</a> (Chrome extension). More on that in the next section of the course.</li><br/>
<li><a href="https://www.w3.org/WAI/perspective-videos/speech/">Text to speech:</a></li><br/>
<li>Web crawlers, etc.</li><br/>
</ul>

You can use &lt;div&gt; elements in all cases where the proposed structural elements do not fit your needs: for defining some content that should be styled, for example.

This chart from the <a href="https://html5doctor.com/">HTML5 Doctor Web site</a> may help you decide whether or not to use a &lt;div&gt;:

<!------------------------------------------------------------------------------------------------>
<!--------------- 24. html5 doctor web site. whether or not to use a <dev> (xx) ------------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image024.png?raw=true"
   alt="HTML5 Doctor Web site.  Whether or not to use a 'dev'"
   width="85%" />
</p>

<h3>Headings & Structural Elements</h3>

We will now present some best practices for starting to use &lt;section&gt;, &lt;article&gt;, &lt;nav&gt;, &lt;aside&gt;, in particular concerning the use of headings (h1, h2, h3, h4, h5 and h6).

Use &lt;h1&gt;\...&lt;h6&gt; for the headings

Since the very beginning, HTML has had heading elements: &lt;h1&gt;\...&lt;h6&gt;. These elements are used to display headings with different sizes by default, when no CSS is used.  The following example shows 6 sentences that are surrounded by &lt;h1&gt;, &lt;h2&gt;, &lt;h3&gt;, &lt;h4&gt;, &lt;h5&gt; and &lt;h6&gt;:

# This is a H1 heading

## This is a H2 heading

### This is a H3 heading

#### This is a H4 heading

##### This is a H5 heading

###### This is a H6 heading

These headings define a hierarchy, as shown by the default sizes given by the browser. This hierarchy can also be used to define *an outline of the document*. To illustrate this, we have used a browser extension. Here is the result for the previous example:

<!------------------------------------------------------------------------------------------------>
<!------------------ 25. outliner in action from the previous example (xx) ----------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image025.png?raw=true"
   alt="Outliner in action from the previous example"
   width="65%" />
</p>

In the above outline, note that we have only used H1\... H6 elements, without any new HTML5 structural elements such as &lt;section&gt; or &lt;article&gt;.

Here is a list of browser extensions you can try, for visualizing the outline of a document: <a href="https://chrome.google.com/webstore/detail/table-of-contents-crx/eeknhipceeelbgdbcmchicoaoalfdnhi?hl=f">table-of-contents-crx</a> (Chrome extension) or <a href="https://addons.mozilla.org/fr/firefox/addon/outline-sidebar/?src=search">this Firefox extension</a>.

<h3>Using headings and new sectioning elements (section, article, aside, nav)</h3>

<h4>Definition of heading content and sectioning content</h4>

The &lt;section&gt;, &lt;article&gt;, &lt;nav&gt; and &lt;aside&gt; elements are called <b>&quot;sectioning elements&quot;</b>. They cut a document into slices we call <b>&quot;sections&quot;</b>.

The HTML5 specification says that &quot;each sectioning element potentially has a heading and has also an outline associated&quot;.

&lt;h1&gt;\...&lt;h6&gt; are called **headings**, and define the header of a section (whether explicitly marked up using sectioning content elements, or implied by the heading content itself). This means that:

```
<body>
    <h1>Title of my document</h1>
    ...
</body>
```

... defines the header of a section *implicitly*, while:

```
<body>
   ...
   <section>
      <h1>Title of my section</h1>
      ...
   </section>
</body>
```

\... defines the heading of *the explicit section* (its parent element &lt;section&gt;).

<h3>Use multiple headings of different rank with sectioning content</h3>

The first element of a heading content in an element of sectioning content represents the heading for that section (the &lt;section&gt;&lt;h1&gt;\...&lt;/h1&gt;&lt;/section&gt; in the above example).

Subsequent headings of equal or higher rank start new (implied) sections, headings of lower rank start implied subsections that are part of the previous one. In both cases, the element represents the heading of the implied section.

Let&apos;s clarify this by looking at some example code:

```
<body>
<section>
     <h1>This H1 is the heading of an explicit section</h1>
     ...
        <h2>This H2 is a subheading, part of the same section
            (lower rank)</h2>
             ....
     <h1>This H1 starts an implicit new section in the explicit
         section (equal or higher rank)</h1>
         ...
        <h2>This is a H2 heading in the new section that has
            just started</h2>
            ...
</section>
</body>
```

The corresponding outline is:

<!------------------------------------------------------------------------------------------------>
<!------------------------------ 26. outline of previous example --------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image026.jpeg?raw=true"
   alt="Outline of previous example"
   width="55%">
&nbsp;
<br/>

In the above example, please note two things:

1.  The outline shows an &quot;Untitled body&quot; at the root of the hierarchy,

2.  The default size for the H1 and H2 is the same (!). Indeed, when we start a &lt;h1&gt; inside a &lt;section&gt; the browser lowers its default size automatically, as if a new hierarchy level has been added artificially. We will discuss this further in the following sections, as we introduce some best practices.

<h3>Best Practices when using Sectioning Elements</h3>

Best practice #1: always add a heading to explicit sectioning content

It&apos;s always better - mainly for accessibility reasons - to include a heading (a &lt;h1&gt;, &lt;h2&gt;\...&lt;h6&gt;) in each sectioning element (&lt;section&gt;, &lt;article&gt;, &lt;nav&gt;, &lt;aside&gt;), but also after the &lt;body&gt; element (called a &quot;sectioning root&quot;). 

Here are some examples:

<h4>Good (heading in each explicit section):</h4>

```
<section>
    <h1>Blog post of April 2020</h1>
    ...
</section>
```

<h4>Good (heading in a <header> does not change anything)</h4>

```
<section>
    <header>**
       <h1>Blog post of April 2020</h1>
       <p>Posted by Michel Buffa...</p>
  </header>
...
</section>
```

<h4>Bad (there is no Hx after the <section> - no heading):</h4>

```
<section>
    <header>
       <p class="article title">Blog post of April 2020</p>
       <p>Posted by Michel Buffa...</p>

    </header>
   ...
</section>
```

The last example is bad for accessibility reasons. A screen reader that vocalizes the page will just say &quot;Entering section&quot;, while in the previous two good examples it would say &quot;entering section with heading Blog Posts of April 2020&quot;. You can also check if your headings and sectioning elements are ok by using a browser extension that displays the outline of the document (just search for &quot;html5 outliner&quot; in your browser&apos;s extension search engine).

<b>UPDATE : </b>For the course screenshots, we used the Google Chrome HTML5 outliner extension that is no more available (it has been removed by its developer), but you can use any other equivalent extension such as [table-of-contents-crx](https://chrome.google.com/webstore/detail/table-of-contents-crx/eeknhipceeelbgdbcmchicoaoalfdnhi?hl=f) for Chrome or [Outline sidebar](https://addons.mozilla.org/fr/firefox/addon/outline-sidebar/?src=search) for Firefox.

The outline of the last example looks like this:

<!------------------------------------------------------------------------------------------------>
<!------------------------------ 27. outline of previous example --------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image027.jpeg?raw=true"
   alt="Outline of last example"
   width="55%">
&nbsp;
<br/>

Notice that &lt;body&gt; is also a sectioning element. It&apos;s called a &quot;sectioning root&quot;, and would also need a heading.

<h4>Final good version:</h4>

```
<body>
    <h1>Example Blog</h1>
    <section&gt;
       <header>
          <h2>Blog post of April 2020</h2>
          <p>Posted by Michel Buffa...</p>
       </header>
      <p>Content of the blog post...</p>
   </section>
</body>
```

In red, the sectioning root (&lt;body&gt;) and the sectioning elements (&lt;section&gt; here\...), each have a heading.

<h4>To sum up:</h4>

-   Always use a heading element after a sectioning</lement, for example &lt;section&gt;**&lt;Hx&gt;\...&lt;/Hx&gt;\...**&lt;/section&gt;, and after &lt;body&gt;, where **x** can be 1..6,

-   Or, use a &lt;header&gt; element, like in &lt;section&gt;**&lt;header&gt;&lt;Hx&gt;\...&lt;/Hx&gt;\.....&lt;/header&gt;**\...&lt;/section&gt;

<h4>More about the &lt;header&gt; element</h4>

<b>The &lt;header&gt; element is just a container. It is not taken into account for defining new sections of a document nor does it affect the hierarchy levels.</b>

You can use heading elements &lt;h1&gt;\...&lt;h6&gt; in a &lt;header&gt; but be careful if you use more than one, as the rules explained in the previous part of the course will apply and may generate implicit &quot;sections&quot; in the header.

This example has two headings in the &lt;header&gt;:

```
<section>
   <header>
     <h1>Some text in a h1 in a header of a section</h1>
     <h2>This a h2 in the header...</h2>
   </header>
</section>
```

Here is the resulting table of contents, notice the two subsections that appear, one for the H1, one for the H2:

<!------------------------------------------------------------------------------------------------>
<!------------------------------ 28. outline of previous example --------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image028.jpeg?raw=true"
   alt="Outline of previous example"
   width="55%">
&nbsp;
<br/>

Indeed, HTML does not have a dedicated mechanism for marking up subheadings, alternative titles or taglines. 

If you do not want the subtitles to be included in the table of contents, just use standard markup, for example &lt;p&gt; elements, as shown in the next example. Of course, CSS rules can be applied to change colors, sizes, etc.

```
<header>
    <h1>HTML 5.1 Nightly</h1>
    <p>A vocabulary and associated APIs for HTML and XHTML</p>
    <p>Editor's Draft 9 May 2013</p>
</header>
```

<b>Best practice #2</b>: try not to rely on implicit sectioning, use &lt;section&gt;, &lt;article&gt;, etc. instead of just &lt;h1&gt;\...&lt;h6&gt;

The example below defines several implicit &quot;sections&quot; by using &lt;Hx&gt; directly (at *lines 7 and 9*):

<h4>Ok version (no explicit sections everywhere):</h4>

```
<body>
<h4>Apples</h4>
<p>Apples are fruit.</p>
<section>
     <h2>Taste</h2>
     <p>They taste lovely.</p>
     <h6>Sweet</h6>
     <p>Red apples are sweeter than green ones.</p>
     <h1>Color</h1>
     <p>Apples come in various colors.</p>
</section>
</body>
```

<h4>Better version (best practice):</h4>

```
<body>
<h1>Apples</h1>
<p>Apples are fruit.</p>

<section>
      <h2>Taste</h2>
      <p>They taste lovely.</p>
      <section>
          <h3>Sweet</h3>
          <p>Red apples are sweeter than green ones.</p>
      </section>
 </section>
 <section>
      <h2>Color</h2>
      <p>Apples come in various colors.</p>
 </section>
 </body>
```

Both of the examples above are semantically identical and produce the same outline:

<!------------------------------------------------------------------------------------------------>
<!------------------------------ 29. outline of previous example --------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image029.jpeg?raw=true"
   alt="Outline of previous example"
   width="55%">
&nbsp;
<br/>

<h3>1.2.4 The HTML5 Logo</h3>

Here is the HTML5 logo! It has been [unveiled on 18 January 2011,](https://www.w3.org/blog/2011/01/an-html5-logo/) so way before HTML5 became a Web standard. This logo represents HTML5, the cornerstone for modern Web applications.

<!------------------------------------------------------------------------------------------------>
<!------------------------------------ 30. html5 logo (xx) --------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image030.png?raw=true"
   alt="HTML5 logo"
   width="15%">
&nbsp;
<br/>

<h3 id="ch1-3">1.3 New Structural Elements</h3>

Changes have been made to particular elements in HTML5 making it simpler to use. In this section, we will look at some examples highlighting these improvements, including:

-   the new doctype definition;

-   the fact that the &quot;type&quot; attribute of elements such as &lt;link&gt; or &lt;script&gt; are now optional;

-   the syntax constraints that have been relaxed;

-   the new structural elements that have been added, etc.

<h3>A minimal HTML5 document</h3>

```
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="utf-8">
    <title>Page Title&lt;/title>
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>
</head>
<body>
... <!-- The rest is content -->
</body>
</html>
```

Let&apos;s compare it to the HTML4 minimal document below (taken from [this source](https://www.sitepoint.com/a-minimal-html-document/)). Differences are underlined in red:

```
[<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "https://www.w3.org/TR/html4/strict.dtd">]
<html lang="en">
<head&gt;
     <meta http-equiv[="content-type&quot; ]content[="text/html"]charset="utf-8">
     <title>title</title>
     <link rel="stylesheet" type[="text/css"] href="style.css">
     <script type[="text/javascript"] src="script.js"></script>
 </head>
 <body>
...
</body>
</html>
```

<h4>Simpler character set definition</h4>

One word about the &lt;meta charset=&quot;utf-8&quot;&gt; at line 4 in the HTML5 version: it is a **best practice** to declare the character set of your document to protect against [a serious security risk](https://code.google.com/p/doctype-mirror/wiki/ArticleUtf7). For more details, please refer to the &quot;Why Internationalization is important&quot; section in the Course intro chapter.

<h4>No more complicated DOCTYPE definitions</h4>

The &quot;DOCTYPE&quot; (Document Type Declaration) is used by tools such as HTML validators (i.e.  [the W3C validator](https://validator.w3.org/)), and specifies the rules used by  an HTML or an XHTML page. These rules are contained in special documents called &quot;Document Type Definitions&quot; (also abbreviated as DTDs), written in a language that may seem a bit barbaric to humans (they are intended to be read by software), and hosted by W3C.

DTDs are not used by current Web browsers to  validate the structure of an HTML page, as  they &quot;read&quot; the code without using the DTD to decipher it, using only &quot;rules&quot; contained in their own &quot;HTML engine&quot;, but it is still preferable to indicate the doctype as modern browsers have several rendering engines that are chosen depending on the doctype.

Old HTML1 Web pages will not be rendered the same way as new HTML5 pages, since, in the 90&apos;s, some of them were written by hand and may contain errors, embedded HTML elements, etc.

With HTML4, doctype definitions looked like this:<br/>

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;https://www.w3.org/TR/html4/loose.dtd&quot;&gt;, which was even more complicated as one had to choose between three different possibilities (doctypes could be transitional, strict, or frameset). Most of the time, the doctype definition was copied and pasted from one document to another and was nearly impossible to memorize.

With HTML5, there is only one way to indicate the doctype, and it&apos;s so simple there is no reason to forget it:

1.  &lt;!doctype html&gt;

<h4>The "TYPE" attribute is optional</h4>

With a rel=&quot;stylesheet&quot; attribute, it is no longer necessary to indicate type=&quot;text/css&quot; (from [the specification](https://www.w3.org/TR/html5/links.html#link-type-stylesheet): &quot;the default type for resources given by the  [stylesheet](https://dev.w3.org/html5/spec/single-page.html#link-type-stylesheet)  keyword is text/css.&quot;)

The &quot;type&quot; attribute is not needed in HTML5, and even old browsers will use text/css as the default type for stylesheets today. So, either way, you can omit the &quot;type&quot; attribute altogether and use:

1.  &lt;link href=&quot;file.css&quot; rel=&quot;stylesheet&quot;/&gt;

instead of:

1.  &lt;link href=&quot;file.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;/&gt;

We will not go into detail about the &lt;link&gt; element, but the fact that the type attribute is becoming optional shows the current direction taken by HTML5: towards greater simplicity.

Please see how to include a JavaScript file in our page:

1.  &lt;script src=&quot;script.js&quot;&gt;&lt;/script&gt;

Here again, the type attribute has been omitted. Just as a reminder, the old way to do the same thing is: 

1.  &lt;script type=&quot;text/javascript&quot; src=&quot;script.js&quot;&gt;&lt;/script&gt;

<h3>More flexible syntax constraints</h3>

If you look at the &quot;minimal document&quot; example, or at other examples in this course, you won&&lbra;t find a lot of differences compared to the same code in XHTML: attribute values are surrounded by quotes, all elements are written in lower case, etc. This is because we are used to writing this way, but HTML5 also supports a simplified syntax:

-   Thanks to HTML5, you can omit quotes (not always, but most of the time) or use uppercase, lowercase or a combination of the two.

-   Many elements no longer need a closing tag: &lt;/li&gt;, &lt;/dt&gt;, &lt;/dd&gt;, &lt;/tr&gt;, &lt;/th&gt;, &lt;/td&gt;, &lt;/thead&gt;, &lt;/tfoot&gt;, &lt;/tbody&gt;, &lt;/option&gt;, &lt;/optgroup&gt;, &lt;/p&gt; (in most cases), &lt;/head&gt;, &lt;/body&gt; and &lt;/html&gt;. Older browsers often add closing tags automatically at render time. We recommend, however, closing tags that would naturally be closed: the ones that delimit a particular zone in the document.

-   Attribute values only need to be quoted if they contain spaces or some non-alphanumeric characters, instead of writing &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;, we could have used &lt;link rel=stylesheet href=style.css&gt;. However, for compatibility with older browsers, it is wiser to still use quotes\...

<h3>1.3.2 Structural Elements</h3>

<h3>New structural elements</h3>

<!------------------------------------------------------------------------------------------------>
<!------------- 13. some of the new structural elements introducted by html5 (xx) ---------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image013.jpeg?raw=true"
   alt="Some of the new structural elements introduced by HTML5: section, article, etc."
   width="65%" />
&nbsp;
<br/>

<h4>History</h4>

As Web site layouts evolve, HTML5 structural elements such as lists, paragraphs, tables, etc. show their limits. Today, many Web sites offer navigation menus, tabbed panels, headers, footers, and so on. The way these &quot;parts&quot;&apos; are implemented relies heavily on &lt;div&gt; and &lt;span&gt; elements with different id and class attributes, lots of CSS and lots of JavaScript code to apply custom styles and behaviors.

However, there are some issues with this approach:
<ul>
<li>id and class names differ from one developer to another, from one country to another, etc.</li><br/>
<li>Even with the same ids and class names, the css rules may be different.</li><br/>
<li>JavaScript libraries have become increasingly heavy over the years.</li><br/>
<li>Web pages have become increasingly heavy over the years!</li><br/>
<li>These elements can not be handled by the Web browser natively\...</li><br/>
</ul>

Even if differences exist between ids, classes and css/js implementations, they also share common behaviors, layouts, and &quot;ways of doing things&quot; that could be guessed at first glance by a human.

So various studies have been conducted in order to identify the most popular ids, class names, widgets, etc. used on the Web:

Quoting from this <a href="https://dev.opera.com/articles/new-structural-elements-in-html5/">article:</a> &quot;During the creation of HTML5, Ian Hickson used Google&apos;s tools to mine data from over a billion Web pages, surveying what ids and class names are most commonly used on the real world Web. Opera did a similar study of 3.5 million URLs, calling it MAMA (&quot;Metadata Analysis and Mining Application&quot;). MAMA, as structural Web-paged search engine, had a smaller URL set, but looked at a larger and wider variety of Web page statistics&quot;.

<h4>New elements added to the HTML5 set</h4>

The results of these surveys led to the addition of new structural elements in HTML5. For example, the very popular &lt;div class=&quot;header&quot;&gt; led to the creation of a &lt;header&gt; element, &lt;div class=&quot;aside&quot;&gt; to a &lt;aside&gt; element, etc.

Finally, the 20 most popular ids and class names found in Hickson&apos;s and Opera&apos;s surveys gave birth to these new elements (click on the element&apos;s name to go to the W3C specification about this element):

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  HTML5 structural elements with descriptions.                                                                                                                                                
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  HTML5 element                                                                                                                                                                               Description

  [**&lt;header&gt;**](https://www.w3.org/TR/html5/sections.html#the-header-element)                                                                                                              Introduction of &quot;sectioning elements&quot;: an article, a section, the entire document (header page). Typically the header of a Web site that appears on top of each page, or a header of a long &lt;article&gt; or of a long &lt;section&gt;

  [**&lt;footer&gt;**](https://www.w3.org/TR/html5/sections.html#the-footer-element)                                                                                                              Contains the footer of a site, a long &lt;article&gt;, or a long &lt;section&gt;

  [**&lt;nav&gt;**](https://www.w3.org/TR/html5/sections.html#the-nav-element)                                                                                                                    Section that contains the main navigation links (within the document or to other pages).

  [**&lt;article&gt;**](https://www.w3.org/TR/html5/sections.html#the-article-element)                                                                                                            Independent content, which can be individually extracted from the document and syndicated (RSS or equivalent) without penalizing its understanding. Typically a blog post.

  [**&lt;section&gt;**](https://www.w3.org/TR/html5/sections.html#the-section-element)                                                                                                            Generic section used to group different articles for different purposes or subjects, or to define the different sections of a single article. Generally used with a header.

  [**&lt;time&gt;**](https://www.w3.org/TR/html5/text-level-semantics.html#the-time-element)                                                                                                      Used for marking up times and dates.

  [**&lt;aside&gt;**](https://www.w3.org/TR/html5/sections.html#the-aside-element)                                                                                                                Section whose content is not necessarily directly related to the main content that surrounds it, but can provide additional information.

  [**&lt;figure&gt;**](https://www.w3.org/TR/html5/grouping-content.html#the-figure-element) and [**&lt;figcaption&gt;**](https://www.w3.org/TR/html5/grouping-content.html#the-figcaption-element)   Used to encapsulate a figure as a single item, and contains a caption for the figure, respectively.

  [**&lt;main&gt;**](https://www.w3.org/TR/html5/sections.html#the-aside-element)                                                                                                                 The main element represents the main content of the body of a document or application. The main content area consists of content that is directly related to or expands upon the central topic of a document or central functionality of an application. **There can be only one &lt;main&gt; element in a document.**
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

And there is no &lt;content&gt; element even though the &lt;div class=&quot;content&quot;&gt; was very popular. Instead, the HTML5 group decided that anything not embedded in one of the elements from the above table is &quot;default content&quot;. If the content is of a type that corresponds to one of the elements from the table, i.e. if the content is an article, it should be embedded between &lt;article&gt; and &lt;/article&gt;.

Read also at the end of this section about the new &lt;main&gt; element .  This element is [part of the HTML5 recommendation](https://www.w3.org/TR/html5/grouping-content.html#the-main-element) and  an integral part of the HTML document structure.

<h3>External resources:</h3>

-   A Smashing Magazine article: [Structural Semantics: The Importance Of HTML5 Sectioning Elements](https://coding.smashingmagazine.com/2013/01/18/the-importance-of-sections/)

-   A Dev. Opera article: [New Structural Elements in HTML5](https://dev.opera.com/articles/new-structural-elements-in-html5/)

<h3>1.3.3 Mixing All Elements Together: A Blog Example</h3>

<h3>A blog example that uses the structural elements</h3>

Let&apos;s study [an example we put on JsBin](https://jsbin.com/bucokav/edit?html,output) (all examples we have cooked up are available on the jsbin.com Web site and can be modified freely: you can save your own version using the &quot;Bins/create milestone&quot; menu, share your version with others in the forums, etc. Don&apos;t  hesitate to play with the source code, you will never break anything).

<h4>Use a &lt;header&gt; at the top of the blog</h4>

<!------------------------------------------------------------------------------------------------>
<!---------------- 14. image of the header element at the top of the blog (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image014.jpeg?raw=true"
   alt="image of the header element at the top of the blog"
   width="35%" />
&nbsp;
<br/>

This is an example of one way to organize a blog. Here, we have designed the HTML page using a &lt;header&gt; element that contains the &quot;Simple HTML5 blog&quot; text that appears on top of the page.

<h4>HTML code:</h4>

```
<!DOCTYPE html>
   <html lang="en">
      <head>
         <meta charset="utf-8"/>
         <title>Simple HTML5 blog</title>
      </head>
      <body>
         <header>
            <h1>Simple <span>HTML5</span> blog</h1>
         </header>
...
```

<h4>The CSS rules we used:</h4>

```
header {
    color: #007e99;
    font-size: 2.5em;
    padding: 20px 50px
}
header span {
    color: #722
}
```

<h4>Use a &lt;nav&gt; for the navigation menu just below the header</h4>

<!------------------------------------------------------------------------------------------------>
<!---------------- 15. image of the navigation menu (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image015.jpeg?raw=true"
   alt="image of the navigation menu"
   width="35%" />
&nbsp;
<br/>

The navigation menu just below the header is a &lt;nav&gt; element. For the purpose of this example we haven&apos;t provided any value for the hyperlinks\...

<h4>HTML code:</h4>

```
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="utf-8"/>
   <title>Simple HTML5 blog</title>
</head>
<body>
<header>
   <h1>Simple <span>HTML5</span> blog</h1>
</header>
<nav>
    <ul>
       <li><span>Blog</span></li>
       <li><a href="">About</a></li>
       <li><a href="">Contact</a></li>
    </ul>
</nav>
```

<h4>And here is the CSS we used in this example for the &lt;nav&gt; element:</h4>

```
nav {
    font-size: 1.5em;
    margin: 5px 0;
    padding: 20px 50px
}
nav li {
    display: inline;
    margin: 0 15px
}
nav li:first-child {
    margin-left: 0
}
* html nav ul {
    margin-left: -15px
}
nav span, nav a {
    padding: 3px 15px 4px
}
nav span {
    background: #722;
    color: #fff
}
```

<h4>A &lt;section&gt; for each month and an &lt;article&gt; for each post in the blog</h4>

Now, we have one big &lt;section&gt; element that contains a set of &lt;article&gt; elements\...

<!------------------------------------------------------------------------------------------------>
<!---------------- 16. image of sections that contain articles (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image016.jpeg?raw=true"
   alt="image of sections that contain articles"
   width="65%" />
&nbsp;
<br/>

<h4>HTML code:</h4>

```
> <section>
>    <article>
>     ...
>    </article>
>    <article>
>     ...
>    </article>
>    <article>
>     ...
>    </article>
> </section>
```

**And here is the CSS:**

```
> section {
>    float: left;
>    padding: 35px 0;
>    position: relative;
>    width: 70%
> }
> section article {
>    margin: 0 50px 40px;
>    padding: 25px 0 0;
>    position: relative
> }
> section header {
>    font-size: 1em;
>    padding: 0;
> }
> section h2 {
>    font-size: 2.3em;
> }
```

Note that the H2, article, article header, etc. will be styled using these rules.

<h4>Add a &lt;header&gt; at the beginning of each &lt;article&gt;</h4>

<!------------------------------------------------------------------------------------------------>
<!---------------- 17. image of the header at the top of each article (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image017.jpeg?raw=true"
   alt="image of the header at the top of each article"
   width="65%" />
&nbsp;
<br/>

Next, in each article in the section we have a header (to display the article title), paragraphs (article content), and so on.

Example for the first blog article:

```
<section>
   <article>
     <header>
         <h2><a href="">Information about this example</a></h2>
     </header>
     <p>Try to move the mouse on different elements. The structure will be
     highlighted and you will be able
     to see the different inclusions of elements one in each other. If you
     move the cursor to this sentence, it will be highlighted in dark grey,
     showing the presence of an &lt;article&gt; element, surrounded by a
     &lt;section&gt; element (light grey), etc. So we have some articles in
     a single section element. The page title at the top is a &lt;header&gt;
     element, while the tag cloud on the right is a &lt;aside&gt; element. The
     main menu on top (with Blog, About, Contact) is a &lt;nav&gt; element.</p>
     <figure>
         <img src="HTML5-tags.png"
             alt="Example of HTML5 structural tags" />
         <figcaption>
             Fig. 1 : an example of how new structural elements could
             be used. This page put a &lt;nav&gt; on top, and does not have
             headers and footer for each article, like in this figure,
             but it could... By the way this is a
             &lt;figcaption&gt; inside a &lt;figure&gt; element...
         </figcaption>
    </figure>
   </article>
   ...
</section>
```

#### Use &lt;figure&gt; and &lt;figcaption&gt; and embed &lt;img&gt; inside

Also note the way we included a figure using the new &quot;HTML5&quot; method, using a &lt;figure&gt;..&lt;/figure&gt; element that embedded a &lt;img src=\.../&gt; element together with a &lt;figcaption&gt; element. 

<!------------------------------------------------------------------------------------------------>
<!---------------- 18. image of figure and figcaption that embed an img (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image018.jpeg?raw=true"
   alt="image of figure and figcaption that embed an img"
   width="65%" />
&nbsp;
<br/>

Here is the CSS for the &lt;figcaption&gt; element we have used in the example (we did not apply any style to the &lt;figure&gt; element):

<h4>HTML code:</h4>

```
<figure>
    <img src="HTML5-tags.png"
         alt="Example of HTML5 structural tags" />
    <figcaption>
        Fig. 1 : an example of how .....
    </figcaption>
</figure>
```

<h4>CSS code:</h4>

```
figcaption {
    font-style:italic;
    font-size: 0.8em;
    width: 100%
}
```

#### Use an &lt;aside&gt; element to display a tag cloud on the\... side of the main content

After the long &lt;section&gt; element that contains all the blog articles displayed in the page, we added the HTML code for the tag cloud that is displayed on the right of the page, &quot;aside&quot;! This is done using - you already guessed it - an &lt;aside&gt; element:

<!------------------------------------------------------------------------------------------------>
<!---------------- 19. image of the tag cloud defined as an aside element (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image019.jpeg?raw=true"
   alt="image of the tag cloud defined as an aside element"
   width="25%" />
&nbsp;
<br/>

```
<section>
.... all <article>... </article> here....
</section>
<aside>
   <h2>Tag cloud</h2>
   <ul class="tag-cloud">
       <li><a href="" rel="tag" class="w2">ajax</a></li>
       <li><a href="" rel="tag" class="w8">apple</a></li>
       <li><a href="" rel="tag" class="w3">css</a></li>
       ...
   </ul>
</aside>
...
```

We are not going to show the complete CSS here as it uses some tricks to display the list as a &quot;real tag cloud&quot; that uses JavaScript for handling events, etc. Those who are curious can look at [the code of the online example](https://jsbin.com/bucokav/edit?html,output).

**Here is the CSS for the &lt;aside&gt; element:**

```
aside {
    float: right;
    padding: 70px 0 30px;
    position: relative;
    width: 25%
}
aside h2 {
    color: #888;
    font-size: 1.8em
}
aside .tag-cloud {
    padding: 15px 35px 10px 0;
    text-align: center
}
...
```

We used a float:right CSS rule to put the tag cloud on the right\... In a following section we will provide several examples that explain how to make a nice layout with the new structural elements, using simple CSS rules.

###### **Here is the result:**

<!------------------------------------------------------------------------------------------------>
<!---------------- 19. image of the tag cloud defined as an aside element (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image019.jpeg?raw=true"
   alt="image of the tag cloud defined as an aside element"
   width="25%" />
&nbsp;
<br/>
![The aside tag cloud on the right](./images/image020.jpeg){width="5.0in" height="1.6762817147856517in"}

#### Add a &lt;footer&gt; at the end of the blog

<!------------------------------------------------------------------------------------------------>
<!---------------- 19. image of the tag cloud defined as an aside element (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image019.jpeg?raw=true"
   alt="image of the tag cloud defined as an aside element"
   width="25%" />
&nbsp;
<br/>
![image of the blog footer](./images/image021.jpeg){width="2.1875in" height="0.7916666666666666in"}

###### Finally, we added a &lt;footer&gt; element (*lines 12-14* below) after the tag cloud definition, to display a page footer:

```
<html>
...
<body>
...
<section>
...
</section>
<aside>
...
</aside>
<footer>
   <p>&copy; 2009 Some blog</p>
</footer>
</body>
</html>
```

<h4>With this CSS rule:</h4>

```
footer {
    clear: both;
    color: #777;
    padding: 10px 50px
}
```

###### **And here is the result at the bottom of the page:**

<!------------------------------------------------------------------------------------------------>
<!---------------- 19. image of the tag cloud defined as an aside element (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image019.jpeg?raw=true"
   alt="image of the tag cloud defined as an aside element"
   width="25%" />
&nbsp;
<br/>

![The resulting footer at the bottom of the page](./images/image022.jpeg){width="5.0in" height="1.757425634295713in"}

<h3>1.3.4 More on &lt;article&gt; and &lt;section&gt;</h3>

<h4>Can an &lt;article&gt; contain a &lt;section&gt;?</h4>

<!------------------------------------------------------------------------------------------------>
<!---------------- xx.  (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/imagexx.jpeg?raw=true"
   alt=""
   width="25%" />
&nbsp;
<br/>

<!------------------------------------------------------------------------------------------------>
<!---------------- xx.  (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/imagexx.jpeg?raw=true"
   alt=""
   width="25%" />
&nbsp;
<br/>

![Picture of &apos;eisher&apos; hands](./images/image023.jpeg){width="2.4270833333333335in" height="1.3333333333333333in"}

It may not be clear whether a &lt;section&gt; may contain one or several &lt;article&gt; elements or if an &lt;article&gt; may contain one or several &lt;section&gt; elements.

-   The &lt;article&gt; element was designed for stand-alone parts of a document that could eventually be syndicated in RSS streams.

-   &lt;section&gt; elements are used to cut a logical part into subparts.

**An &lt;article&gt; may be cut into different &lt;section&gt; elements!**

###### Example of a blog post defined as a long &lt;article&gt;, that is in turn cut into smaller &lt;section&gt; elements:

```
<article id="id1">
   <section id="id1part1">
     <h2>Introduction</h2>
   </section&gt;
   <section id="id1part2">
     <h2>My travel to India</h2>
   </section>
   <section id="id1part3">
     <h2>Return to France</h2>
   </section>
</article>
```

The blog example from the previous part of the course, on the other hand, uses a single &lt;section&gt; that contains several &lt;article&gt; elements.

Indeed, we can also have a &lt;section&gt; that regroups all blog posts per month, each one being an &lt;article&gt; element.

<h4>A &lt;section&gt; may be cut into different &lt;article&gt; elements, too!</h4>

<h3>Can you put a &lt;nav&gt; in an &lt;article&gt;?</h3>

Yes, you can, in case you would like to propose some navigation links with each blog post, for example:

```
<article>
   <header>
     <h1>Blog post title</h1>
       <p>Author: Michel</p>
   </header>
   <nav>
       <ul>
           <li><a href="...">Next post</a></li>
           <li><a href="...">Previous post</a></li>
           <li><a href="...">Contact author</a></li>
       </ul>
   </nav>
   <p&gt;Content...</p>
   <footer>
     <p>Posted by Michel, the <time datetime="2012-02-02">February 2,
     2012</time> </p>
   </footer>
</article>
```

In that case, the &lt;nav&gt; element proposes navigation links to the next or previous blog post, as well as a link to contact the author of the blog post.

Also note that we used in that example a &lt;footer&gt; element in the blog post.

### What about the &lt;div&gt; element? Is it still useful?

The new elements have been primarily designed to better structure the code of HTML pages such as those generated by blog or CMS software, however do not forget that they add new semantics and will be taken into account by :

-   Browsers natively or browsers&apos; extensions, i.e. for automatically generating a table of contents, an outline view of the document, for applying default CSS rules to these elements, etc. See for example the [table-of-contents-crx extension](https://chrome.google.com/webstore/detail/table-of-contents-crx/eeknhipceeelbgdbcmchicoaoalfdnhi?hl=f) (Chrome extension). More on that in the next section of the course.

-   Text to speech: https://www.w3.org/WAI/perspective-videos/speech/

-   Web crawlers, etc.

You can use &lt;div&gt; elements in all cases where the proposed structural elements do not fit your needs: for defining some content that should be styled, for example.

This chart from the [HTML5 Doctor Web site](https://html5doctor.com/) may help you decide whether or not to use a &lt;div&gt;:

<!------------------------------------------------------------------------------------------------>
<!---------------- xx.  (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/imagexx.jpeg?raw=true"
   alt=""
   width="25%" />
&nbsp;
<br/>

![flow chart about using header, H1, etc.](./images/image024.png){width="6.5in" height="4.600694444444445in"}

### 1.3.5 Headings and Structural Elements

We will now present some best practices for starting to use &lt;section&gt;, &lt;article&gt;, &lt;nav&gt;, &lt;aside&gt;, in particular concerning the use of headings (h1, h2, h3, h4, h5 and h6).

### Use &lt;h1&gt;\...&lt;h6&gt; for the headings

Since the very beginning, HTML has had heading elements: &lt;h1&gt;\...&lt;h6&gt;. These elements are used to display headings with different sizes by default, when no CSS is used.  The following example shows 6 sentences that are surrounded by &lt;h1&gt;, &lt;h2&gt;, &lt;h3&gt;, &lt;h4&gt;, &lt;h5&gt; and &lt;h6&gt;:

# This is a H1 heading

## This is a H2 heading

### This is a H3 heading

#### This is a H4 heading

##### This is a H5 heading

###### This is a H6 heading

These headings define a hierarchy, as shown by the default sizes given by the browser. This hierarchy can also be used to define *an outline of the document*. To illustrate this, we have used a browser extension. Here is the result for the previous example:
<!------------------------------------------------------------------------------------------------>
<!---------------- xx.  (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/imagexx.jpeg?raw=true"
   alt=""
   width="25%" />
&nbsp;
<br/>

![outliner in action from the previous example](./images/image025.png){width="6.5in" height="3.5097222222222224in"}

In the above outline, note that we have only used H1\... H6 elements, without any new HTML5 structural elements such as &lt;section&gt; or &lt;article&gt;.

Here is a list of browser extensions you can try, for visualizing the outline of a document: [table-of-contents-crx](https://chrome.google.com/webstore/detail/table-of-contents-crx/eeknhipceeelbgdbcmchicoaoalfdnhi?hl=f) Chrome extension or [this Firefox extension](https://addons.mozilla.org/fr/firefox/addon/outline-sidebar/?src=search).

### Using headings and new sectioning elements (section, article, aside, nav)

#### Definition of heading content and sectioning content

The &lt;section&gt;, &lt;article&gt;, &lt;nav&gt; and &lt;aside&gt; elements are called **&quot;sectioning elements&quot;**. They cut a document into slices we call** &quot;sections&quot;.**

The HTML5 specification says that &quot;each sectioning element potentially has a heading and has also an outline associated&quot;.

&lt;h1&gt;\...&lt;h6&gt; are called **headings**, and define the header of a section (whether explicitly marked up using sectioning content elements, or implied by the heading content itself). This means that:

> <body>
>     <h1>Title of my document</h1>
>     ...
> </body>
> ... defines the header of a section *implicitly*, while:
> <body>
>    ...
>    <section>
>       <h1>Title of my section</h1>
>       ...
>    </section>
> </body>
```

###### \... defines the heading of *the explicit section* (its parent element &lt;section&gt;).

### Use multiple headings of different rank with sectioning content

The first element of a heading content in an element of sectioning content represents the heading for that section (the &lt;section&gt;&lt;h1&gt;\...&lt;/h1&gt;&lt;/section&gt; in the above example).

Subsequent headings of equal or higher rank start new (implied) sections, headings of lower rank start implied subsections that are part of the previous one. In both cases, the element represents the heading of the implied section.

###### Let&apos;s clarify this by looking at some example code:

###### &lt;body&gt;

###### &lt;section&gt;

######     &lt;h1&gt;This H1 is the heading of an explicit section&lt;/h1&gt;

######     \...

######        &lt;h2&gt;This H2 is a subheading, part of the same section

######            (lower rank)&lt;/h2&gt;

######             \....

######     &lt;h1&gt;This H1 starts an implicit new section in the explicit

######         section (equal or higher rank)&lt;/h1&gt;

######         \...

######         &lt;h2&gt;This is a H2 heading in the new section that has

######             just started&lt;/h2&gt;

######             \...

###### &lt;/section&gt;

###### &lt;/body&gt;

###### The corresponding outline is:
<!------------------------------------------------------------------------------------------------>
<!---------------- xx.  (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/imagexx.jpeg?raw=true"
   alt=""
   width="25%" />
&nbsp;
<br/>

![outline of previous example](./images/image026.jpeg){width="6.0in" height="2.6333333333333333in"}

In the above example, please note two things:

1.  The outline shows an &quot;Untitled body&quot; at the root of the hierarchy,

2.  The default size for the H1 and H2 is the same (!). Indeed, when we start a &lt;h1&gt; inside a &lt;section&gt; the browser lowers its default size automatically, as if a new hierarchy level has been added artificially. We will discuss this further in the following sections, as we introduce some best practices.

### 1.3.6 Best Practices When Using Sectioning Elements

### **Best practice #1**: always add a heading to explicit sectioning content

It&apos;s always better - mainly for accessibility reasons - to include a heading (a &lt;h1&gt;, &lt;h2&gt;\...&lt;h6&gt;) in each sectioning element (&lt;section&gt;, &lt;article&gt;, &lt;nav&gt;, &lt;aside&gt;), but also after the &lt;body&gt; element (called a &quot;sectioning root&quot;). 

Here are some examples:

**Good (heading in each explicit section):**

```
####### &lt;section&gt;
#######     &lt;h1&gt;Blog post of April 2020&lt;/h1&gt;
#######     \...
####### &lt;/section&gt;
**Good (heading  in a &lt;header&gt; does not change anything)**
####### &lt;section&gt;
#######    **&lt;header&gt;**
#######       **&lt;h1&gt;Blog post of April 2020&lt;/h1&gt;**
#######       **&lt;p&gt;Posted by Michel Buffa\...&lt;/p&gt;**
#######    **&lt;/header&gt;**
####### \...
####### &lt;/section&gt;
```
**Bad (there is no Hx after the &lt;section&gt; -&gt; no heading):**

```
####### <section>
#######    <header>
#######       <p class="article title">Blog post of April 2020</p>
#######       <p>Posted by Michel Buffa...</p>
#######    </header>
#######    ...
####### </section>
```

The last example is bad for accessibility reasons. A screen reader that vocalizes the page will just say &quot;Entering section&quot;, while in the previous two good examples it would say &quot;entering section with heading Blog Posts of April 2020&quot;. You can also check if your headings and sectioning elements are ok by using a browser extension that displays the outline of the document (just search for &quot;html5 outliner&quot; in your browser&apos;s extension search engine).

**UPDATE : **For the course screenshots, we used the Google Chrome HTML5 outliner extension that is no more available (it has been removed by its developer), but you can use any other equivalent extension such as [table-of-contents-crx](https://chrome.google.com/webstore/detail/table-of-contents-crx/eeknhipceeelbgdbcmchicoaoalfdnhi?hl=f) for Chrome or [Outline sidebar](https://addons.mozilla.org/fr/firefox/addon/outline-sidebar/?src=search) for Firefox.

The outline of the last example looks like this:
<!------------------------------------------------------------------------------------------------>
<!---------------- xx.  (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/imagexx.jpeg?raw=true"
   alt=""
   width="25%" />
&nbsp;
<br/>

![outline of last example](./images/image027.jpeg){width="6.5in" height="2.3006944444444444in"}

Notice that &lt;body&gt; is also a sectioning element. It&apos;s called a &quot;sectioning root&quot;, and would also need a heading.

**Final good version:**

```
> <body>
>     **<h1>Example Blog</h1>**
>     <section>
>        <header>
>           **<h2>Blog post of April 2020</h2>**
>           <p>Posted by Michel Buffa...</p>
>        </header>
>       <p>Content of the blog post...</p>
>    </section>
> </body>
```

In red, the sectioning root (&lt;body&gt;) and the sectioning elements (&lt;section&gt; here\...), each have a heading.

**To sum up:**

-   Always use a heading element after a sectioning element, for example &lt;section&gt;**&lt;Hx&gt;\...&lt;/Hx&gt;\...**&lt;/section&gt;, and after &lt;body&gt;, where **x** can be 1..6,

-   Or, use a &lt;header&gt; element, like in &lt;section&gt;**&lt;header&gt;&lt;Hx&gt;\...&lt;/Hx&gt;\.....&lt;/header&gt;**\...&lt;/section&gt;

#### More about the &lt;header&gt; element

The &lt;header&gt; element is just a container. It is not taken into account for defining new sections of a document nor does it affect the hierarchy levels. 

You can use heading elements &lt;h1&gt;\...&lt;h6&gt; in a &lt;header&gt; but be careful if you use more than one, as the rules explained in the previous part of the course will apply and may generate implicit &quot;sections&quot; in the header.

This example has two headings in the &lt;header&gt;:

```
1.  <section>
2.     <header>
3.       <h1>Some text in a h1 in a header of a section</h1>
4.       <h2>This a h2 in the header...</h2>
5.     </header>
6.  </section>
```

Here is the resulting table of contents, notice the two subsections that appear, one for the H1, one for the H2:

<!------------------------------------------------------------------------------------------------>
<!------------------------------ 28. example structural elements --------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image028.jpeg?raw=true"
   alt=""
   width="55%">
&nbsp;
<br/>

Indeed, HTML does not have a dedicated mechanism for marking up subheadings, alternative titles or taglines. 

If you do not want the subtitles to be included in the table of contents, just use standard markup, for example &lt;p&gt; elements, as shown in the next example. Of course, CSS rules can be applied to change colors, sizes, etc.

```
1.  <header>
2.      <h1>HTML 5.1 Nightly</h1>
3.      <p>A vocabulary and associated APIs for HTML and XHTML</p>
4.      <p>Editor's Draft 9 May 2013</p>
5.  </header>
```

### **Best practice #2**: try not to rely on implicit sectioning, use &lt;section&gt;, &lt;article&gt;, etc. instead of just &lt;h1&gt;\...&lt;h6&gt;

The example below defines several implicit &quot;sections&quot; by using &lt;Hx&gt; directly (at *lines 7 and 9*):

<h4>Ok version (no explicit sections everywhere):</h4>

```
1.  <body>
2.  **<h4>Apples</h4>**
3.  <p>Apples are fruit.</p>
4.  <section>
5.       <h2>Taste</h2>
6.       <p>They taste lovely.</p>
7.       <h6>Sweet<h6>
8.       <p>Red apples are sweeter than green ones.</p&gt;
9.       **<h1>Color</h1>**
10.      <p>Apples come in various colors.</p>
11. </section>
12. </body>
```

<b>Better version (best practice):</b>

```
1.  <body>
2.  <h1>Apples</h1>
3.  <p>Apples are fruit.</p>
4.  <section>
5.       <h2>Taste</h2>
6.       <p>They taste lovely.</p>
7.       <section>
8.           <h3>Sweet</h3>
9.           <p>Red apples are sweeter than green ones.</p>
10.      </section>
11. </section>
12. <section>
13.      <h2>Color</h2>
14.      <p>Apples come in various colors.</p>
15. </section>
16. </body>
```

Both of the examples above are semantically identical and produce the same outline:

<!------------------------------------------------------------------------------------------------>
<!-------------------------------- 29. outline of previous examples ------------------------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image029.jpeg?raw=true"
   alt="CodePen logo"
   width="45%">
&nbsp;
<br/>

<h3 id="ch1-3-7">1.3.7 Embedding a Table of Contents

Here we propose a small piece of JavaScript code you can use in your documents to display an embedded table of contents. 

This example is a simple document, with a hyperlink that, once clicked, displays the table of contents in an &lt;aside&gt; element in the main &lt;section&gt;. Just look at the source code and copy/paste the link into your own HTML documents.

[Online example at JsBin](https://jsbin.com/tolagec/1/edit?html,css,js,output).

<h4>Extract of source code:</h4>

```
1.  <body>
2.  <h1>This is an example of embedded table of content</h1>
3.  <section>
4.       <header>
5.           <h1>First section of the document (this is a h1)</h1>
6.           This is a subheading...
7.       </header>
8.       <h2>First subsection of the first section (a h2)</h2>
9.       <p>Blah Blah...</p>
10.  </section>
11. <section>
12.      <h1>Second section of the document (a h1)</h1>
13.      <h2>First subsection (a h2)</h2>
14. </section>
15. <aside>
16.      <h3>Table of contents</h3>
17.      **<a href="javascript:(function(){...})();"**
18. **        title="TableDeMatiere">**
19. **        Click here to display the table of contents!**
20. **     </a>**
21. </aside>
22. </body>
```

**Best practice**: visualizing the table of contents is useful for debugging the structure of your page, and checking the presence of headings after sectioning content.

Indeed, tools that generate the table of contents are a good way to debug the structure of your page. Is the hierarchy correct? Is it what I wanted when I designed my page?

They are also useful for checking the presence of headings in each sectioning content. If some headings are missing, the table of contents will display some &quot;untitled entries&quot;. Remember that having a heading after each sectioning content is a good practice in terms of accessibility.

### 1.3.8 The &lt;main&gt; Element

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 31. (##) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image031.jpeg?raw=true"
   alt="Main Element Funny"
   width="25%" />
</p>

If you use &lt;nav&gt; / &lt;header&gt; / &lt;footer&gt; etc. to structure your document, you can also use &lt;main&gt; to identify the main content of the document. Doing so provides a navigable document structure for assistive technology users as well as styling hooks for devs.

We have seen the different sectioning elements of HTML5, so why didn&apos;t we talk about the &lt;main&gt; element earlier in this part of the course? Shouldn&apos;t  &lt;main&gt;\...&lt;/main&gt; be used in place of  &lt;div class=&quot;main&quot;&gt;\...&lt;/div&gt;?

The &lt;main&gt; element is supported by major modern browsers (see the corresponding [support table](https://caniuse.com/#feat=mdn-html_elements_main) on CanIUse and [MDN&apos;s brower compatibility page](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/main#Browser_compatibility)).

This element is subject to some constraints:

-   There must not be more than one &lt;main&gt; element in a document,

-   It must not be a descendant of an &lt;article&gt;,&lt;aside&gt;, &lt;footer&gt;, &lt;header&gt;, or &lt;nav&gt; element.

And finally, here are some examples (from [the HTML5 specification](https://www.w3.org/TR/html5/grouping-content.html#the-main-element))  that mix the &lt;main&gt; element with the other sectioning elements already seen in the course:

```
1.  &lt;!\-- other content \--&gt;
2.  
3.  &lt;main&gt;
4.  
5.     &lt;h1&gt;Skateboards&lt;/h1&gt;
6.     &lt;p&gt;The skateboard helps kids to get around.&lt;/p&gt;
7.  
8.     &lt;article&gt;
9.        &lt;h2&gt;Longboards&lt;/h2&gt;
10.       &lt;p&gt;Longboards are a type of skateboard with a longer
11. wheelbase and larger, softer wheels.&lt;/p&gt;
12.       &lt;p&gt;\... &lt;/p&gt;
13.       &lt;p&gt;\... &lt;/p&gt;
14.    &lt;/article&gt;
15. 
16.    &lt;article&gt;
17.       &lt;h2&gt;Electric Skateboards&lt;/h2&gt;
18.       &lt;p&gt;These no longer require the propelling of the skateboard by means of the feet; rather an electric motor propels the board, fed by an electric battery.&lt;/p&gt;
19.       &lt;p&gt;\... &lt;/p&gt;
20.       &lt;p&gt;\... &lt;/p&gt;
21.    &lt;/article&gt;
22. 
23. &lt;/main&gt;
24.  
25. &lt;!\-- other content \--&gt;
```

Here is another example (also from the specification). Here the &lt;main&gt; element contains a &lt;nav&gt; element consisting of links to subsections of the main content:

1.  &lt;!DOCTYPE html&gt;
2.     &lt;html lang=&quot;en&quot;&gt;
3.        &lt;head&gt;
4.           &lt;meta charset=&quot;utf-8&quot;/&gt;
5.           &lt;title&gt;Graduation Ceremony Summer 2022&lt;/title&gt;
6.        &lt;/head&gt;
7.        &lt;body&gt;
8.         &lt;header&gt;The Lawson Academy:
9.           &lt;nav&gt;
10.             &lt;h2&gt;Click these links to navigate\...&lt;/h2&gt;
11.             &lt;ul&gt;
12.                &lt;li&gt;&lt;a href=&quot;courses.html&quot;&gt;Courses&lt;/a&gt;&lt;/li&gt;
13.                &lt;li&gt;&lt;a href=&quot;fees.html&quot;&gt;Fees&lt;/a&gt;&lt;/li&gt;
14.                &lt;li&gt;&lt;a&gt;Graduation&lt;/a&gt;&lt;/li&gt;
15.             &lt;/ul&gt;
16.          &lt;/nav&gt;
17.       &lt;/header&gt;
18.       &lt;main&gt;
19.          &lt;h1&gt;Graduation&lt;/h1&gt;
20.          &lt;nav&gt;
21.             &lt;h2&gt;Please choose:&lt;/h2&gt;
22.             &lt;ul&gt;
23.                &lt;li&gt;&lt;a href=&quot;#ceremony&quot;&gt;Ceremony&lt;/a&gt;&lt;/li&gt;
24.                &lt;li&gt;&lt;a href=&quot;#graduates&quot;&gt;Graduates&lt;/a&gt;&lt;/li&gt;
25.                &lt;li&gt;&lt;a href=&quot;#awards&quot;&gt;Awards&lt;/a&gt;&lt;/li&gt;
26.             &lt;/ul&gt;
27.          &lt;/nav&gt;
28.          &lt;h2 id=&quot;ceremony&quot;&gt;Ceremony&lt;/h2&gt;
29.          &lt;p&gt;Opening Procession&lt;/p&gt;
30.          &lt;p&gt;Speech by Valedictorian&lt;/p&gt;
31.          &lt;p&gt;Speech by Class President&lt;/p&gt;
32.          &lt;p&gt;Presentation of Diplomas&lt;/p&gt;
33.          &lt;p&gt;Closing Speech by Headmaster&lt;/p&gt;
34.          &lt;h2 id=&quot;graduates&quot;&gt;Graduates&lt;/h2&gt;
35.          &lt;ul&gt;
36.             &lt;li&gt;Eileen Williams&lt;/li&gt;
37.             &lt;li&gt;Andy Maseyk&lt;/li&gt;
38.             &lt;li&gt;Blanca Sainz Garcia&lt;/li&gt;
39.             &lt;li&gt;Clara Faulkner&lt;/li&gt;
40.             &lt;li&gt;Gez Lemon&lt;/li&gt;
41.             &lt;li&gt;Eloisa Faulkner&lt;/li&gt;
42.          &lt;/ul&gt;
43.          &lt;h2 id=&quot;awards&quot;&gt;Awards&lt;/h2&gt;
44.             &lt;ul&gt;
45.                &lt;li&gt;Clara Faulkner&lt;/li&gt;
46.                &lt;li&gt;Eloisa Faulkner&lt;/li&gt;
47.                &lt;li&gt;Blanca Sainz Garcia&lt;/li&gt;
48.             &lt;/ul&gt;
49.          &lt;/main&gt;
50.       &lt;footer&gt;Copyright 2012 B.lawson&lt;/footer&gt;
51.    &lt;/body&gt;
52. &lt;/html&gt;
```

<h4>Best practice</h4>

For accessibility matters, a best practice is to split your page content into &quot;regions&quot; defined by the five 5 elements (aside, footer, header, main and nav) learned this week. 

We recommend this article written by Steve Faulkner: &quot;[Easy content organisation with HTML5](https://www.paciellogroup.com/blog/2015/09/easy-content-organisation-with-html5/)&quot; (24 September 2015). Steve explains in details how to organize an HTML document into &quot;regions&quot; based on the semantic markup elements we have seen so far during Module 1 of this course.

<h4>External resources:</h4>

-   This [document](https://www.w3.org/TR/html5/grouping-content.html#the-main-element) has been written by the W3C HTML5 Working Group, which details the different use-cases for this element

-   [Rationale and use cases for standardizing a &apos;main content&apos; HTML feature](https://www.w3.org/html/wg/wiki/User:Sfaulkne/main-usecases)

-   On MDN&apos;s Web Docs: the [main element](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/main)

<h3 id="ch1-3-9">1.3.9 The Blog Example, Applying Best Practices</h3>

Let&apos;s go back to our blog example and see what can be improved:

-   Do we have a heading after each sectioning element?

-   Did we use sectioning elements or implicit sections?

-   Can we embed a table of contents?

[The blog example is online at JsBin](https://jsbin.com/heboke/edit?html,output):  let&apos;s see below what the Google Chrome HTML5 Outliner extension showed.

<!------------------------------------------------------------------------------------------------>
<!----------------- 32. image of teh blog toc, show an untitled nav entry (##) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image032.jpeg?raw=true"
   alt="Image of the Blog Table of Contents, that show an untitled nav entry"
   width="65%" />
</p>

Also note that in this example, we used H1s after each sectioning element, and we still get a hierarchy, some H1s are inside an &lt;article&gt; that is in a &lt;section&gt; (this corresponds to the third example given in the &quot;heading and sectioning elements&quot; part of the course):

```
1.  **&lt;section&gt;**
2.     &lt;header&gt;
3.       **&lt;h1&gt;Blog posts for April 2012&lt;/h1&gt;**
4.     &lt;/header&gt;
5.     **&lt;article&gt;**
6.       &lt;header&gt;
7.         **&lt;h1&gt;&lt;a href=&quot;&quot;&gt;Information about this example&lt;/a&gt;&lt;/h1&gt;**
8.         This example is a modified version of &lt;a href=&quot;https://example.com/blog/index.html&quot;&gt;https://example.com/blog/index.html&lt;/a&gt;
9.       &lt;/header&gt;
10.      \...
11.    &lt;/article&gt;
12. &lt;/section&gt;
```

With this technique, parts of the document can be moved more easily, or integrated inside an RSS stream, without the need to renumber the headings.

Beware that this technique will require you to use some CSS styling, and may confuse some screen readers that do not yet take into account this way of computing the heading hierarchy. A simple fix is to use an H1 right after the &lt;body&gt; and use only H2\...H6 inside &lt;section&gt;, &lt;article&gt;, &lt;nav&gt; and &lt;aside&gt;.

<h4>Let's fix the missing heading</h4>

We need to add a heading in the &lt;nav&gt; element. This will both fix the outline of the document by removing the untitled entry, and will also make screen readers happy as they will better vocalize the structure of the page (it will say &quot;entering nav&quot; followed by the vocalization of the heading content).

```
1.  &lt;nav&gt;
2.     **&lt;header&gt;**
3.       **&lt;h1&gt;Navigation menu&lt;/h1&gt;**
4.     **&lt;/header&gt;**
5.     &lt;ul&gt;
6.       &lt;li&gt;&lt;span&gt;Blog&lt;/span&gt;&lt;/li&gt;
7.       &lt;li&gt;&lt;a href=&quot;&quot;&gt;About&lt;/a&gt;&lt;/li&gt;
8.       &lt;li&gt;&lt;a href=&quot;&quot;&gt;Contact&lt;/a&gt;&lt;/li&gt;
9.     &lt;/ul&gt;
10. &lt;/nav&gt;
```

**Here is the fixed result:**

<!------------------------------------------------------------------------------------------------>
<!---------------- xx.  (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image033.jpeg?raw=true"
   alt="Good outline without the untitled nav"
   width="55%" />
&nbsp;
<br/>

A common remark from Web designers is: &quot;we do not want a heading content displayed systematically after a &lt;nav&gt;, or an &lt;aside&gt; element\...&quot;

**BEST PRACTICE #1: **In order to NOT display the heading content on screen  the recommended technique  is described in [this article by Steve Faulkner](https://www.paciellogroup.com/blog/2012/05/html5-accessibility-chops-hidden-and-aria-hidden/). Do not use display:none or visibility:hidden in your CSS stylesheet, as in that case the heading content will never be vocalized by screen readers, and more generally by assistive technologies. **\
\
**As an illustration of the recommended technique, see [this JSBin version of the blog example](https://jsbin.com/savabo/edit?html,output) that hides the &lt;h2&gt;Navigation menu&lt;/h2&gt; from the &lt;nav&gt;\...&lt;/nav&gt; element, using the CSS technique explained in the above link.

**BEST PRACTICE #2: **it is not advised to include interactive content (links, controls etc) that is hidden offscreen (it is in fact a violation of the [W3C WCAG 2.0 Guidelines](https://www.w3.org/TR/WCAG20/)). All interactive content must have a visible focus indicator (and be on screen when focused).

### Embedding a table of contents and adding a &lt;main&gt; element

In the previous section, we saw how to embed a table of contents using some JavaScript code borrowed from the Google Chrome HTML5 outliner extension.

Let&apos;s add this piece of code (we removed the JS details from this extract):

```
1.  &lt;aside&gt;
2.     &lt;h1&gt;
3.       &lt;a href=&quot;javascript:(function(){\...});&quot;
4.          title=&quot;TableOfContents&quot;&gt;
5.          Click here to display the table of contents!
6.       &lt;/a&gt;
7.     &lt;/h1&gt;
8.  &lt;/aside&gt;
```

We also added a &lt;main&gt; element to identify the main content of the page composed of the big section with all blog posts:

```
1.  &lt;main&gt;
2.    &lt;section&gt;
3.       &lt;header&gt;
4.           &lt;h2&gt;Blog posts for April 2012&lt;/h2&gt;
5.       &lt;/header&gt;
6.       \...
7.  &lt;/main&gt;
```

### Use H1 as top level headings only, use H2\...H6 in sectioning content

As explained in the article [HTML5 Document Outline](https://www.paciellogroup.com/blog/2013/10/html5-document-outline/) and in [the W3C HTML Wiki](https://www.w3.org/wiki/HTML/Usage/Headings) , it is risky to use nested H1s, as browsers do not correctly implement the &quot;outline algorithm&quot;.

The blog example uses nested H1's. If you check it with [the W3C conformance checker](https://validator.w3.org/nu), it issues a warning: &quot;*Consider using the h1 element as a top-level heading only (all h1 elements are treated as top-level headings by many screen readers and other tools).*&quot;

While this is just a warning, we do prefer to use H1s only as top level elements, and replace the H1s we had after &lt;section&gt;, &lt;article&gt;, &lt;nav&gt; and &lt;aside&gt; elements respectively by a H2s and H3s. 

**Extract from source code:**

```
1.  &lt;nav&gt;
2.     &lt;header&gt;
3.       **&lt;h2&gt;Navigation menu&lt;/h2&gt;**
4.     &lt;/header&gt;
5.     \...
6.  &lt;/nav&gt;
``

### Finally, the fixed example

-   [Check it online with this JsBin](https://jsbin.com/heboke/edit?html,output)
<!------------------------------------------------------------------------------------------------>
<!---------------- xx.  (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/imagexx.jpeg?raw=true"
   alt=""
   width="25%" />
&nbsp;
<br/>

![blog with embedded table of contents](./images/image034.jpeg){width="5.0in" height="2.8536340769903763in"}

### 1.3.10 Examples of Page Layouts

In this section, we show some &quot;classic&quot; CSS layout techniques for designing an HTML page that uses the new sectioning elements. 

We embed examples from this [very good post about &quot;Positioning content&quot;](https://learn.shayhowe.com/html-css/positioning-content/). This is a recommended reading as it details how to use the CSS float property to layout a Web page.

The 4 examples below are given &quot;as is&quot; to give you some hints. There are lots of other possibilities on using CSS to position element.

### Example #1: a &lt;section&gt; on the left and an &lt;aside&gt; on the right, using the float and width CSS properties

This example uses the following HTML structure (notice that we use the &quot;HTML entity syntax&quot; for displaying &quot;&lt;&quot; or &quot;&gt;&quot;. For example, &lt; displays a &quot;&lt;&quot; character).

```
1.  <header&gt;
2.  <code&gt;&lt;header&gt;&lt;/code&gt;
3.  </header&gt;
4.   
5.  <section&gt;
6.  <code&gt;&lt;section&gt; &lt;br&gt; float: left;&lt;/code&gt;
7.  </section&gt;
8.   
9.  <aside&gt;
10. <code&gt; right;&lt;/code&gt;
11. </aside&gt;
12.  
13. <footer>
14. <code>&lt;footer&gt;</code>
15. </footer>
```

Here we use the CSS rule float:left for the &lt;section&gt; and the CSS rule float:right for the &lt;aside&gt;. When an element floats, it goes out of the normal flow of the HTML element. Then by default it floats to the edge of its parent; and its size depends on the elements it contains. So, in order to fill the whole horizontal space, we prefer here to &quot;force the width&quot; by setting the CSS width property with a percentage.  So we took width: 63% for the &lt;section&gt; on the left and width:30% for the &lt;aside&gt; on the right.

You can look at the complete CSS code in the interactive example below (click on the CSS or HTML text in the menu bar below, or click &quot;edit on codepen&quot; to change the code and see the results):
<!------------------------------------------------------------------------------------------------>
<!---------------- xx.  (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image035.png?raw=true"
   alt=""
   width="65%" />
&nbsp;
<br/>

[Also available online at JSBin](https://jsbin.com/dufapo/edit?html,css,output).

<!------------------------------------------------------------------------------------------------>
<!---------------- 36.  (xx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image036.png?raw=true"
   alt=""
   width="65%" />
&nbsp;
<br/>

<h4>Example #2: three sections centered, of equal size, also using the float and width CSS properties</h4>

Here we show how to make a 3 column layout using the CSS float property.

<b>HTML code:</b>

```
1.  &lt;header&gt;
2.  &lt;code&gt;&lt;header&gt;&lt;/code&gt;
3.  &lt;/header&gt;
4.   
5.  &lt;section&gt;
6.  &lt;code&gt;&lt;section&gt; &lt;br&gt; float: left;&lt;/code&gt;
7.  &lt;/section&gt;
8.   
9.  &lt;section&gt;
10. &lt;code&gt;&lt;section&gt; &lt;br&gt; float: left;&lt;/code&gt;
11. &lt;/section&gt;
12.  
13. &lt;section&gt;
14. &lt;code&gt;&lt;section&gt; &lt;br&gt; float: left;&lt;/code&gt;
15. &lt;/section&gt;
16.  
17. &lt;footer&gt;
18. &lt;code&gt;&lt;footer&gt;&lt;/code&gt;
19. &lt;/footer&gt;
```

Instead of having one element with a float:left and one element with a float:right property, we instead use float:left for all three of them, and we give a  width:30% CSS property value to each &lt;section&gt;. We also set a small margin so that the colums have a gap between them.

**Look at the CSS code in the example below:**

![](./images/image037.png){width="6.5in" height="2.329861111111111in"}

### Example #3: same result using the CSS flex property

This example uses the CSS flex property to achieve a result similar to the one shown in Example 2.\
There are many articles on Flexbox and we recommend those from Rachel Andrew on Smashing Magazine: &quot;[Use cases for Flexbox](https://www.smashingmagazine.com/2018/10/flexbox-use-cases/)&quot;, &quot;[Flexbox: how big is that flexible box](https://www.smashingmagazine.com/2018/09/flexbox-sizing-flexible-box/)&quot;, etc.

![](./images/image038.png){width="6.5in" height="2.357638888888889in"}

### Example #4: another example written by a student, that uses the flex property

This example also uses all the structuring elements we saw: main, article, section, etc. It uses only the simplest parts of the FlexBox CSS module, so it should be easy to understand, even for CSS beginners:

![](./images/image039.png){width="6.5in" height="3.467361111111111in"}

### External resources

-   An article on CSS Tricks: [All about floats](https://css-tricks.com/all-about-floats/)

-   Old but good article on &quot;A List Apart&quot; (ALA): [CSS Floats 101](https://alistapart.com/article/css-floats-101)

-   Another article on Lifewire:[ Understanding CSS float](https://www.lifewire.com/understanding-css-float-3466205)

-   On MDN&apos;s Web Docs: the [float CSS property](https://developer.mozilla.org/en-US/docs/Web/CSS/float) and the [clear CSS property](https://developer.mozilla.org/en-US/docs/Web/CSS/clear)

<h3 id="ch1-4">1.4.1 The &lt;details&gt; and &lt;summary&gt; Elements</h3>

These elements have been introduced for displaying a foldable zone in an HTML document.

In the screenshot below, taken from the W3C specification page, the text next to the horizontal arrow is a &lt;summary&gt; element, and the text displayed when we click on the summary part, is the &lt;details&gt; element. This is a sort of &quot;accordion&quot; with foldable content.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 40. example of summary details elements from the w3c specs (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image040.png?raw=true"
   alt="Example of Summary Details Elements from the W3C specification"
   width="35%">
&nbsp;
<br/>

The &lt;details&gt; element generates a simple widget to show/hide element contents, optionally by clicking on its child &lt;summary&gt; element.

Here is an example of what can be done using these elements ) see the [online version on JSBin](https://jsbin.com/yociyel/1/edit?html,css,js,output):

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 41. example of folded summary details (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image040.png?raw=true"
   alt="example of Folded Summary Details"
   width="35%">
&nbsp;
<br/>

And here is what is displayed after clicking on the small arrow-shaped icon to the left of the summary:


<!------------------------------------------------------------------------------------------------>
<!----------------------------- 42. Example of summary details unfolded (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image042.jpeg?raw=true"
   alt="Example of summary details unfolded"
   width="35%">
&nbsp;
<br/>

<b>Here is the code of this example:</b>

```
> &lt;!DOCTYPE html&gt;
> &lt;html lang=&quot;en&quot;&gt; \...
> &lt;body&gt;
> &lt;details&gt;
> &lt;summary&gt;
> How to beat the boss\...spoiler alert !
> &lt;/summary&gt;
> &lt;p&gt; Just aim to the red spots near his eyes&lt;/p&gt;
> &lt;p&gt;Keep shooting at these spots until the eyes open, then hit quickly both eyes with your laser beam.&lt;/p&gt;
> &lt;/details&gt;
> &lt;/body&gt;
> &lt;/html&gt;
```

The &lt;summary&gt;\...&lt;/summary&gt; is inside a &lt;details&gt;\...&lt;/details&gt; element. By clicking on the icon at the left of the summary, the content of the &lt;details&gt; value is displayed/hidden.

&lt;details&gt; blocks can be embedded inside one another, like in this [example](https://jsbin.com/dejagi/edit?html,css,output):

**Step 1: all folded:**

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Other example, unfolded](./images/image043.jpeg){width="3.3229166666666665in" height="0.4270833333333333in"}

**Step 2: click on top level summary icon, the first &quot;hidden&quot; part appears\...**

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![The unfolded content contains in turn a summary details folded](./images/image044.jpeg){width="3.3333333333333335in" height="2.1875in"}

**Step3: click on embedded summary icon inside the part that has been previously unfolded**

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![We unfolded the summary details inside the previous summary details. Recursive accordeons!](./images/image045.jpeg){width="3.25in" height="3.6875in"}

**Source code of this example, see the summary/details inside another one:**

```
> <details>
> <summary>
> How to beat the boss...spoiler alert !
> </summary>
> <p> Just aim to the red spots near his eyes</p>
> <p>Keep shooting at these spots until the eyes open, then hit quickly both eyes with your laser beam.</p>
> <details>
> <summary>
> Bonus and spoiler No 2: get a new weapon by cutting the tail of the boss.
> </summary>
> <p>Before finishing him, try to cut his trail, you will get a new weapon&lt;/p&gt;
> <p>Just try to stay behind him as long as you can, hitting his tail with your melee weapon, after a few hits the trail will fall and you will get a new bonus weapon, then finish the boss.&lt;/p&gt;
> </details>
> </details>
```

### CSS pseudo classes for styling summary icons

There are CSS pseudo classes to style this icon when it is in the open or closed state. Support for these is still incomplete as of June 2020 (works on Google Chrome, Opera, Safari, not in FF).

Example1 (see [online example](https://jsbin.com/tomehim/1/edit?html,css,output)):

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Styling the open/close icon](./images/image046.jpeg){width="3.4583333333333335in" height="0.4166666666666667in"}

The color and background of the icon on the left are specified by the following CSS rule, which uses the pseudo class ::-webkit-details-marker

In this example: red arrow, white background.

```
1.  summary::-webkit-details-marker {
2.  color:#FF0000;
3.  background:#FFFFFF;
4.  }
```

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Styled summary details icon, unfolded state](./images/image047.jpeg){width="3.7708333333333335in" height="1.8125in"}

Once opened, the selector details&lbrack;open&rbrack; can style the icon when &lt;details&gt; is unfolded. In this example: blue arrow, turquoise background. Here is the corresponding CSS rule:

```
1.  details&lbrack;open&rbrack; summary::-webkit-details-marker {
2.  color:#0000FF;
3.  background:#00FFFF;
4.  }
```

It is also possible to change the icon itself using the CSS pseudo class :after

**Example 2 (see it [online](https://jsbin.com/sajusop/edit?html,css,output)):**

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![A + as a custom open icon for summary](./images/image043.jpeg){width="3.40625in" height="0.4375in"}

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![A &quot;-&quot; as a custom close icon](./images/image048.jpeg){width="3.4791666666666665in" height="1.6458333333333333in"}

CSS rules used in this example:

Use a &quot;+&quot; shaped icon, pink, bold, etc\... :

```
1.  summary:after {
2.  content: &quot;+&quot;;
3.  color: #FF00FF;
4.  float: left;
5.  font-size: 1.5em;
6.  font-weight: bold;
7.  margin: -5px 5px 0 0;
8.  padding: 0;
9.  text-align: center;
10. width: 20px;
11. }
```

Use a &quot;-&quot; shaped icon, white, when details are displayed:

```
1.  details&lbrack;open&rbrack; summary:after {
2.  content: &quot;-&quot;;
3.  color: #FFFFFF
4.  }
```

### Current browser support

-   On CanIUse: [compatibility table for details and summary elements](https://caniuse.com/#feat=details)

### 1.4.2 The &lt;time&gt; and &lt;mark&gt; Elements

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![Picture of a clock with the words &apos;it&apos;s about time&apos;](./images/image049.jpeg){width="2.0in" height="1.9085422134733159in"}

### The &lt;time&gt; element

The &lt;time&gt; element is useful for marking a time or a duration in a document.

It provides both a human readable part (the part between &lt;time&gt; and &lt;/time&gt;) and a machine readable part contained within a datetime attribute. Dates are expressed as YYYY-MM-DD.

The machine readable part adds semantics that can be used by search engines for indexing, by browsers or by browser extensions, or by JavaScript code. Useful scenarios include generating alerts for birthdays, automatically adding dates or events that contain &lt;time&gt; elements in a calendar, etc.

**Example:**

1.  We open at **&lt;time&gt;10:00&lt;/time&gt;** every morning.

2.  

3.  I have a meeting the **&lt;time datetime=&quot;2020-02-14&quot;&gt;Monday 14/02/2020.&lt;/time&gt;**.

4.  Blog posts from the year **&lt;time datetime=&quot;2020&quot;&gt;2020&lt;/time&gt;**.

5.  Archives, blog posts for **&lt;time datetime=&quot;2020-04&quot;&gt;April 2020&lt;/time&gt;**

6.  This recipe was published by Michel the **&lt;time datetime=&quot;2020-04-16&quot;&gt;April 16, 2020&lt;/time&gt;**.

### The datetime attribute

The datetime attribute can be used for indicating a date/time or a duration.

**Date/time values**

Supports different specifications of time such as &quot;a year&quot;, &quot;a month in a year&quot;, &quot;a week in a year&quot;, &quot;a time&quot;, etc\... 

##### 

##### Here are some examples:

  ---------------------------------------------------------------------------------------------------------------------------------------------------------
  Different syntaxes of the datetime attribute   
  ---------------------------------------------- ----------------------------------------------------------------------------------------------------------
  datetime attribute values                      Interpretation

  &lt;time datetime=&quot;2020&quot;&gt;                     The year 2020

  &lt;time datetime=&quot;2020-11&quot;&gt;                  November 2020

  &lt;time datetime=&quot;11-13&quot;&gt;                    November 13th (any year)

  &lt;time datetime=&quot;2020-W21&quot;&gt;                 Week 21 from year 2020

  &lt;time datetime=&quot;2020-11-13 09:00&quot;&gt;         November 13th year 2020, time = 9:00

  &lt;time datetime=&quot;2020-11-13T09:00&quot;&gt;         Same as previous example, both syntaxes are supported, with and without the &quot;T&quot; between date and time.

  &lt;time datetime=&quot;09:00Z&quot;&gt;                   9:00 in the morning, GMT

  &lt;time datetime=&quot;09:00-05&quot;&gt;                 9:00 in the morning, GMT minus 5 hours

  &lt;time datetime=&quot;09:00+05:45&quot;&gt;              9:00 in the morning, GMT plus 5 hours 45 minutes, (for example, Nepal is 5:45 ahead of  GMT)
  ---------------------------------------------------------------------------------------------------------------------------------------------------------

#### Duration values

Duration values use the prefix "P" for "period" as in &lt;time datetime=&quot;P4D&quot;&gt; (period = four days)\...

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![funny pict duration values](./images/image050.jpeg){width="2.0in" height="2.0608694225721784in"}

So you start the attribute string value with a &quot;P&quot;, followed by a duration value that ends with another letter indicating the unit used: &quot;D&quot; for &quot;days&quot;,  "H" for hours, "M" for minutes and "S" for seconds. 

You can separate the different elements &quot;P&quot;, value and unit with spaces, but this is optional. So &lt;time datetime=&quot;P4D&quot;&gt; is a duration of 4 days, as is &lt;time datetime=&quot;P 4 D&quot;&gt;.

Using a "T" after the "P" marker allows you to indicate a more accurate duration time: &lt;time datetime=&quot;PT4H 6M 12.55S&quot;&gt; is a duration of 4 hours, 6 minutes and 12.55 seconds.

Alternatively, you could use also a duration time component.

From Bruce Lawson&apos;s article : *&quot;Whichever you choose, it's represented internally as a number of seconds. Because of this, you can't specify a duration in terms of months, because a month isn't a precise number of seconds; a month can last from 28 to 31 days. Similarly, a year isn't a precise number of seconds; it's 12 months and February sometimes has an extra day.*

*You still can't represent dates before the Christian era, as years can't be negative. Neither can you indicate date ranges. To mark up From "21/02/2012 to 25/02/2012″, use two separate &lt;time&gt; elements.&quot;*

Examples:

&lt;h2&gt;Recipe:&lt;/h2&gt;

&lt;ul&gt;

  &lt;li&gt; Preparation time: &lt;time datetime=&quot;PT30M&quot;&gt;30 minutes&lt;/time&gt; &lt;/li&gt;

  &lt;li&gt; Cooking time:     &lt;time datetime=&quot;PT10M&quot;&gt;10 minutes&lt;/time&gt; &lt;/li&gt;

&lt;/ul&gt;

#### The &lt;time&gt; element with no attributes

Used without attributes, the value between the opening &lt;time&gt; and closing &lt;/time&gt; should follow the syntax given by the specification so that machines can understand it (same syntax as the one presented for the datetime attribute in the previous section). However it is recommended to use a datetime attribute, as it gives more freedom in the way you can display the date/time/duration in a human-readable form. 

#### External resources:

-   From the specification: <https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-time-element>

-   On MDN&apos;s Web Docs: <https://developer.mozilla.org/en-US/docs/Web/HTML/Element/time>

-   MDN&apos;s browser compatibility [table](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/time#Browser_compatibility) for &lt;time&gt;

-   Old but interesting article by Bruce Lawson: <https://www.brucelawson.co.uk/2012/best-of-time/>

-   A CSS Tricks&apos; article: &quot;[The &apos;time&apos; element](https://css-tricks.com/time-element/)

### The &lt;mark&gt; element

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Picture of a yellow hightlighter pen](./images/image051.jpeg){width="4.34375in" height="0.9791666666666666in"}

The HTML &lt;mark&gt; tag is used for indicating text as marked or highlighted for reference purposes, due to its relevance in another context.

Some use cases:

-   Display search results with search strings highlighted in the results.

-   &gt;Highlight important parts of a text, such as &quot;quoting parts&quot;, etc.

-   Replace &lt;strong&gt; and &lt;em&gt; with &lt;mark&gt; when suitable.

Example 1: <https://jsbin.com/tafelic/edit?html,output>

Source code:
```
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta charset=utf-8 /&gt;
&lt;title&gt;JS Bin&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;Project is due in **&lt;mark&gt;.zip format&lt;/mark&gt;** next monday.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
```

Example 2:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Another example for marking code](./images/image052.jpeg){width="4.6875in" height="0.9375in"}

Source code:
```
<body>
<pre>
<code><mark>var</mark> i = 3;</code>
</pre>
<p>The var keyword is used to declare a variable in JavaScript.</p>
</body>
```

#### Change the default style of the &lt;mark&gt; element

If you don&apos;t like the default yellow background, you may use CSS to change the style of the &lt;mark&gt; element:

For example:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![style the mark element with CSS](./images/image053.jpeg){width="4.28125in" height="1.34375in"}

```
\... comes with this CSS rule:
```
1.  mark {
2.      background-color: green;
3.      color: yellow;
4.  }
```

#### External resources:

-   From the specification: <https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-mark-element>

-   On MDN&apos;s Web Docs: <https://developer.mozilla.org/en-US/docs/Web/HTML/Element/mark>

    -   MDN&apos;s browser compatibility [table](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/mark#Browser_compatibility) for &lt;time&gt;

-   An article on Web Platform News: &quot;[The &lt;mark&gt; element could help make your text more scannable](https://webplatform.news/issues/2019-02-28)&quot;

### 1.4.3 The Download and Translate Attributes

### The old way to download files using HTML and HTTP

Everyone knows the classic way to make hyperlinks, using &lt;a href=&quot;\...&quot;&gt;some text&lt;/a&gt;. What happens when you click on the hyperlink depends on the MIME type received by the browser. If you link to a file the browser knows how to render (an html page, a gif, jpg, or png image, etc.) there is a good chance that the MIME type received by the browser will be something like this:

1.  Content-type: text/html, text/plain, image/gif, image/jpg, etc.

For example,  HTML code such as this:

1.  &lt;a href=&quot;toto.jpg&quot;&gt;

```

```
1.      please right click this link to download
2.      the toto.jpg picture&lt;/a&gt;
```
\...will ask the remote HTTP server to send back the toto.jpg file. The browser will receive in the response HTTP header from the server (and by default the browser will display the image in a new tab):
```
1.  \...
2.  Content-type: image/jpg
3.  \...
```
However, if the link points to some PHP code,  Java servlet code, or any kind of script/application on the server side, this remote server code can send in its HTTP response a Content-type that may force the browser to download the image instead of rendering it.

It may also propose a name for the file to be downloaded that may be different from the one that appears in the URL of the href attribute. This can be done by generating, in addition to the Content-type line in the response HTTP header, a Content-Disposition line that looks like this:

1.  Content-Disposition: attachment; filename=&quot;MyImage.png&quot;;

Here are some extracts from a Java Servlet that generate a zip file and forces the browser to propose downloading it using a specified name:
```
1.  protected void doGet(HttpServletRequest request, HttpServletResponse response)
2.  throws ServletException, IOException {
3.     try {
4.       // Build the zip file
5.         String path = getServletContext().getRealPath(&quot;data&quot;);
6.         File directory = new File(path);
7.         String&lbrack;&rbrack; files = directory.list();
8.         if (files != null && files.length &gt; 0) {
9.           byte&lbrack;&rbrack; zip = zipFiles(directory, files);
10.          ServletOutputStream sos = response.getOutputStream();
11. 
12.          // generate a HTTP response that forces the download
13.          [response.setContentType(&quot;application/zip&quot;);]
14.          [response.setHeader(&quot;Content-Disposition&quot;,]
15.                             [&quot;attachment; filename=&amp;amp;quot;DATA.ZIP\&amp;quot;&quot;);]
16.          sos.write(zip); sos.flush();
17.        }
18.     } catch (Exception e) {
19.        e.printStackTrace();
20.     }
21. }
```

The above example will cause the browser that invoked this server-side code to start the download of a file named &quot;DATA.ZIP&quot;.

### To download a file using an arbitrary name: the download attribute

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Picture of a road sign with the words &apos;New Way&apos;](./images/image054.jpeg){width="1.2708333333333333in" height="0.9791666666666666in"}

HTML5 proposes the use of a new attribute named download to download resources rather than navigating to them. The example below shows how to trigger the download of an image by the browser (instead of rendering it, which is the default behavior) with a name different from the name of the resource.

1.  &lt;a href=&quot;normal.gif&quot; [download]=[&quot;MichelBuffa.gif&quot;]&gt;

2.      download a picture of Michel Buffa

3.  &lt;/a&gt;

This will indeed force the download of an image with a filename different from its original filename on the server side. Here is a screen capture of the Web browser while downloading the picture. We can see in the status bar the name of the link (the image is &quot;normal.gif&quot;) and the downloaded file is &quot;MichelBuffa.gif&quot;:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Image saved with another names thanks to the download attribute](./images/image055.png){width="2.375in" height="0.71875in"}

**WARNING**: since 2015, and for security reasons, **the image should be located on the same domain as the HTML page that contains the link** (using a relative URL works well, for example, but linking a page on another domain will not work - it will keep its original name).

#### Interesting applications: serverless download

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![no server picture](./images/image056.jpeg){width="3.2395833333333335in" height="0.8958333333333334in"}

##### Serverless download demo (by E.Bilderman)

This demo shows the use of the download attribute together with the HTML5 File, FileSystem and FileWriter APIs (to be studied later in this course) for generating on-the-fly content from JavaScript code, and proposing downloading it to a file.  

We won&apos;t detail this demo here, but take a look if you are curious to see what can be done with this new download attribute. As the FileWriter and FileSystem APIs are still supported only by Google Chrome (other browsers need polyfills), you will need Google Chrome to try it.

We have also put the simplified [source code of this demo on JSBin.com](https://jsbin.com/muluwey/1/edit?html,css,js,output) for you to play with.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Serverless download demo: type text in a text area, press download, enter a filename and voilà! you can download the textarea content into a file, without any server.](./images/image057.png){width="5.0in" height="4.820754593175853in"}

#### External resources:

-   From the specification: [downloading resources](https://www.w3.org/TR/2014/REC-html5-20141028/links.html#downloading-resources)

-   From CanIUse: the [browser support of the download attribute](https://caniuse.com/#feat=download)

### The HTML5 translate attribute

HTML5 gives us a new translate attribute. This attribute is used to limit the impact of  translation tools such as [Google Translate](https://translate.google.com/) by prohibiting the translation of certain content. In many cases some parts of a document should not be translated.

Use cases include:

-   HTML pages that contain source code: you would certainly not like to see the Java or PHP or whatever programming language parts of your page translated into another spoken language!

-   Video game Web sites that propose cheat codes; the codes do not have to be translated,

-   Street names, author names in an &quot;about&quot; page must not be translated,

-   etc.

Both [Google translate](https://translate.google.com/) and [Microsoft online translation services](https://www.microsofttranslator.com/) already offer the ability to prevent translation of content by adding markup to your content, although they do it in (multiple) different ways. Hopefully, the new attribute will help significantly by providing a standard approach.

#### Principle: give hints to translating tools

[The specification about the translate attribute](https://www.w3.org/TR/html5/dom.html#the-translate-attribute) tells us that  *&quot;The translate attribute is an enumerated attribute that is used to specify whether an element&apos;s attribute values and the values of its Text node children are to be translated when the page is localized, or whether to leave them unchanged.*

*The attribute&apos;s keywords are the empty string, yes, and no. The empty string and the yes keyword map to the yes state. The no keyword maps to the no state. In addition, there is a third state, the inherit state, which is the missing value default (and the invalid value default).&quot;*

#### Example illustrating how to specify parts of an HTML element that should not be translated:

1.  &lt;span **[translate=&quot;no&quot;]** class=&quot;author&quot;&gt;[Michel Ham]&lt;/span&gt;

In the above example, a &lt;span&gt; element defines an author (of a blog, for example) who is named Michel Ham. However, his family name is the same as pork and would be translated to &quot;Michel Jambon&quot; in French, or Michel Jamón in Spanish\...

Using the translate=&quot;no&quot; attribute should prevent this behavior\...

1.  &lt;span **[translate=&quot;no&quot;]** class=&quot;author&quot;&gt;[Michel Ham]&lt;/span&gt; is a professor

2.  from the University of Nice,France.

Will be correctly translated into French by:

1.  &quot;[Michel Ham] est un professeur de l&apos;Université de Nice, France.&quot;

\...where all of the end of the sentence has been translated except the author&apos;s name.

#### Inheritance between elements

When you define an element as not being translatable, its children inherit this behavior and are themselves not translatable. The reverse is also true. 

1.  &lt;p **[translate=&quot;no&quot;]**&gt;This is a text in a paragraph element, that should not be translated: the p element has a translate=&quot;no&quot; attribute.[&lt;span&gt; This part that is in a span element embedded within the paragraph. It does not have a translate attribute but inherits the translation-mode of the p and will not be translated too&lt;/span&gt;]. This is the end of the paragraph\...&lt;/ p&gt;

### External resources:

-   From the specification: [the translate attribute](https://html.spec.whatwg.org/multipage/dom.html#the-translate-attribute)

-   From MDN&apos;s Web Docs: <https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/translate>

    -   Its corresponding [browser compatibility table](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/translate#Browser_compatibility)

-   An article from W3C&apos;s Internationalization Activity: [&quot;Using HTML&apos;s translate attribute&quot;](https://www.w3.org/International/questions/qa-translate-flag)

### 1.5 Microdata

There are several ways to provide machine-readable content embedded in a classical Web document: [HTML+RDFa](https://www.w3.org/TR/html-rdfa/), [microformats](http://microformats.org/), [JSON-LD](https://json-ld.org/), HTML5 microdata. In this section, we focus on microdata.

Adding microdata to Web pages helps search engines to better understand the pages&apos; content, their topics, etc. The main purpose of microdata is [Search Engine Optimization ](https://en.wikipedia.org/wiki/Search_engine_optimization)(SEO).

This information is not visible to humans: it is pure *semantic information*. Popular kinds of microdata are events, a person&apos;s profile, the description of an organization, the details of a recipe, a product description, a geographical location, etc. 

### Quick example of microdata that describes a person

1.  &lt;section [itemscope itemtype=&quot;https://schema.org/Person&quot;]&gt;

2.      &lt;h1&gt;Contact Information&lt;/h1&gt;

3.      &lt;dl&gt;

4.        &lt;dt&gt;Name&lt;/dt&gt;

5.        &lt;dd [itemprop=&quot;name&quot;]&gt;Michel Buffa&lt;/dd&gt;

6.        &lt;dt&gt;Position&lt;/dt&gt;

7.        &lt;dd&gt;&lt;span [itemprop=&quot;jobTitle&quot;]&gt;

8.             Professor/Researcher/Scientist&lt;/span&gt; for

9.            &lt;span [itemprop=&quot;affiliation&quot;]&gt;

10.               University of Côte d&apos;Azur, France

11.           &lt;/span&gt;

12.       &lt;/dd&gt;

13.     &lt;/dl&gt;

14.     &lt;!\-- SURFACE ADDRESS GOES HERE \--&gt;

15.     &lt;h1&gt;My different online public accounts&lt;/h1&gt;

16.     &lt;ul&gt;

17.        &lt;li&gt;&lt;a href=&quot;https://www.twitter.com/micbuffa&quot;

18.               [itemprop=&quot;url&quot;]&gt;Twitter profile&lt;/a&gt;&lt;/li&gt;

19.        &lt;li&gt;&lt;a href=&quot;https://www.blogger.com/micbuffa&quot;

20.               [itemprop=&quot;url&quot;]&gt;Michel Buffa&apos;s blog&lt;/a&gt;&lt;/li&gt;

21.     &lt;/ul&gt;

22. &lt;/section&gt;

We can also add another embedded data item in the middle, such as the person&apos;s address:

1.  \...

2.  &lt;/dl&gt;

3.  

4.  &lt;!\-- SURFACE ADDRESS GOES HERE \--&gt;

5.  

6.  &lt;dd [itemprop=]&quot;address&quot;[ itemscope]

7.      itemtype=&quot;https://schema.org/PostalAddress&quot;&gt;

8.      &lt;span [itemprop=]&quot;streetAddress&quot;&gt;10 promenade des anglais&lt;/span&gt;&lt;br&gt;

9.      &lt;span [itemprop=]&quot;addressLocality&quot;&gt;Nice&lt;/span&gt;,

10.     &lt;span [itemprop=]&quot;addressRegion&quot;&gt;Alpes maritimes, France&lt;/span&gt;

11.     &lt;span [itemprop=]&quot;postalCode&quot;&gt;06410&lt;/span&gt;&lt;br&gt;

12.     &lt;span [itemprop=]&quot;addressCountry&quot;[ itemscope]

13.           [itemtype=]&quot;https://schema.org/Country&quot;&gt;

14.          &lt;span [itemprop=]&quot;name&quot;&gt;France&lt;/span&gt;

15.     &lt;/span&gt;

16. &lt;/dd&gt;

17. 

18. &lt;h1&gt;My different online public accounts&lt;/h1&gt;

19. 

20. \...

In the following sections, we look more closely at the itemprop, itemscope and itemtype attributes.

### Data that can be processed, organized, structured, or presented in a given context

Different use cases:

-   The browser, or a browser extension, may interpret the last example as an address and may propose to send it to a map application,

-   A Web crawler may interpret this as an address and display it in its responses using a dedicated presentation layout,

-   Some JavaScript code in the page can access this data,

-   With other types of microdata, for events, for example, the browser may pop up a calendar application, etc.

**Note**: For advanced users, Microdata is very similar to [microformats](http://microformats.org/), which use HTML classes, or to [RDFa](https://www.w3.org/TR/xhtml-rdfa-primer/), which doesn&apos;t validate in HTML4 or HTML5. Because RDFa was considered to be too hard for authors to write, microdata is HTML5&apos;s answer to help embed semantics into html documents.

### External resources

-   [W3C&apos;s HTML Microdata Working Draft](https://www.w3.org/TR/microdata/)

-   MDN&apos;s Web Docs: [Microdata](https://developer.mozilla.org/en-US/docs/Web/HTML/Microdata)

-   Very good [Microdata](https://journal.code4lib.org/articles/6400) paper from code{4}lib journal

-   [Microdata and the microdata DOM API](https://dev.opera.com/articles/microdata-and-the-microdata-dom-api/), old article from dev.opera.com

-   [Chapter from Mark Pilgrim&apos;s book about microdata](https://diveinto.html5doctor.com/extensibility.html), very detailed introduction about semantic metadata in general, contains full examples with explanations about how to describe a Person, etc.

### 1.5.2 Testing Tools

### Introduction

After seeing the principle of embedding microdata in an HTML page, we now present some structured data test tools you can use to check if your data are correct.
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Picture of diverse tools used by workers](./images/image058.jpeg){width="2.0in" height="2.0in"}

One of the most popular resources for testing microdata (as well as microformats and RDFa) is this [Google page about understanding how structured data works](https://developers.google.com/search/docs/guides/intro-structured-data). This page contains a link to a structured data testing tool that you can use to see how Google recognizes the semantic data you embed in your HTML code.

### Testing a real interactive example with an &quot;about page&quot; for Michel Buffa

Let&apos;s have a look now at a (small) example of an about page. It renders as a very simple paragraph that explains who Michel Buffa is\... But we embedded Microdata, so it&apos;s interesting to see how a search engine sees it, and how it may produce &quot;augmented search results&quot;.

[Online example at JsBin](https://jsbin.com/gunuzus/1/edit?html,output)

Source code:

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;

3.  &lt;head&gt;

4.  &lt;meta charset=utf-8 /&gt;

5.  &lt;title&gt;Michel Buffa&lt;/title&gt;

6.  &lt;/head&gt;

7.  &lt;body&gt;

8.  &lt;div [itemscope itemtype=&quot;https://schema.org/Person&quot;]&gt;

9.      My name is &lt;span itemprop=&quot;name&quot;&gt;Michel Buffa&lt;/span&gt;,

10.     And I&apos;m a &lt;span itemprop=&quot;jobTitle&quot;&gt;professor/researcher&lt;/span&gt; at

11.      &lt;a href=&quot;https://www.i3s.unice.fr/&quot; itemprop=&quot;affiliation&quot;&gt;I3S

12.     Laboratory&lt;/a&gt; in the south of France, near the city of Nice. My

13.     email

14.     is : &lt;span itemprop=&quot;email&quot;&gt;micbuffa@gmail.com&lt;/span&gt;.

15.     I live in the city of

16.     &lt;span itemprop=&quot;address&quot; itemscope

17.         [itemtype=&quot;https://schema.org/PostalAddress&quot;]&gt;

18.          &lt;span itemprop=&quot;addressLocality&quot;&gt;Biot&lt;/span&gt;, in a region named

19.          &lt;span itemprop=&quot;addressRegion&quot;&gt;Alpes Maritimes&lt;/span&gt;

20.     &lt;/span&gt;

21. &lt;/div&gt;

22. &lt;/body&gt;

23. &lt;/html&gt;

Rendering of the page in a browser:
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Rendering of Michel Buffa home page](./images/image059.jpeg){width="6.5in" height="1.0298611111111111in"}

Here is what Google sees of the page. We just entered its [URL](https://output.jsbin.com/gunuzus/1) in the [Google page about rich snippets and structured data](https://developers.google.com/search/docs/guides/intro-structured-data):

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Microdata of the example, as seen by Google](./images/image060.png){width="5.0in" height="2.4758213035870518in"}

Note that the address is a fully featured embedded object in the Person&apos;s description.

### Live Microdata

The [Live Microdata Web site](https://foolip.org/microdatajs/live/)  is a bit similar to the previous one except that it shows the extracted metadata as JSON objects: 

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![example of live microdata from the previous example. Microdata are displayed as json objects](./images/image061.jpeg){width="6.0in" height="5.615387139107612in"}

And the JSON view of the microdata:
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![JSON view of the microdata](./images/image062.jpeg){width="4.0in" height="4.4615365266841644in"}

### 1.5.3 Adding Microdata to an HTML Page

### Basic steps

Adding microdata to an HTML page is a really simple task and requires only three attributes: itemscope, itemtype  and itemprop.

#### 1 - Define a container element by adding an itemscope attribute

First, you need to add an itemscope attribute to an HTML element. This will define the &quot;global object&quot; for which we will define properties. This element can be of different types that we will describe later, but for now let us keep looking at the same example we used in previous sections:

1.  &lt;section itemscope itemtype=&quot;https://schema.org/Person&quot;&gt;

2.  \...

3.  &lt;/section&gt;

We will look at the itemtype attribute later. Now that we have defined a global wrapper object/element (a Person in this case), we can  add properties inside this element to define the first name, last name, etc.

#### 2 - Specify the vocabulary used for your microdata with the itemtype attribute of the container element

HTML5 proposes semantic elements for representing sections, articles, headers, etc, but it does not propose any specific elements or attributes to describe an address, a product, a person, etc.

We need a special vocabulary to represent a person or a physical address. With microdata you can define your own vocabulary or better, reuse one of the existing popular vocabularies, such as [schema.org](https://schema.org/). 

Microdata works with properties defined as name/value pairs. The names are defined in the corresponding vocabulary. For example, the vocabulary for representing a [Person](https://schema.org/Person) defines a set of property names.

As you can see in this small extract from the vocabulary (also called a &quot;schema&quot;), a Person can have a name (some text), an Address (the type is defined by another vocabulary named PostalAddress), an affiliation (defined by another vocabulary named Organization) and so on.

We notice that one property, such as the address of a Person, may use another vocabulary. Yes, a vocabulary may link to another vocabulary! There is also inheritance between vocabularies! The above screenshot shows that the Person vocabulary inherits from a Thing vocabulary, and the five first properties of the table come from this vocabulary that describes things.

If you are a developer and if you are familiar with object oriented programming, think of properties as class attributes and think of vocabularies as classes.

**Vocabularies are meant to be shared**

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Picture wish words &apos;time to share&apos;](./images/image063.jpeg){width="2.6145833333333335in" height="1.7395833333333333in"}

If one of the existing vocabularies available at the schema.org Web site fits your needs, you should reuse it, as the most popular vocabularies are becoming de facto standards and will be taken into account by Web crawlers, browsers, and browser extensions.

However, if you do not find a vocabulary corresponding to your needs, keep in mind that anyone can define a microdata vocabulary and start embedding custom properties in their own Web pages. You need to define a namespace and put a description of your vocabulary in a Web page that has the name of your vocabulary.

#### 3 - Add properties using the itemprop attribute in HTML elements inside the container

**Basics:**

Now that you have defined a container element, you may add properties to the HTML inside:

1.  &lt;section itemscope itemtype=&quot;https://schema.org/Person&quot;&gt;

2.       &lt;h1&gt;Contact Information&lt;/h1&gt;

3.       &lt;dl&gt;

4.           &lt;dt&gt;Name&lt;/dt&gt;

5.           &lt;dd **[itemprop=&quot;name&quot;]**&gt;Michel Buffa&lt;/dd&gt;

6.           &lt;dt&gt;Position&lt;/dt&gt;

7.           &lt;dd&gt;&lt;span **[itemprop=&quot;jobTitle&quot;]**&gt;

8.                 Professor/Researcher/Scientist

9.               &lt;/span&gt; for

10.              &lt;span **[itemprop=&quot;affiliation&quot;]**&gt;University of Nice,

11.                     France

12.              &lt;/span&gt;

13.           &lt;/dd&gt;

14.      &lt;/dl&gt;

15.      &lt;h1&gt;My different online public accounts&lt;/h1&gt;

16.      &lt;ul&gt;

17.          &lt;li&gt;&lt;a href=&quot;https://www.twitter.com/micbuffa&quot;

18.             ** [itemprop=&quot;url&quot;]**&gt;Twitter profile&lt;/a&gt;&lt;/li&gt;

19.          &lt;li&gt;&lt;a href=&quot;https://www.blogger.com/micbuffa&quot;

20.              **[itemprop=&quot;url&quot;]**&gt;Michel Buffa&apos;s blog&lt;/a&gt;&lt;/li&gt;

21.      &lt;/ul&gt;

22. &lt;/section&gt;

In this example, the container is a &lt;section&gt; that corresponds to a Person (we have one clue here: the name of the vocabulary given by the itemtype attribute), and each property defined inside this section is identified by the value of the itemprop attribute of sub-elements.

The line: 

1.  &lt;dd itemprop=&quot;name&quot;&gt;Michel Buffa&lt;/dd&gt;

\...defines a property called &quot;name&quot; that has a value of &quot;Michel Buffa&quot; (the text value between the opening and closing tags of the &lt;dd&gt; element).

Nesting microdata items

As we saw with the Person/Address example at the beginning of this chapter, it is possible to nest microdata items inside one another.

Give an element inside a microdata container its own itemscope attribute with the recommended itemtype attribute for indicating the name of the vocabulary used by the nested microdata.

Again, look at the Person/Address example:
```
1.  ...
2.  </dl>
3.  
4.  <!-- SURFACE ADDRESS GOES HERE -->
5.  
6.  <dd itemprop="address"[ itemscope]
7.      [itemtype="https://schema.org/PostalAddress"]>
8.       <span itemprop="streetAddress">10 promenade des anglais&lt;/span><br>
9.       <span itemprop="addressLocality">Nice</span>,
10.      <span itemprop="addressRegion">Alpes maritimes, France</span>
11.      <span itemprop="postalCode">06410</span><br>
12.      <span itemprop="addressCountry" itemscope
13.            [itemtype="https://schema.org/Country"]>
14.           <span itemprop="name">France</span>
15.      </span>
16. </dd>
17. 
18. <h1>My different online public accounts</h1>
19. 
20. ...
```
The properties at *lines 8-12* refer to the address nested microdata (they are defined in the Address vocabulary, not the Person vocabulary), and &quot;France&quot; (*line 14*) is a property that refers to the Country vocabulary.

**Several properties with the same name but different values**

It is possible to use the same property name several times in one microdata object, but with different values:
```
1.  ...
2.  <h1>My different online public accounts</h1>
3.  <ul>
4.  <li><a href="https://www.twitter.com/micbuffa"[ itemprop="url"]>Twitter
5.        profile</a></li>
6.  <li><a href="https://www.blogger.com/micbuffa"[ itemprop="url"]>Michel
7.        Buffa&apos;s blog</a></li>
8.  </ul>
```
This defines the fact that Michel Buffa has two online accounts, and the two properties have the name url, each with its own value.

**It is possible to set more than one property at once, with the same value**

Here are some microdata that represent a song. In this example, at line 5 we set  two different properties: genre and keywords with the same value (see the [MusicRecording schema definition](https://schema.org/MusicRecording)):
```
1.  <div itemscope itemtype="https://schema.org/MusicRecording">
2.  <h2>The song I just published</h2>
3.  <ul>
4.  <li>Name: <span itemprop="name">Please buy me on itunes, I need money!</span></li>
5.  <li>Band: <span [itemprop="genre keywords"]>[Punk, Ska]</span></li>
6.  </ul>
7.  </div>
```
And so on\...

Now, let&apos;s see what elements are compatible with the itemprop attribute and where the values of the properties are located, depending on each element type.

#### The HTML elements compatible with the itemprop attribute

If the itemprop attribute appears on a:

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Elements that can be associated with microdata              
  ----------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  HTML5 elements                                              microdata value associated

  &lt;a&gt;, &lt;area&gt;, &lt;audio&gt;, &lt;embed&gt;, &lt;iframe&gt;, \        The data is the url in the element&apos;s href, src, or data attribute, as appropriate. For example, an image element inside a container of personal contact information can be recognized as that person&apos;s photo and downloaded accordingly.
  &lt;img&gt;, &lt;link&gt;, &lt;object&gt;, &lt;source&gt;, or &lt;video&gt; \   
  element                                                     

  &lt;time&gt; element                                            The data is the time in the element&apos;s datetime attribute. This lets you, for example, just say &quot;last week&quot; in your text content but still indicate exact date and time.

  &lt;meta&gt; element                                            The data is whatever appears in the content attribute of the &lt;meta&gt; element. This is used when you need to include some data that isn&apos;t actually in the text of your page.

  anything else                                               The data is whatever is in the text of the element.
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

For example, the value of a property defined in an &lt;img&gt; element will be the value of the src attribute:

1.  &lt;img itemprop=&quot;image&quot; src=&quot;MichelBuffa.png&quot; alt=&quot;A great professor&quot;&gt;

Or for a &lt;time&gt;, it will be the value of the datetime attribute:

1.  &lt;time itemprop=&quot;birthday&quot; datetime=&quot;1965-04-16&quot;&gt;April 16, 1965&lt;/time&gt;

Or for an &lt;a&gt; element, the value will be the value of the href attribute:

1.  &lt;a href=&quot;https://www.twitter.com/micbuffa&quot; itemprop=&quot;url&quot;&gt;profile&lt;/a&gt;

<h3 id="ch1-5-4">1.5.4 Microdata Tools</h3>

There are many tools available (most are free) that you can use for generating, visualizing and debugging microdata. We list some of them in this page, but feel free to share the tools you find / like in the forums.

#### Microdata generators

To automatically generate microdata for describing persons, restaurants, movies, products, organizations, etc., there is a wide variety of microdata generators such as these listed below (but do not hesitate to search for &quot;microdata generators&quot; using your favorite search engine, and you will find lots!):

-   The [Ultimate Microdata Generator](https://webcode.tools/microdata-generator)

-   The [MicroData Generator](https://microdatagenerator.org/)

-   The [Schema Markup Generator (JSON-LD)](https://technicalseo.com/tools/schema-markup-generator/)

Example:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Example of generator. I entered my name, job, city in a form and a text area next to it shows the corresponding HTML microdata](./images/image064.jpeg){width="6.5in" height="3.3743055555555554in"}

<h3 id="ch1-5-5">1.5.5 Examples of Well Structured Documents with Microdata</h3>

Here, we propose a few links to Web pages that were created by students of previous editions of this course).

The students had to create a Web page to introduce themselves, with some information including: name, job, employer, location, etc., and of course enrich the page with microdata. They also had to follow the best practices concerning the new structural elements, headings, etc.

Click on these pages and look at the source code\...

<h4>Example #1</h4>

Visit the [exemple #1 online](https://jsbin.com/cuzipa/edit?html,css,output).

Structure:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![picture of the first about me page example. Shows the table of content](./images/image065.jpeg){width="4.0625in" height="4.010416666666667in"}

Microdata:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![microdata from the example page](./images/image066.jpeg){width="5.0in" height="3.7708333333333335in"}

<h4>Example #2</h4>

View the [example #2 online](https://jsbin.com/karemi/1/edit?html,output).

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Example page, shows table of content](./images/image067.jpeg){width="4.958333333333333in" height="3.4375in"}

<h3 id="ch2-1">Module 2: HTML5 Multimedia</h3>

<h3 id="ch2-2-1">2.2.1 The <video> Element</h3>

Until 2012, it was only possible to integrate an audio or video player using the proprietary Flash technology, marketed by the company Macromedia (later acquired by Adobe). The &lt;video&gt; element of HTML5 is one of the three &quot;Flash killers&quot; (the others being &lt;audio&gt; for the sound and &lt;canvas&gt; for drawing and animation).\
*(Note that Adobe [no longer supports Flash Player](https://www.adobe.com/products/flashplayer/end-of-life.html) since December 31, 2020)*

Check the HTML code of the following CodePen:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![](./images/image068.png){width="6.5in" height="2.061111111111111in"}

Please note that:

-   The controls attribute indicates that a control panel with play/stop/volume/progress widgets should be displayed;

-   Usually the browser  will use the first format it recognizes  (in this case, the browser checks whether mp4 is supported, and if not, it will check for the ogg format, and so on). Some browsers may use a different heuristic and choose a &quot;preferred&quot; format;

-   The &lt;video&gt; element is a DOM member, so  CSS styling can be applied, as well as manipulation using the DOM API.

You will learn more about the different attributes of the &lt;video&gt; element later on in the course.

### Current browser support for the &lt;video&gt; element

The &lt;video&gt; element is supported by all major browsers. See the [support table from CanIUse.](https://caniuse.com/video)

### Restriction: you cannot embed a YouTube or DailyMotion video using the &lt;video&gt; element

Help! &lt;video src=&quot;my youtube video URL&quot;&gt;&lt;/video&gt; does not work! 

**BEWARE**: *you cannot directly embed videos from most of the popular Web sites such as YouTube, Dailymotion, Vimeo, etc. For commercial reasons, and because advertising is automatically added to the videos, these Web sites do not allow &quot;regular&quot; embedding of their videos.*

While they use HTML5 to render their videos, these hosting sites (YouTube, etc.) use rather complex techniques in order to prevent you from using them with the &lt;video&gt;element. Instead, you often need to embed an &lt;iframe&gt; that will render the HTML5 videos in your Web site, and of course, the advertising that comes along with them.

Usually you have an &quot;embed&quot; button close to the videos that prompts you with some HTML code that you can copy and paste for embedding.

**An example using YouTube:**

Here is the HTML code you need to copy and paste in order to embed a video:

1.  &lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/WMFXg-kni0U&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen&gt;&lt;/iframe&gt;

The YouTube video embedded in this page by the above code: it&apos;s HTML5 but it&apos;s not a &lt;video&gt; element directly inserted in the HTML of this page, it&apos;s an &lt;iframe&gt;.

![](./images/image069.png){width="5.84375in" height="3.28125in"}

### Support for different video CODECS (mp4, ogG, avi, etc.)

This is one of the main problems encountered in recent years: codec support was not the same from one browser to another, for commercial/economic reasons. For example, between 2010 and 2013, Firefox only supported the ogg/oggm format. It did not support mp3/mp4 encoding for audio/video, while Internet Explorer only supported H.264 encoding. Since 2012, things have changed with browser updates and today most popular formats are supported.

*The recommended CODEC, which works in all popular browsers: H264/mp4.*

### External resources

-   From W3C&apos;s specification: [The video element](https://www.w3.org/TR/html52/semantics-embedded-content.html#the-video-element)

-   MDN&apos;s Web Docs:  [&lt;video&gt;: The Video Embed element](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video)

-   From Apple&apos;s developer site: [Safari HTML5 audio and video guide](https://developer.apple.com/library/archive/documentation/AudioVideo/Conceptual/Using_HTML5_Audio_Video/ControllingMediaWithJavaScript/ControllingMediaWithJavaScript.html)

-   Article from HTML5 Rocks: [Media](https://www.html5rocks.com/en/tutorials/video/basics/)


<h3 id="ch2-2-2">2.2.2 The <audio> Element</h3>

HTML5 audio is composed of several layers:
<ul>
<li>The** **&lt;audio&gt; element is useful for embedding an audio player into a Web page. It is dedicated for **streamed audio**. It is very similar to the &lt;video&gt; element, both in its use and in its API.</li>
<li>The Web Audio API is designed for musical applications and for adding sound effects to games. This pure JavaScript API supports manipulation of sound samples (loops, etc.), music synthesis and sound generation (oscillators, etc.). It also comes with a set of predefined sound processing modules (reverb, delay, etc.).</li>
</ul>

This course will focus on the &lt;audio&gt; element. We present the [Web Audio API](https://www.w3.org/TR/webaudio/) and other advanced HTML5 features in the [W3Cx HTML5 Apps and Games course](https://www.edx.org/course/html5-apps-and-games).

The attributes, event set and JavaScript API  of the &lt;audio&gt; element are just a &quot;reduced&quot; version of the ones from the &lt;video&gt; element, and here we will only address the differences and peculiarities.

### The &lt;audio&gt; element, basic usage

Here is a simple example (also available [online example from JSBin](https://jsbin.com/yogojis/edit?html,output)):

Press play to stream the neigh of a horse:   

As you can see, the code is very similar to the basic &lt;video&gt; element usage.

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;

3.     &lt;head&gt;

4.        &lt;meta charset=&quot;utf-8&quot;/&gt;

5.        &lt;title&gt;horse song&lt;/title&gt;

6.  

7.     &lt;/head&gt;

8.     &lt;body&gt;

9.        &lt;audio controls=&quot;controls&quot;&gt;

10.          &lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/horse.ogg&quot; type=&quot;audio/ogg&quot; /&gt;

11.          &lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/horse.mp3&quot; type=&quot;audio/mp3&quot; /&gt;

12.             Your browser does not support the audio element.

13.             Download the audio/video in

14.          &lt;a href=&quot;https://mainline.i3s.unice.fr/mooc/horse.ogg&quot;&gt;OGG&lt;/a&gt;

15.          or &lt;a href=&quot;https://mainline.i3s.unice.fr/mooc/horse.mp3&quot;&gt;MP3&lt;/a&gt;

16.          format.

17.       &lt;/audio&gt;

18. 

19.    &lt;/body&gt;

20. &lt;/html&gt;

In this example, just as for the &lt;video&gt; element, we used the controls attribute in order to render the play/stop, time, volume and progress widgets.

Notice the other similarities: between the &lt;audio&gt;\...&lt;/audio&gt; tags, we added a text message that is displayed if the Web browser doesn&apos;t support the &lt;audio&gt; element, and we used several &lt;source&gt;\...&lt;/source&gt; elements that link to different audio formats for the same file. The browser will use the first format it recognizes.

External resources

<ul>
<li>From W3C&apos;s specification: <a href="https://www.w3.org/TR/html52/semantics-embedded-content.html#the-audio-element">The audio element</a>.</li>
<li>From MDN&apos;s Web Docs: [&lt;audio&gt;: <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio">The Embed Audio element</a>.</li>
</ul>

<h3 id="ch2-2-3">2.2.3 Attributes of <video> and <audio></h3>

<h4>Most useful attributes of the &lt;video&gt; element</h4>

Here are the most common attributes you can use with the &lt;video&gt; element. They are self explanatory\...

<ul>
<li>src: source of the video.</li>
<li>width and height: size of the video. If unspecified, the default width and height of the video will be used. If you specify one dimension but not the other, the browser will adjust the size of the unspecified dimension to preserve the aspect ratio of the video.</li>
<li>controls: If this boolean attribute is present, the browser displays its own controls for video playback and volume.</li>
<li>poster: This attribute allows you to specify an image that the browser will use while video is being downloaded, or until the user starts playing the video. If this attribute is not specified, the first frame of the video will be used instead.</li>
<li>autoplay: This attribute asks the browser to start playing the video automatically as soon as the page is ready.</li>
<li>preload:  The preload attribute is used when autoplay is not used. It tells the browser what to do before a user plays a video. This attribute is a hint - the browser may ignore it. While autoplay and preload are mutually exclusive, if both are present, then preload is ignored. Possible values:</li>
<ul>
    <li>none: do nothing. This saves bandwidth, no video will be downloaded in background before a user or a call to the play() method starts playing the video.</li>
    <li>metadata: download metadata, such as length of the video or its format.</li>
    <li>auto (default value): the browser will decide. This will depend on the implementation, and on the kind of connection: wifi, 3G, data roaming etc.</li>
	</ul>
<li>loop: Another boolean attribute that indicates to play the video in loop mode (and it starts again when finished).</li>
</ul>

<h4>Be careful if you target mobile applications or if you have multiple videos on the same page</h4>

The autoplay attribute is not recommended if your Web site targets mobile applications (actually, it is often ignored by mobile browsers), as it may consume bandwidth even if the user is not interested in watching the proposed video. If you target mobile devices, we recommend using preload=none as well, as the default value for this attribute is auto.

**Best practice**: do not use autoplay and add preload=&quot;none&quot; if you target mobile devices or if you have multiple audio/video files on the same page.  For example, [this page](https://thepaciellogroup.github.io/AT-browser-tests/test-files/audio.html) contains many audio elements and it does not make sense to have them preload or autoplay.

<h4>About the poster attribute</h4>

If the poster attribute is missing, usually the first non-blank frame of the video will be used as the image that is shown when the video is not playing. 

<h4>About the autoplay attribute for general use</h4>

Do not abuse of the autoplay attribute. We talked earlier about mobile applications, but even on desktop applications it&apos;s usually a bad idea to use it (except for WebCams and for some animations with small video loops, without sound, or for sites like YouTube, with just videos).

**Best practice**: think twice before using the autoplay attribute, even for desktop applications.

<h4>Attributes of the &lt;audio&gt; element</h4>

The attributes you can use with the &lt;audio&gt; element are a subset of those available for the &lt;video&gt; element. Except for the poster attribute, they are all recognized and have the expected meanings: 

-   src: source of an audio stream.

-   controls: if this attribute is present, the browser displays its own controls for audio playback and volume.

-   autoplay: tells the browser to start playing the audio stream automatically as soon as the page is ready - please read details in the above table.

-   preload: tells the browser what to do before a user plays a sound - please read details in the above table.

-   loop:  indicates to play the audio stream in loop mode (start again when finished).

As with the &lt;video&gt; element, the same best practice in regard to preload and autoplay attributes should be followed.

<h3 id="ch2-2-4">2.2.4 Styling Media Players with CSS</h3>

The &lt;video&gt; and &lt;audio&gt; elements are just like other HTML elements, so CSS can be used for styling, including CSS transitions, animations, etc.

<h4>An example of an audio player with some style</h4>

You can try this example [online at JSBin](https://jsbin.com/zoquru/2/edit?html,css,output).

To add some styling to the basic example we saw when we introduced the &lt;audio&gt; element, we just add a &lt;figure&gt; with two children: an &lt;img&gt; and a &lt;figcaption&gt;. Inside the &lt;figcaption&gt; we add the &lt;audio&gt; element from the previous example.

Please move the mouse pointer over this player&apos;s elements: 

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 70. Two gery-black horses in a field (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image070.jpeg?raw=true"
   alt="Two gery-black horses in a field"
   width="25%">
&nbsp;
<br/>

Press Play to hear the horse ! 

<h4>HTML source code:</h4>
```
1.  &lt;figure id=&quot;figaudio1&quot;&gt;
2.    &lt;img id=&quot;imghorse&quot; width=&quot;200&quot;
3.       src=&quot;https://upload.wikimedia.org/wikipedia/commons/d/d4/Nokota_Horses.jpg&quot;
4.       alt = &quot;a horse&quot;/&gt;
5.    &lt;figcaption id=&quot;figcptionaudio1&quot;&gt; Press Play to hear the horse!
6.      &lt;audio controls=&quot;controls&quot;&gt;
7.         &lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/horse.ogg&quot;
8.                 type=&quot;audio/ogg&quot; /&gt;
9.         &lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/horse.mp3&quot;
10.                type=&quot;audio/mp3&quot; /&gt;
11.        Your browser does not support the audio element.
12.        Download the audio/video in
13.        &lt;a href="https://mainline.i3s.unice.fr/mooc/horse.ogg"&gt;OGG&lt;/a&gt;
14.      or &lt;a href="https://mainline.i3s.unice.fr/mooc/horse.mp3"&gt;MP3&lt;/a&gt;
15.         format.
16.    &lt;/audio&gt;
17. &lt;/figcaption&gt;
18. &lt;/figure&gt;
```

<h4>CSS source code:</h4>

```
1.  #figaudio1 {
2.      width : 420px;;
3.      text-align:center;
4.      padding : 6px;
5.      background : white;
6.      margin : 0 11px 0px 0;
7.      border :solid 1px #888888;
8.      border-radius : 8px ;
9.  }
10.  
11. #figcptionaudio1 {
12.     font-size : .8em;
13.     padding : 6px 8px;
14.     background : #dddddd;
15.     display :block;
16.     text-align :center;
17.     font-family : georgia, serif;
18.     font-style : italic;
19.     border-radius : 7px ;
20. }
21.  
22. #figaudio1 &gt; img {
23.     background : #eeeeee;
24.     padding : 5px;
25.     border : solid 1px #444444;
26. }
27.  
28. /\* For audio and img transitions/animation \*/
29. audio, #figaudio1 &gt; img {
30.     transition:all 0.5s;
31. }
32.  
33. #figaudio1 &gt; img:hover {
34.     box-shadow: 15px 15px 20px rgba(0,0, 0, 0.4);
35.     transform: scale(1.05);
36. }
37.  
38. audio:hover, audio:focus, audio:active {
39.     box-shadow: 15px 15px 20px rgba(0,0, 0, 0.4);
40.     transform: scale(1.05);
41. }
```

<h4>Changing the size of a video on the fly using CSS transforms</h4>

<h4>Resizing and rotating a video as the mouse pointer comes over it</h4>

See this <a href="https://jsbin.com/zoquru/4/edit?html,css,output">example online</a> (where you can modify the code on the fly) or just play the following video, and move the mouse pointer in and out of the video while it&apos;s playing.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 71.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image071.png?raw=true"
   alt=""
   width="55%">
&nbsp;
<br/>

This example uses the pseudo CSS class :hover in order to track the mouseover event. On mouseover, it uses a CSS transition property that interpolates the changes in the scale and orientation of the video element (done using a transform CSS property).

The corresponding HTML source code is:

```
1.  &lt;video **id=&quot;w3devCampusVideo&quot;** autoplay controls&gt;
2.  
3.       &lt;source src=https://mainline.i3s.unice.fr/mooc/samuraiPizzacat.webm
4.               type=video/webm&gt;
5.       &lt;source src=https://mainline.i3s.unice.fr/mooc/samuraiPizzacat.ogg
6.               type=video/ogg&gt;
7.       &lt;source src=https://mainline.i3s.unice.fr/mooc/samuraiPizzacat.mp4
8.               type=video/mp4&gt;
9.  &lt;/video&gt;
```

\... and the CSS source code is as follows:
```
1.  #w3devCampusVideo {
2.      width: 300px;
3.      **transition: all 0.5s ease-in-out;**
4.  }
5.   
6.  #w3devCampusVideo**:hover** {
7.      width:400px;
8.      transform:rotate(-5deg);
9.  }
```

<h4>Fullscreen video that resizes and maintains ratios</h4>

This is a trendy way of displaying videos.

Below you will find two examples that show how to do this trick. The first is for a &quot;regular&quot; video, using the &lt;video&gt; and &lt;source&gt; elements. This technique can also be used on any YouTube embedded videos (see Example #2 below).

The interesting part is that we use a 100% standard (and really small and simple) JavaScript code here to handle the window resize events and we just set regular CSS properties width and height of the video element, to resize the video.

<h4>Example #1: with a regular video</h4>

Full width, resizable, borderless video, just using plain CSS and JS DOM events.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 72.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image072.png?raw=true"
   alt=""
   width="65%">
&nbsp;
<br/>

Here is the HTML code. It&apos;s really simple, just notice the &lt;body onload=&quot;init();&quot;&gt; which calls the JavaScript init() function right after the page is loaded.

```
1.  &lt;!DOCTYPE html&gt;
2.  &lt;html lang=&quot;en&quot;&gt;
3.  &lt;head&gt;
4.      &lt;meta charset=&quot;utf-8&quot;&gt;
5.      &lt;title&gt;Full width video like PayPal site&lt;/title&gt;
6.  &lt;/head&gt;
7.  &lt;body onload=&quot;init();&quot;&gt;
8.      &lt;video id=&quot;myVideo&quot; autoplay&gt;
9.        &lt;source
10.           src=https://mainline.i3s.unice.fr/mooc/samuraiPizzacat.webm
11.           type=video/webm&gt;
12.       &lt;source
13.           src=https://mainline.i3s.unice.fr/mooc/samuraiPizzacat.ogg
14.           type=video/ogg&gt;
15.       &lt;source
16.           src=https://mainline.i3s.unice.fr/mooc/samuraiPizzacat.mp4
17.           type=video/mp4&gt;
18.     &lt;/video&gt;
19. &lt;/body&gt;
```

Here is the CSS (remove margins, remove padding, hide parts that could overflow from the &lt;body&gt;):

```
body {
    margin:0;
    padding:0;
    overflow:hidden;
}
```

And now the JavaScript code:

```
> var video;
>  
> function init() {
>    // function called when the page is loaded
>    video = document.querySelector(&quot;#myVideo&quot;);
>    // For initial value
>    video.width = window.innerWidth;
>    video.height = window.innerHeight;
>    // For dealing with window resize
>    window.onresize = function() {
>        video.width = window.innerWidth;
>        video.height = window.innerHeight;
>    };
> }
```

<h4>Example #2: with a YouTube video</h4>

Full width, resizable, borderless YouTube video. To do this: just 100% standard CSS + DOM manipulation using JavaScript.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 73.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image073.png?raw=true"
   alt=""
   width="55%">
&nbsp;
<br/>

The CSS and JavaScript codes for this example are exactly the same as in Example #1.

<h4>Full screen video, pure CSS approaches</h4>

1.  Let&apos;s use the video from the PayPal Web site, played full screen using only very simple CSS.

In this example, the video does not rescale; it&apos;s just cropped if the browser window is resized. Enlarge your browser and you&apos;ll see a man with a phone on the right. Resize your browser and you&apos;ll see only part of the video.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 74.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image074.png?raw=true"
   alt=""
   width="55%">
&nbsp;
<br/>

<h4>CSS code:</h4>
```
> body {
>   margin:0;
>   padding:0;
>   overflow:hidden;
> }
>
>  
>
> video {
>   width:100%;
>   height:auto;
> }
```

2.  Full screen video with CSS effects

This time the video is zoomed in so that it&apos;s much bigger than the browser&apos;s window. When we resize the browser, the part of the video that is visible adapts itself. It&apos;s not &quot;real resize&quot; of the video. Try this [example and read the explanation in this article by Dudley Storey](https://thenewcode.com/777/Create-Fullscreen-HTML5-Page-Background-Video).

<h4>HTML code:</h4>

```
> &lt;!DOCTYPE html&gt;
> &lt;html lang=&quot;en&quot;&gt;
> &lt;head&gt;
>    &lt;meta charset=&quot;utf-8&quot;&gt;
>    &lt;title&gt;Full screen video with CSS effects &lt;/title&gt;
> &lt;/head&gt;
> &lt;body&gt;
> &lt;header&gt;
>  &lt;video autoplay loop=&quot;&quot;
>   poster=&quot;https://mainline.i3s.unice.fr/mooc/polina.jpg&quot;
>   id=&quot;bgvid&quot;&gt;
>     &lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/polina.webm&quot;
>             type=&quot;video/webm&quot;&gt;
>     &lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/polina.mp4&quot;
>             type=&quot;video/mp4&quot;&gt;
>  &lt;/video&gt;
> &lt;/header&gt;
> &lt;section&gt;
> &lt;h1&gt;Full screen video with CSS effects&lt;/h1&gt;
> &lt;/section&gt;
> &lt;/body&gt;
> &lt;/html&gt;
```

<h4>CSS code:</h4>
```
> html, body{
>     color:white;
>     height: 100%;
> }
> header{
>     height: 100%;
>     background-image: url(&apos;https://mainline.i3s.unice.fr/mooc/dots.png&apos;),                             url(&apos;#&apos;);
>     background-repeat: repeat, no-repeat;
>     background-size: auto, cover;
>     background-position: center center, top left;
>     font-family: sans-serif;
>     color: #051a00;
> }
>  
> header video {
>     position:fixed;
>     top:50%;
>     left:50%;
>     min-width:100%;
>     min-height:100%;
>     width:auto;
>     height:auto;
>     z-index:-100;
>     transform:translateX(-50%) translateY(-50%);
> }
```

The trick here is that:

1.  the video is in the header, and the header has a plotted transparent background image (&quot;dots.png&quot;) that is repeated in X and Y (see *lines 8* and *9*).

2.  The video is positioned so that it&apos;s origin (top left corner) is away from the visible surface (*line 25*), while it is set to take 100% of the surface (*lines 20* and *21*).

Full screen video that resizes and keeps its ratio, using the viewport units.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 75.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image075.png?raw=true"
   alt=""
   width="65%">
&nbsp;
<br/>

This time we obtain the same result as with the first example that used JavaScript and a resize event. The video resizes correctly and keeps its ratio.

<h4>CSS code:</h4>

```css
body {
   margin: 0;
}

video {
   position: absolute;
   width: 100vw;
   height: 100vh;
   object-fit: cover;
   object-position: center center;
}
```

### Discussion: why can&apos;t we achieve perfect resizing with only CSS and the use of properties width=100% and height=100%?

Let&apos;s use the same video to compare the different approaches again:

1.  [Original approach](https://jsbin.com/zowuqey/edit?html,css,js,output), using JavaScript. This solution works on any browser, so we will focus on the two following methods, based on pure CSS.

2.  [Using CSS 100%](https://jsbin.com/sakujuv/1/edit?html,css,output) width and height properties (no JavaScript).

3.  [Using CSS viewport ](https://jsbin.com/xureyu/3/edit?html,css,output)units for width and height (no JavaScript).

Resizing the browser window shows that #1 (JavaScript) and #3 (viewport units) behave in the same way: the width or height of the video always fills the window (whichever is smaller), and we always see the whole video.

**Conclusion**: we can get full size video without JavaScript by using viewport units (vw and vh), unless we need to support some old browsers (see their [current support on CanIUse](https://caniuse.com/#feat=viewport-units)).

Setting the video to 100% width and height results in different behavior:

-   100% means 100% of the size of the &lt;body&gt; tag.

-   The body tag&apos;s width is 100% of the browser window width, so the video is always full width.

-   The body tag&apos;s height, however, is determined by the size of its children: the body tag&apos;s height grows and shrinks to accommodate the size of the children.

-   If the browser window is made wide and short, the video is full width, the height is taller than the window, and part of the video is not visible. It seems that just using % does not get us the same effect.

<h3 id="ch2-2-5">2.2.5 Control Players From JavaScript</h3>

The &lt;video&gt; and &lt;audio&gt; elements have methods, properties/attributes and events that can be manipulated with JavaScript. Using the DOM API, it&apos;s possible to manipulate an audio or video element as a JavaScript object that has:

-   **Methods** for controlling the behavior, such as play(), pause(), etc.

-   **Properties** (duration, current position, etc.), either in read/write mode (such as volume), or in read-only mode (such as encoding, duration, etc.)

-   **Events** generated during the life cycle of the element that can be processed using JavaScript callbacks. It is also possible to send events to control the video player

The set of properties/attributes/methods of the &lt;audio&gt; and &lt;video&gt; elements is called an &quot;API&quot; (Application Programming Interface). For example, we will speak here of the &quot;media API&quot; to talk about the associated API.

Like any HTML element, the &lt;video&gt; element can be manipulated/created using the DOM JavaScript API. Here is an example of programmatically creating a &lt;video&gt; element:

1.  var video = document.createElement(&apos;video&apos;);

2.  video.src = &apos;video.mp4&apos;;

3.  video.controls = true;

4.  document.body.appendChild(video);

This will create a complete video player for the file &quot;video.mp4&quot;, with control buttons, and will add it to the &lt;body&gt; element of the page.

### Example that shows how to call play/pause or rewind a video

Please look at this interesting example:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 76.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image076.png?raw=true"
   alt=""
   width="65%">
&nbsp;
<br/>
Note that in order to play the video, you must click on the &quot;vid.play()&quot; text. To pause it, you click on the &quot;vid.pause()&quot; text, and so on. *Notice the text at the top of the video, as well as the transparency.* The text can be selected, since all the elements displayed are pure DOM objects. You can zoom the page in and out, etc. This was not possible with the Flash technology.

**Conclusion**:  you can very easily change the look and feel of the standard video player by using custom CSS and designing your own control widgets. We can find many examples of such video players that offer extended functionalities on the Web. We will present some of them later in the course, but before that, let&apos;s see a little more of what we can do using the JavaScript API of the &lt;video&gt; element (it will be an identical approach for the &lt;audio&gt; element, since it shares the same API by a very small margin).

<h3 id="ch2-2-6">2.2.6 The JavaScript API</h3>

### Methods, properties, and events

The JavaScript API gives you powerful tools to manipulate the &lt;video&gt; element, as the video object provides many properties, methods and events.

The complete list of events can be found in the [HTML5 living standard specification](https://html.spec.whatwg.org/multipage/embedded-content.html#event-definitions).

The list of properties can be found at the [W3C HTML5 Video Events and API](https://www.w3.org/2010/05/video/mediaevents.html) page. This page is interesting for Web developers because it shows an interactive view of the different values and events changing over time while the video is playing within the page.

Try the [direct link](https://www.w3.org/2010/05/video/mediaevents.html), and play with the different buttons and look at the table of events and properties that will change in real time. The displayed names show the properties, events, and methods from the API.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 77.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image077.png?raw=true"
   alt=""
   width="65%">
&nbsp;
<br/>

#### Here is a table that shows the most interesting methods, properties, and events provided by the &lt;video&gt; element API

We provide this as a quick reminder - keep in mind that the [complete list](https://html.spec.whatwg.org/multipage/media.html#mediaevents) is much longer! 

  ------------------------------------------------------------------------
  **Methods**        **Properties**                   **Events**
  ------------------ -------------------------------- --------------------
  **play()**         **currentSrc**                   **play**

  **pause()**        **currentTime**                  **pause**

  load()             startTime (readonly)             progress

  canPlayType()      videoWidth                       error

                     videoHeight                      timeupdate

                     duration (readonly)              ended

                     ended (readonly)                 abort

                     error                            empty

                     paused (readonly)                emptied

                     muted                            waiting

                     seeking                          loadedmetadata

                     volume                           

                     **height**                       

                     **width**                        

                     **seekable (readonly)**          

                     **played (readonly)**            
  ------------------------------------------------------------------------

In the next pages, let&apos;s see, through a set of examples, how to use these most important properties, methods, and events\...

<h3 id="ch2-2-7">2.2.7 The &lt;video&gt; Element JavaScript API</h3>

The JavaScript API is useful for implementing playlists, making custom user interfaces and many other interesting things. The &quot;enhanced HTML5 multimedia players&quot; lesson presented further on the course relies heavily on this API.

### Example #1: how to use external buttons to control the player&apos;s behavior

This example gives the first steps towards writing a custom video player. It shows basic usage of the JavaScript API for adding custom buttons to play/pause the video or to go back to the beginning by setting the currentTime property to zero.

Try it online:

<!------------------------------------------------------------------------------------------------>
<!-------------------------------------- 78.  ---------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image078.png?raw=true"
   alt=""
   width="65%" />
&nbsp;

<!------------------------------------------------------------------------------------------------>
<!-------------------------------------- 79.  ---------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image079.png?raw=true"
   alt=""
   width="45%" />
&nbsp;

##### Source code extract:

&lt;video id=&quot;vid&quot; controls&gt;

&lt;source src=https://mainline.i3s.unice.fr/mooc/samuraiPizzacat.webm

         type=video/webm&gt;

\...

&lt;/video&gt;

&lt;p&gt;Example of custom controls:&lt;/p&gt;

&lt;button onclick=&quot;playVideo();&quot; style=&quot;cursor: pointer;&quot;&gt;Play&lt;/button&gt;

 

&lt;button onclick=&quot;pauseVideo();&quot; style=&quot;cursor: pointer;&quot;&gt;Pause&lt;/button&gt;

 

&lt;button onclick=&quot;rewindVideo();&quot; style=&quot;cursor: pointer;&quot;&gt;

       Back to beginning&lt;/button&gt;

&lt;script&gt;

    vid = document.querySelector(&quot;#vid&quot;);

    function playVideo() {

       vid.play();

    }

    function pauseVideo() {

       vid.pause();

    }

    function rewindVideo() {

       vid.currentTime = 0;

    }

&lt;/script&gt;

 **Explanations:**

-   *Lines 7, 9 and 11*: we add a click listener to each button, in order to call a JavaScript function when each button is clicked.

-   *Line 14*: using the DOM API, we get the JavaScript object that corresponds to the video element we inserted in the HTML document. This line is outside a function, it will be executed when the page loads.

-   *Lines 17 and 20*: we call methods from the API for playing/pausing the video.

-   *Line 24*: we modify the currentTime property in order to rewind the video. Note that vid.load() also rewinds the video, shows the poster image again, but also pauses the video. By using currentTime=0, the playback does not stop.

### Example #2: how to detect the end of a video and start another one

This example listens to the ended event, and calls a callback function when the video is ended.

<!------------------------------------------------------------------------------------------------>
<!-------------------------------------- 80.  ---------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image080.png?raw=true"
   alt=""
   width="65%" />
&nbsp;

```
<video src="video.ogv" id="myVideo"&gt;
    video not supported
</video>
<script type=&apos;text/javascript'>
  var vid = document.querySelector(&apos;#myVideo&apos;);
  vid.addEventListener(&apos;ended&apos;, playNextVideo, false);
  function playNextVideo(e) {
     // Whatever you want to do after the event, change the src attribute
     // of the video element, for example, in order to play another video
  }
</script&gt;
```

### Example #3: how to manage playlists - sequential movies

This example detects the end of a video, then loads the next video, changes the src attribute of the video element and plays the video.

Check the online example below: use the progress cursor to go near the end of the first video that is being played, and see how it continues with the next video. 

<!------------------------------------------------------------------------------------------------>
<!-------------------------------------- 81.  ---------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image081.png?raw=true"
   alt=""
   width="65%" />
&nbsp;

<h4>Source code:</h4>

```
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Sequential Movies</title>    <script>
      var myVideo;
      var currentVideo = 0;
      var sources = [
        "https://mainline.i3s.unice.fr/mooc/samuraiPizzacat.mp4",
        "https://www.archive.org/download/AnimatedMechanicalArtPiecesAtMit/P1120973_512kb.mp4"
        ];
// Set the src of the video to the next URL in the playlist
// If at the end we start again from beginning (the modulo
// source.length does that)
      function loadNextVideo() {
        myVideo.src = sources&lbrack;currentVideo % sources.length]
        myVideo.load();
        currentVideo++;
      }
// listener plays the video
    function loadAndplayNextVideo() {
      console.log("playing " + sources&lbrack;currentVideo % sources.length])
      loadNextVideo();
      myVideo.play();
    }
// Called when the page is loaded
    function init(){
// get the video element using the DOM api
    myVideo = document.querySelector(&quot;#myVideo&quot;);
// Defines a callback function called each time a video ended
    myVideo.addEventListener(&apos;ended&apos;, loadAndplayNextVideo, false);
// Loads the first video when the page is loaded
    loadNextVideo();
    }
  </script>
</head>
<body onload="init()">
    <video id="myVideo"
      controls>
    </video>
</body>
</html>
```

Explanations:

-   *Line 9*: the JavaScript array that contains the URLs of the videos in the playlist. In this example, we&apos;ve got only two of them, but if the array is larger the example still works.

-   *Line 44*: when the page is loaded, an init() function is called.

-   *Lines 34-40*: we use the DOM to get the JavaScript object corresponding to the video element, then define a listener for the ended event. Each time a video ends, the loadAndplayNextVideo() callback is called. As the video element has no src attribute by default, we also preload the first video (call to loadNextVideo() at *line 38*).

-   *Lines 17-21*: the loadNextVideo() function uses a variable called currentVideo that corresponds to the index of the current video. By setting myVideo.src = sources &lbrack;currentVideo % sources.length&rbrack;, we set the src of the video element to sources&lbrack;0&rbrack;, then to sources&lbrack;1&rbrack;, and, as we increment the currentVideo index each time (line 19), if it becomes greater than 1, the modulo (the &quot;%&quot; symbol is the modulo in JavaScript) will make it &quot;loop&quot; between 0 and the number of videos in the playlist. In other words, when the last video ends, it starts back to the first one.

<h3 id="ch2-2-8">2.2.8 [Advanced&rbrack; Extended Examples</h3>

In this section, we propose five extended examples that use more JavaScript and more complex CSS manipulation. They might be a little hard to understand if you are a JavaScript beginner, but don&apos;t be afraid to try and test them, look at the code, etc.

Some examples are given &quot;as is&quot;, such as the custom video player that uses SVG (at the end of the page); if you are interested, you may view the code. 

### Example #1: a player showing the use of every type of CSS3 transformation

Please see this example online, originally written by [Chris Heilmann](https://christianheilmann.com/), and tuned by us ;).

<!------------------------------------------------------------------------------------------------>
<!-------------------------------------- 82.  ---------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image082.png?raw=true"
   alt=""
   width="65%" />
&nbsp;

Don&apos;t forget to click the JavaScript and CSS tabs of the CodePen in order to display the JavaScript code that creates the buttons on the right of the video, and the CSS that processes the different clicks and applies CSS3 transforms.

This example shows a lot:

-   It uses the HTML5 elements &lt;nav&gt;, &lt;footer&gt;, &lt;header&gt;.

-   It shows the use of CSS3 2D transformations (scale, translate, and rotate).

-   It shows how to handle DOM events using JavaScript and how to modify CSS properties of the &lt;video&gt; element from JavaScript.

### Example #2: how to track all possible events and manipulate many properties

This example also shows how to handle failures. See the code and play with this example below:

<!------------------------------------------------------------------------------------------------>
<!-------------------------------------- 83.  ---------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image083.png?raw=true"
   alt=""
   width="65%" />
&nbsp;

Below is a piece of code for handling errors during video playback:

\...

vid.addEventListener(&apos;error&apos;, function(evt) {

    logEvent(evt,&apos;red&apos;);

}, false);

\...

function logEvent(evt, color) {

    switch (evt.type) {

       \...

       case &apos;error&apos;:

           var error = document.querySelector(&apos;video&apos;).error;

           switch (error.code) {

             case error.MEDIA_ERR_ABORTED:

                note.innerHTML = &quot;fetching aborted at the user&apos;s request&quot;;

                break;

             case error.MEDIA_ERR_NETWORK:

                note.innerHTML = &quot;a network error caused the browser to stop fetching the media&quot;;

                break;

             case error.MEDIA_ERR_DECODE:

                note.innerHTML = &quot;an error occurred while decoding the media&quot;;

                break;

             case error.MEDIA_ERR_SRC_NOT_SUPPORTED:

                note.innerHTML = &quot;the media indicated by the src

                                  attribute was not suitable&quot;;

                break;

             default:

                note.innerHTML = &quot;an error occurred&quot;;

                break;

           }

           break;

       }

 \...

}

### Example #3: how to display a percentage of buffering when using a slow connection

See the [example online](https://jsbin.com/xororol/3/edit?html,output) here too.

<!------------------------------------------------------------------------------------------------>
<!-------------------------------------- 84.  ---------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image084.png?raw=true"
   alt=""
   width="65%" />
&nbsp;

Note that on mobile phones, the video does not start until the user presses the play control or clicks on the video picture. Using the &quot;canplaythrough&quot; event is a trick to call a function that starts the video player as soon as the page is loaded on desktop. This event is not supported by mobile devices, so if you try this example on a mobile, the video will not start automatically.

As explained by the [Apple Developer Web site](https://developer.apple.com/):  &quot;The buffered property is a TimeRanges object: an array of start and stop times, not a single value. Consider what happens if the person watching the media uses the time scrubber to jump forward to a point in the movie that hasn&apos;t loaded yet---the movie stops loading and jumps forward to the new point in time, then starts buffering again from there. So the buffered property can contain an array of discontinuous ranges. The example simply seeks the end of the array and reads the last value, so it actually shows the percentage into the movie duration for which there is data. &quot;

Source code extract:

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

  &lt;head&gt;

    &lt;title&gt;JavaScript Progress Monitor&lt;/title&gt;

    &lt;meta charset=&quot;utf-8&quot;/&gt;

    &lt;script&gt;

      function getPercentProg() {

          var myVideo = document.getElementsByTagName(&apos;video&apos;)&lbrack;0&rbrack;;

          var endBuf = myVideo.buffered.end(0);

          var soFar = parseInt(((endBuf / myVideo.duration) \* 100));

          document.getElementById(&quot;loadStatus&quot;).innerHTML = soFar + &apos;%&apos;;

      }

      // Will be called as soon as the page is ready on desktop computer,

      // Only when a user clicks on play control or image on mobile

      function myAutoPlay() {

          var myVideo = document.getElementsByTagName(&apos;video&apos;)&lbrack;0&rbrack;;

          myVideo.play();

      }

      function addMyListeners(){

          var myVideo = document.getElementsByTagName(&apos;video&apos;)&lbrack;0&rbrack;;

          myVideo.addEventListener(&apos;progress&apos;, getPercentProg, false);

          // Calls autoplay only if the device is adapted

          myVideo.addEventListener(&apos;canplaythrough&apos;, myAutoPlay, false);

      }

  &lt;/script&gt;

&lt;/head&gt;

&lt;body onload=&quot;addMyListeners()&quot;&gt;

    &lt;h1&gt;Check progression of buffering before playing a movie. Useful withy

        slow connexion (3G, etc.)&lt;/h1&gt;

    &lt;div&gt;

      &lt;video controls&gt;

          &lt;source src=https://html5doctor.com/demos/video-canvas-magic/video.webm

                  type=video/webm&gt;

          &lt;source src=https://html5doctor.com/demos/video-canvas-magic/video.ogg  

                  type=video/ogg&gt;

          &lt;source src=https://html5doctor.com/demos/video-canvas-magic/video.mp4

                  type=video/mp4&gt;

      &lt;/video&gt;

      &lt;p id=&quot;loadStatus&quot;&gt;Buffering\...&lt;/p&gt;

    &lt;/div&gt;

&lt;/body&gt;

&lt;/html&gt;

### Example #4: how to use SVG elements as external controllers

This is the ultimate way of doing a real custom player: redesign your own controls using SVG shapes! This example (try it [online](https://www.w3.org/2010/Talks/0430-www2010-plh/video-player.xhtml)) is given &quot;as is&quot; for those of you who may be curious.

<!------------------------------------------------------------------------------------------------>
<!-------------------------------------- 85. cup on table ---------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image085.png?raw=true"
   alt="Snapshot of the Online Example of a Custom XHTML5/SVG Video Player.  Image Shows a Cup of Coffee on a Table"
   width="25%" />
&nbsp;

### Example #5: a custom video player written by a previous student

This is more an example than a tutorial. Maurice, a student who followed the precursor version of this MOOC, had the assignment to write a custom video player with playlist, video thumbnails, custom play/pause/next/previous/volume controls, and present it in a Web page that used a nice layout based on the HTML5 structuring elements studied previously.

Here is the online example. We recommend that you look at the source code:

<h3 id="ch2-3-1">2.3.1 HTML5 Captioning</h3>

This section introduces the HTML5 &lt;track&gt; element, useful for adding closed captions, subtitles, descriptions, and metadata to your videos. It comes with a new JavaScript API.

The WebVTT format used for describing a track file is also presented in this chapter.

### Most of the major desktop browsers support HTML5 captioning

Please check the[ browser support](https://caniuse.com/mdn-html_elements_track) related to the &lt;track&gt; element support by browsers.

### Some definitions

-   **closed captions **describe all relevant audio present in the video (fire, rain, birds, gun fights, etc.).

-   **subtitles **are only for spoken words.

The accessibility features of TV programs often propose both options for people with hearing deficiencies. 

### Typical use: add a subtitle/caption track to a &lt;video&gt; element

**Important warning!!**

The &lt;track&gt; element cannot be used with a file:// URL. Please use https:// and a Web server. Your server must use a special MIME format for the .vtt files: text/vtt;charset=utf-8 (set by default on most servers now).

Examples of the lines to add to an Apache Web server:

1.  &lt;Files mysubtitle.vtt&gt;

2.  ForceType text/vtt;charset=utf-8

3.  &lt;/Files&gt;

It is worth mentioning that most browsers work well with WebVTT, even if the MIME type is not defined.

Here is an example of a video element that includes a &lt;track&gt; element in the .vtt (WebVTT) format (*line 9 *in the source code shown below):

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![](./images/image086.png){width="6.5in" height="2.0881944444444445in"}

The example uses a &lt;track&gt; element to insert basic *captions* to the video: sounds and music are described, in addition to standard *subtitles* that correspond to what the different movie characters say.

&lt;video height=&quot;272&quot; width=&quot;640&quot;

       poster=&quot;https://mainline.i3s.unice.fr/mooc/q1fx20VZ-640.jpg&quot;

       **crossorigin=&quot;anonymous&quot;**

       controls&gt;

   &lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/sintel.mp4&quot;

           type=&quot;video/mp4&quot;&gt;

   &lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/sintel.webm&quot;

           type=&quot;video/webm&quot;&gt;

   **&lt;track src=&quot;https://mainline.i3s.unice.fr/mooc/sintel-captions.vtt&quot;**

**          kind=&quot;captions&quot; label=&quot;Closed Captions&quot; default&gt;**

&lt;/video&gt;

**Notes:**

-   The &lt;track&gt; element at *line 9* has an attribute named kind that indicates the type of the track that is included. Possible values are: subtitles, captions, descriptions, chapters or metadata.

```
<!-- -->
```
-    The &lt;track&gt; element also has an attribute default that indicates that we want this track to be displayed by default when reading the video.

```
<!-- -->
```
-   We also used  an attribute named crossorigin that is necessary just to run this demo, as it is required by the server that hosts the video from this example (server = codepen.io, but as the video and .vtt files come from another origin -another server-, this attribute is necessary).

### Multiple tracks may be included in a video element

Multiple tracks are needed to support different langages, video captions for the hearing-impaired, subtitles, etc.

Below is an example ([from the specification](https://html.spec.whatwg.org/multipage/media.html#the-track-element)) that includes multiple &lt;track&gt; elements (subtitles for three languages and captions only for English):

&lt;video src=&quot;brave.webm&quot;&gt;

   &lt;track kind=subtitles src=brave.en.vtt

          srclang=en

          label=&quot;English&quot;&gt;

   &lt;track kind=captions src=brave.en.hoh.vtt

          srclang=en

          label=&quot;English for the Hard of Hearing&quot;&gt;

   &lt;track kind=subtitles src=brave.fr.vtt

          srclang=fr

          lang=fr 

          label=&quot;Français&quot;&gt;

   &lt;track kind=subtitles src=brave.de.vtt

          srclang=de

          lang=de

          label=&quot;Deutsch&quot;&gt;

&lt;/video&gt;

Note the use of some new attributes in the &lt;track&gt; element:

-   label: the label value will be displayed in the GUI control that is included in the default HTML5 video player,

-   srclang:  gives the language for the text track data. The value must be a valid [BCP 47 language tag](https://tools.ietf.org/html/bcp47). This attribute must be present if [the element&apos;s kind attribute](https://www.w3.org/TR/html5/embedded-content-0.html#attr-track-kind) is in the [subtitles state](https://www.w3.org/TR/html5/embedded-content-0.html#attr-track-kind-subtitles).

### External resources

-   From the HTML specification: [The track element](https://html.spec.whatwg.org/multipage/media.html#the-track-element)

-   From the W3C specification:  [WebVTT: The Web Video Text Tracks Format](https://www.w3.org/TR/webvtt1/)

-   From MDN&apos;s Web Docs: [WebVTT ](https://developer.mozilla.org/en-US/docs/Web/API/WebVTT_API)and [Adding captions and subtitles to HTML5 video](https://developer.mozilla.org/en-US/docs/Web/Guide/Audio_and_video_delivery/Adding_captions_and_subtitles_to_HTML5_video)

-   An article from 3playmedia: [How to create a WebVTT file](https://www.3playmedia.com/2017/06/30/how-to-create-a-webvtt-file/)

<h3 id="ch2-3-2">2.3.2 The WebVTT Format</h3>

The &quot;[WebVTT: The Web Video Text Tracks Format](http://dev.w3.org/html5/webvtt/)&quot; defines files that contain text for captions and subtitles, and much more\... The WebVTT files are used with the src attribute of the &lt;track&gt; element, that can be used inside a &lt;video&gt;\...&lt;/video&gt;.

In the interactive example presented before, we used a file called sintel-captions.vtt:

&lt;video height=&quot;272&quot; width=&quot;640&quot;

       poster=&quot;https://mainline.i3s.unice.fr/mooc/q1fx20VZ-640.jpg&quot;

       crossorigin=&quot;anonymous&quot;

       controls&gt;

   \...

   &lt;track src=&quot;https://mainline.i3s.unice.fr/mooc/**sintel-captions.vtt**&quot;

          kind=&quot;captions&quot; label=&quot;Closed Captions&quot; default&gt;

&lt;/video&gt;

And here is an extract of the corresponding [sintel-captions.vtt](https://mainline.i3s.unice.fr/mooc/sintel-captions.vtt) file:
```
1.  WEBVTT
2.  
3.  00:00:01.000 \--&gt; 00:00:02.042
4.  (drumbeat)
5.  
6.  00:00:07.167 \--&gt; 00:00:12.025
7.  (plaintive violin solo playing)
8.  
9.  00:00:15.000 \--&gt; 00:00:18.183
10. (wind whistling)
11. 
12. 00:00:24.167 \--&gt; 00:00:27.025
13. (orchestra music swells)
14. 
15. 00:00:43.033 \--&gt; 00:00:43.192
16. (weapons clash)
17. 
18. 00:00:44.000 \--&gt; 00:00:44.175
19. (gasps)
20. 
21. 00:00:44.183 \--&gt; 00:00:45.158
22. (grunts)
23. 
24. 00:00:45.167 \--&gt; 00:00:47.058
25. (groaning)
26. 
27. 00:00:54.192 \--&gt; 00:00:55.150
28. (blade rings)
29. 
30. 00:00:55.158 \--&gt; 00:00:57.008
31. (bellowing)
32. 
33. 00:00:57.017 \--&gt; 00:00:58.067
34. (grunting)
35. 
36. 00:00:59.075 \--&gt; 00:01:00.133
37. (panting)
38. 
39. 00:01:05.108 \--&gt; 00:01:06.125
40. (cries out in agony)
41. 
42. 00:01:08.050 \--&gt; 00:01:09.058
43. (panting)
44. 
45. 00:01:12.092 \--&gt; 00:01:13.142
46. (panting)
47. 
48. 00:01:14.017 \--&gt; 00:01:18.125
49. (orchestra plays ominous low notes)
50. 
51. 00:01:31.058 \--&gt; 00:01:35.133
52. (plaintive violin solo returns)
53. 
54. 00:01:46.158 \--&gt; 00:01:49.058
55. This blade has a dark past.
56. 
57. 00:01:51.092 \--&gt; 00:01:54.108
58. It has shed much innocent blood.
59. 
60. 00:01:57.083 \--&gt; 00:02:00.000
61. You&apos;re a fool for traveling alone
62. so completely unprepared.
63. 
64. 00:02:01.100 \--&gt; 00:02:03.033
65. You&apos;re lucky your blood&apos;s still flowing.
66. 
67. 00:02:04.183 \--&gt; 00:02:06.075
68. Thank you.
```

This format is rather simple, but we still recommend reading [this excellent article from Mozilla Developer Network ](https://developer.mozilla.org/fr/docs/Web/API/WebVTT_API)that explains in detail all the different options.

Each &quot;element&quot; in this file has a starting and ending time, plus a value (the text that will be displayed), followed by a blank line (blank lines are separators between elements).

**Each element is called &quot;a cue&quot;**, and may optionally have an ID that will be useful when using the track element JavaScript API, in particular the getCueById() method of TextTrack objects.

Example of a .vtt file with numeric IDs:

1.  9

2.  00:00:21.000 \--&gt; 00:00:22.000

3.  to hear from &lt;u&gt;you&lt;/u&gt;

4.  

5.  10

6.  00:00:22.500 \--&gt; 00:00:25.000

7.  We want to hear what inspires you as a developer

IDs may also be defined as strings, and values can use HTML as well:

1.  Opening

2.  00:00:00.000 \--&gt; 00:00:30.000

3.  Welcome to our &lt;i&gt;nice film&lt;/i&gt;

The displayed text can span multiple lines, but blank lines are not allowed, as they would be interpreted as a separator:

1.  00:01:57.083 \--&gt; 00:02:00.000

2.  &lt;p&gt;You&apos;re a fool for traveling alone&lt;/p&gt;

3.  &lt;p&gt;so completely unprepared.&lt;/p&gt;

### External resource:

-   An unofficial [Live WebbVTT format](https://quuz.org/webvtt/)

<h3 id="ch2-3-3">2.3.3 Adding Subtitles to a Video</h3

Let&apos;s look at a simple example. First, you need a video on one of the formats/codecs supported by the browsers you target. A recommended codec is mp4/H264, but other formats, such as webm, may have some advantages if the browser supports them. For example, webm allows the video to start playing after a much shorter buffering time. In other words, try if possible to provide the video encoded with more than one codec.

For this, use any sort of open source, free or commercial video encoding software, such as [Handbrake](https://handbrake.fr/) (free, open source) or [Super](https://www.erightsoft.com/SUPER.html) (free). There are also online video encoding services, and you can even upload your video to YouTube, let it encode your video in several resolutions and codecs, and use a browser extension such as [Video DownloadHelper ](https://addons.mozilla.org/fr/firefox/addon/video-downloadhelper/)(for Firefox) or [JDownloader](https://jdownloader.org/), to download the video in your chosen formats.

So, let&apos;s suppose you have a video like the one below (we included it on YouTube for practical reasons). This video has subtitles (you can activate them in the YouTube player), but the goal of this lesson is to explain how we made them without using the YouTube embedded tools, which do not allow export the subtitle file to be exported in the webVTT format.

<!------------------------------------------------------------------------------------------------>
<!-------------------------------------- 87.  ---------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image087.png?raw=true"
   alt=""
   width="25%" />
&nbsp;

And if you&apos;ve also got it in mp4/H264 and in webm formats, here is how you can embed it in your page using the video element:

&lt;video id=&quot;myVideo&quot; width=500 controls&gt;

  &lt;source  

      src=&quot;videos/SameOldSongAndDanceRogerLathaudPart1MidRes.mp4&quot;

      type=&quot;video/mp4&quot;&gt;

  &lt;source   

      src=&quot;videos/SameOldSongAndDanceRogerLathaudPart1MidRes.webm&quot;

      type=&quot;video/webm&quot;&gt;

 

  &lt;track src=&quot;videos/subtitles.vtt&quot;   

         kind=&quot;subtitles&quot; srclang=&quot;en&quot; default&gt;

&lt;/video&gt;

At *line 9*, we added a &lt;track&gt; element to add English subtitles, as the guitar teacher there is speaking in French. We will now explain how we created this subtitle track.

### Adding subtitles to the video

Now, we need to create a WebVTT file for this video. How can we synchronize an English translation of what the guitar teacher says in French?

Many tools - both free and commercial - are available to add subtitles to a video. Most are native applications you need to install on your computer. However, a free and very practical tool is available for doing this 100% in a Web browser: [amara](https://amara.org/en/).

Go to the above Web site, click on the &quot;subtitle a video&quot; link, then follow the different tutorials/instructions. It will ask for a YouTube URL, so it&apos;s better to first upload your video to YouTube (even in private mode). Once you have entered the URL of your video, you will have an online subtitles/caption editor. Enter your subtitles and sync them until you are happy with the results.
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![](./images/image088.png){width="4.0in" height="3.3752187226596675in"}

Once your subtitles/captions are ok, you will be able to upload them to YouTube, or -this is what we wanted first- download them as WebVTT format:
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![](./images/image089.png){width="6.0in" height="5.204489282589677in"}

Note that YouTube can also help you &quot;make subtitles&quot; with its speech recognition tool, but you will only be able to export in .srt format afterwards. You will have to convert this format afterwards to .vtt.

### Try your subtitled/captioned video
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![](./images/image090.png){width="4.0in" height="2.306801181102362in"}

<h3 id="ch2-3-4">2.3.4 Styling Captions</h3>

In this section, we will look at different possibilities for styling and positioning  the text displayed as captions/subtitles while playing a video.

The example below shows how we can do that (play the video for 40s, look at the positions and styles of the subtitles and captions, look at the HTML):
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![](./images/image091.png){width="6.0in" height="1.9147419072615923in"}

The WebVTT file is shown below. Notice the new attributes that have been added on the right end of the duration values:

1.  WEBVTT

2.  

3.  00:00:01.000 \--&gt; 00:00:05.000

4.  These captions test some features of the WebVTT formats

5.  

6.  00:00:06.000 \--&gt; 00:00:10.000** line:5%**

7.  This cue is positioned at the top of the video

8.  

9.  00:00:11.000 \--&gt; 00:00:15.000** position:5% align:start**

10. This cue is positioned at the left side of the video.

11. 

12. 00:00:16.000 \--&gt; 00:00:20.000 position:95%** align:end**

13. And this one ate the right side.

14. 

15. 00:00:21.000 \--&gt; 00:00:25.000** size:33%**

16. This cue is only a third of the width of the video, hence the multiple line breaks.

17. 

18. 00:00:26.000 \--&gt; 00:00:30.000

19. This cue contains **&lt;b&gt;**bold**&lt;/b&gt;** text.

20. 

21. 00:00:31.000 \--&gt; 00:00:35.000

22. This cue contains **&lt;i&gt;**italic**&lt;/i&gt;** text.

23. 

24. 00:00:36.000 \--&gt; 00:00:40.000

25. This cue contains **&lt;u&gt;** **&lt;/u&gt;** text.

26. 

27. 00:00:41.000 \--&gt; 00:00:45.000

28. This cue contains **&lt;b&gt;&lt;i&gt;&lt;u&gt;**bold, italic, underlined**&lt;/u&gt;&lt;/i&gt;&lt;/b&gt;** text.

29. 

30. 00:00:46.000 \--&gt; 00:00:50.000

31. **&lt;c.myclass&gt;**This cue contains the class &quot;myclass&quot;.

32. Browsers that support ::cue CSS should make it red.**&lt;/c&gt;**

33. 

34. 00:00:51.000 \--&gt; 00:00:55.000

35. The following cue contains two voices.

36. Tarzan should be blue and Jane green.

37. 

38. 00:00:56.000 \--&gt; 00:01:00.000

39. &lt;v Tarzan&gt;Me Tarzan\...

40. &lt;v Jane&gt;That would make me Jane!

41. 

42. bigtext

43. 00:01:01.000 \--&gt; 00:01:05.000

44. This cue has a unique id.

45. Using CSS, its font size should be 150%.

46. 

47. 00:01:06.000 \--&gt; 00:01:10.000

48. The &lt;00:01:06.333&gt;text &lt;00:01:06.666&gt;in &lt;00:01:07.000&gt;this &lt;00:01:07.333&gt;cue &lt;00:01:07.666&gt;should &lt;00:01:08.000&gt;grow

49. &lt;00:01:08.333&gt;one &lt;00:01:08.666&gt;word &lt;00:01:09.000&gt;at &lt;00:01:09.333&gt;a &lt;00:01:09.666&gt;time

50. 

51. 00:01:11.000 \--&gt; 00:01:15.000

52. That&apos;s it! For now\...

### How to position the subtitles
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![](./images/image092.png){width="6.5in" height="6.856944444444444in"}

The video example tests nearly all the possibilities for positioning subtitles/captions, styling (using HTML element wrapping with &lt;b&gt;, &lt;i&gt;,  etc.), voicing (subtitles corresponding to different characters will be displayed in different colors) and CSS styling.

It is possible to locate the cues in the video viewport using absolute or relative values. The attributes that position the text are located on the same line as the cue definition, like at *line 9* of the previous WebVTT example file:

9.  00:00:11.000 \--&gt; 00:00:15.000** position:5% align:start**

10. This cue is positioned at the left side of the video.

There are several possible values:

-   **line:5%** means &quot;vertical position at a line 5% of the height of the video viewport (it will be located at the top of the video, proportional to its vertical size).

-   **position:5% align:start** means &quot;regular location at the bottom of the video, the start of the sentence will be located at 5% of the width of the video&quot;, i.e., near the left side.

-   **position:95% align:end** means &quot;regular location at the bottom of the video, the end of the sentence will be at 95% of the horizontal width of the video&quot;.

-   **size:33%** The size of each line will be one third of the size of the video. Since the sentence won&apos;t fit, it will be displayed in multiple lines.

And so on. Please look at the video as it is self-explanatory.

### Use of &lt;b&gt;, &lt;i&gt;, &lt;u&gt; for styling subtitles / captions

One can use the HTML elements  &lt;b&gt;, &lt;i&gt;, &lt;u&gt; to modify the rendering of subtitles and captions, as illustrated in the example below:
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![](./images/image093.png){width="6.5in" height="2.8361111111111112in"}

### Using CSS classes for styling

It is possible to style using CSS classes as part of a cue value, using the &lt;c&gt; element. You can specify the CSS class that should be applied by adding &quot;.&quot; followed by the name of your CSS class. Here is an example:

1.  &lt;c.myclass&gt;This cue contains the class &quot;myclass&quot;.

2.  Browsers that support ::cue CSS should make it red.&lt;/c&gt;
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![Snaphot of a video frame showing a cue containing the class &apos;myclass&apos;. Browsers that support ::cue CSS should make it red](./images/image094.jpeg){width="6.5in" height="2.8097222222222222in"}

CSS rules used in this example:

1.  &lt;style type=&quot;text/css&quot;&gt;

2.       ::cue(.myclass) { color: red; }

3.       ::cue(v&lbrack;voice=&quot;Tarzan&quot;&rbrack;) { color: blue; }

4.       ::cue(v&lbrack;voice=&quot;Jane&quot;&rbrack;) { color: green; }

5.       ::cue(#bigtext) { font-size: 150%; }

6.  &lt;/style&gt;

The ::cue pseudo element selector is used to match &quot;cues&quot; in the webVTT file. You add parenthesis and a secondary CSS selector to match cues that have a particular id, or a particular CSS class, etc. Look at the CSS above and at the extract from the webVTT file, play the video, you will understand how the above CSS classes affect the rendering of the subtitles for Jane and Tarzan&apos;s voices.

Support differs from one browser to another, see [this compatibility table](https://caniuse.com/#feat=webvtt) (from CanIuse). Note however that most of the enhanced players presented further on in the course provide full support.

### Using voicing for styling: the &lt;v&gt; element

Here is an example that shows the voices of the different characters displayed with different colors:
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![](./images/image095.png){width="6.5in" height="2.765277777777778in"}

Using the &lt;v&gt; tag, you will distinguish different voices that should be displayed in different colors (depending on the HTML5 video player implementation). See the CSS presented in the previous section to see how to specify the colors for the different voices.

Example source code:

1.  00:00:56.000 \--&gt; 00:01:04.000

2.  &lt;v Tarzan&gt;Me Tarzan\...

3.  &lt;v Jane&gt;That would make me Jane!

<h3 id="ch2-3-5">2.3.5 Chapter</h3>

When you play a movie in DVD or Blu-Ray format, a menu appears on the screen: play a movie, choose subtitles, etc. Usually there is also a &quot;chapters&quot; menu that allows you to quickly access a part of the movie. With videos on the Web, one can also indicate the chapter breakdown, using WebVTT files and a &lt;track&gt; element/tag.

Adding chapters is very similar to adding subtitles/captions. Look at *line 5* in the code below, where we use an extra &lt;track&gt; element with a kind=&quot;chapters&quot; attribute.

1.  &lt;video poster=&quot;webvtt_talk.png&quot; style=&quot;width:100%&quot; preload=&quot;metadata&quot;&gt;

2.      &lt;source src=&quot;webvtt_talk.webm&quot;&gt;

3.      &lt;source src=&quot;webvtt_talk.mp4&quot;&gt;

4.      &lt;source src=&quot;webvtt_talk.ogv&quot;&gt;

5.      &lt;track id=&quot;nav&quot; src=&quot;webvtt_talk_navigation.vtt&quot; **kind=&quot;chapters&quot;** srclang=&quot;en&quot;&gt;

6.      &lt;track id=&quot;cc&quot; src=&quot;webvtt_talk_captions.vtt&quot; kind=&quot;captions&quot;

7.            label=&quot;captions&quot; srclang=&quot;en&quot; default&gt;

8.  &lt;/video&gt;

Here is an example of WebVTT files with defined chapters. Each &quot;CUE&quot; at *lines 3, 7, 11*, \... can bear any name. We use &quot;Chapter 1, Chapter 2, Ending, etc.&quot; but you are free to name them as you wish.

What makes them special is that the track has an attribute kind=&quot;chapters&quot;. 

Often, the &lt;video&gt; elements rendered in standard browsers ignore chapters, but enhanced HTML5 players take them into account, and it&apos;s not much of a stretch to make your own enhanced player with a nice chapter presentation, as we&apos;ll see in a more advanced chapter of this course.  For example, we&apos;ll generate a custom navigation menu, using the &lt;track&gt; JavaScript API (explained later in this section).

Example of a WebVTT file that defines chapters:

1.  WEBVTT FILE

2.   

3.  Chapter 1

4.  00:00:00.000 \--&gt; 00:00:10.700

5.  Title Slide

6.   

7.  Chapter 2

8.  00:00:10.700 \--&gt; 00:00:47.600

9.  Introduction by Naomi Black

10.  

11. Chapter 3

12. 00:00:47.600 \--&gt; 00:01:50.100

13. Impact of Captions on the Web

14.  

15. Chapter 4

16. 00:01:50.100 \--&gt; 00:03:33.000

17. Requirements of a Video text format

18.  

19. Ending

20. 00:03:33.000 \--&gt; 00:04:57.766

21. Simple WebVTT file

22.  

23. Greetings 6

24. 00:04:57.766 \--&gt; 00:06:16.666

25. Styled WebVTT file

An example of what you can achieve using chapters, using the [JW Player](https://www.jwplayer.com/):
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![](./images/image096.png){width="6.5in" height="2.527083333333333in"}

<h3 id="ch2-3-6">2.3.6 Tools for Creating WebVTT Files</h3>

Many tools are available to make and edit HTML5 video and caption/subtitles:

-   **Tools for converting existing file formats to  WebVTT files**, such as [Simple SubRip to WebVTT](https://atelier.u-sub.net/srt2vtt/) converter, which is popular in the DivX/AVI/Mkv/mp4 scene. Do a quick Web search and you will get plenty of other results.

-   **Tools for creating subtitles/captions from scratch. Use these to generate a WebVTT file. **You can embed the &lt;track&gt; element in your own videos, on your own Web pages, or upload the WebVTT file to YouTube.  We recommend [amara](https://amara.org/en/). It&apos;s a free online tool that is very easy to use. There are also apps such as[ Subs Factory](https://www.macupdate.com/app/mac/25826/subs-factory) (Mac OS), [Jubler](https://jubler.org/) or [Subtitle Edit](https://nikse.dk/SubtitleEdit) (Windows).

-   **Enhanced HTML5 video players** that use the &lt;video&gt;, &lt;source&gt; and &lt;track&gt; elements under the hood. They also provide many extra features, including **support for subtitle/caption formats other than WebVTT (by converting on the fly)**.

We do not claim that these are the best tools, so feel free to share your discoveries in the discussion forum!

<h3 id="ch2-3-7">2.3.7 The &lt;track&gt; JavaScript API</h3>

Most &quot;complex&quot; HTML elements like forms, audio or video players, come with a JavaScript API that allows you to control them programmatically, customize them, etc.

The &lt;track&gt; element comes with a powerful API that is used to develop many interesting features such as:

-   Dynamically building a navigation menu that shows the different chapters of the video,

-   Synchronizing page content with timestamps in the WebVTT file (for example: show a map next to the video, that shows the location corresponding to the video content),

-   Displaying all the subtitles/captions at once as HTML in the page,

-   Making an app for creating on the fly subtitles/captions,

-   Etc.

### Examples of use

#### Example #1: add a navigation menu to start playing the video at given chapters

This example shows a video with an enhanced progress bar that displays the different chapters as small &quot;clickable&quot; squares. Furthermore, using the JavaScript API of the &lt;track&gt; element, this Web site builds a navigation menu (on the right of the video):
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![navigation menu using the track javascript api](./images/image097.jpeg){width="6.5in" height="3.5965277777777778in"}

#### Example #2: sync video with Google Map and Google Street View

Check [this demo](https://simpl.info/track/map/index.html) (only on Chrome) by [Sam Dutton](https://samdutton.com/): it shows a video that comes with a WebVTT file that contains longitudes and latitudes. When the video plays, JavaScript functions are called at given times and get the longitude and latitude. A Google Map and a Google Street views are updated in real time.
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![video sync with map and street view](./images/image098.jpeg){width="6.5in" height="5.80625in"}

#### Example #3: sync guitar tablatures and music score with a video

This example shows how we manage to render music scores in real time as the video plays. 

Some JavaScript code listens to the ontimeupdate event while the video is playing. We use the currentTime property of the video to know exactly where we are in the video. Finally, we also rely on an external library to render in an HTML5 canvas the bars corresponding to the current video explanations. We render in real time guitar pro tablatures using the alphatab.net library.
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>

![](./images/image099.png){width="5.0in" height="2.784694881889764in"}

<h3 id="ch2-3-8">2.3.8 Enhanced HTML5 Video Players</h3>

There are numerous &quot;enhanced&quot; video players; most are free and open source, some are commercial. They offer lots of features, which are listed below. Not all of these features are available in every player, this list just illustrates what can be added to the standard &lt;video&gt; element. 

We call them &quot;HTML5 enhanced video players&quot; because on top of being based on the &lt;video&gt; element, they come with custom features, custom look&apos;n&apos;feel, chapters, etc., based on a JavaScript API that makes such customization possible.

### Accessible players

For those of you interested in this particular topic, here is a very good resource that compares most of the players presented in this section, in terms of accessibility. This resource has links to players designed especially for people with disabilities: [accessible media players and resources](https://www.digitala11y.com/accessible-jquery-html5-media-players/).

### Advantages and disadvantages of using a custom player

**Advantages of enhanced video players:**

-   Support for all kinds of subtitle formats

-   Customizable look&apos;n&apos;feel (add your logo, custom themes, etc.)

-   Full screen mode without borders on old browsers (today&apos;s implementations of the &lt;video&gt; element support full screen mode)

-   Consistent look&apos;n&apos;feel across browsers (menus for subtitles, etc.)

-   1.5x, 2x, 3x speeds for fast playback

-   Social buttons for sharing on Facebook, Twitter, etc.

-   Support for chapters

-   Support for scrub bar thumbnails

-   Extra features for better accessibility

-   And so on\...

**Advantages of relying only on the &lt;video&gt; element  rather than on an enhanced player:**

-   Total control!

-   No need for external dependencies

-   Lightweight: no need to download lots of JavaScript and CSS code

### Video.js: a framework for building your own custom video player

Open source, and made for developers, [video.js](https://videojs.com/) comes with many plugins (chapters, thumbnails etc.). 

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![VideoJS examples](./images/image100.png){width="6.145833333333333in" height="4.395833333333333in"}

### Which should I use? the &lt;video&gt; element and my own customization or an out of the box enhanced player?

Either solution (basic player or enhanced player) is good and HTML5 compliant.

Popular players such as  [JWPlayer](https://www.jwplayer.com/) have many explanations and examples on their Web sites, and are either free of charge or come with free versions.

**Interesting comparisons and reviews are available on the following Web sites:**

-   Comparison matrix of most of [existing HTML5 video players](https://videosws.praegnanz.de/)

-   [10 HTML5 video players compared](https://toppersworld.com/10-html5-video-players-as-alternatives-to-flash-player/)

### Example screenshots

Scrub Bar thumbnails (JWPlayer)

![scrub bar thumbnails](./images/image101.jpeg){width="4.84375in" height="3.6458333333333335in"}

Custom look&apos;n&apos;feel and logo (Sublime video player):

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![custom look&apos;n&apos;feel and logo](./images/image102.jpeg){width="5.0in" height="2.8125in"}

Chapters and chapter thumbnails (JWPlayer):

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![chapters and chapter thumbnails](./images/image103.png){width="5.229166666666667in" height="2.3333333333333335in"}

PayPal accessible player:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![paypal accessible player](./images/image104.png){width="5.427083333333333in" height="3.4895833333333335in"}

LeanBack (says &quot;free for non-commercial use&quot;, licensing is not very clear\...):

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![](./images/image105.png){width="6.0in" height="5.586537620297463in"}

<h3 id="ch2-4-1">2.4.1 Webcam</h3>

### Introduction

HTML5 has introduced, with the getUserMedia and MediaDevices APIs, a way to control webcams and microphones programmatically. This allows, for example, to create an identification form where one can simply click on a button to capture his portrait from the Webcam of his computer or smartphone. It will also allow to record a video or audio extract (for example for a &quot;telephone answering machine&quot; type application), to create video conference applications running in the Web browser, or even musical applications if you plug a guitar into a sound card. The possibilities are numerous.\
\
We will therefore study together how to access the audio and video streams of the hardware on which a Web application is going to run, and how to parameterize them (choice of camera, resolution, etc.).

### The getUserMedia API

The [getUserMedia API](https://www.w3.org/TR/mediacapture-streams/) is useful for controlling a Webcam video stream.

This API is one component of the [WebRTC specification](https://www.w3.org/TR/webrtc/). When using getUserMedia, to manage a webcam with its video stream, we will always use it in conjunction with the &lt;video&gt; element. We could also use it with the &lt;audio&gt; element if we are only interested in using a microphone (i.e. from a computer), or any sound input .

The getUserMedia API, when dealing with video streams, is always used in conjunction with the &lt;video&gt; element.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![screenshot of a simple Web camera webcam display in a Web page](./images/image106.jpeg){width="3.3020833333333335in" height="3.15625in"}

### Typical use of the getUserMedia API with a Webcam

The main idea is to set the srcObject attribute of a &lt;video&gt; element to the live video stream object coming out of the Webcam. To get this stream, you&apos;ll have to call the navigator.getUserMedia(params) method from the getUserMedia API, that returns an ES6 promise (ES stands for &quot;ECMAScript&quot; and is the scripting language that forms the basis of JavaScript). Do not panic if you do not know ES6&apos;s promises! The syntax is very simple, and you&apos;ll learn what you need from the provided examples.

The stream is passed as a parameter to the then() method returned by the promise, as in this typical example (you can run it and see the result by clicking on the &quot;CodePen&quot; logo at the top right):

&lt;video id=&quot;myVideo&quot; autoplay&gt;Fallback msg here.&lt;/video&gt;

&lt;script&gt;

if (navigator.mediaDevices.getUserMedia) {

// request video and audio stream from the user&apos;s webcam

navigator.mediaDevices.getUserMedia({

audio: true,

video: true

}).then((stream) =&gt; {

let video = document.querySelector(&apos;#myVideo&apos;);

video.srcObject = stream;

video.play();

}).catch((error) =&gt; {

console.log(&apos;navigator.getUserMedia error: &apos;, error);

});

}

&lt;/script&gt;

We can also simplify the code by using a writing with async/await of JavaScript:

&lt;video id=&quot;myVideo&quot; autoplay&gt;Fallback msg here.&lt;/video&gt;

&lt;script&gt;

async function startWebCam() {

// request video and audio stream from the user&apos;s webcam

let stream = await navigator.mediaDevices.getUserMedia({

audio: true,

video: true

});

let video = document.querySelector(&apos;#myVideo&apos;);

video.srcObject = stream;

video.play();

}

startWebCam();

&lt;/script&gt;

**HTTPS is mandatory:** for getUserMedia to work, it is mandatory to access the page that contains the JavaScript code through https://, for security reasons.

Support of getUserMedia/stream is [very good in all modern browsers](https://caniuse.com/stream), including mobile ones. All the video conferencing applications you use that run in a Web browser are based on this API (Google Meet, Jitsi, Bigblue Button), and even Microsoft Teams is a web application in disguise.

### 2.4.1 More On getUserMedia

Let&apos;s see some more examples of what we can do with the getUserMedia API: start/stop the Webcam, take a screenshot from the current video stream from the Webcam, and apply CSS effects in real time. Below, we give links to some cool examples available on the Web.

### How to stop/release the Webcam

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Resulting image of Michel Buffa using his WebCam, with two custom controls below: &apos;Start WebCam&apos; and &apos;Stop WebCam&apos;](./images/image107.jpeg){width="3.1875in" height="3.4583333333333335in"}

```
<!DOCTYPE html&gt;
<html lang=&quot;en&quot;&gt;
<head&gt;
<meta charset=&quot;utf-8&quot;&gt;
<title&gt;Webcam start/stop&lt;/title&gt;
<script&gt;
let webcamStream;
function startWebcam() {
// request video and audio stream from the user&apos;s webcam
navigator.mediaDevices.getUserMedia({
audio: true,
video: true
}).then((stream) =&gt; {
let video = document.querySelector(&apos;#video&apos;);
video.srcObject = stream;
video.play();
webcamStream = stream;
}).catch((error) =&gt; {
console.log(&apos;navigator.getUserMedia error: &apos;, error);
});

}
function stopWebcam() {
webcamStream.getTracks()&lbrack;0&rbrack;.stop(); // audio
webcamStream.getTracks()&lbrack;1&rbrack;.stop(); // video
}
</script&gt;
</head&gt;
<body &gt;
<video width=400 height=400 id=&quot;video&quot; controls&gt;&lt;/video&gt;
<p&gt;
<button onclick=&quot;startWebcam();&quot;&gt;Start WebCam&lt;/button&gt;
<button onclick=&quot;stopWebcam();&quot;&gt;Stop WebCam&lt;/button&gt;
</p&gt;
</body&gt;
&lt;/html&gt;
```

In order to stop the Webcam and make the hardware &quot;unlock it&quot;, you need to call the stop() method of the video stream.

Code source:
```
1.  &lt;!DOCTYPE html&gt;
2.  &lt;html lang=&quot;en&quot;&gt;
3.  &lt;head&gt;
4.  &lt;meta charset=&quot;utf-8&quot;&gt;
5.  &lt;title&gt;Webcam start/stop&lt;/title&gt;
6.  &lt;script&gt;
7.    let webcamStream;
8.   
9.    function startWebcam() {
10.     // request video and audio stream from the user&apos;s webcam
11.     navigator.mediaDevices.getUserMedia({
12.       audio: true,
13.       video: true
14.     }).then((stream) =&gt; {
15.       let video = document.querySelector(&apos;#video&apos;);
16.       video.srcObject = stream;
17.       video.play();
18.  
19.       webcamStream = stream;
20.     }).catch((error) =&gt; {
21.         console.log(&apos;navigator.getUserMedia error: &apos;, error);
22.     });
23.   }
24.  
25.   function stopWebcam() {
26.     webcamStream.getTracks()&lbrack;0&rbrack;.stop(); // audio
27.     webcamStream.getTracks()&lbrack;1&rbrack;.stop(); // video
28.   }
29. &lt;/script&gt;
30. &lt;/head&gt;
31. &lt;body &gt;
32.   &lt;video width=400 height=400 id=&quot;video&quot; controls&gt;&lt;/video&gt;
33.   &lt;p&gt;
34.   &lt;button onclick=&quot;startWebcam();&quot;&gt;Start WebCam&lt;/button&gt;
35.   &lt;button onclick=&quot;stopWebcam();&quot;&gt;Stop WebCam&lt;/button&gt;
36.   &lt;/p&gt;
37. &lt;/body&gt;
38. &lt;/html&gt;
```

**Explanations:**

-   *Lines 11-13*: we call navigator.getUserMedia. The parameters indicate that we want to capture the video and the audio from the current device (default Webcam). The call to getUserMedia returns an ES6 promise: the then(stream) method that follows.

-   *Line 14:* the then(stream) method is called in case of success and gets the current audio/video stream as parameter. This is passed by the browser to your JavaScript code. 

-   *Lines 15-19*: The *line 16 *sets the audio/video stream of the default Webcam to the srcObject attribute of the video element, while *line 18* starts displaying it in the video player (there can be more than one Webcam, we&apos;ll see how to select one in particular next). *Line 19* stores the stream in a global variable so that we can use it from another function (for stopping/starting the Webcam\...)

-   *Lines 19-23* define the catch method called in case of error (it could be that the Webcam cannot be accessed, or authorizations have not been granted).

-   *Lines 25-27*: a function for stopping the Webcam. We use the global variable webcamStream here, that has been initialized when we started using the Webcam in *line 19*. We have to stop separately the audio and the video streams.

### Other examples that mix what we&apos;ve seen in previous chapters, but this time with a live video stream

#### Applying CSS effects on a video element with a live webcam

![Resulting image of Michel Buffa using his WebCam with css filter effects on live stream](media/image108.jpeg){width="3.0in" height="4.110464785651794in"}

Try this example that shows how to use the getUserMedia API. Note the CSS effects (click on the video to cycle from one effect to another):

//\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

// GET USER MEDIA CODE

//\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

let video;

let webcamStream;

function startWebcam() {

// request video and audio stream from the user&apos;s webcam

navigator.mediaDevices.getUserMedia({

audio: true,

video: true

}).then((stream) =&gt; {

let video = document.querySelector(&apos;#video&apos;);

video.srcObject = stream;

video.play();

webcamStream = stream;

}).catch((error) =&gt; {

console.log(&apos;navigator.getUserMedia error: &apos;, error);

});

}

function stopWebcam() {

webcamStream.getTracks()&lbrack;0&rbrack;.stop(); // audio

webcamStream.getTracks()&lbrack;1&rbrack;.stop(); // video

}

//\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

// CODE FOR CHANGING CSS FILTERS

//\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

let idx = 0;

let filters = &lbrack;

&apos;grayscale&apos;,

&apos;sepia&apos;,

&apos;blur&apos;,

&apos;brightness&apos;,
&apos;contrast&apos;,
&apos;hue-rotate&apos;, &apos;hue-rotate2&apos;, &apos;hue-rotate3&apos;,
&apos;saturate&apos;,
&apos;invert&apos;
&rbrack;;
function changeFilter(el) {
// Remove all CSS classes for element el
el.className = &apos;&apos;;
// Choose a CSS class name
console.log(&quot;toggling effect: &quot; + filters&lbrack;idx % filters.length&rbrack;);
let effect = filters&lbrack;idx++ % filters.length&rbrack;;
el.classList.add(effect);
}

<h4>CSS</h4>
```
#output {
width: 307px;
height: 250px;
background: rgba(255,255,255,0.5);
border: 1px solid #ccc;
}
#screenshot-stream {
width: initial;
height: initial;
}
#screenshot {
vertical-align: top;
}
.blur {
filter: blur(3px);
}
.brightness {
filter: brightness(5);
}
.contrast {
filter: contrast(8);
}
.hue-rotate {
filter: hue-rotate(90deg);
}
.hue-rotate2 {
filter: hue-rotate(180deg);
}
.hue-rotate3 {
filter: hue-rotate(270deg);
}
.saturate {

filter: saturate(10);

}

.grayscale {

filter: grayscale(1);

}
.sepia {
filter: sepia(1);
}
.invert {
filter: invert(1)
}
```

<h4>HTML</h4>
```
<!DOCTYPE html>
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;Webcam and CSS effects&lt;/title&gt;
&lt;/head&gt;
&lt;body &gt;
&lt;h1&gt;Example of CSS effects on a live video stream&lt;/h1&gt;
&lt;p&gt;
Click the button &quot;start webcam at the end of this page, then click on the video to toggle the different effects.&lt;/p&gt;
&lt;/p&gt;
&lt;video onclick=&quot;changeFilter(this);&quot; width=400 height=400 id=&quot;video&quot; controls autoplay&gt;&lt;/video&gt;
&lt;p&gt;
&lt;button onclick=&quot;startWebcam();&quot;&gt;Start WebCam&lt;/button&gt;
&lt;button onclick=&quot;stopWebcam();&quot;&gt;Stop WebCam&lt;/button&gt;
&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
```

<h4>Taking a snapshot from the live Webcam stream</h4>

The trick is to copy and paste the current image from the video stream into a &lt;canvas&gt; element.


![](media/image109.png){width="6.5in" height="2.0909722222222222in"}


<h4>JS</h4>
```
> //\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--
>
> // GET USER MEDIA CODE
>
> //\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--
>
> let video;
>
> let webcamStream;
>
> function startWebcam() {
>
> // request video and audio stream from the user&apos;s webcam
>
> navigator.mediaDevices.getUserMedia({
>
> audio: true,
>
> video: true
>
> }).then((stream) =&gt; {
>
> video = document.querySelector(&apos;#video&apos;);
>
> video.srcObject = stream;
>
> video.play();
>
> webcamStream = stream;
>
> }).catch((error) =&gt; {
>
> console.log(&apos;navigator.getUserMedia error: &apos;, error);
>
> });
>
> }
>
> function stopWebcam() {
>
> webcamStream.getTracks()&lbrack;0&rbrack;.stop(); // audio
>
> webcamStream.getTracks()&lbrack;1&rbrack;.stop(); // video
>
> }
>
> //\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--
>
> // TAKE A SNAPSHOT CODE
>
> //\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--
>
> var canvas, ctx;
>
> function init() {
>
> // Get the canvas and obtain a context for
>
> // drawing in it
>
> canvas = document.getElementById(&quot;myCanvas&quot;);
>
> ctx = canvas.getContext(&apos;2d&apos;);
>
> }
>
> function snapshot() {
>
> // Draws current image from the video element into the canvas
>
> ctx.drawImage(video, 0,0, canvas.width, canvas.height);
>
> }
```

<h4>CSS</h4>
```
> canvas {
> border:1px solid black;
> }
```

<h4>HTML</h4>
```
> <!DOCTYPE html>
> <html lang="en">
> <head>
> <title>WebCam screenshot</title>
> <meta charset="utf-8"/>
> </head>
> <body onload="init();">
> <h1>Take a snapshot of the current video stream</h1>
> Check the CSS and JavaScript tabs. Click on the Start WebCam button.
> <p>
> <button onclick="startWebcam();">Start WebCam</button&gt;
> <button onclick="stopWebcam();">Stop WebCam</button>
> <button onclick="snapshot();">Prendre un screenshot</button>
> </p>
> <video onclick="snapshot(this);" width=200 height=200 id="video" controls autoplay></video>
> <p>
> Screenshots : <p>
> <canvas id="myCanvas" width="200" height="150"></canvas>
> </body>
> </html>
```

We will look at this example in greater detail in the next course section (related to the &lt;canvas&gt; element).

<h4>Impressive demonstrations available on the Web</h4>

-   [WebCam pixelization! Fun!](https://codepen.io/dlueth/pen/zBhwv)

-   [Webcam Toy](https://webcamtoy.com/): video effects on Paul Neave&apos;s webcam (using WebGL)

<h3>2.4.3 Using the Microphone</h3>

Instead of using the getUserMedia API with: navigator.getUserMedia({video:true}, onSuccess, onError), it is also possible to use {audio:true} for the first parameter. In this case, only the microphone input will be captured. Notice that {video:true, audio:true} is also accepted, if you write a video conferencing system and need to capture both the audio and the video (this is often the case when writing WebRTC applications).

Apart from videoconferencing, microphone input will be used for music Web apps, from the [WebAudio API](https://www.w3.org/TR/webaudio/). This API focuses on real time sound processing and music synthesis. This API is covered in the advanced W3Cx HTML5 course ([HTML5 Apps and Games](https://www.edx.org/course/html5-apps-and-games)).

Check out the [WebAudio demonstrations](https://webaudiodemos.appspot.com/) written by Chris Wilson, esp. the one called &quot;Input effects&quot;.

The image below is taken from [one of the demonstrations](https://webaudiodemos.appspot.com/input/index.html), where the sound captured by the microphone is processed in real time. We get visualizations of the signal in real time as an animated waveform, animated frequencies or animated audiogram. If we connect an electric guitar to the sound card input, then this demonstration shows that we can recreate with WebAudio most of the classic effects used by guitarists (delay, reverb, distortion, chorus, etc.).

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 110. webaudio live processing (xxx) ------------------------------>
<!------------------------------------------------------------------------------------------------>
<p align="center" width="100%">
<img src="./images/image110.jpeg?raw=true"
   width="55%"
   alt="WebAudio Live Processing" />
</p>

<h3>2.4.4 Webcam Resolution</h3>

It is possible to set &quot;hints&quot; for the preferred cam/resolution during video capture. This is done by using a [&quot;constraint&quot; object ](https://tools.ietf.org/html/draft-alvestrand-constraints-resolution-00#page-4)that is passed as a parameter to the getUserMedia(\...) method. It&apos;s just the same object we passed in the basic example: navigator.getUserMedia(**{video:true}**, success, error) except that this time this object is a little more complex by including new properties in addition to video:true or audio:true.

For more information, this [article on MDN about the getUserMedia API](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia) gives great examples on how to set the camera resolution and/or to choose the front or back camera when using a mobile phone.  

<b>Typical use:</b>

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 111.  (xxx) ------------------------------>
<!------------------------------------------------------------------------------------------------>
<p align="center" width="100%">
<img src="./images/image111.png?raw=true"
   width="65%"
   alt="" />
</p>

<b>JS</b>

```
> var vgaButton, qvgaButton, hdButton, dimensions, video, stream;
> function init() {
> vgaButton = document.querySelector(&apos;button#vga&apos;);
> qvgaButton = document.querySelector(&apos;button#qvga&apos;);
> hdButton = document.querySelector(&apos;button#hd&apos;);
> dimensions = document.querySelector(&apos;p#dimensions&apos;);
> video = document.querySelector(&apos;video&apos;);
> // Defines event listeners for the buttons that set the resolution
> qvgaButton.onclick = function() {
> getMedia(qvgaConstraints);
> };
> vgaButton.onclick = function() {
> getMedia(vgaConstraints);
> };
> hdButton.onclick = function() {
> getMedia(hdConstraints);
> };
> // Trick: check regularly the size of the video element and display it
> // When getUserMedia is called the video element changes it sizes but for
> // a while its size is zero pixels... o we check every half a second
> video.addEventListener(&apos;play&apos;, function() {
> setTimeout(function() {
> displayVideoDimensions();
> }, 500);
> });
> }
> // The different values for the constraints on resolution
> var qvgaConstraints = {
> video: {
> width: { max: 320 },
> height: { max: 180 }
> }
> };
> var vgaConstraints = {
> video: {
> width: { max: 640 },
> height: { max: 360 }
> }
> };
> var hdConstraints = {
> video: {
> width: { min: 1280 },
> height: { min: 720 }
> }
> };
> // The function that is called when a button has been clicked: starts the video^
> // with the preferred resolution^
> function\ getMedia(constraints) {^
> if\ (!!stream) {^
> video.srcObject = null;^
> stream.getTracks()[0].stop();^
> }^
> navigator.mediaDevices.getUserMedia(constraints)^
> .then((stream) => {^
> video.srcObject = stream;^
> video.play();^
> window.stream = stream;^
> })
> .catch((error)\ =&gt;{^
> console.log(&apos;navigator.getUserMedia\ error:\ &apos;,\ error);^
> });^
> }^
> ^//\ util\ function\ that\ is\ called\ by\ the\ setInterval(\...)\ every\ 0.5s,\ for^
> ^//\ displaying\ the\ video\ dimensions^
> ^function\ displayVideoDimensions()\ {^
> ^dimensions.innerHTML\ =\ &apos;Actual\ video\ dimensions:\ &apos;\ +\ video.videoWidth\ +^
> ^&apos;x&apos;\ +\ video.videoHeight\ +\ &apos;px.&apos;;^
> ^}^
```

<h4>CSS</h4>
```
> video {
> border:1px solid;
> }
```

<h4>HTML</h4>
```
> <!DOCTYPE html>
> <html lang="en"&gt;
> <head>
> <meta charset="utf-8"/>
> <title>getUserMedia constraints for Webcam resolutions&lt;/title&gt;
> </head>
> <body onload="init();">
> <h1>Set the camera resolution</h1>
> Example adapted from:
> &lt;a href=&quot;https://www.simpl.info/getusermedia/constraints/&quot;&gt;
> https://www.simpl.info/getusermedia/constraints/
> &lt;/a&gt;
> &lt;br&gt;
> &lt;p&gt;Click a button to call &lt;code&gt;getUserMedia()&lt;/code&gt; with appropriate resolution. &lt;/p&gt;
> &lt;div id=&quot;buttons&quot;&gt;
> &lt;button id=&quot;qvga&quot;&gt;QVGA&lt;/button&gt;
> &lt;button id=&quot;vga&quot;&gt;VGA&lt;/button&gt;
> &lt;button id=&quot;hd&quot;&gt;HD&lt;/button&gt;
> &lt;/div&gt;
> &lt;p id=&quot;dimensions&quot;&gt;&lt;/p&gt;
> &lt;video autoplay&gt;&lt;/video&gt;
> &lt;/body&gt;
> &lt;/html&gt;
```

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 112.  (xxx) ------------------------------>
<!------------------------------------------------------------------------------------------------>
<p align="center" width="100%">
<img src="./images/image112.png?raw=true"
   width="45%"
   alt="" />
</p>

Code source extract related to the &quot;constraint&quot; object which specifies the desired resolutions:

```
1.  var vgaConstraints = {
2.     video: {
3.        width: { max: 640 },
4.        height: { max: 360 }
5.     }
6.  };
7.  var hdConstraints = {
8.     video: {
9.        width: { min: 1280 },
10.       height: { min: 720 }
11.    }
12. };
13.  
14. let constraints = hdConstraints;
15. navigator.mediaDevices.getUserMedia(constraints)
16. .then((stream) =&gt; {\...}
```

<h4>How to check which resolutions are supported by a browser?</h4>

Use this [Web app that ](https://webrtchacks.github.io/WebRTC-Camera-Resolution/)systematically tests a set of &quot;preferred resolutions&quot; and compared them to the actual resolutions returned by the browser. Remember that the requested resolution is a hint, and there is no real guarantee that your configuration will allow it.

<h4>Selecting the front or rear camera on smartphones</h4>

Here are some other constraints you can set. In particular, look at the ones for selecting the front or rear camera (smartphones):
```
1.  **// more on video resolution**
2.  **constraints = {**
3.      video: {
4.          width: { min: 1024,** ideal: 1280**, max: 1920 },
5.         height: { min: 776,** ideal: 720**, max: 1080 }
6.      }
7.  }
8.  **// Framerate**
9.  **constraints = { video: { frameRate: { ideal: 10, max: 15 } } };**
10.  
11. **// front and back camera (mobile), some examples**
12. **var front = false;**
13. 
14. document.getElementById(&apos;flip-button&apos;).onclick = function() {\
        front = !front;\
    };
15. **// toggle front and back camera (mobile) by clicking a button**
16. **constraints = { video: { facingMode: (front? &quot;user&quot; : &quot;environment&quot;) } };**
17.  
18. **// prefer front camera**
19. constraints = { audio: true,** video: { facingMode: &quot;user&quot; }** }
20.  
21. **// require rear camera**
22. constraints = { audio: true,** video: { facingMode: { exact: &quot;environment&quot; } }** }
```

<h4>Select input/output for audio and video streams</h4>

-   Resource: [WebRTC samples: Select sources & outputs](https://webrtc.github.io/samples/src/content/devices/input-output/)

<!------------------------------------------------------------------------------------------------>
<!--------------- 113. webapp for selecting audio and video input/output (xxx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center" width="100%">
<img src="./images/image113.jpeg?raw=true"
   width="45%"
   alt="webapp for selecting audio and video input/output" />
</p>

Source code extract:
```
1.  function gotDevices(deviceInfos) {
2.      for (var i = 0; i !== deviceInfos.length; ++i) {
3.          var deviceInfo = deviceInfos&lbrack;i&rbrack;;
4.          console.log(&quot;device with id: &quot; + deviceInfo.deviceId);
5.          // possible values: audioinput, audiooutput, videoinput
6.          console.log(&quot;device with kind: &quot; + deviceInfo.kind);
7.          // &apos;speaker&apos; or &apos;camera&apos; for example
8.          console.log(&quot;device with label: &quot; + deviceInfo.label);
9.          //\... should build a menu, test kind/label and set
10.         // audioSource and videoSource variables
11.     }
12. }
13. // \...
14. var constraints = {
15.     audio: {**deviceId: audioSource **? {exact: audioSource} : undefined},
16.     video: {**deviceId: videoSource **? {exact: videoSource} : undefined}
17. };
18. 
19. navigator.mediaDevices.getUserMedia(constraints).
20. then(gotStream).then(gotDevices).catch(handleError)
```

### 2.4.5 The MediaRecorder API

This MediaRecoredr API allows to record / capture the audio or video stream. There are many sources for audio or video streams, but we will only consider here the streams coming from a WebCam or a sound input (i.e. microphone).

For example, the MediaRecorder API is used to record the video stream from a WebCam as a file saved on the hard disk. Below is a screenshot of an application allowing to record the WebCam. You will be able to run this example a little further, but for security reasons, it cannot run directly in this Web page.

<!------------------------------------------------------------------------------------------------>
<!--------------- 114. Screenshot showing on the left the webcam video stream, and on the right the same stream recorded and playable in a HTML video element (xxx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center" width="100%">
<img src="./images/image114.jpeg?raw=true"
   width="40%"
   alt="Screenshot showing on the left the webcam video stream, and on the right the same stream recorded and playable in a HTML video element" />
</p>

Let&apos;s record, replay and download the video stream captured using a Webcam. You can test it below by clicking on &quot;CodePen&quot; at the top right:

<b>JS</b>

```
> var mediaRecorder;
> var recordedBlobs;
> var gumVideo = document.querySelector(&apos;video#gum&apos;);
> var recordedVideo = document.querySelector(&apos;video#recorded&apos;);
> var recordButton = document.querySelector(&apos;button#record&apos;);
> var playButton = document.querySelector(&apos;button#play&apos;);
> var downloadButton = document.querySelector(&apos;button#download&apos;);
> recordButton.onclick = toggleRecording;
> playButton.onclick = play;
> downloadButton.onclick = download;
> // get stream using getUserMedia
> navigator.mediaDevices.getUserMedia({ audio: true,video: true})
> .then((stream) =&gt; {
> recordButton.disabled = false;
> console.log(&apos;getUserMedia() got stream: &apos;, stream);
> window.stream = stream;
> gumVideo.srcObject = stream;
> })
> .catch((error) =&gt; {
> console.log(&apos;navigator.getUserMedia error: &apos;, error);
> });
> function handleDataAvailable(event) {
> if (event.data && event.data.size &gt; 0) {
> recordedBlobs.push(event.data);
> }
> }
> function handleStop(event) {
> console.log(&apos;Recorder stopped: &apos;, event);
> }
> function toggleRecording() {
> if (recordButton.textContent === &apos;Start Recording&apos;) {
> startRecording();
> } else {
> stopRecording();
>
> recordButton.textContent = &apos;Start Recording&apos;;
>
> playButton.disabled = false;
>
> downloadButton.disabled = false;
> }
> }
> // create the media recorder
> function startRecording() {
> recordedBlobs = [];
> try {
> mediaRecorder = new MediaRecorder(window.stream);
> } catch (e) {
> console.error(&apos;Exception while creating MediaRecorder: &apos; + e);
> return;
> }
> console.log('Created MediaRecorder', mediaRecorder);
> recordButton.textContent = 'Stop Recording&apos;;
> playButton.disabled = true;
> downloadButton.disabled = true;
> mediaRecorder.onstop = handleStop;
> mediaRecorder.ondataavailable = handleDataAvailable;
> mediaRecorder.start(10); // collect 10ms of data
> console.log(&apos;MediaRecorder started&apos;, mediaRecorder);
> }
> function stopRecording() {
> mediaRecorder.stop();
> console.log('Recorded Blobs: ', recordedBlobs);
> recordedVideo.controls = true;
> }
> function play() {
> var superBuffer = new Blob(recordedBlobs, {type: 'video/webm'});
> recordedVideo.src = window.URL.createObjectURL(superBuffer);
> }
> function download() {
> var blob = new Blob(recordedBlobs, {type: 'video/webm'});
> var url = window.URL.createObjectURL(blob);
> var a = document.createElement(&apos;a&apos;);
> a.style.display = 'none';
> a.href = url;
> a.download = 'test.webm&apos;;
> document.body.appendChild(a);
> a.click();
> setTimeout(function() {
> document.body.removeChild(a);
> window.URL.revokeObjectURL(url);
> }, 100);
> }
```

<b>CSS</b>

```
> /*
> * Copyright (c) 2015 The WebRTC project authors. All Rights Reserved.
> *
> * Use of this source code is governed by a BSD-style license
> * that can be found in the LICENSE file in the root of the source
> * tree.
> */
> button {
> margin: 0 3px 10px 0;
> padding-left: 2px;
> padding-right: 2px;
> width: 99px;
> }
> button:last-of-type {
> margin: 0;
> }
> p.borderBelow {
> margin: 0 0 20px 0;
> padding: 0 0 20px 0;
> }
> video {
> height: 232px;
> margin: 0 12px 20px 0;
> vertical-align: top;
> width: calc(20em - 10px);
> }
> video:last-of-type {
> margin: 0 0 20px 0;
> }
> video#gumVideo {
> margin: 0 20px 20px 0;
> }
> @media screen and (max-width: 500px) {
> button {
> font-size: 0.8em;
> width: calc(33% - 5px);
> }
> }
> @media screen and (max-width: 720px) {
> video {
> height: calc((50vw - 48px) * 3 / 4);
> margin: 0 10px 10px 0;
> width: calc(50vw - 48px);
> }
> video#gumVideo {
> margin: 0 10px 10px 0;
> }
> }
```

<h4>HTML</h4>

```
> <!DOCTYPE html>
> <html>
> <head>
> <meta charset="utf-8">
> <meta name="viewport" content="width=device-width">
> <title>MediaRecorder API usage</title>
> </head>
> <body>
> <div id="container">
> <h1><a href="//webrtc.github.io/samples/" title="WebRTC samples homepage">WebRTC example:</a> <span>MediaRecorder</span></h1>
> <p>For more info, see the <a href="https://w3c.github.io/mediacapture-record/MediaRecorder.html" title="W3C MediaStream Recording API - Editor's Draft">MediaStream Recording API Editor's Draft</a>.</p>
> <video id="gum" autoplay muted></video>
> <video id="recorded" loop controls></video>
> <div>
> <button id="record" disabled>Start Recording</button>
> <button id="play" disabled>Play</button>
> <button id="download" disabled>Download</button>
> </div>
> <a href="https://github.com/webrtc/samples/tree/gh-pages/src/content/getusermedia/record" title="View source for this page on GitHub" id="viewSource">View source on GitHub</a>
> </div>
> </body>
> </html>
```

Click &quot;start recording&quot;, then press the play button on the video element on the right of the app. You can also click the &quot;download&quot; button to download a .webm file, playable offline with a media player such as [VLC](https://www.videolan.org/) or online in a Web page with the &lt;video&gt; element.

<h4>Five steps are needed to use the mediaRecorder object</h4>

<h4>1 - Create a mediaRecorder from a stream</h4>

Source code extract:

1.  var options = {mimeType: &apos;video/webm; codecs=vp9&apos;};

2.  mediaRecorder = new MediaRecorder(stream, options);

\... where stream is typically the object returned by the call to getUserMedia (see previous examples).

<h4>2 - Add a &quot;data handler&quot; and call the start() method of the mediaRecorder object</h4>

<b>Source code extract:</b>
```
1.  var recordedChunks = &lbrack;&rbrack;; // will hold the recorded stream
2.  mediaRecorder.ondataavailable = handleDataAvailable;
3.  mediaRecorder.start();
4.   
5.  function handleDataAvailable(event) {
6.     if (event.data.size &gt; 0) {
7.        recordedChunks.push(event.data);
8.     } else {
9.     // \...
10. }
```
   
<b>Explanations:</b>

-   *Line 1*: we declare an array of bytes that will hold the recorded stream.

-   *Line 2*: we declare the callback function that will be called while the stream is being captured. While the Webcam will be used, every xxx seconds, chunks of data will be passed to the handleDataAvailable function.

-   *Lines 5-10*: this function collects the chunk of data that corresponds to a few seconds of video, and stores it in the recordedChunks byte array.

<h4>3 - When you&apos;ve finished recording, tell the mediaRecorder to stop</h4>

When you&apos;re done, you need to call the stop() method of the mediaRecorder object. This will end the periodic execution of the handleDataAvailable method, and stop the data capture.

1.  mediaRecorder.stop();

<h4>4 - Create a BLOB (Binary Large Object) with the collected data, and use it to set the src attribute of an HTML5 video player</h4>

This piece of code creates a blob with the recordedChunks array. Use the URL.createObjectURL(recordedChunks) standard method to create another object that can be used as a value to set the src attribute of an HTML5 video element.

Like that, the recorded stream can be played using a standard HTML5 &lt;video&gt; element.

```
1.  function play() {
2.     var superBuffer = new Blob(recordedChunks);
3.     videoElement.src =
4.           window.URL.createObjectURL(superBuffer);
5.  }
```

<h4>5 - Download the captured stream</h4>

A trick consists in creating, on the fly, an invisible link with a download attribute (see Module 1) and a href attribute  that points to the blob object containing the recorded stream encoded using a given codec, then generate programmatically a click event on the link. This will force the browser to download a file of type video/webm to the hard disk.

```
1.  function download() {
2.  var blob = new Blob(recordedChunks, {
3.  type: &apos;video/webm&apos;
4.  });
5.  var url = URL.createObjectURL(blob);
6.  var a = document.createElement(&apos;a&apos;);
7.  document.body.appendChild(a);
8.  a.style = &apos;display: none&apos;;
9.  a.href = url;
10. a.download = &apos;test.webm&apos;;
11. a.click();
12. window.URL.revokeObjectURL(url);
13. }
```

<h3 id="ch3-1-1">3.1.1 HTML5 Graphics</h3>

<h3 id="ch3-2-1">3.2.1 About JavaScript and HTML5</h3>


![JavaScript logo](./images/image115.png){width="1.0in" height="1.0in"}

HTML5 is composed of new elements, but it also comes with many JavaScript APIs for controlling video and sound, drawing and animating things in the new &lt;canvas&gt; element, for offline applications, persistence, geolocation, orientation, etc.

So yes, during this course, in particular in Modules 3 and 4, you will have to do a bit of JavaScript. **But, DON&apos;T PANIC!**

Here we provide a basic introduction to JavaScript. If you want to learn more, many resources are available on the Web; this document is simply here to give you a head start. Remember that one great thing about these MOOCs courses is that everybody can help each other. Some students are very good in JavaScript and are usually very happy to help others when they encounter difficulties.

<b>You will learn a lot by looking at examples, tweaking them, cloning and modifying them, etc.</b> Many previous students who were real JavaScript beginners managed to do [all] the assignments (drawing and animating a monster with keyboard/mouse interaction)! And they did this by just studying the provided examples.

<h4>External resources</h4>

-   The[ JavaScript Introduction](https://www.edx.org/course/javascript-introduction) course on W3Cx!

-   Mozilla Developper Network [has a JS guide](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide)

<h4>What do you need? How to debug? How to catch errors?</h4>

We will not look at the JavaScript syntax here, but more at &quot;JavaScript in the browser&quot;, how it works, how to start writing code, etc.

First of all, you need to find a way to debug your code and see errors. If your work does not produce any results, you must know why!

For that you will use **the dev. tools of your browser**. Press *F12* in Windows or *cmd-alt-i* in Mac to open the dev. tools, then go to the console tab: **this is where errors will be displayed**, or messages of your own (use the console.log(string) JavaScript function in the JavaScript code embedded in your html page). In the console, you will be able to type any JavaScript command.

Let&apos;s look at [ this example on JS Bin](https://jsbin.com/visariz/1/edit?html,output):

+----+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 1  | &lt;!DOCTYPE html&gt;                                                                                                                                                      |
|    |                                                                                                                                                                        |
| 2  | &lt;[**html lang=&quot;en&quot;**](https://december.com/html/4/element/html.html)&gt;                                                                                              |
|    |                                                                                                                                                                        |
| 3  |   &lt;[**head**](https://december.com/html/4/element/head.html)&gt;                                                                                                        |
|    |                                                                                                                                                                        |
| 4  |   &lt;[**meta**](https://december.com/html/4/element/meta.html) charset=utf-8 /&gt;                                                                                        |
|    |                                                                                                                                                                        |
| 5  |   &lt;[**title**](https://december.com/html/4/element/title.html)&gt;Web Audio API&lt;/[**title**](https://december.com/html/4/element/title.html)&gt;                         |
|    |                                                                                                                                                                        |
| 6  |   &lt;[**script**](https://december.com/html/4/element/script.html)&gt;                                                                                                    |
|    |                                                                                                                                                                        |
| 7  |    console.log(&quot;Some JavaScript code has been executed&quot;);                                                                                                            |
|    |                                                                                                                                                                        |
| 8  |   &lt;/[**script**](https://december.com/html/4/element/script.html)&gt;                                                                                                   |
|    |                                                                                                                                                                        |
| 9  |   &lt;/[**head**](https://december.com/html/4/element/head.html)&gt;                                                                                                       |
|    |                                                                                                                                                                        |
| 10 |   &lt;[**body**](https://december.com/html/4/element/body.html)&gt;                                                                                                        |
|    |                                                                                                                                                                        |
| 11 |     &lt;[**h1**](https://december.com/html/4/element/h1.html)&gt;JavaScript debugging using the dev tool console&lt;/[**h1**](https://december.com/html/4/element/h1.html)&gt; |
|    |                                                                                                                                                                        |
| 12 |   &lt;/[**body**](https://december.com/html/4/element/body.html)&gt;                                                                                                       |
|    |                                                                                                                                                                        |
| 13 | &lt;/[**html**](https://december.com/html/4/element/html.html)&gt;                                                                                                         |
+====+========================================================================================================================================================================+
+----+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

The simplest way to add JavaScript code in an HTML page, is by using the &lt;script&gt;\...&lt;/script&gt; element.

**The code in this example is executed sequentially when the page is loaded**: the JavaScript code is executed before the browser could see the rest of the page (as the &lt;script&gt;&lt;/script&gt; is located before the &lt;body&gt;).

The H1 element, for example, does not exist in the Document Object Model, and has not yet been displayed when the JavaScript code is executed. If we move the &lt;script&gt;&lt;/script&gt; at the end of the document, then the H1 would have been built before the JavaScript code is executed.

The only line of code we have is console.log(&quot;Some JavaScript code has been executed&quot;);

This means &quot;display in the JavaScript console the message\...&quot;. If we open the console tab provided by jsbin.com in a dedicated tab (that redirects all console.log() messages), and re-execute the page (just type a space at the end of a line, this will re-render the page and display the message in the console), we see the message in the console tab, as well as in the dev. tools console. This is illustrated by the image below:

![java script console view 1](./images/image116.jpeg){width="5.0in" height="2.65625in"}

It is also possible to use the &quot;real dev. tool console&quot;, and for this I recommend running the application in a single window, not in the JS Bin editor. Press the black arrow on the top right of the output window - this will render the page as a standalone Web page, then press *F12*. You should see:

![view of the javascript console](./images/image117.jpeg){width="4.0in" height="3.3867125984251967in"}

Ok, now, let&apos;s make an error: change console.log() into conso**lll**e.log(). Let&apos;s see what happens:

![view of the javascript console](./images/image118.jpeg){width="5.0in" height="4.207420166229221in"}

And if we run it standalone and use the dev. tool console:

![View of the JavaScript console](./images/image119.jpeg){width="5.0in" height="2.508445975503062in"}

And if we click on the line number in the right, the dev. tool shows the source code centered on the line that caused the error:

![View of the JavaScript console. We can see an extract of the source code with different tools for watching variable values over execution etc.](./images/image120.jpeg){width="5.0in" height="4.183226159230096in"}

Without such tools, debugging JavaScript code is impossible. So you need to look at some basic tutorials on how to use the dev. tools of your browsers, since they differ from one another in the way they work - although the principles remain the same.

### About the asynchronous nature of JavaScript

Some of you may not be used to &quot;asynchronous programming&quot;, &quot;callbacks&quot; etc. We recommend to read [this article on WikiPedia](https://en.wikipedia.org/wiki/Callback_%28computer_programming%29) and [this thread on StackOverflow](https://stackoverflow.com/questions/8736378/what-is-a-callback-in-java).

<h3 id="ch3-2-2">3.2.2 The &lt;canvas&gt; Element</h3>

![canvas element logo](./images/image121.jpeg){width="1.0in" height="1.0in"}

The &lt;canvas&gt; tag was introduced into the HTML specification around 2010 as a &quot;Flash killer.&quot; At the time, popular video games used this proprietary technology and only a few browsers supported it. The HTML canvas allows drawing and animation at 60 frames per second, in 2D or 3D.

**The canvas has been designed for pixel-based graphics**, while SVG (Scalable Vector Graphics, another W3C standard) is for vector-based graphics.

Indeed, the canvas JavaScript drawing API supports different kind of shapes: lines, rectangles, ellipses, arcs, curves, text, images. Some drawing styles need to be specified that will affect the way shapes are drawn (color, drawing width, shadows, etc.). An alpha channel for drawing in transparent mode is also supported, as well as many advanced drawing modes and global filters (blur, etc.).

The canvas is also used to do animations at 60 frames per second (useful for games), to display videos with special effects, to display a webcam stream, and so on.

### Examples

Here are some fun examples that show the interest of the HTML5 canvas.

#### Example #1

[Foot Chinko](https://www.ravalmatic.com/portfolio/footchinko/) is one popular free HTML5 games:

![foot chinko one of the best html5 2D game of 2015](./images/image122.jpeg){width="4.0in" height="5.304965004374453in"}

#### Example #2

Lots of data visualization tools and JavaScript libraries use the HTML5 canvas element for [Data visualization](http://www.creativebloq.com/design-tools/data-visualization-712402):

![html5 data visualization](./images/image123.jpeg){width="5.0in" height="3.3043471128608926in"}

#### Example #3

A version of the [arcade game Galaxian](https://intersoft.itch.io/galaxian), that runs at 60 frames per second in an HTML5 canvas element:

![A version of the game Galaxian that runs at 60 frames/s in a canvas.](./images/image124.jpeg){width="5.0in" height="3.1185859580052493in"}

Performance is  good and animation is generally very smooth, since most Web browsers (mobile and desktop) support hardware acceleration.

**Note**: 3D drawing using the WebGL API is also possible in a &lt;canvas&gt;, but will not be covered in this course. For the most curious among you, please have a look at the two popular libraries for doing 3D drawing/animation in a &lt;canvas&gt;: [BabylonJS](https://www.babylonjs.com/) and [ThreeJS](https://threejs.org/).

### External resources

-   Comprehensive [HTML5 canvas tutorials](https://www.html5canvastutorials.com/)

-   An [HTML Canvas Deep Dive](https://joshondesign.com/p/books/canvasdeepdive/title.html)

-   MDN&apos;s Web docs: [&lt;canvas&gt;: The Graphics Canvas element](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas)

-   The &lt;canvas&gt; element is well supported by browsers:

    -   CanIUse: [browser support table](https://caniuse.com/canvas)

    -   MDN&apos;s [compatibility table of &lt;canvas&gt;](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas#Browser_compatibility)

<h3 id="ch3-2-3">3.2.3 Canvas and Accessibility</h3>

The dynamic nature of the &lt;canvas&gt; element has made it difficult to use in applications that need to be accessible to people with disabilities. To be accessible, it must meet the following principles:

-   Providing alternative content for what is drawn on the &lt;canvas&gt;,

-   Exposing the location of shapes, paths, images drawn on the &lt;canvas&gt; to assistive technologies,

-   Visually indicating whether or not a shape in the canvas had keyboard focus.

Read more on this topic: 

-   An article on [What the canvas element means for accessibility](https://www.creativebloq.com/web-design/canvas-element-accessibility-41514740)

-   From the W3C wiki: [Canvas Element Accessibility Issues](https://www.w3.org/html/wg/wiki/AddedElementCanvas)

<h3 id="ch3-2-4">3.2.4 HTML Canvas Cheatsheet</h3>

We recommend these 2 quick references (or [cheatsheets](https://en.wikipedia.org/wiki/Cheat_sheet)) below. Do not hesitate to keep your favorite one open in a separate browser ta

1.  As a [PDF file](https://courses.edx.org/assets/courseware/v1/4b7360cab7f3bf439c26782ec47cf7a8/asset-v1:W3Cx+HTML5.1x+2T2020+type@asset+block/Infopgraphic-CanvasCheatSheet-Final2.pdf), this canvas cheatsheet:

![snapshot of an HTML Canvas cheatsheet from skilled.com](./images/image125.png){width="6.5in" height="5.470138888888889in"}

2.  Another resource, as an [HTML file](https://simon.html5.org/dump/html5-canvas-cheat-sheet.html):

![Snapshot of a canvas sheet API](./images/image126.png){width="6.5in" height="4.809722222222222in"}

<h3 id="ch3-2-5">3.2.5 Coordinate System</h3>

The coordinate system used for drawing in canvases is similar to the one used by many drawing APIs like Java2D: the (0 , 0) is in the top left corner while the X axis is going to the right and the Y axis to the bottom, as  shown in the following picture:

![coordinate system](./images/image127.png){width="5.46875in" height="4.53125in"}

-   **X** axis is horizontal, directed to the right 

-   **Y** axis is vertical, directed downwards

<h3 id="ch3-2-6">3.2.6 Drawing Rectangles in a Canvas</h3>

Small errata about what I said in the above video: &quot;*So let&apos;s get the canvas using the DOM API method document.getElementById() or better, use document.querySelector() that is a more recent method **from the DOM API**&quot;*..

The part is bold is not correct: querySelector, technically, comes from [Selectors API](https://www.w3.org/TR/selectors-api/). Just in case some people would like to check the specification.\\

### Detailed explanation of the example shown in the above video

Here are the different steps, in a little more detail, of the example demonstrated in the above video:

#### 1 - Add the &lt;canvas&gt; element into an HTML page

1.  &lt;canvas id=&quot;myCanvas&quot; width=&quot;300&quot; height=&quot;225&quot;&gt;

2.  Fallback content that will be displayed in case the web browser

3.  does not support the canvas tag or in case scripting

4.  is disabled.

5.  &lt;/canvas&gt;

Place code similar to the above somewhere in an HTML page. This example defines an area of 300 by 225 pixels on which content can be rendered with JavaScript.

Normally you should see nothing as a result; by default canvases are &quot;transparent&quot;. **Make it visible using CSS!**\
For example, you can add a border to the canvas (or change the background color, or put an image in the background).

The three lines of CSS will create a border around the canvas with id=&quot;myCanvas&quot;, of 1 pixel width, in black:

1.  &lt;style&gt;

2.      #myCanvas {

3.          border:1px solid black;

4.      }

5.  &lt;/style&gt;

#### 2 - Select the &lt;canvas&gt; element for use from JavaScript

We can have more than one &lt;canvas&gt; in a single page, and canvases will be manipulated with JavaScript like other elements in the DOM.

For example with:

1.  var canvas = document.getElementById(&quot;myCanvas&quot;);

\... or with the querySelector() method introduced by HTML5, that use the CSS selector syntax for selecting elements:

1.  var canvas = document.querySelector(&quot;#myCanvas&quot;);

#### 3 - Get a &quot;2D context&quot; associated with the canvas

This step is useful for drawing and setting drawing properties (color, etc.)

Once we have a pointer to the &lt;canvas&gt;, we can get a &quot;context&quot;. This particular object is the core of the canvas JavaScript API. It provides methods for drawing, like fillRect(x, y, width, height) for example, that draws a filled rectangle, and properties for setting the color, shadows, gradients, etc.

So, let&apos;s first get the context (do this only once):

1.  var ctx=canvas.getContext(&apos;2d&apos;);

\... then, set the color for drawing filled shapes:

1.  ctx.fillStyle=&apos;red&apos;;

\... and draw a filled rectangle:

1.  ctx.fillRect(0,0,80,100);

### Complete example that draws a filled rectangle in red

<h4>HTML</h4>

```
<!DOCTYPE html>
<html lang="en">
<head>
<style>
#myCanvas {
border: 1px solid black;
}
</style>
<title>Canvas</title>
<meta charset="utf-8"/>
<script>
var canvas, ctx;
function init() {
// This function is called after the page is loaded
// 1 - Get the canvas
canvas = document.getElementById('myCanvas');
// 2 - Get the context
ctx=canvas.getContext('2d');
// 3 - we can draw
drawSomething();
}
function drawSomething() {
// draw a red rectangle
ctx.fillStyle=&apos;#FF0000&apos;;
ctx.fillRect(0,0,80,100);
}
</script>
</head>
<body onload="init();">
<canvas id="myCanvas" width="200" height="200">
Your browser does not support the canvas tag.
</canvas>
</body>
</html>
```

Source code:

```
1.  <!DOCTYPE html>
2.  <html lang="en">
3.     <head>
4.        <style>
5.           #myCanvas {
6.              border: 1px solid black;
7.           }
8.        </style>
9.        <title>Canvas</title>
10.       <meta charset="utf-8"/>
11.       <script>
12.          var canvas, ctx;
13.          function init() {
14. // This function is called after the page is loaded
15. // 1 - Get the canvas
16.          canvas = document.getElementById('myCanvas');
17. // 2 - Get the context
18.          ctx=canvas.getContext('2d');
19. // 3 - we can draw
20.          drawSomething();
21.       }
22.       function drawSomething() {
23. // draw a red rectangle
24.          ctx.fillStyle='#FF0000';
25.          ctx.fillRect(0,0,80,100);
26.       }
27.       </script>
28.    </head>
29.    <body onload="init();">
30.      <canvas id="myCanvas" width="200" height="200">
31.       Your browser does not support the canvas tag.
32.      </canvas>
33.    </body>
34. </html>
```

#### **Explanations**

**Only access elements when the DOM is ready:**

Notice that we wrote an &quot;init&quot; function (*line 13*) that is called only when the page has been entirely loaded (we say &quot;when the DOM is ready&quot;). There are several ways to do this. In this example we used the &lt;body onload=&quot;init();&quot;&gt; method, at *line 29*.

It&apos;s good practice to have such a function, as we cannot access the elements of the page before the page has been loaded entirely and before the DOM is ready.

Another way is to put the JavaScript code at the end of the document (between &lt;script&gt;\...&lt;/script&gt;), right before the &lt;/body&gt;. In this case when the JavaScript code is executed, the DOM has already been constructed.

**Start by getting the canvas and the context:**

Before drawing or doing anything interesting with the canvas, we must first get its drawing &quot;context&quot;. The drawing context defines the drawing methods and properties we can use.

Good practice is to get the canvas, the context, the width and height of the canvas and other global objects in this &quot;init&quot; function.

**After the context is set, we can draw, but first let&apos;s set the current color for filled shapes:**

The example shows the use of the fillStyle property at *line 24* - useful for specifying the way shapes will be filled. In our case this line indicates the color of all the filled shapes we are going to draw:

1.  ctx.fillStyle=&apos;#FF0000&apos;;

The context property named fillStyle is used here. This property can be set with a color, a gradient, or a pattern. We will see examples of these later on in the course.

The example says that all filled shapes will use the color &quot;#FF0000&quot;, which corresponds to a pure red color using the CSS RGB hexadecimal encoding (we could also have used ctx.fillStyle=&apos;red&apos;);

**Then we can draw:**

1.  ctx.fillRect(0,0,80,100);

This line is a call to the method fillRect(top left X coordinate, top left Y coordinate, width, height), which draws a filled rectangle.

The way the rectangle will be filled depends on the current value of several properties of the context, in particular the value of the fillStyle property. So, in our case, the rectangle will be red.

### Summary of the different steps

1.  **Declare the canvas,** remembering to add an id attribute, and fallback content:  \
    &lt;canvas id=&quot;myCanvas&quot; width=&quot;200&quot; height=&quot;200&quot;&gt;\
    \...fallback content\...\
    &lt;/canvas&gt;

2.  **Get a reference to the canvas in a JavaScript variable** using the DOM API:\
    var canvas=document.getElementById(&apos;myCanvas&apos;);

3.  **Get the context for drawing in that canvas**:  \
    var ctx=canvas.getContext(&apos;2d&apos;);

4.  **Specify some drawing properties** (optional):  \
    ctx.fillStyle=&apos;#FF0000&apos;;

5.  **Draw some shapes**:\
    ctx.fillRect(0,0,80,100)

<h3 id="ch3-2-7">3.2.7 Drawing Principles</h3>

### More about the &quot;context&quot; object

Before we go on, we should take some time to clarify the way we draw on HTML5 canvases. We already mentioned that we use a graphic context for all the main operations. Whenever a shape, a text, or an image is drawn, the current values of the different properties of the graphic context are taken into account. Some are relevant only for certain kinds of shapes or drawing modes, but you must be aware that it is always the current values of these drawing properties that are used.

Later on we&apos;ll see that there are ways to save and restore this whole set of values, but for now, let&apos;s examine in greater detail some of the properties and methods we&apos;ve already encountered, and introduce new ones.

### More about properties and methods of the context object

-   #### **fillStyle** is a property of the context, similar in a way to a CSS property

Its value can be one of the following:

-   a color,
-   a pattern (texture), or
-   a gradient.

The default value is the color black. Any kind of drawing in &quot;fill mode&quot; will use the value of this property to determine how to render the &quot;filled part&quot; of the drawing: any filled rectangle will be filled black by default, any filled circle will be filled in black, and so on.

As long as we don&apos;t modify the value of this property, all drawing commands for filled shapes will use the current value.

Note that we will study in detail how to use colors, gradients and patterns later, but for now we introduce some properties and values so that you can understand the principles of canvas drawing.

fillStyle and the other context properties can be considered to be &quot;global variables&quot; of the context.

-   #### fillRect(x, y, width, height):  a call to this method draws a filled rectangle

The two first parameters are the coordinates of the top left corner of the rectangle. This method uses the current value of the fillStyle property to determine how to fill the rectangle.

```
1.  ctx.fillStyle='pink';
2.  ctx.fillRect(10,10,200,200);
```

Produces this result:

![filled rectangle with pink color](./images/image128.jpeg){width="2.59375in" height="2.5833333333333335in"}

-   #### strokeStyle is a property of the context similar to fillStyle, but this time for indicating how the shape&apos;s outline should be rendered

The possible values are the same as those for the fillStyle property: a color, a pattern, or a gradient. This property will be taken into account when wireframe shapes are drawn.

-   #### strokeRect(x, y, width, height): like fillRect(\...), but instead of drawing a filled rectangle the rectangle is drawn in wireframe mode
```
1.  ctx.strokeStyle=&apos;blue&apos;;
2.  ctx.strokeRect(10,10,200,200);
```
\... gives this result:

![stroked rectangle - border is in blue](./images/image129.jpeg){width="2.5833333333333335in" height="2.6041666666666665in"}

Only the outline of the rectangle will be drawn, and it will be drawn using the value of the strokeStyle property.

-   #### clearRect(x, y, width, height): a call to this method erases the specified rectangle

Actually it draws it in a color called &quot;transparent black&quot; (!) that corresponds to the initial state of the rectangle as if no drawing had occurred.

```
1.  ctx.fillStyle=&apos;pink&apos;;
2.  ctx.fillRect(10,10,200,200);
3.  ctx.clearRect(50, 50, 20, 20);
```

The result is:

![The use of ClearRect draws a white rectangle against the pink background](./images/image130.jpeg){width="2.6770833333333335in" height="2.6770833333333335in"}

### Let&apos;s see some simple examples

#### Example #1: draw a wireframe red rectangle, width lineWidth = 3 pixels

Extract from the source code (the part that draws the rectangle):

```
1.  function drawSomething() {
2.       // draw a red rectangle, line width=3 pixels
3.       ctx.lineWidth=3;
4.       ctx.strokeStyle=&apos;red&apos;;
5.       ctx.strokeRect(10,10,80,100);
6.  }
```

Here, we used &quot;stroke&quot; instead of &quot;fill&quot; in the property and method names (*lines 4 and 5*): strokeStyle instead of fillStyle, strokeRect(\...) instead of fillRect(\...).

We also introduced a new property of the context, that applies only when drawing in &quot;stroke&quot; mode, the lineWidth property (*line 3*), that is used for setting the width of the shape outline. The value is in pixels.

#### Example #2: draw two filled red rectangles with a blue outline of 5 pixels and some text

Let&apos;s continue with another example. This time we will draw several shapes that share the same colors - they will be filled in red, with a blue outline. We also show how to draw a text message with a given font.

<h4>HTML</h4>

```
<!DOCTYPE html>
<html lang="en">
<head>
<title>Drawing with outline&lt;/title&gt;
<meta charset="utf-8"/>
<style>
#myCanvas {
border: 1px solid black;
}
</style>
<script>
var canvas, ctx;
function init() {
// This function is called after the page is loaded
// 1 - Get the canvas
canvas = document.getElementById('myCanvas');
// 2 - Get the context
ctx=canvas.getContext('2d');
// 3 - we can draw
drawSomething();
}
function drawSomething() {
// set the global context values
ctx.lineWidth=5;
ctx.fillStyle='red';
ctx.strokeStyle='blue'
// font for all text drawing
ctx.font = 'italic 20pt Calibri';
// Draw the two filled red rectangles
ctx.fillRect(10, 30, 70, 150);
ctx.fillRect(110, 30, 70, 150);
// Draw the two blue wireframe rectangles
ctx.strokeRect(10, 30, 70, 150);
ctx.strokeRect(110, 30, 70, 150);
// Draw a message above the rectangles
ctx.fillText("hello", 70, 22);
}
</script>
</head>
<body onload="init();">
<canvas id="myCanvas" width="200" height="200">
Your browser does not support the canvas tag.
</canvas>
</body>
</html>
```

Source code extract:

```
1.  function drawSomething() {
2.       // set the global context values
3.      ctx.lineWidth=5;
4.      ctx.fillStyle='red';
5.      ctx.strokeStyle='blue'
6.      // font for all text drawing
7.      ctx.font = 'italic 20pt Calibri';
8.  
9.      // Draw the two filled red rectangles
10.     ctx.fillRect(10, 30, 70, 150);
11.     ctx.fillRect(110, 30, 70, 150);
12. 
13.     // Draw the two blue wireframe rectangles
14.     ctx.strokeRect(10, 30, 70, 150);
15.     ctx.strokeRect(110, 30, 70, 150);
16. 
17.     // Draw a message above the rectangles
18.     ctx.fillText("hello", 70, 22);
19. }
```

This example shows the &quot;global&quot; nature of the context properties. Once you set the filled color to red, any shapes you draw in filled mode will be red. This is true for all the context properties. We set some of these properties in *lines 3-7*, and all following calls to context methods for drawing rectangles or text will depend on them. The two filled rectangles at *lines 10-11* will be red, the two wireframe rectangles drawn at *lines 14-15* will be blue, etc.

*Line 18* shows how to draw a text message at an X position of 70 and a Y position of 22. The font is set at *line 7* using the font property of the context.  The syntax is the same we use in CSS for using &quot;system fonts&quot;.

If you would like to draw the filled text message in green, for example, you should set the ctx.fillStyle property to &quot;green&quot; after you draw the rectangles and before you draw the text (i.e just before *line 18*).

### Summary of what we&apos;ve learned

-   &quot;stroke&quot; means &quot;wireframe&quot; or &quot;outlined&quot;. It is a prefix for setting properties or calling methods that will affect wireframe shapes.

-   &quot;fill&quot; is a prefix for filled shapes.

-   To set the properties of wireframe shapes use ctx.**stroke**Style= \..., for filled shapes use ctx.**fill**Style=\... So far the values we have used are colors, expressed as strings. Example: ctx.strokeStyle  = &apos;blue&apos;;

-   To draw a wireframe rectangle use ctx.strokeRect(x, y, width, height), to draw a filled rectangle use ctx.fillRect(x, y, width, height);

-   To set the line width of wireframe shapes, use the ctx.lineWidth property. Example ctx.lineWidth = 10; ctx.strokeRect(0, 0, 100, 100);  will draw a 100x100 rectangle in wireframe mode, with an outline width of 10 pixels.

-   To draw a text message use ctx.strokeText(message, x, y) or ctx.fillText(message, x, y), for wireframe text or filled text respectively.

-   To set the character font use the ctx.font property; the value is a font in CSS syntax, for example:  ctx.font = &apos;italic 20pt Calibri&apos;;

<h3 id="ch3-2-8">3.2.8 Transformations</h3>

We now introduce the basics of 2D transformations, a powerful tool that will make things easier as soon as you have to:

-   Draw complex shapes at given positions, with given orientations and sizes,

-   Draw shapes relative to one another.

Let&apos;s start with some simple examples before looking at how we use 2D transforms.

### Examples

-   #### Let&apos;s draw three rectangles!

If we draw three rectangles of size 100x200 in a 400x400 canvas, one at (0, 0) and another at (150, 0), and a third at (300, 0), here is the result and the corresponding code:

<h4>HTML</h4>

```
<!DOCTYPE html>
<html lang="en">
<head>
<title&gt;Let's draw three rectangles!</title>
<meta charset="utf-8"/>
<style>
#myCanvas {
border: 1px solid black;
}
</style>
<script>
var canvas, ctx;
function init() {
// This function is called after the page is loaded
// 1 - Get the canvas
canvas = document.getElementById('myCanvas');
// 2 - Get the context
ctx=canvas.getContext('2d');
// 3 - we can draw
drawSomething();
}
function drawSomething() {
// draw a red rectangle
ctx.fillStyle='lightgreen';
ctx.fillRect(0,0,100,200);
ctx.fillRect(150,0,100,200);
ctx.fillRect(300,0,100,200);
}
</script>
</head>
<body onload="init();">
<canvas id="myCanvas" width="400" height="400">
Your browser does not support the canvas tag.
</canvas>
</body>
</html>
```

JavaScript code extract:

```
1.  function drawSomething() {
2.       ctx.fillStyle='lightgreen';
3.   
4.       ctx.fillRect(0,0,100,200);
5.       ctx.fillRect(150,0,100,200);
6.       ctx.fillRect(300,0,100,200);
7.  }
```

-   #### Let&apos;s modify the code so that we can draw these rectangles at any X and Y position

What if we wanted to draw these 3 rectangles at another position, as a group? We would like to draw all of them a little closer to the bottom, for example\... Let&apos;s add some parameters to the function:  the X and Y position of the rectangles.

<h4>HTML</h4>

```
<!DOCTYPE html>
<html>
<head lang="en">
<title>Draw 3 rectangles at any X and Y position</title>
<meta charset="utf-8"/>
<style>
#myCanvas {
border: 1px solid black;
}
</style>
<script>
var canvas, ctx;
function init() {
// This function is called after the page is loaded
// 1 - Get the canvas
canvas = document.getElementById('myCanvas');
// 2 - Get the context
ctx=canvas.getContext('2d');
// 3 - we can draw
drawSomething(0, 100);
}
function drawSomething(x, y) {
// draw a red rectangle
ctx.fillStyle='lightgreen';
ctx.fillRect(x,y,100,200);
ctx.fillRect(x+150,y,100,200);
ctx.fillRect(x+300,y,100,200);
}
</script>
</head>
<body onload="init();">
<canvas id="myCanvas" width="400" height="400">
Your browser does not support the canvas tag.
</canvas>
</body>
</html>
```

Code extract:

```
1.  var canvas, ctx;
2.  
3.  function init() {
4.      // This function is called after the page is loaded
5.      // 1 - Get the canvas
6.      canvas = document.getElementById(&apos;myCanvas&apos;);
7.      // 2 - Get the context
8.      ctx=canvas.getContext(&apos;2d&apos;);
9.      // 3 - we can draw
10.     drawSomething(**0, 100**);
11. }
12. 
13. function drawSomething(**x, y**) {
14.     // draw 3 rectangles
15.     ctx.fillStyle=&apos;lightgreen&apos;;
16.     ctx.fillRect(**x,y**,100,200);
17.     ctx.fillRect(**x+150**,y,100,200);
18.     ctx.fillRect(**x+300**,y,100,200);
19. }
```

At *line 10*, we called the drawSomething(\...) function with 0 and 100 as parameters, meaning &quot;please add an offset of 0 in X and 100 in Y directions to what is drawn by the function\...

If you look at the code of the modified function, you will see that each call to fillRect(\...) uses the x and y parameters instead of hard coded values. In this way, if we call it with parameters (0, 100), then all rectangles will be drawn 100 pixels to the bottom (offset in y). Here is the result:

![rectangles are drawn 100 pixels towards the bottom](./images/image131.jpeg){width="2.9895833333333335in" height="3.0in"}

-   #### Now, let&apos;s draw a small monster&apos;s head with rectangles

Now we can start having some fun\... let&apos;s draw a monster&apos;s head using only rectangles:

HTML

```
<!DOCTYPE html>
<html lang="en">
<head>
<title>Monster's head with rectangles</title>
<meta charset="utf-8"/>
<style>
#myCanvas {
border: 1px solid black;
}
</style>
<script>
var canvas, ctx;
function init() {
// This function is called after the page is loaded
// 1 - Get the canvas
canvas = document.getElementById('myCanvas');
// 2 - Get the context
ctx=canvas.getContext('2d');
// 3 - we can draw
drawMonster(0, 0);
}
function drawMonster(x, y) {
// draw a red rectangle
// head
ctx.fillStyle='lightgreen';
ctx.fillRect(x,y,200,200);
// eyes
ctx.fillStyle='red';
ctx.fillRect(x+35,y+30,20,20);
ctx.fillRect(x+140,y+30,20,20);
// interior of eye
ctx.fillStyle='yellow';
ctx.fillRect(x+43,y+37,10,10);
ctx.fillRect(x+143,y+37,10,10);
// Nose
ctx.fillStyle='black';
ctx.fillRect(x+90,y+70,20,80);
// Mouth
ctx.fillStyle='purple';
ctx.fillRect(x+60,y+165,80,20);
}
</script>
</head>
<body onload="init();">
<canvas id="myCanvas" width="400" height="400">
Your browser does not support the canvas tag.
</canvas>
</body>
</html>
```

An extract of the JavaScript source code is:

```
1.  function drawMonster(x, y) {
2.     // head
3.     ctx.fillStyle=&apos;lightgreen&apos;;
4.     ctx.fillRect(x,y,200,200);
5.  
6.     // eyes
7.     ctx.fillStyle=&apos;red&apos;;
8.     ctx.fillRect(x+35,y+30,20,20);
9.     ctx.fillRect(x+140,y+30,20,20);
10. 
11.    // interior of eye
12.    ctx.fillStyle=&apos;yellow&apos;;
13.    ctx.fillRect(x+43,y+37,10,10);
14.    ctx.fillRect(x+143,y+37,10,10);
15. 
16.    // Nose
17.    ctx.fillStyle=&apos;black&apos;;
18.    ctx.fillRect(x+90,y+70,20,80);
19. 
20.    // Mouth
21.    ctx.fillStyle=&apos;purple&apos;;
22.    ctx.fillRect(x+60,y+165,80,20);
23. }
```

As you can see, the code uses the same technique, becomes less and less readable. The Xs and Ys at the beginning of each call makes understanding the code harder, etc.

However, there is a way to simplify this =&gt; 2D geometric transformations! 

### Geometric transformations: changing the coordinate system

The idea behind 2D transformations is that instead of modifying all the coordinates passed as parameters to each call to drawing methods like fillRect(\...), we will keep all the drawing code &quot;as is&quot;. For example, if the monster of our previous example was drawn at (0, 0), we could just translate (or rotate, or scale) the original coordinate system.

Let&apos;s take a piece of code that draws something corresponding to the original coordinate system, located at the top left corner of the canvas:

1.  function drawMonster(x, y) {

2.     // head

3.     ctx.fillStyle=&apos;lightgreen&apos;;

4.     ctx.fillRect(0,0,200,200);

5.  

6.     // eyes

7.     ctx.fillStyle=&apos;red&apos;;

8.     ctx.fillRect(35,30,20,20);

9.     ctx.fillRect(140,30,20,20);

10. 

11.    // interior of eye

12.    ctx.fillStyle=&apos;yellow&apos;;

13.    ctx.fillRect(43,37,10,10);

14.    ctx.fillRect(143,37,10,10);

15. 

16.    // Nose

17.    ctx.fillStyle=&apos;black&apos;;

18.    ctx.fillRect(90,70,20,80);

19. 

20.    // Mouth

21.    ctx.fillStyle=&apos;purple&apos;;

22.    ctx.fillRect(60,165,80,20);

23. 

24.    // coordinate system at (0, 0)

25.    drawArrow(ctx, 0, 0, 100, 0, 10, &apos;red&apos;);

26.    drawArrow(ctx, 0, 0, 0, 100, 10, &apos;red&apos;);

27. }

This code is the just the same as in the previous example except that we removed all Xs and Yx in the code. We also added at the end *(lines 25-26*) two lines of code that draw the coordinate system. The drawArrow(startX, startY, endX, endY, width, color) function is a utility function that we will present later. You can see it in the JS source code of the pen below:

JS

// Borrowed and adapted from : http://stackoverflow.com/questions/808826/draw-arrow-on-canvas-tag

function drawArrow(ctx, fromx, fromy, tox, toy, arrowWidth, color){

//variables to be used when creating the arrow

var headlen = 10;

var angle = Math.atan2(toy-fromy,tox-fromx);

ctx.save();

ctx.strokeStyle = color;

//starting path of the arrow from the start square to the end square and drawing the stroke

ctx.beginPath();

ctx.moveTo(fromx, fromy);

ctx.lineTo(tox, toy);

ctx.lineWidth = arrowWidth;

ctx.stroke();

//starting a new path from the head of the arrow to one of the sides of the point

ctx.beginPath();

ctx.moveTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),toy-headlen\*Math.sin(angle-Math.PI/7));

//path from the side point of the arrow, to the other side point

ctx.lineTo(tox-headlen\*Math.cos(angle+Math.PI/7),toy-headlen\*Math.sin(angle+Math.PI/7));

//path from the side point back to the tip of the arrow, and then again to the opposite side point

ctx.lineTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),toy-headlen\*Math.sin(angle-Math.PI/7));

//draws the paths created above

ctx.stroke();

ctx.restore();

}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;title&gt;Monster&apos;s head drawn with 2D transformations&lt;/title&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;style&gt;

#myCanvas {

border: 1px solid black;

}

&lt;/style&gt;

&lt;script&gt;

var canvas, ctx;

function init() {

// This function is called after the page is loaded

// 1 - Get the canvas

canvas = document.getElementById(&apos;myCanvas&apos;);

// 2 - Get the context

ctx=canvas.getContext(&apos;2d&apos;);

// 3 - we can draw, try to change these values

drawMonster(0, 0);

}

function drawMonster(x, y) {

// head

ctx.fillStyle=&apos;lightgreen&apos;;

ctx.fillRect(0,0,200,200);

// eyes

ctx.fillStyle=&apos;red&apos;;

ctx.fillRect(35,30,20,20);

ctx.fillRect(140,30,20,20);

// interior of eye

ctx.fillStyle=&apos;yellow&apos;;

ctx.fillRect(43,37,10,10);

ctx.fillRect(143,37,10,10);

// Nose

ctx.fillStyle=&apos;black&apos;;

ctx.fillRect(90,70,20,80);

// Mouth

ctx.fillStyle=&apos;purple&apos;;

ctx.fillRect(60,165,80,20);

// coordinate system at (0, 0)

drawArrow(ctx, 0, 0, 100, 0, 10, &apos;red&apos;);

drawArrow(ctx, 0, 0, 0, 100, 10, &apos;red&apos;);

}

&lt;/script&gt;

Note that the X and Y parameters are useless for now\...

-   #### Translation using ctx.translate(offsetX, offsetY)

Now, instead of simply calling drawMonster(0, 0), we will call first ctx.translate(100, 100), and look at the result below:

JS

// Borrowed and adapted from : http://stackoverflow.com/questions/808826/draw-arrow-on-canvas-tag

function drawArrow(ctx, fromx, fromy, tox, toy, arrowWidth, color){

//variables to be used when creating the arrow

var headlen = 10;

var angle = Math.atan2(toy-fromy,tox-fromx);

ctx.save();

ctx.strokeStyle = color;

//starting path of the arrow from the start square to the end square and drawing the stroke

ctx.beginPath();

ctx.moveTo(fromx, fromy);

ctx.lineTo(tox, toy);

ctx.lineWidth = arrowWidth;

ctx.stroke();

//starting a new path from the head of the arrow to one of the sides of the point

ctx.beginPath();

ctx.moveTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),toy-headlen\*Math.sin(angle-Math.PI/7));

//path from the side point of the arrow, to the other side point

ctx.lineTo(tox-headlen\*Math.cos(angle+Math.PI/7),toy-headlen\*Math.sin(angle+Math.PI/7));

//path from the side point back to the tip of the arrow, and then again to the opposite side point

ctx.lineTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),toy-headlen\*Math.sin(angle-Math.PI/7));

//draws the paths created above

ctx.stroke();

ctx.restore();

}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;title&gt;Translated monster&apos;s head&lt;/title&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;style&gt;

#myCanvas {

border: 1px solid black;

}

&lt;/style&gt;

&lt;script&gt;

var canvas, ctx;

function init() {

// This function is called after the page is loaded

// 1 - Get the canvas

canvas = document.getElementById(&apos;myCanvas&apos;);

// 2 - Get the context

ctx=canvas.getContext(&apos;2d&apos;);

// 3 - we can draw, try to change these values

ctx.translate(100, 100);

drawMonster(0, 0);

}

function drawMonster(x, y) {

// head

ctx.fillStyle=&apos;lightgreen&apos;;

ctx.fillRect(0,0,200,200);

// eyes

ctx.fillStyle=&apos;red&apos;;

ctx.fillRect(35,30,20,20);

ctx.fillRect(140,30,20,20);

// interior of eye

ctx.fillStyle=&apos;yellow&apos;;

ctx.fillRect(43,37,10,10);

ctx.fillRect(143,37,10,10);

// Nose

ctx.fillStyle=&apos;black&apos;;

ctx.fillRect(90,70,20,80);

// Mouth

ctx.fillStyle=&apos;purple&apos;;

ctx.fillRect(60,165,80,20);

// coordinate system at (0, 0)

drawArrow(ctx, 0, 0, 100, 0, 10, &apos;red&apos;);

drawArrow(ctx, 0, 0, 0, 100, 10, &apos;red&apos;);

}

&lt;/script&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;

Your browser does not support the canvas tag.

&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

JavaScript code extract:

1.  ctx.translate(100, 100);

2.  drawMonster(0, 0);

*Line 1* changes the position of the coordinate system, *line 2* draws a monster in the new translated coordinate system. All subsequent calls to drawing methods will be affected and will work in this new system too.

-   #### Other transformations: rotate, scale

There are other transformations available:

-   ctx.rotate(angle), with angle in radians. Note that the order of transformations is important: usually we translate, then rotate, then scale\... If you change this order, you need to know what you are doing\...

-   ctx.scale (sx, sy), where scale(1, 1) corresponds to &quot;no zoom&quot;, scale(2, 2) corresponds to &quot;zooming 2x&quot; and scale(0.5, 0.5) corresponds to zooming out to see the drawings half as big as before. If you do not use the same values for sx and sy, you do &quot;asymmetric scaling&quot;, you can distort a shape horizontally or vertically. Try changing the values in the source code of the next online examples.

Here is the previous example, but this time we translated the coordinate system, then rotated it with an angle equal to PI/4 , then we scaled it so that units are half as big:

JS

// Borrowed and adapted from : http://stackoverflow.com/questions/808826/draw-arrow-on-canvas-tag

function drawArrow(ctx, fromx, fromy, tox, toy, arrowWidth, color){

//variables to be used when creating the arrow

var headlen = 10;

var angle = Math.atan2(toy-fromy,tox-fromx);

ctx.save();

ctx.strokeStyle = color;

//starting path of the arrow from the start square to the end square and drawing the stroke

ctx.beginPath();

ctx.moveTo(fromx, fromy);

ctx.lineTo(tox, toy);

ctx.lineWidth = arrowWidth;

ctx.stroke();

//starting a new path from the head of the arrow to one of the sides of the point

ctx.beginPath();

ctx.moveTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),toy-headlen\*Math.sin(angle-Math.PI/7));

//path from the side point of the arrow, to the other side point

ctx.lineTo(tox-headlen\*Math.cos(angle+Math.PI/7),toy-headlen\*Math.sin(angle+Math.PI/7));

//path from the side point back to the tip of the arrow, and then again to the opposite side point

ctx.lineTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),toy-headlen\*Math.sin(angle-Math.PI/7));

//draws the paths created above

ctx.stroke();

ctx.restore();

}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;title&gt;Translated, rotated, and scaled monster&apos;s head&lt;/title&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;style&gt;

#myCanvas {

border: 1px solid black;

}

&lt;/style&gt;

&lt;script&gt;

var canvas, ctx;

function init() {

// This function is called after the page is loaded

// 1 - Get the canvas

canvas = document.getElementById(&apos;myCanvas&apos;);

// 2 - Get the context

ctx=canvas.getContext(&apos;2d&apos;);

// 3 - we can draw, try to change these values

ctx.translate(100, 100);

ctx.rotate(Math.PI/4);

ctx.scale(0.5, 0.5);

drawMonster(0, 0);

}

function drawMonster(x, y) {

// head

ctx.fillStyle=&apos;lightgreen&apos;;

ctx.fillRect(0,0,200,200);

// eyes

ctx.fillStyle=&apos;red&apos;;

ctx.fillRect(35,30,20,20);

ctx.fillRect(140,30,20,20);

// interior of eye

ctx.fillStyle=&apos;yellow&apos;;

ctx.fillRect(43,37,10,10);

ctx.fillRect(143,37,10,10);

// Nose

ctx.fillStyle=&apos;black&apos;;

ctx.fillRect(90,70,20,80);

// Mouth

ctx.fillStyle=&apos;purple&apos;;

ctx.fillRect(60,165,80,20);

// coordinate system at (0, 0)

drawArrow(ctx, 0, 0, 100, 0, 10, &apos;red&apos;);

drawArrow(ctx, 0, 0, 0, 100, 10, &apos;red&apos;);

}

&lt;/script&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;

Your browser does not support the canvas tag.

&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

And here is the code of the transformations we used, followed by the call to the function that draws the monster:

1.  ctx.translate(100, 100);

2.  ctx.rotate(Math.PI/4);

3.  ctx.scale(0.5, 0.5);

4.   

5.  drawMonster(0, 0);

-   #### BEWARE: all drawings to come will be in that modified coordinate system!

If we draw two shapes at two different positions, they will be relative to this new coordinate system.

JS

// Borrowed and adapted from : http://stackoverflow.com/questions/808826/draw-arrow-on-canvas-tag

function drawArrow(ctx, fromx, fromy, tox, toy, arrowWidth, color){

//variables to be used when creating the arrow

var headlen = 10;

var angle = Math.atan2(toy-fromy,tox-fromx);

ctx.save();

ctx.strokeStyle = color;

//starting path of the arrow from the start square to the end square and drawing the stroke

ctx.beginPath();

ctx.moveTo(fromx, fromy);

ctx.lineTo(tox, toy);

ctx.lineWidth = arrowWidth;

ctx.stroke();

//starting a new path from the head of the arrow to one of the sides of the point

ctx.beginPath();

ctx.moveTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),toy-headlen\*Math.sin(angle-Math.PI/7));

//path from the side point of the arrow, to the other side point

ctx.lineTo(tox-headlen\*Math.cos(angle+Math.PI/7),toy-headlen\*Math.sin(angle+Math.PI/7));

//path from the side point back to the tip of the arrow, and then again to the opposite side point

ctx.lineTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),toy-headlen\*Math.sin(angle-Math.PI/7));

//draws the paths created above

ctx.stroke();

ctx.restore();

}

<h4>HTML</h4>
```
<!DOCTYPE html>
<html lang="en">
<head>
<title>2D transformation</title>
<meta charset="utf-8"/>
<style>
#myCanvas {
border: 1px solid black;
}
</style>
<script>
var canvas, ctx;
function init() {
// This function is called after the page is loaded
// 1 - Get the canvas
canvas = document.getElementById('myCanvas');
// 2 - Get the context
ctx=canvas.getContext('2d');
// 3 - we can draw, try to change these values
ctx.translate(100, 100);
ctx.rotate(Math.PI/4);
ctx.scale(0.5, 0.5);
// Draw the monster at (0, 0)
drawMonster(0, 0);
// draw a filled rectagle at (250, 0)
ctx.fillRect(250, 0, 100, 100);
drawCoordinateSystem('red', 10);
}
function drawMonster(x, y) {
// head
ctx.fillStyle='lightgreen';
ctx.fillRect(0,0,200,200);
// eyes
ctx.fillStyle='red';
ctx.fillRect(35,30,20,20);
ctx.fillRect(140,30,20,20);
// interior of eye
ctx.fillStyle='yellow';
ctx.fillRect(43,37,10,10);
ctx.fillRect(143,37,10,10);
// Nose
ctx.fillStyle='black';
ctx.fillRect(90,70,20,80);
// Mouth
ctx.fillStyle='purple';
ctx.fillRect(60,165,80,20);
}
function drawCoordinateSystem(color, width) {
// coordinate system at (0, 0)
drawArrow(ctx, 0, 0, 100, 0, width, color);
drawArrow(ctx, 0, 0, 0, 100, width, color);
}
</script>
</head>
<body onload="init();">
<canvas id="myCanvas" width="400" height="400">
Your browser does not support the canvas tag.
</canvas>
</body>
</html>
```
1.  ctx.translate(100, 100);

2.  ctx.rotate(Math.PI/4);

3.  ctx.scale(0.5, 0.5);

4.  

5.  // Draw the monster at (0, 0)

6.  drawMonster(0, 0);

7.  // Draw a filled rectagle at (250, 0)

8.  ctx.fillRect(250, 0, 100, 100);

### How can we reset the coordinate system, how can we go back to the previous one?

Aha, this is a very interesting question\... the answer is in the next page!

<h3 id="ch3-2-9">3.2.9 Saving and Restoring the Context</h3>

There are two methods for saving and restoring the context properties: ctx.save()and ctx.restore().

What will be saved: fillStyle and strokeStyle, lineWidth, the previous coordinate system, etc. **Meaning that ALL properties that affect drawing!**

A call to ctx.save() will probably save the context property values in a hardware register on your graphics card. Multiple contexts can be saved consecutively and restored.

Multiple contexts can be backed up consecutively and restored. Contexts saved will be stacked, the last one that has been saved will be restored by the next call to restore(), so it is very important to have one restore for each save.

***Best practice**: save the context at the beginning of any function*\
*that changes the context, restore it at the end of the function!*

### Example of a function that changes the context and restores it after execution

JS

// Borrowed and adapted from : http://stackoverflow.com/questions/808826/draw-arrow-on-canvas-tag

function drawArrow(ctx, fromx, fromy, tox, toy, arrowWidth, color){

//variables to be used when creating the arrow

var headlen = 10;

var angle = Math.atan2(toy-fromy,tox-fromx);

ctx.save();

ctx.strokeStyle = color;

//starting path of the arrow from the start square to the end square and drawing the stroke

ctx.beginPath();

ctx.moveTo(fromx, fromy);

ctx.lineTo(tox, toy);

ctx.lineWidth = arrowWidth;

ctx.stroke();

//starting a new path from the head of the arrow to one of the sides of the point

ctx.beginPath();

ctx.moveTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),toy-headlen\*Math.sin(angle-Math.PI/7));

//path from the side point of the arrow, to the other side point

ctx.lineTo(tox-headlen\*Math.cos(angle+Math.PI/7),toy-headlen\*Math.sin(angle+Math.PI/7));

//path from the side point back to the tip of the arrow, and then again to the opposite side point

ctx.lineTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),toy-headlen\*Math.sin(angle-Math.PI/7));

//draws the paths created above

ctx.stroke();

ctx.restore();

}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;title&gt;Saving and restoring the context&lt;/title&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;style&gt;

#myCanvas {

border: 1px solid black;

}

&lt;/style&gt;

&lt;script&gt;

var canvas, ctx;

function init() {

// This function is called after the page is loaded

// 1 - Get the canvas

canvas = document.getElementById(&apos;myCanvas&apos;);

// 2 - Get the context

ctx=canvas.getContext(&apos;2d&apos;);

// 3 - we can draw, try to change these values

drawMonster(200, 100, Math.PI/4, &apos;lightGreen&apos;, &apos;yellow&apos;);

// draw another rectangle at (0, 0), you will see it&apos;s black

// (default color), and at the top left corner of the canvas

// (original position of the coordinate system)

ctx.fillRect(0, 0, 80, 80);

}

function drawMonster(x, y, angle, headColor, eyeColor) {

// GOOD PRACTICE : SAVE CONTEXT AND RESTORE IT AT THE END

ctx.save();

// Moves the coordinate system so that the monster is drawn

// at position (x, y)

ctx.translate(x, y);

ctx.rotate(angle)

// head

ctx.fillStyle=headColor;

ctx.fillRect(0,0,200,200);

// eyes

ctx.fillStyle=&apos;red&apos;;

ctx.fillRect(35,30,20,20);

ctx.fillRect(140,30,20,20);

// interior of eye

ctx.fillStyle=eyeColor;

ctx.fillRect(43,37,10,10);

ctx.fillRect(143,37,10,10);

// Nose

ctx.fillStyle=&apos;black&apos;;

ctx.fillRect(90,70,20,80);

// Mouth

ctx.fillStyle=&apos;purple&apos;;

ctx.fillRect(60,165,80,20);

// coordinate system at (0, 0)

drawArrow(ctx, 0, 0, 100, 0, 10, &apos;red&apos;);

drawArrow(ctx, 0, 0, 0, 100, 10, &apos;red&apos;);

// GOOD PRACTICE !

ctx.restore();

}

&lt;/script&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;

Your browser does not support the canvas tag.

&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

We slightly modified the function that draws the monster:

-   We added parameters for setting the position and orientation of the monster, and added calls to ctx.translate(x, y) and ctx.rotate(angle) in the function.

-   We added parameters for the head color and eye color.

-   We saved the context at the beginning of the function (BEST PRACTICE),

-   We restored it at the end (BEST PRACTICE).

![example of context save / restore : a monster is drawn by a function that saves and restored the context, then a rectangle is draw, with context as it was previously ](./images/image132.jpeg){width="4.083333333333333in" height="4.09375in"}

Source code extract of this function: notice at *lines 3 *and* 26* how we save/restore the context at the beginning/end. Right after saving the context, we modify the coordinate system (l*ines 7-8*). The rest of the code is nearly the same as in the last version of the monster example.

1.  function drawMonster(x, y, angle, headColor, eyeColor) {

2.      // BEST PRACTICE: SAVE CONTEXT AND RESTORE IT AT THE END

3.      ctx.save();

4.  

5.      // Moves the coordinate system so that the monster is drawn

6.      // at position (x, y)

7.      ctx.translate(x, y);

8.      ctx.rotate(angle);

9.  

10.     // head

11.     ctx.fillStyle=headColor;

12.     ctx.fillRect(0,0,200,200);

13. 

14.     // eyes

15.     ctx.fillStyle=&apos;red&apos;;

16.     ctx.fillRect(35,30,20,20);

17.     ctx.fillRect(140,30,20,20);

18. 

19.     // interior of eye

20.     ctx.fillStyle=eyeColor;

21.     ctx.fillRect(43,37,10,10);

22.     ctx.fillRect(143,37,10,10);

23.  

24.     \...

25.     // BEST PRACTICE!

26.     ctx.restore();

27. }

### 

<h3 id="ch3-3-1">3.3.1 Immediate Mode</h3>

In the previous sections, we learned how to draw filled or wireframe rectangles.

As soon as the ctx.strokeRect(x, y, width, height) or the ctx.fillRect(x, y, width, height) method is called, a rectangle is indeed drawn *immediately* in the canvas. 

While drawing rectangles with strokeRect or fillRect, drawing text or drawing images, all these shapes will be drawn in *immediate mode*.

Another mode called &quot;path mode&quot; or &quot;buffered mode&quot; will be seen later in this course, which will be useful for drawing lines, curves, arcs, and also rectangles. Rectangles are the only shapes that have methods for drawing them *immediately* and also other methods for drawing them in &quot;*path/buffered mode*&quot;.

### Example: drawing rectangles in immediate mode using bests practices

Let&apos;s give an example that draws several rectangles, filled or wireframe, with different colors and line widths:

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;title&gt;Immediate mode&lt;/title&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;style&gt;

#myCanvas {

border: 1px solid black;

}

&lt;/style&gt;

&lt;script&gt;

var canvas, ctx;

window.onload = function () {

canvas = document.getElementById(&apos;myCanvas&apos;);

ctx = canvas.getContext(&apos;2d&apos;);

// black rectangle, default color (black)

ctx.fillRect(10, 10, 100, 100);

// outlined rectangle, default color

ctx.strokeRect(150, 10, 100, 100);

// outlined rectangle filled in red, outline blue

ctx.fillStyle = &apos;red&apos;;

ctx.strokeStyle = &apos;lightBlue&apos;;

ctx.lineWidth = 10;

ctx.fillRect(100, 150, 150, 150);

ctx.strokeRect(100, 150, 150, 150);

// A function to automatize previous drawing

var angle = Math.PI / 10;

drawFilledRectangle(300, 150, 150, 150, &apos;pink&apos;, &apos;green&apos;, 10, angle);

drawFilledRectangle(300, 150, 150, 150, &apos;yellow&apos;, &apos;purple&apos;, 10, angle + 0.5);

};

function drawFilledRectangle(x, y, w, h, fillColor, strokeColor, lw, angle) {

// GOOD PRACTICE : save if the function change the context or coordinate

// system

ctx.save();

// position coordinate system

ctx.translate(x, y);

ctx.rotate(angle);

// set colors, line width\...

ctx.lineWidth = lw;

ctx.fillStyle = fillColor;

ctx.strokeStyle = strokeColor;

// draw at 0, 0 as we translated the coordinate

// system already

ctx.fillRect(0, 0, w, h);

ctx.strokeRect(0, 0, w, h);

// GOOD PRACTICE : a restore for a save!

ctx.restore();

}

&lt;/script&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;578&quot; height=&quot;400&quot;&gt;

&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

<h3 id="ch3-3-2">3.3.2 Drawing Text</h3>

The canvas API provides two main methods for drawing text: ctx.strokeText(message, x, y) and ctx.fillText(message, x, y).\
It also provides a set of context properties for setting the character font and style, for laying out the text, etc.

### Typical use

Look at the example below, and change the position where the text is drawn, change font attributes, etc.:

HTML

&lt;!DOCTYPE html&gt;

&lt;html&gt;

&lt;head&gt;

&lt;title&gt;Drawing text&lt;/title&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; width=500 height=300&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var context=canvas.getContext(&apos;2d&apos;);

context.font = &quot;60pt Calibri&quot;;

context.lineWidth = 3;

context.strokeStyle = &quot;blue&quot;;

context.fillStyle = &quot;red&quot;;

context.fillText(&quot;Hello World!&quot;, 10, 100);

context.strokeText(&quot;Hello World!&quot;, 10, 100);

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

ource code extract:

1.  context.font = &quot;60pt Calibri&quot;;

2.  // .. set color, lineWidth, shadow etc.

3.  

4.  // 10, 10 is the start of the baseline, bottom of left leg of the &quot;H&quot; in the

5.  // &quot;Hello World&quot; example.

6.  context.fillText(&quot;Hello World!&quot;, 10, 10);

7.  // Or

8.  context.strokeText(&quot;Hello World!&quot;, 10, 10);

### Properties and methods useful for drawing text

#### Choosing the font: the context.font property

It is possible to draw text in a canvas using the font property of the context to specify the font style (plain, bold, italic), the size, and the font name. Other properties such as strokeStyle or fillStyle, as well as other properties that are detailed in the next pages, are also going to be taken into account.

The font property accepts values like: font-style,  font-weight, font-size, font-face.

Accepted values are: 

-   font-style: normal, italic, oblique

-   font-weight: normal, bold, bolder, lighter

-   font-size: a size in pixels or in points, such as 60pt, 20px, 36px, etc. 

-   font-face:  Arial, Calibri, Times, Courier, etc. Some font faces may not work in all browsers.

Examples: 

-   context.font = &quot;60pt Calibri&quot;;

-   context.font = &quot;normal normal 20px Verdana&quot;;

-   context.font = &quot;normal 36px Arial&quot;;

-   context.font = &quot;italic bold 36px Arial&quot;;

#### Drawing text in solid or wireframe: the fillText() or strokeText() methods

The fillText(message, x, y) or strokeText(message, x, y) methods from the context will actually draw a text message at the origin of the baseline position. In the &quot;Hello World&quot; example, this is located at the bottom of the left leg of the &quot;H&quot;.

There is a fourth optional parameter maxWidth that forces the text to fit into a given width, distorting it if necessary:

1.  context.strokeText(&quot;Hello World!&quot;, x, y &lbrack;, maxWidth&rbrack;);

2.  context.fillText(&quot;Hello World!&quot;, x, y &lbrack;, maxWidth&rbrack;);

#### Forcing a text not to exceed a certain width: the maxWidth property 

&lt;!DOCTYPE html&gt;

&lt;html&gt;

&lt;head&gt;

&lt;title&gt;Drawing text: the maxWidth property&lt;/title&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; width=500 height=300&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var context=canvas.getContext(&apos;2d&apos;);

context.font = &quot;60pt Calibri&quot;;

context.lineWidth = 3;

context.strokeStyle = &quot;blue&quot;;

context.fillStyle = &quot;red&quot;;

context.fillText(&quot;Hello World!&quot;, 10, 100);

context.strokeText(&quot;Hello World!&quot;, 10, 100);

// Draw text with constrained width

context.fillText(&quot;Hello World!&quot;, 10, 160, 250);

context.strokeText(&quot;Hello World!&quot;, 10, 160, 250);

context.fillText(&quot;Hello World!&quot;, 10, 220, 150);

context.strokeText(&quot;Hello World!&quot;, 10, 220, 150);

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

ource code extract:

1.  \...

2.  context.font = &quot;60pt Calibri&quot;;

3.  context.lineWidth = 3;

4.  context.strokeStyle = &quot;blue&quot;;

5.  context.fillStyle = &quot;red&quot;;

6.  

7.  context.fillText(&quot;Hello World!&quot;, 10, 100);

8.  context.strokeText(&quot;Hello World!&quot;, 10, 100);

9.  

10. // Draw text with constrained width of 250 pixels

11. context.fillText(&quot;Hello World!&quot;, 10, 160, **250**);

12. context.strokeText(&quot;Hello World!&quot;, 10, 160, **250**);

13. 

14. // Constrain width to 150 pixels

15. context.fillText(&quot;Hello World!&quot;, 10, 220, **150**);

16. context.strokeText(&quot;Hello World!&quot;, 10, 220, **150**);

#### Measuring the width of a given text (bounding box) with the ctx.measureText()method

The ctx.measureText() method can be used to get the current width in pixels of a given text, taking into account the diverse properties involved such as font, size, shadow, lineWidth, etc.

HTML

&lt;!DOCTYPE html&gt;

&lt;html&gt;

&lt;head&gt;

&lt;title&gt;Drawing text: the ctx.measureText() method&lt;/title&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; width=500 height=300&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var context=canvas.getContext(&apos;2d&apos;);

context.font = &quot;60pt Calibri&quot;;

context.lineWidth = 3;

context.strokeStyle = &quot;blue&quot;;

context.fillStyle = &quot;red&quot;;

context.fillText(&quot;Hello World!&quot;, 10, 100);

context.strokeText(&quot;Hello World!&quot;, 10, 100);

var textMetrics = context.measureText(&quot;Hello World!&quot;);

var width = textMetrics.width;

context.font = &quot;20pt Arial&quot;;

context.fillText(&quot;Width of previous text: &quot; + width + &quot;pixels&quot;, 10, 150);

// Draw the baseline of the given width

context.moveTo(10, 100);

context.lineTo(width+10, 100);

context.stroke();

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Source code extract from this example:

1.  context.font = &quot;60pt Calibri&quot;;

2.  context.lineWidth = 3;

3.  context.strokeStyle = &quot;blue&quot;;

4.  context.fillStyle = &quot;red&quot;;

5.  

6.  context.fillText(&quot;Hello World!&quot;, 10, 100);

7.  context.strokeText(&quot;Hello World!&quot;, 10, 100);

8.  

9.  **var textMetrics = context.measureText(&quot;Hello World!&quot;);**

10. **var width = textMetrics.width;**

11. 

12. // Draw a text that displays the width of the previous drawn text

13. context.font = &quot;20pt Arial&quot;;

14. context.fillText(&quot;Width of previous text: &quot; + width + &quot;pixels&quot;, 10, 150);

15. 

16. // Draw the baseline of the given width

17. context.moveTo(10, 100);

18. context.lineTo(width+10, 100);

19. context.stroke();

#### Changing the way the text is horizontally drawn: the ctx.textbaseline property

The textBaseline property of the context is used to specify the different ways one can position the baseline of a given text:

HTML

&lt;!DOCTYPE html&gt;

&lt;html&gt;

&lt;head&gt;

&lt;title&gt;Drawing text: the ctx.textbaseline property&lt;/title&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; width=500 height=300&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var context=canvas.getContext(&apos;2d&apos;);

context.strokeStyle = &quot;#000000&quot;;

context.lineWidth = 1;

context.beginPath();

context.moveTo( 0, 75);

context.lineTo(500, 75);

context.stroke();

context.closePath();

context.font = &quot;16px Verdana&quot;;

context.fillStyle = &quot;#000000&quot;;

context.textBaseline = &quot;top&quot;;

context.fillText(&quot;top&quot;, 0, 75);

context.textBaseline = &quot;hanging&quot;;

context.fillText(&quot;hanging&quot;, 40, 75);

context.textBaseline = &quot;middle&quot;;

context.fillText(&quot;middle&quot;, 120, 75);

context.textBaseline = &quot;alphabetic&quot;;

context.fillText(&quot;alphabetic&quot;, 200, 75);

context.textBaseline = &quot;ideographic&quot;;

context.fillText(&quot;ideographic&quot;, 300, 75);

context.textBaseline = &quot;bottom&quot;;

context.fillText(&quot;bottom-glyph&quot;, 400, 75);

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

The example above shows the different possible values for this property and the corresponding results. The default value is &quot;alphabetic&quot; and corresponds to what has been used in the previous &quot;Hello World&quot; example.

Possible values:

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Possible values for the textBaseline property   
  ----------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------
  top                                             The text is aligned based on the top of the tallest glyph in the text.

  hanging                                         The text is aligned based on the line the text seems to hang from. This is almost identical to top, and in many cases, you cannot see the difference.

  middle                                          The text is aligned according to the middle of the text.

  alphabetic                                      The bottom of vertically oriented glyphs, e.g. western alphabet like the Latin.

  ideographic                                     The bottom of horizontally oriented glyphs.

  bottom                                          The text is aligned based on the bottom of the glyph in the text, that extends furthest down in the text.
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Typical use (taken from the example above):

1.  **context.textBaseline = &quot;top&quot;;**

2.  context.fillText(&quot;top&quot;, 0, 75);

3.  **context.textBaseline = &quot;hanging&quot;;**

4.  context.fillText(&quot;hanging&quot;, 40, 75);

5.  **context.textBaseline = &quot;middle&quot;;**

6.  context.fillText(&quot;middle&quot;, 120, 75);

#### Setting the horizontal justification of a text with the textAlign property

The textAlign property of the context tells how the x parameter will be used when calling strokeText(&quot;some text&quot;, x, y) and fillText(&quot;some text&quot;, x, y). For example, with textAlign=&quot;center&quot;, the x parameter gives the position of the vertical center of the text, while in textAlign=&quot;right&quot;, x corresponds to the rightmost position of the text.

HTML

&lt;!DOCTYPE html&gt;

&lt;html&gt;

&lt;head&gt;

&lt;title&gt;Drawing text: the textAlign property&lt;/title&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; width=500 height=120&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var context=canvas.getContext(&apos;2d&apos;);

context.stokeStyle = &quot;#000000&quot;;

context.lineWidth = 1;

context.beginPath();

context.moveTo( 250, 0);

context.lineTo( 250, 130);

context.stroke();

context.closePath();

context.font = &quot;16px Verdana&quot;;

context.fillStyle = &quot;#000000&quot;;

context.textAlign = &quot;center&quot;;

context.fillText(&quot;center&quot;, 250, 20);

context.textAlign = &quot;start&quot;;

context.fillText(&quot;start&quot;, 250, 40);

context.textAlign = &quot;end&quot;;

context.fillText(&quot;end&quot;, 250, 60);

context.textAlign = &quot;left&quot;;

context.fillText(&quot;left&quot;, 250, 80);

context.textAlign = &quot;right&quot;;

context.fillText(&quot;right&quot;, 250, 100);

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Typical use (source code taken from the above example):

1.  context.textAlign = &quot;center&quot;;

2.  context.fillText(&quot;center&quot;, 250, 20);

3.  context.textAlign = &quot;start&quot;;

4.  context.fillText(&quot;start&quot;, 250, 40);

5.  context.textAlign = &quot;end&quot;;

6.  context.fillText(&quot;end&quot;, 250, 60);

7.  context.textAlign = &quot;left&quot;;

8.  context.fillText(&quot;left&quot;, 250, 80);

9.  context.textAlign = &quot;right&quot;;

10. context.fillText(&quot;right&quot;, 250, 100);

<h3 id="ch3-3-3">3.3.3 Drawing Images</h3>

Working with images is rather simple, except that we need the images to be fully loaded into memory before drawing them. Loading images is an *asynchronous* process we need to take care of. Working with multiple images might also be difficult for beginners. We present a multiple image loader later on in this course.

**Let&apos;s say it once again**: To use an image in a canvas, make sure that the image has been loaded by the Web browser before drawing it!

It is also possible to draw images from a video stream, images corresponding to another canvas content, or images that are defined by &lt;img&gt; HTML elements in the page. We will see that as well in the following parts of this chapter.

But let&apos;s start with a basic example!

### Example #1: drawing an image in a canvas

Source code:

1.  &lt;!DOCTYPE HTML&gt;

2.  &lt;html lang=&quot;en&quot;&gt;

3.     &lt;head&gt;

4.        &lt;meta charset=&quot;utf-8&quot;/&gt;

5.        &lt;title&gt;Simple image drawing in a canvas&lt;/title&gt;

6.        &lt;script&gt;

7.           window.onload = function () {

8.  // Necessity to run this code only after the web page has been loaded.

9.           var canvas = document.getElementById(&quot;myCanvas&quot;);

10.          var context = canvas.getContext(&quot;2d&quot;);

11.          var imageObj = new Image();

12. // Callback function called by the imageObj.src = \.... line

13. //located after this function

14. **         **imageObj.onload = function () {

15. // Draw the image only when we have the guarantee

16. // that it has been loaded

17.          context.drawImage(imageObj, 0, 0);

18.       };

19.  

20. // Calls the imageObj.onload function asynchronously

21.       imageObj.src =

22.          &quot;https://www.w3.org/html/logo/downloads/HTML5_Logo_512.png&quot;;

23.       };

24.       &lt;/script&gt;

25.    &lt;/head&gt;

26.    &lt;body&gt;

27.       &lt;canvas id=&quot;myCanvas&quot; width=&quot;512&quot; height=&quot;512&quot;&gt;&lt;/canvas&gt;

28.    &lt;/body&gt;

29. &lt;/html&gt;

**Explanations:**

1.  We have to **create a JavaScript Image object** (*line 10*),

2.  When we set the src attribute of this object with the URL of the image file, then **an asynchronous  request is sent in the background by the browser**. Loading a big image may take some time, so the rest of the JavaScript code continues running. This is why we call it &quot;asynchronous&quot;.

3.  When the image file has been loaded, **the browser calls the onload callback associated with the image** (*line 14*). 

4.  **We draw the image only from inside this callback**, otherwise we have no guarantee that the image has been loaded and can be usable. The actual drawing here is done *line 17*.

5.  **There are numerous variants** of the drawImage(\...) context method at *line 17*

-   drawImage(img, x, y): draws the image at position x, y, keeping the original image size.

-   drawImage(img, x, y, sizeX, sizeY): same as before except that the image drawn is resized.

-   drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh): for drawing sub-images, (sx, sy, sw, sh) define the source rectangle, while dx, dy, dw, sh define the target rectangle. If these rectangles don&apos;t have the same size, the source sub-image is resized.

See picture below :
<!------------------------------------------------------------------------------------------------>
<!------------------------------ 133. (xxx) -------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image133.png?raw=true"
   alt="Drawing Images with Subimages"
   width="55%">
&nbsp;
<br/>

### Example #2: different variants of drawImage(\...)

This example illustrates the use of the different variants of the drawImage method:

HTML

&lt;!DOCTYPE HTML&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Drawing images: drawImage variants&lt;/title&gt;

&lt;script&gt;

window.onload = function() {

var canvas = document.getElementById(&quot;myCanvas&quot;);

var context = canvas.getContext(&quot;2d&quot;);

var imageObj = new Image();

imageObj.onload = function() {

// Try commenting/uncommenting the following lines to see the

// effect of the different drawImage variants

// Original, big image

// context.drawImage(imageObj, 0, 10);

// Original image drawn with size = 100x100 pixels

context.drawImage(imageObj, 0, 10, 100, 100);

// with size = 150x150

context.drawImage(imageObj, 80, 10, 150, 150);

// with size = 200x200

context.drawImage(imageObj, 210, 10, 200, 200);

// draw the sub image at 0, 0, width = 512, height = 100

// at position 100, 250, with a width of 256 and a height of 50

context.drawImage(imageObj, 0, 0, 512, 100, 100, 250, 256, 50);

};

imageObj.src = &quot;https://www.w3.org/html/logo/downloads/HTML5_Logo_512.png&quot;;

};

&lt;/script&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;512&quot; height=&quot;512&quot;&gt;&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

CSS

#myCanvas {

border:1px solid black;

}

Source code extract:

1.  var imageObj = new Image();

2.   

3.  imageObj.onload = function() {

4.     // Try commenting/uncommenting the following lines to see the

5.     // effect of the different drawImage variants

6.  

7.     // Original, big image

8.     // context.drawImage(imageObj, 0, 10);

9.  

10.    // Original image drawn with size = 100x100 pixels

11.    context.drawImage(imageObj, 0, 10, 100, 100);

12.    // with size = 150x150

13.    context.drawImage(imageObj, 80, 10, 150, 150);

14.    // with size = 200x200

15.    context.drawImage(imageObj, 210, 10, 200, 200);

16.  

17.   // draw the sub image at 0, 0, width = 512, height = 100

18.   // at position 100, 250, with a width of 256 and a height of 50

19.   context.drawImage(imageObj, 0, 0, 512, 100, 100, 250, 256, 50);

20. };

21. imageObj.src = &quot;https://www.w3.org/html/logo/downloads/HTML5_Logo_512.png&quot;;

22. };

### Example #3: draw an image defined in the page by an &lt;img src=&quot;\...&quot;&gt; element

Sometimes, you may want to draw an image that is already declared in the HTML document as an &lt;img src=&quot;\...&quot;&gt; element. Remember that when you add an &lt;img&gt; in the document, the browser starts downloading it in background. 

You could try drawing it using some code like this:

1.  &lt;body&gt;

2.  &lt;canvas id=&quot;myCanvas&quot; width=&quot;512&quot; height=&quot;512&quot;&gt;&lt;/canvas&gt;

3.  &lt;p&gt;Original image as an &lt;img&gt; element:&lt;/p&gt;

4.  **&lt;img id=&quot;logo&quot;**

5.  **src=&quot;https://fc07.deviantart.net/fs70/f/2013/149/b/8/texture_85_by_voyager168-d670m68.jpg&quot;&gt;**

6.  &lt;script&gt;

7.       canvas = document.getElementById(&quot;myCanvas&quot;);

8.       var ctx = canvas.getContext(&quot;2d&quot;);

9.       var logo = document.querySelector(&quot;#logo&quot;);

10.      **ctx.drawImage(logo, 0, 0, 100, 100);**

11. &lt;/script&gt;

12. &lt;/body&gt;

Although you will find many examples on the Web that do it this way, they will only work most of the time with small images, or with images that are in the browser&apos;s cache. Remember that** you cannot draw an image that has not been fully loaded!**

If you try to draw an image that is not loaded or partially loaded, you will have unexpected results!

**Best practice: ***only draw an image that is fully loaded, use*\
*the onload callback!*

The right way to do this is shown in this online example, that starts drawing only from the onload callback function:

CSS

#myCanvas {

border:1px solid black;

}

HTML

&lt;!DOCTYPE HTML&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Drawing an image with &lt;img&gt;&lt;/title&gt;

&lt;script&gt;

var canvas, context, imageObj;

window.onload = function() {

canvas = document.getElementById(&quot;myCanvas&quot;);

context = canvas.getContext(&quot;2d&quot;);

imageObj = document.querySelector(&quot;#logo&quot;);

drawAllImages();

};

function drawAllImages() {

console.log(&quot;image is already loaded, we draw it!&quot;);

// Original image drawn with size = 100x100 pixels

context.drawImage(imageObj, 0, 10, 100, 100);

// with size = 150x150

context.drawImage(imageObj, 80, 10, 150, 150);

// with size = 200x200

context.drawImage(imageObj, 210, 10, 200, 200);

// draw the sub image at 0, 0, width = 512, height = 100

// at position 100, 250, with a width of 256 and a height of 50

context.drawImage(imageObj, 0, 0, 512, 100, 100, 250, 256, 50);

}

&lt;/script&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;p&gt;A canvas with an image that is further in the page, loaded by the &lt;img src=\...&gt; tag. This is not the recommended way to load images, except if the image is already in your page. Use the onload callback to be sure that the image is in the page. &lt;/p&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;512&quot; height=&quot;512&quot;&gt;&lt;/canvas&gt;

&lt;p&gt;Original image is an &lt;img&gt; element:

&lt;/p&gt;

&lt;img id=&quot;logo&quot; src=&quot;https://www.w3.org/html/logo/downloads/HTML5_Logo_512.png&quot; alt=&quot;html5 logo&quot;&gt;

&lt;/body&gt;

&lt;/html&gt;

With large image files, this will not break nor produce unexpected results:

CSS

#myCanvas {

border:1px solid black;

}

HTML

&lt;!DOCTYPE HTML&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Using a large image&lt;/title&gt;

&lt;script&gt;

let canvas, context;

window.onload = () =&gt; {

canvas = document.getElementById(&quot;myCanvas&quot;);

context = canvas.getContext(&quot;2d&quot;);

draw();

};

function draw() {

var imageObj = document.querySelector(&quot;#logo&quot;);

console.log(&quot;Image has been loaded, let&apos;s draw it!&quot;);

// Original image drawn with size = 100x100 pixels

context.drawImage(imageObj, 0, 10, 100, 100);

// with size = 150x150

context.drawImage(imageObj, 80, 10, 150, 150);

// with size = 200x200

context.drawImage(imageObj, 210, 10, 200, 200);

// draw the sub image at 0, 0, width = 512, height = 100

// at position 100, 250, with a width of 256 and a height of 50

context.drawImage(imageObj, 0, 0, 512, 100, 100, 250, 256, 50);

}

&lt;/script&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;p&gt;It is possible that the drawing in the canvas below appears only after a few seconds, because the image is very large!&lt;/p&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;512&quot; height=&quot;512&quot;&gt;&lt;/canvas&gt;

&lt;p&gt;Very large original image, declared as an &lt;img&gt; element:

&lt;/p&gt;

&lt;img id=&quot;logo&quot; alt=&quot;logo&quot; src=&quot;https://mainline.i3s.unice.fr/mooc/texture_85_by_voyager168-d670m68.jpg&quot; width=&quot;512&quot; height=&quot;512&quot;&gt;

&lt;/body&gt;

&lt;/html&gt;

The **[DOM Level 2 Events specification](https://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-eventgroupings-htmlevents) **says: &quot;*The load event occurs when the DOM implementation finishes loading **all content** within a document, all frames within a FRAMESET, or an OBJECT element.*&quot;

<h3 id="ch3-3-4">3.3.4 Drawing Images from a Video Stream</h3>

The drawImage(\...) function can take a video element as its first parameter. The image that will be drawn is the one currently played by the video stream. This can be done at video frequency on most modern computers or mobile devices.

HTML

&lt;!DOCTYPE HTML&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Drawing images from a video stream&lt;/title&gt;

&lt;style&gt;

body {

margin: 10px;

padding: 0px;

}

#myCanvas {

border: 10px solid red;

}

&lt;/style&gt;

&lt;script&gt;

var video;

var canvas, ctx;

var angle = 0;

function init() {

video = document.getElementById(&apos;sourcevid&apos;);

canvas = document.getElementById(&apos;myCanvas&apos;);

ctx = canvas.getContext(&apos;2d&apos;);

setInterval(&quot;processFrame()&quot;, 25);

}

function processFrame() {

// Uncomment next line for drawing 100% copy of the video content

//ctx.drawImage(video, 0, 0);

// Comment these 4 lines if you uncommented the previous one

ctx.drawImage(video, 0, 0, 320, 180);

drawRotatingVideo(480, 90);

ctx.drawImage(video, 0, 180, 320, 180);

ctx.drawImage(video, 320, 180, 320, 180);

}

function drawRotatingVideo(x, y) {

// Clear thze zone at the top right quarter of the canvas

ctx.clearRect(320, 0, 320, 180);

// We are going to change the coordinate system, save the context !

ctx.save();

// translate, rotate and recenter the image at its &quot;real&quot; center,

//not the top left corner

ctx.translate(x, y);

ctx.rotate(angle += 0.01);

ctx.translate(-80, -45);

ctx.drawImage(video, 0, 0, 160, 90);

// restore the context

ctx.restore();

}

&lt;/script&gt;

&lt;/head&gt;

&lt;body onload=&quot;init()&quot; &gt;

&lt;p&gt;This is a &lt;code&gt;&lt;video&gt;&lt;/code&gt; element: &lt;/p&gt;

&lt;video id=&quot;sourcevid&quot; autoplay loop&gt;

&lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/BigBuckBunny_640x360.mp4&quot; type=&quot;video/mp4&quot; /&gt;

&lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/BigBuckBunny_640x360.ogv&quot; type=&quot;video/ogg&quot;/&gt;

&lt;/video&gt;

&lt;p&gt;This is a &lt;code&gt;&lt;canvas&gt;&lt;/code&gt; element: &lt;/p&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;620&quot; height=&quot;360&quot;&gt;&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

This example shows:

-   a &lt;video&gt; element on top, and four images drawn in a canvas below.

-   The images are drawn every XXX milliseconds using the setInterval(function, delay) method.

Source code extract:

1.  &lt;script&gt;

2.     var video;

3.     var canvas, ctx;

4.     var angle = 0;

5.   

6.  function init() {

7.     video = document.getElementById(&apos;sourcevid&apos;);

8.     canvas = document.getElementById(&apos;myCanvas&apos;);

9.     ctx = canvas.getContext(&apos;2d&apos;);

10.  

11.    setInterval(&quot;processFrame()&quot;, 25); // call processFrame each 25ms

12. }

13.  

14. function processFrame() {

15.     ctx.drawImage(video, 0, 0, 320, 180);

16.     drawRotatingVideo(480, 90);

17.     ctx.drawImage(video, 0, 180, 320, 180);

18.     ctx.drawImage(video, 320, 180, 320, 180);

19. }

20.  

21. function drawRotatingVideo(x, y) {

22.      // Clear the zone at the top right quarter of the canvas

23.     ctx.clearRect(320, 0, 320, 180);

24.  

25.     // We are going to change the coordinate system, save the context!

26.     ctx.save();

27.     // translate, rotate and recenter the image at its &quot;real&quot; center,

28.     //not the top left corner

29.     ctx.translate(x, y);

30.     ctx.rotate(angle += 0.01); // rotate and increment the current angle

31.     ctx.translate(-80, -45);

32.  

33.     ctx.drawImage(video, 0, 0, 160, 90);

34.  

35.     // restore the context

36.     ctx.restore();

37. }

38. &lt;/script&gt;

39. &lt;/head&gt;

40.  

41. &lt;body onload=&quot;init()&quot; &gt;

42. &lt;p&gt;This is a &lt;video&gt; element: &lt;/p&gt;

43. &lt;video id=&quot;sourcevid&quot; autoplay=&quot;true&quot; loop=&quot;true&quot;&gt;

44. &lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/BigBuckBunny_640x360.mp4&quot;

45.          type=&quot;video/mp4&quot; /&gt;

46. &lt;source src=&quot;https://mainline.i3s.unice.fr/mooc/BigBuckBunny_640x360.ogv&quot;

47.          type=&quot;video/ogg&quot;/&gt;

48. &lt;/video&gt;

49. &lt;p&gt;This is a &lt;canvas&gt; element: &lt;/p&gt;

50. &lt;canvas id=&quot;myCanvas&quot; width=&quot;620&quot; height=&quot;360&quot;&gt;&lt;/canvas&gt;

51. &lt;/body&gt;

Explanations:

-   *Line 11*: the call to setInterval will make the browser execute the processFrame function each 25ms.

-   *Lines 15, 17 and 18*: in processFrame, drawImage(\...) is called 3 times with the video element passed as first parameter.

-   *Line 43*: the video element declared at *line 43* has autoplay=true and loop=true, it starts playing the video as soon as possible and will loop it.

-   *Line 21*: We implemented a rotating video effect in the drawRotatingVideo. The use of context save/restore is primordial as this function changes the coordinate system at each call, translating and rotating it. Notice the extra translation at *line 31* that translates the coordinate system backwards with half of the size of the image that is drawn. We did this in order to make the image rotate around the center of the rectangle, instead of around the top left corner at (0, 0) by default. Try commenting out this line in the running example and you will see what we mean.

<h3 id="ch3-4-1">3.4.1 Immediate Mode vs. Path Mode</h3

### Immediate mode

As a reminder: an immediate mode means &quot;executing a call to a drawing method means *immediately* drawing in the canvas&quot;. The drawing appears as soon as the design instruction is executed.

-   In the previous examples, we saw how to draw rectangles using the fillRect(x, y, width, height) and strokeRect(x, y, width, height) methods of the context.

```
<!-- -->
```
-   We also learned how to draw a text message using the fillText(message, x, y) and strokeText(message, x, y) methods that draws a text in filled and wireframe mode, respectively.

```
<!-- -->
```
-   These methods, along with the drawImage(\...) method already seen in section 3.3.3, are *&quot;immediate methods&quot;*: as soon as they are executed, the results are displayed on screen, the drawings are performed, pixels on the canvas area change their colors, etc.

Here is an example that draws 1000 random rectangles in a canvas, using immediate mode rectangle drawing calls:

JS

var canvas, ctx, w, h;

function init() {

canvas = document.getElementById(&apos;myCanvas&apos;);

ctx = canvas.getContext(&apos;2d&apos;);

w = canvas.width;

h = canvas.height;

console.time(&quot;time to draw&quot;);

for(var i=0; i &lt; 1000; i++) {

var x = Math.random() \* w;

var y = Math.random() \* h;

var width = Math.random() \* w;

var height = Math.random() \* h;

ctx.strokeRect(x, y, width, height);

}

console.timeEnd(&quot;time to draw&quot;);

}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Canvas&lt;/title&gt;

&lt;/head&gt;

&lt;body onload = init();&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;400&quot; height =400&gt;

Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

1.  var canvas, ctx, w, h;

2.  

3.  function init() {

4.      canvas = document.getElementById(&apos;myCanvas&apos;);

5.      ctx = canvas.getContext(&apos;2d&apos;);

6.  

7.      w = canvas.width;

8.      h = canvas.height;

9.  

10.     console.time(&quot;time to draw&quot;);

11. 

12.     for(var i=0; i &lt; 1000; i++) {

13.        var x = Math.random() \* w;

14.        var y = Math.random() \* h;

15.        var width = Math.random() \* w;

16.        var height = Math.random() \* h;

17. 

18.        ctx.strokeRect(x, y, width, height);

19.     }

20.     console.timeEnd(&quot;time to draw&quot;);

21. }

*Lines 12-18* draw 1000 rectangles of random sizes in immediate mode. We also measure the time using the usual console.time(name_of_timer) and console.timeEnd(name_of_timer) that will write in the browser console the time elapsed. Note that console.time(\...) and console.timeEnd(\...) display results only in the browser&apos;s console, not in the JSBin console.

On a Mac Book Pro from 2015, the result is an average time of 4.034ms for drawing all these rectangles:

![Image of the devtool console that shows random time values. The average time elapsed is around 4s](./images/image134.jpeg){width="6.5in" height="1.3833333333333333in"}

### Path mode

There is another drawing mode called &quot;path drawing mode&quot; where you first send drawing orders to the graphics processor, and these orders are stored in a buffer. Then you call methods to draw the whole buffer at once. There are also methods to erase the buffer&apos;s content.

Path drawing mode allows parallelism: if you need to draw 10,000 rectangles, it&apos;s better to store the orders in the graphics card, then execute the drawing all at once, rather than doing 10,000 immediate calls to strokeRect(\...) for example. With the buffered mode, the Graphic Processing Unit (GPU) of the graphics card hardware will be able to parallelize the computations (modern graphics cards can execute hundreds/thousands of things in parallel).

Same example as before, this time using the buffered mode for drawing rectangles:

JS

var canvas, ctx, w, h;

function init() {

canvas = document.getElementById(&apos;myCanvas&apos;);

ctx = canvas.getContext(&apos;2d&apos;);

w = canvas.width;

h = canvas.height;

console.time(&quot;time to draw&quot;);

for(var i=0; i &lt; 1000; i++) {

var x = Math.random() \* w;

var y = Math.random() \* h;

var width = Math.random() \* w;

var height = Math.random() \* h;

ctx.rect(x, y, width, height);

}

ctx.stroke();

console.timeEnd(&quot;time to draw&quot;);

}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Canvas&lt;/title&gt;

&lt;/head&gt;

&lt;body onload = init();&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;400&quot; height =400&gt;

Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

Extract from source code (the part that draws the rectangles):

1.  for(var i=0; i &lt; 1000; i++) {

2.  var x = Math.random() \* w;

3.  var y = Math.random() \* h;

4.  var width = Math.random() \* w;

5.  var height = Math.random() \* h;

6.  ctx.rect(x, y, width, height); // store a rectangle in path/buffer

7.  }

8.  ctx.stroke(); // draws the whole buffer (the 1000 rectangles) at once

Instead of calling strokeRect(\...) or fillRect(\...), we just call the rect(\...) method of the context (*line 7*). This is how we can delay the drawing of the rectangles. The 1000 rectangles are stored in a buffer in the hardware.

The call to ctx.stroke() (*line 9*) or to its sister method ctx.fill() will draw the entire buffer contents in fill or stroke mode.

And here is what the timer gives: a slightly faster execution time. Changing 1000 to 100,000 will give even larger differences.

**Path mode is faster than immediate mode! We have now an average time of 3.1ms**

![Image of the devtool console that shows random time values. The average time elapsed is around 3.1ms](./images/image135.jpeg){width="6.5in" height="1.5576388888888888in"}

#### Reset the path mode buffer

A call to ctx.beginPath() will reset the buffer (empty its contents). We will see many more examples of using the path drawing mode in another further section.

1.  // start a new buffer / path

2.  ctx.beginPath();

3.  // all these orders are in a buffer/path

4.  ctx.moveTo(10, 10);

5.  ctx.lineTo(100, 100);

6.  ctx.lineTo(150, 70);

7.  // Draw the buffer

8.  ctx.stroke();

Summary of path mode principles

1.  **Call drawing methods that work in path mode**, for example call ctx.rect(\...) instead of ctx.strokeRect(\...) or ctx.fillRect(\...)

2.  **Call ctx.stroke() or ctx.fill() to draw the buffer&apos;s contents**

3.  **Beware that the buffer is never emptied, **two consecutive calls to ctx.stroke() will draw the buffer contents twice! Instead, use ctx.beginPath() to empty it if needed

4.  It is possible to empty the buffer by calling ctx.beginPath()

5.  Path drawing is faster than immediate drawing (parallelization is possible)

<h3 id="ch3-4-2">3.4.2 A Warning</h3>

**Warning**: you do not need to spend too much time on each part of this sub-section

You do not need to memorize or learn by heart all the examples in the following pages. They are given as references. There will be no quizzes about curves as they are not often done &quot;by hand&quot;, but are generated by tools such as Adobe Illustrator or online generators.

-   **You need to draw arcs?** Then, please use the corresponding section as a reference: you know you will find one or more examples and a detailed explanation.

-   **You need to draw lines? Arrows? Curves?** Same thing: go to the corresponding pages and look at the examples!

Also, do not forget to use your favorite HTML5 canvas cheatsheet (provided before in the last section). You will find it very helpful when you start playing with the canvas.

<h3 id="ch3-4-3">3.4.3 Drawing Lines</h3>

We have been drawing rectangles so far.

Now let&apos;s go a bit further by introducing the notion of &quot;path drawing&quot;. This approach uses the ctx.moveTo(x, y) method of the context, in conjunction with other drawing methods that end in &quot;To&quot;, such as ctx.lineTo(x, y).

This makes it easier to draw multiple connected lines. Consecutive calls to ctx.lineTo(x, y) will store in the path/buffer a set of connected lines that we will draw altogether by a single call to ctx.stroke() or ctx.fill().

Here are the 5 different steps:

1.  Put the &quot;pencil&quot; somewhere with a call to ctx.moveTo(x1, y1). This will be the origin of the first line.

2.  Call the ctx.lineTo(x2, y2) method to draw a line from the previous position (previous step) to the position passed as parameters to the lineTo(\...) method. This position will serve as the origin for the next line to be drawn.

3.  Call lineTo(x3, y3) again to draw a line that goes from (x2, y2) to (x3, y3). This line will start at the end of the previous one.

4.  Repeat step 3 to draw more connected lines.

5.  Call the ctx.stroke() or the ctx.fill() methods to draw the path defined by the different lines.

Note the call to ctx.stroke() or ctx.fill() will use the current values of the strokeStyle or fillStyle properties. It is possible to call ctx.moveTo(x, y) in the middle of steps 1 through 5 in order to move the pen somewhere else without connecting to the last drawn line.

### Drawing a grid

See the example below:

![](./images/image136.png){width="6.5in" height="2.0722222222222224in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Drawing a grid&lt;/title&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var ctx=canvas.getContext(&apos;2d&apos;);

// Vertical lines

for (var x = 0.5; x &lt; 500; x += 10) {

ctx.moveTo(x, 0);

ctx.lineTo(x, 375);

}

// Horizontal lines

for (var y = 0.5; y &lt; 375; y += 10) {

ctx.moveTo(0, y);

ctx.lineTo(500, y);

}

// Draw in blue

ctx.strokeStyle = &quot;#0000FF&quot;;

// Before the execution of the next line nothing as been drawn yet !

ctx.stroke();

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Code source extract:

1.  var canvas=document.getElementById(&apos;myCanvas&apos;);

2.  var ctx=canvas.getContext(&apos;2d&apos;);

3.  

4.  // Vertical lines

5.  for (var x = 0.5; x &lt; 500; x += 10) {

6.      ctx.moveTo(x, 0);

7.      ctx.lineTo(x, 375);

8.  }

9.  

10. // Horizontal lines

11. for (var y = 0.5; y &lt; 375; y += 10) {

12.     ctx.moveTo(0, y);

13.     ctx.lineTo(500, y);

14. }

15.  

16. // Draw in blue

17. ctx.strokeStyle = &quot;#0000FF&quot;;

18.  

19. // Until the execution of the next line, nothing has been drawn!

20. ctx.stroke();

In this example, the entire grid is drawn during the execution of the last line of code, with the single call to ctx.stroke().

### Mixing filled and wireframe shapes (and immediate and path modes)

Try this:

![](./images/image137.png){width="6.5in" height="2.0722222222222224in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Canvas&lt;/title&gt;

&lt;/head&gt;

&lt;canvas id=&quot;myCanvas&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var ctx=canvas.getContext(&apos;2d&apos;);

ctx.fillStyle=&apos;#FF0000&apos;;

ctx.fillRect(0,0,80,100);

ctx.moveTo(0,0);

ctx.lineTo(100, 100);

ctx.lineTo(100,0);

ctx.strokeStyle = &quot;#0000FF&quot;;

ctx.stroke();

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Code source:

1.  var canvas=document.getElementById(&apos;myCanvas&apos;);

2.  var ctx=canvas.getContext(&apos;2d&apos;);

3.  

4.  // a filled rectangle in immediate mode

5.  ctx.fillStyle=&apos;#FF0000&apos;;

6.  ctx.fillRect(0,0,80,100);

7.  

8.  // two consecutive lines in path mode

9.  ctx.moveTo(0,0);

10. ctx.lineTo(100, 100);

11. ctx.lineTo(100,0);

12. 

13. // draws only the two lines in wireframe mode

14. ctx.strokeStyle = &quot;#0000FF&quot;;

15. ctx.stroke();

This example shows that filled and wireframe shapes should be drawn differently (here a filled rectangle is drawn using a call to the fillRect(\...) method while a wireframe set of connected lines is drawn using the stroke() method of the context).

### Drawing a single path made with disconnected lines / parts

Try this:

![](./images/image138.png){width="6.5in" height="2.0861111111111112in"}

Code source:

1.  var canvas=document.getElementById(&apos;myCanvas&apos;);

2.  var ctx=canvas.getContext(&apos;2d&apos;);

3.  

4.  // first part of the path

5.  ctx.moveTo(20,20);

6.  ctx.lineTo(100, 100);

7.  ctx.lineTo(100,0);

8.  

9.  // second part of the path, moveTo(\...) is used to &quot;jump&quot; to another place

10. ctx.moveTo(120,20);

11. ctx.lineTo(200, 100);

12. ctx.lineTo(200,0);

13. 

14. // indicate stroke color + draw the path

15. ctx.strokeStyle = &quot;#0000FF&quot;;

16. ctx.stroke();

In this last example, we simply called the moveTo() method between each part of the path (*lines 5 and 10*). And we called stroke() (*line 16*) only once to draw the whole path.

<h3 id="ch3-4-4">3.4.4 Drawing Lines with Different Styles</h3>

### Common mistake: drawing the same path twice

Let&apos;s look at the drawing from the last example of the previous section:

![](./images/image139.png){width="6.5in" height="2.0569444444444445in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Drawing disconnected lines&lt;/title&gt;

&lt;/head&gt;

&lt;canvas id=&quot;myCanvas&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var ctx=canvas.getContext(&apos;2d&apos;);

// first part of the path

ctx.moveTo(20,20);

ctx.lineTo(100, 100);

ctx.lineTo(100,0);

// second part of the path, moveTo(\...) is used to &quot;jump&quot; to another place

ctx.moveTo(120,20);

ctx.lineTo(200, 100);

ctx.lineTo(200,0);

// indicate stroke color + draw the path

ctx.strokeStyle = &quot;#0000FF&quot;;

ctx.stroke();

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Imagine that we would like to draw them with different styles and colors: the shape on the left will stay as it is now (blue, wireframe), while the shape on the right will be filled, colored in pink. Let&apos;s look at how we can do this\...

### Drawing two paths with different styles: the WRONG and the right way!

#### First, the wrong way!

In this example, we will draw the two parts of the path with different styles: the first part in wireframe mode, and the second part in filled mode.

What we will try first is to call stroke() after the first half of the path, then call fill() after the second half of the path:

![](./images/image140.png){width="6.5in" height="2.0631944444444446in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Drawing two paths with different styles: the wrong way!&lt;/title&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var ctx=canvas.getContext(&apos;2d&apos;);

// first part of the path

ctx.moveTo(20,20);

ctx.lineTo(100, 100);

ctx.lineTo(100,0);

// indicate stroke color + draw first part of the path

ctx.strokeStyle = &quot;#0000FF&quot;;

ctx.stroke();

// second part of the path

ctx.moveTo(120,20);

ctx.lineTo(200, 100);

ctx.lineTo(200,0);

// indicate stroke color + draw the path

ctx.fillStyle = &quot;pink&quot;;

ctx.fill();

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Here is the code:

1.  var canvas=document.getElementById(&apos;myCanvas&apos;);

2.  var ctx=canvas.getContext(&apos;2d&apos;);

3.  

4.  // first part of the path

5.  ctx.moveTo(20,20);

6.  ctx.lineTo(100, 100);

7.  ctx.lineTo(100,0);

8.  

9.  // indicate stroke color + draw first part of the path

10. ctx.strokeStyle = &quot;#0000FF&quot;;

11. ctx.stroke();

12. 

13. // second part of the path

14. ctx.moveTo(120,20);

15. ctx.lineTo(200, 100);

16. ctx.lineTo(200,0);

17. 

18. // indicate stroke color + draw the path

19. ctx.fillStyle = &quot;pink&quot;;

20. ctx.fill();

Hey - it does not work! Weirdly, the two parts of the path are filled in pink! But we called stroke() after the first half of the path was drawn (lines 5-8). Then we called fill() only after the second part of the path was specified (lines 14-19)\... so, what happened?

Remember that fill() or stroke() *draws the whole path*, even if it is disconnected, and even if it has already been drawn!

What happened is:

1.  The call to stroke() has drawn the path corresponding to the lines 5-7. Indeed, the first part of the path (on the left) has actually been drawn once in wireframe mode, and in blue.

2.  Then, the call to fill() at line 20 has drawn the whole path again, but in pink and in filled mode. But this time the path corresponds to lines 5-7 plus lines 14-16 that make up the second shape on the right.\
    *So the path that has been drawn this time is made of both of the triangles.*

**Important**: If you do not want to draw parts of the same path several times, you need to draw two different paths,\
using the ctx.beginPath() method, as shown in the next example.

#### Now, the right way!

![](./images/image141.png){width="6.5in" height="2.0701388888888888in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Drawing two paths with different styles: the right way!&lt;/title&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var ctx=canvas.getContext(&apos;2d&apos;);

// first part of the path

ctx.moveTo(20,20);

ctx.lineTo(100, 100);

ctx.lineTo(100,0);

// indicate stroke color + draw first part of the path

ctx.strokeStyle = &quot;#0000FF&quot;;

ctx.stroke();

// start a new path, empty the current buffer

ctx.beginPath();

// second part of the path

ctx.moveTo(120,20);

ctx.lineTo(200, 100);

ctx.lineTo(200,0);

// indicate stroke color + draw the path

ctx.fillStyle = &quot;pink&quot;;

ctx.fill();

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Source code:

1.  var canvas=document.getElementById(&apos;myCanvas&apos;);

2.  var ctx=canvas.getContext(&apos;2d&apos;);

3.  

4.  // first part of the path

5.  ctx.moveTo(20,20);

6.  ctx.lineTo(100, 100);

7.  ctx.lineTo(100,0);

8.  

9.  // indicate stroke color + draw first part of the path

10. ctx.strokeStyle = &quot;#0000FF&quot;;

11. ctx.stroke();

12. 

13. // start a new path, empty the current buffer

14. ctx.beginPath();

15. 

16. // second part of the path

17. ctx.moveTo(120,20);

18. ctx.lineTo(200, 100);

19. ctx.lineTo(200,0);

20. 

21. // indicate stroke color + draw the path

22. ctx.fillStyle = &quot;pink&quot;;

23. ctx.fill();

This time, in order to draw the two shapes differently, we defined two separate paths. The way to do this is just to call ctx.beginPath() to start a new path. In this example, the first path has been drawn in wireframe mode, then a new path has been started that is drawn in filled mode.

<h3 id="ch3-4-5">3.4.5 Drawing Lines in Immediate Mode</h3>

Sometimes, it might be useful to draw just one line.

It&apos;s interesting to see how we can write a single &quot;draw line&quot; function that takes the start and end coordinates, the color, the line width, etc., and give the impression of being done in &quot;immediate&quot; mode.

Here is the code for this &quot;utility&quot; function that you may find useful:

1.  function drawLine(x1, y1, x2, y2, color, width) {

2.      ctx.save();

3.  

4.      // set color and lineWidth, if these parameters

5.      // are not defined, do nothing (default values)

6.      if(color)

7.          ctx.strokeStyle = color;

8.  

9.      if(width)

10.         ctx.lineWidth = width;

11. 

12.     // start a new path

13.     ctx.beginPath();

14. 

15.     ctx.moveTo(x1, y1);

16.     ctx.lineTo(x2, y2);

17.     ctx.stroke();

18. 

19.     ctx.restore();

20. }

Notice the save/restore of the context at the beginning/end of the function. This is REALLY a best practice to avoid affecting other functions&apos; context.

-   *Line 13* starts a new path so that the function will only draw what it is meant to draw: a single line.

```
<!-- -->
```
-   *Lines 15-17* move the &quot;pen&quot; at (x1, y1) then draw a line to (x2, y2), and the stroke at *line 17* makes it appear on the screen.

Here is an example:

![](./images/image142.png){width="6.5in" height="2.0569444444444445in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Drawing lines in immediate mode&lt;/title&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var ctx=canvas.getContext(&apos;2d&apos;);

drawLine(0, 0, 100, 100);

drawLine(0, 50, 150, 200, &apos;red&apos;);

drawLine(10, 100, 100, 10, &apos;green&apos;, 10);

function drawLine(x1, y1, x2, y2, color, width) {

ctx.save();

// set color and lineWidth, if these parameters

// are not defined, do nothing (default values)

if(color)

ctx.strokeStyle = color;

if(width)

ctx.lineWidth = width;

// start a new path

ctx.beginPath();

ctx.moveTo(x1, y1);

ctx.lineTo(x2, y2);

ctx.stroke();

ctx.restore();

}

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Source code extract:

1.  drawLine(0, 0, 100, 100);

2.  drawLine(0, 50, 150, 200, &apos;red&apos;);

3.  drawLine(10, 100, 100, 10, &apos;green&apos;, 10);

<h3 id="ch3-4-6">3.4.6 Drawing Arrows</h3>

In this section, we present a function that draws arrows in a canvas.

You may find multiple implementations on the Web for drawing arrows in a canvas, but the one we are presenting has the advantage of being rather simple and enables you to set the color and line width of the arrows.

### Examples

#### Example #1:

1.  // Adapted from : https://stackoverflow.com/questions/808826/draw-arrow-on-canvas-tag

2.  function drawArrow(ctx, fromx, fromy, tox, toy, arrowWidth, color){

3.      //variables to be used when creating the arrow

4.      var headlen = 10;

5.      var angle = Math.atan2(toy-fromy,tox-fromx);

6.   

7.      ctx.save();

8.      ctx.strokeStyle = color;

9.   

10.     //starting path of the arrow from the start square to the end square

11.     //and drawing the stroke

12.     ctx.beginPath();

13.     ctx.moveTo(fromx, fromy);

14.     ctx.lineTo(tox, toy);

15.     ctx.lineWidth = arrowWidth;

16.     ctx.stroke();

17.  

18.     //starting a new path from the head of the arrow to one of the sides of

19.     //the point

20.     ctx.beginPath();

21.     ctx.moveTo(tox, toy);

22.     ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),

23.                toy-headlen\*Math.sin(angle-Math.PI/7));

24.  

25.     //path from the side point of the arrow, to the other side point

26.     ctx.lineTo(tox-headlen\*Math.cos(angle+Math.PI/7),

27.                toy-headlen\*Math.sin(angle+Math.PI/7));

28.  

29.     //path from the side point back to the tip of the arrow, and then

30.     //again to the opposite side point

31.     ctx.lineTo(tox, toy);

32.     ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),

33.                toy-headlen\*Math.sin(angle-Math.PI/7));

34.  

35.     //draws the paths created above

36.     ctx.stroke();

37. 

38.     ctx.restore();

39. }

**Explanations:**

-   An arrow is made of one line (the arrow body) and three connected lines (the arrow head). 

```
<!-- -->
```
-   As we modify some context properties in this function, we call save() and restore() at the beginning and at the end of the function.

```
<!-- -->
```
-   This function can be improved in many ways: adding shadows, using fill() instead of stroke(), which gives strange results when the width is too big, etc.

#### Example #2

![](./images/image143.png){width="6.5in" height="2.0569444444444445in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Drawing arrows&lt;/title&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var ctx=canvas.getContext(&apos;2d&apos;);

// Adapted from : http://stackoverflow.com/questions/808826/draw-arrow-on-canvas-tag

function drawArrow(ctx, fromx, fromy, tox, toy, arrowWidth, color){

//variables to be used when creating the arrow

var headlen = 10;

var angle = Math.atan2(toy-fromy,tox-fromx);

ctx.save();

ctx.strokeStyle = color;

//starting path of the arrow from the start square to the end square

//and drawing the stroke

ctx.beginPath();

ctx.moveTo(fromx, fromy);

ctx.lineTo(tox, toy);

ctx.lineWidth = arrowWidth;

ctx.stroke();

//starting a new path from the head of the arrow to one of the sides of

//the point

ctx.beginPath();

ctx.moveTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),

toy-headlen\*Math.sin(angle-Math.PI/7));

//path from the side point of the arrow, to the other side point

ctx.lineTo(tox-headlen\*Math.cos(angle+Math.PI/7),

toy-headlen\*Math.sin(angle+Math.PI/7));

//path from the side point back to the tip of the arrow, and then

//again to the opposite side point

ctx.lineTo(tox, toy);

ctx.lineTo(tox-headlen\*Math.cos(angle-Math.PI/7),

toy-headlen\*Math.sin(angle-Math.PI/7));

//draws the paths created above

ctx.stroke();

ctx.restore();

}

drawArrow(ctx, 10, 10, 100, 100, 10, &apos;red&apos;);

drawArrow(ctx, 100, 10, 140, 140, 3, &apos;black&apos;);

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Source code extract:

1.  drawArrow(ctx, 10, 10, 100, 100, 10, &apos;red&apos;);

2.  

3.  drawArrow(ctx, 100, 10, 140, 140, 3, &apos;black&apos;);

### How to draw nicer arrows?

On the Web, you will find many different ways to draw arrows.

This [article on drawing lines and arcs with arrow heads](http://www.dbp-consulting.com/tutorials/canvas/CanvasArrow.html) is worth reading. It details how to draw arrows with curved heads and different styles for the head. Note, however, that you will need to modify some parts if you want it to support different line widths, etc.

Screenshot from a demo available on the above Web site:

![](./images/image144.png){width="2.0in" height="2.026147200349956in"}

In a later part of the course dedicated to curve drawing in a canvas, we will also show how to draw curved arrows, with very simple code (much simpler than the one used for drawing the clock&apos;s hands above).

<h3 id="ch3-4-7">3.4.7 Closing a Path</h3>

The ctx.closePath() method indicates that we would like a closed path: draw from the last point to the first.

Try this:

![](./images/image145.png){width="6.5in" height="2.0840277777777776in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Closing a path&lt;/title&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var ctx=canvas.getContext(&apos;2d&apos;);

// Path made of three points (defines two lines)

ctx.moveTo(20,20);

ctx.lineTo(100, 100);

ctx.lineTo(100,0);

// Close the path, try commenting this line

ctx.closePath();

// indicate stroke color + draw first part of the path

ctx.strokeStyle = &quot;blue&quot;;

ctx.stroke();

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Source code:

1.  var canvas=document.getElementById(&apos;myCanvas&apos;);

2.  var ctx=canvas.getContext(&apos;2d&apos;);

3.  

4.  // Path made of three points (defines two lines)

5.  ctx.moveTo(20,20);

6.  ctx.lineTo(100, 100);

7.  ctx.lineTo(100,0);

8.  

9.  // Close the path, try commenting this line

10. ctx.closePath();

11. 

12. // indicate stroke color + draw first part of the path

13. ctx.strokeStyle = &quot;blue&quot;;

14. ctx.stroke();

Explanations:

-   *Lines 5-7* corresponds to a path made of two consecutive lines. If we just call stroke() after that, two lines will be drawn on the canvas.

-   *Line 10* indicates that we would like *a closed path*. In this case, the call to stroke() at *line 14* will draw the two lines plus an extra line that connects the last point of the path to the first one. It will draw a closed triangle!

Try commenting the *line 10* in the online example and see the results!

<h3 id="ch3-4-8">3.4.8 Drawing Circles and Arcs</h3>

The ctx.arc(cx, cy, radius, startAngle, endAngle, drawInverse) method is useful for drawing arcs of circles. It takes the center of the circle/arc, its radius, the starting angle of the arc (turning clockwise), the ending angle of the arc, and an optional parameter we will talk about later.

*Note*: the figures in this page have been borrowed from the [HTML5 Canvas Tutorials](https://www.html5canvastutorials.com/tutorials/html5-canvas-arcs/) Web site.

![HTML5 Canvas Arc Diagram: drawing circle, coordinate system](./images/image146.jpeg){width="5.1875in" height="3.3020833333333335in"}

### Typical usage

Typical usage for drawing an arc/circle/ellipse is:

1.  ctx.arc(centerX, centerY, radius, startAngle, endAngle); // clockwise drawing

2.  

3.  ctx.arc(centerX, centerY, radius, startAngle, endAngle, **false**);

The angles are in radians (between 0 and 2\*Math.PI). The arc is drawn clockwise. Beware that this may not seem natural if you&apos;re used to the trigonometric order.

The last parameter is optional and has a value of false by default. If true, instead of drawing an arc of circle that corresponds to the parameters, *it will draw its complementary*. See the examples below to see the difference.

### Examples

#### Example #1: drawing an arc with radius = 50, starting angle = 0, end angle = PI/2

Try this example:

![](./images/image147.png){width="6.5in" height="2.0430555555555556in"}

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Drawing an arc&lt;/title&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;500&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var ctx=canvas.getContext(&apos;2d&apos;);

ctx.beginPath();

// try to set the last parameter to true or remove it

ctx.arc(100,75,50,0,Math.PI/2);

ctx.lineWidth=10;

ctx.stroke();

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Code source extract:

1.  ctx.beginPath();

2.  // we ommited the last parameter

3.  ctx.arc(100, 75, 50, 0, Math.PI/2);

4.   

5.  ctx.lineWidth = 10;

6.  ctx.stroke();

And if we change the last parameter of the arc function call (*line 3*) to true (we omitted it, so it took a value of false by default) :

1.  ctx.beginPath();

2.  // we omitted the last parameter

3.  ctx.arc(100, 75, 50, 0, Math.PI/2, **true**);

4.   

5.  ctx.lineWidth = 10;

6.  ctx.stroke();

Then, the result is the &quot;complementary&quot; of the previous arc:

![](./images/image148.png){width="6.5in" height="2.0569444444444445in"}

#### Example #2: drawing a Full circle (filled + outlined)

![](./images/image149.png){width="6.5in" height="2.0701388888888888in"}

Source code:

1.  var canvas = document.getElementById(&quot;myCanvas&quot;);

2.  var ctx = canvas.getContext(&quot;2d&quot;);

3.  var centerX = canvas.width / 2;

4.  var centerY = canvas.height / 2;

5.  var radius = 70;

6.  

7.  **ctx.beginPath();**

8.  

9.  // Add to the path a full circle (from 0 to 2PI)

10. **ctx.arc(centerX, centerY, radius, 0, 2\*Math.PI, false);**

11. 

12. // With path drawing you can change the context

13. // properties until a call to stroke() or fill() is performed

14. ctx.fillStyle = &quot;lightBlue&quot;;

15. // Draws the filled circle in light blue

16. **ctx.fill();**

17. 

18. // Prepare for the outline

19. ctx.lineWidth = 5;

20. ctx.strokeStyle = &quot;black&quot;;

21. 

22. // draws the path (the circle) AGAIN, this

23. // time in wireframe

24. **ctx.stroke();**

25. 

26. **// Notice we called ctx.arc() only once ! And drew it twice**

27. **// with different styles**

Notice that we called ctx.arc() only once! And drew it twice, with different styles, with calls to ctx.stroke() and ctx.fill(). Each call drew the defined path in wireframe and in filled mode!

### Proposed projects

#### Project #1: modify the [previous example](https://codepen.io/w3devcampus/pen/YzZBxmO) in order to get:

![half circle](./images/image150.jpeg){width="2.6145833333333335in" height="1.28125in"}

#### Project #2: make a small program that draws a smiling head like this (or make something better!)

![smiling head](./images/image151.jpeg){width="3.0in" height="2.5104166666666665in"}

<h3 id="ch3-4-9">3.4.9 Drawing Rounded Rectangles</h3>

There is another method called ctx.arcTo(x1, y1, x2, y2, radius), which is a bit complex to use, but very practical for drawing rounded rectangles.

In fact, the arcTo(\...) method draws an arc of a circle depending on some tangents. Let&apos;s look at these pictures for a better understanding:

![There are three diagrams all drawn on canvas dynamically. The arcTo really uses arcTo() with reduced alpha, and the rest of the diagram is calculated in JavaScript and drawn with lineTo and arc. ](./images/image152.jpeg){width="6.5in" height="1.8243055555555556in"}

### Typical use

1.  ctx.moveTo(x0, y0);

2.  

3.  ctx.arcTo(x1, y1, x2, y2, radius);

This method can be confusing. It was defined mainly for drawing rounded shapes like rounded rectangles. We used an excerpt here from the excellent [tutorial on the arcTo(\...) method](http://www.dbp-consulting.com/tutorials/canvas/CanvasArcTo.html).

It works like this:

1.  Draw an imaginary line through (x0,y0) and (x1,y1), draw another imaginary line through (x1,y1) and (x2,y2),

2.  Take an imaginary circle of radius r, and slide it up between the two lines until it just touches both lines. The two points at which the circle touches the lines are called the tangent points.

3.  arcTo(x1, y1, x2, y2, r) will draw a line from the current point (x0,y0) to the first tangent point on the line from (x0,y0) to (x1,y1),

4.  It will also draw an arc from that tangent point to the other tangent point on the line from (x1,y1) to (x2,y2) along the circumference of the circle.

5.  Finally, it adds the tangent point where the arc ends up, on the line from (x1,y1) to (x2,y2) to the path as the new current point on the path.

### Examples

#### Example #1: simple use

![](./images/image153.png){width="6.5in" height="2.05in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Simple use - arcTo - Example #1&lt;/title&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; height = 400 width=&quot;800&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var canvas=document.getElementById(&apos;myCanvas&apos;);

var context=canvas.getContext(&apos;2d&apos;);

context.beginPath();

context.moveTo(0, 20);

context.arcTo(100, 100, 200, 20, 50);

context.lineWidth = 5;

context.strokeStyle = &quot;#0000ff&quot;;

context.stroke();

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Source code extract:

1.  context.beginPath();

2.  context.moveTo(0, 20);

3.  context.arcTo(100, 100, 200, 20, 50);

4.  

5.  context.lineWidth = 5;

6.  context.strokeStyle = &quot;#0000ff&quot;;

7.  context.stroke();

#### Example #2: draw A rounded rectangle

Try this:

![](./images/image154.png){width="6.5in" height="2.0701388888888888in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;title&gt;Canvas&lt;/title&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

var roundedRect=function(ctx,x,y,width,height,radius,fill,stroke)

{

ctx.beginPath();

// draw top and top right corner

ctx.moveTo(x+radius,y);

ctx.arcTo(x+width,y,x+width,y+radius,radius);

// draw right side and bottom right corner

ctx.arcTo(x+width,y+height,x+width-radius,y+height,radius);

// draw bottom and bottom left corner

ctx.arcTo(x,y+height,x,y+height-radius,radius);

// draw left and top left corner

ctx.arcTo(x,y,x+radius,y,radius);

if(fill){

ctx.fill();

}

if(stroke){

ctx.stroke();

}

}

var canvas=document.getElementById(&apos;myCanvas&apos;);

var ctx=canvas.getContext(&apos;2d&apos;);

ctx.strokeStyle=&apos;rgb(150,0,0)&apos;;

ctx.fillStyle=&apos;rgb(0,150,0)&apos;;

ctx.lineWidth=7;

roundedRect(ctx,15,15,160,120,20,true,true);

&lt;/script&gt;

&lt;/body&gt;

Source code:
```
1.  var roundedRect=function(ctx,x,y,width,height,radius,fill,stroke) {
2.      ctx.beginPath();
3.  
4.     // draw top and top right corner
5.     ctx.moveTo(x+radius,y);
6.     ctx.arcTo(x+width,y,x+width,y+radius,radius);
7.     // draw right side and bottom right corner
8.     ctx.arcTo(x+width,y+height,x+width-radius,y+height,radius);
9.     // draw bottom and bottom left corner
10.    ctx.arcTo(x,y+height,x,y+height-radius,radius);
11.    // draw left and top left corner
12.    ctx.arcTo(x,y,x+radius,y,radius);
13. 
14.    if(fill) {
15.       ctx.fill();
16.    }
17. 
18.    if(stroke){
19.       ctx.stroke();
20.    }
21. }
22. 
23. var canvas = document.getElementById(&apos;myCanvas&apos;);
24. var ctx    = canvas.getContext(&apos;2d&apos;);
25. 
26. ctx.strokeStyle = &apos;rgb(150,0,0)&apos;;
27. ctx.fillStyle   = &apos;rgb(0,150,0)&apos;;
28. ctx.lineWidth   = 7;
29. 
30. roundedRect(ctx, 15, 15, 160, 120, 20, true, true);
```

In this example, each call to ctx.arcTo(\...) draws a side plus a corner. This makes us suspect that the arcTo() method has been designed primarily for drawing rounded rectangles\...

#### Example #3: comparison between lineTo and arcTo

This example at JS Bin is the same as the previous one, except that we added at the end of the roundedRect function the same lines of code that draw the rounded rectangle, but using lineTo instead of arcTo. Just take a look!

![](./images/image155.png){width="6.5in" height="2.036111111111111in"}

HTML
```
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;/&gt;
&lt;title&gt;Comparison between lineTo and arcTo - Example #3&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;canvas id=&quot;myCanvas&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var roundedRect=function(ctx,x,y,width,height,radius,fill,stroke)
{
ctx.beginPath();
// draw top and top right corner
ctx.moveTo(x+radius,y);
ctx.arcTo(x+width,y,x+width,y+radius,radius);
// draw right side and bottom right corner
ctx.arcTo(x+width,y+height,x+width-radius,y+height,radius);
// draw bottom and bottom left corner
ctx.arcTo(x,y+height,x,y+height-radius,radius);
// draw left and top left corner
ctx.arcTo(x,y,x+radius,y,radius);
if(fill){
ctx.fill();
}
if(stroke){
ctx.stroke();
}
// Draws the square using lineTo instead of arcTo,
// just to compare both methods
ctx.save();
ctx.strokeStyle=&quot;pink&quot;;
ctx.lineWidth=3; // ou ce que tu veux
ctx.beginPath();
ctx.moveTo(x,y);
ctx.lineTo(x+width, y);
ctx.lineTo(x+width, y+height);
ctx.lineTo(x, y+height);
ctx.closePath();
ctx.stroke();
ctx.restore();
}
var canvas=document.getElementById(&apos;myCanvas&apos;);
var ctx=canvas.getContext(&apos;2d&apos;);
ctx.strokeStyle=&apos;rgb(150,0,0)&apos;;
ctx.fillStyle=&apos;rgb(0,150,0)&apos;;
ctx.lineWidth=7;
roundedRect(ctx,15,15,160,120,20,true,true);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
```

Red = arcTo and Pink = lineTo

#### Example #4: use the unrounded vertices in arcTo

For drawing a rounded square, this code also works:
```
1.  ctx.moveTo(x+radius, y);
2.  ctx.arcTo(x+width, y,x+width, y+height, radius);
3.  ctx.arcTo(x+width, y+height, x, y+height, radius); 
4.  ctx.arcTo(x, y+height, x, y,radius);
5.  ctx.arcTo(x, y, x+width, y,radius);
```
which might be easier than trying to figure out where the arc will end like this:
```
1.  ctx.moveTo(x+radius, y);
2.  ctx.arcTo(x+width, y, x+width, y+radius, radius);
3.  ctx.arcTo(x+width, y+height, x+width-radius, y+height,radius); 
4.  ctx.arcTo(x, y+height, x, y+height-radius, radius);
5.  ctx.arcTo(x, y, x+radius, y,radius);
```

This could be particularly helpful if you are dealing with something other than a rectangle, like this rounded triangle:

![](./images/image156.png){width="6.5in" height="2.0701388888888888in"}

HTML
```
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;/&gt;
&lt;title&gt;Use the unrounded vertices in arcTo - Example #4&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;canvas id=&quot;myCanvas&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var roundedTriangle=function(ctx,x1,y1,x2,y2,x3,y3,radius,fill,stroke)
{
ctx.beginPath();
// start at the middle of the side between x1,y1 and x2,y2
ctx.moveTo((x1+x2)/2,(y1+y2)/2);
// go around the x2,y2 vertex
ctx.arcTo(x2,y2,x3,y3,radius);
// go around the x3,y3 vertex
ctx.arcTo(x3,y3,x1,y1,radius);
// go around the x1,y1 vertex
ctx.arcTo(x1,y1,x2,y2,radius);
// and close the triangle with a line to the starting point
ctx.lineTo((x1+x2)/2,(y1+y2)/2);
if(fill){
ctx.fill();
}
if(stroke){
ctx.stroke();
}
}
var canvas=document.getElementById(&apos;myCanvas&apos;);
var ctx=canvas.getContext(&apos;2d&apos;);
ctx.strokeStyle=&apos;rgb(150,0,0)&apos;;
ctx.fillStyle=&apos;rgb(0,150,0)&apos;;
ctx.lineWidth=7;
roundedTriangle(ctx,200,15,300,150,15,100,20,true,true);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
```

<h3 id="ch3-4-10">3.4.10 Quadratic Curves</h3>

### Introduction

![HTML5 Canvas Quadratic Curve Diagram](./images/image157.png){width="5.5in" height="2.5729166666666665in"}

(Picture taken from the [HTML5 Canvas Tutorials](https://www.html5canvastutorials.com/tutorials/html5-canvas-quadratic-curves/) Web site)

Quadratic curves are defined by a starting point (called a &quot;context point&quot;), a control point, and an ending point. The curve fits the tangents between the context and control points and between the control and ending points.

The context point may be defined by a call to the moveTo(x, y) method of the context, or it may be the ending point of a previous path, if we&apos;re drawing a path made of several shapes. For example, drawing a line and a quadratic curve will make the endpoint of the line the context point for the quadratic curve.

The control point controls the curvature - if we move the control point farther we get a sharper curve.

### Typical use

1.  context.moveTo(contextX, contextY);

2.  context.quadraticCurveTo(controlX, controlY, endX, endY);

3.  // Optional : set lineWidth and stroke color

4.  context.lineWidth = 5;

5.  context.strokeStyle = &quot;#0000ff&quot;;

6.  // Draw!

7.  context.stroke();

### Examples

#### Example #1: quadratic curve

![](./images/image158.png){width="6.5in" height="2.05in"}

Source code:
```
1.  var canvas=document.querySelector(&apos;#myCanvas1&apos;);
2.  var context=canvas.getContext(&apos;2d&apos;);
3.   
4.  context.beginPath();
5.   
6.  context.moveTo(100, 20);
7.  context.quadraticCurveTo(230, 200, 250, 20);
8.   
9.  context.lineWidth = 5;
10. context.strokeStyle = &quot;#0000ff&quot;;
11. context.stroke();
```

We set a starting point in *line 6*: moveTo(\...), then set the control and ending points with a call to quadraticCurve(\...), at *line 7*, then set some properties for color, thickness, and finally we call the stroke() method for drawing the curve.

#### Example #2: lines connected with a quadratic curve

Try this:

![](./images/image159.png){width="6.5in" height="2.0701388888888888in"}

HTML

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Lines connected with a quadratic curve - Example #2</title>
</head>
<body>
<canvas id="myCanvas1" height = 400 width="800">Your browser does not support the canvas tag.</canvas>
<script type="text/javascript">
var canvas=document.querySelector('#myCanvas1');
var context=canvas.getContext('2d');
context.beginPath();
context.moveTo(100, 20);
context.lineTo(200, 80);
context.quadraticCurveTo(230, 200, 250, 20);
context.lineTo(500, 90);
context.lineWidth = 5;
context.strokeStyle = "#0000ff";
context.stroke();
</script>
</body>
</html>
```

Source code:

```
1.  context.beginPath();
2.  
3.  context.moveTo(100, 20);
4.  context.lineTo(200, 80);
5.  context.quadraticCurveTo(230, 200, 250, 20);
6.  context.lineTo(500, 90);
7.  
8.  context.lineWidth = 5;
9.  context.strokeStyle = "#0000ff";
10. context.stroke();
```

<h3 id="ch3-4-11">3.4.11 Curved Arrows</h3>

We propose a useful function for drawing curved arrows. See this example:

<!------------------------------------------------------------------------------------------------>
<!----------- 160.  (xxx) ------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image160.png?raw=true"
   alt=""
   width="65%">
&nbsp;
<br/>

<h4>JS</h4>

```
var canvas = document.querySelector('#myCanvas');
var ctx = canvas.getContext('2d');
var contextX = 100;
var contextY = 10;
var endPointX = 200;
var endPointY = 120;
var controlPointX = 35;
var controlPointY = 70;
drawCurvedArrow(contextX, contextY,
endPointX, endPointY,
controlPointX, controlPointY,
3, // arrowWidth, try 30 for example !
20, // width of the arrow head, try smaller values, 10...
'blue');
function drawCurvedArrow(startPointX, startPointY,
endPointX, endPointY,
quadPointX, quadPointY,
lineWidth,
arrowWidth,
color) {
// GOOD PRACTICE: the function changes color and lineWidth -> save context!
ctx.save();
ctx.strokeStyle = color;
ctx.lineWidth = lineWidth;
// angle of the end tangeant, useful for drawing the arrow head
var arrowAngle = Math.atan2(quadPointX - endPointX, quadPointY - endPointY) + Math.PI;
// start a new path
ctx.beginPath();
ctx.moveTo(startPointX, startPointY);
ctx.quadraticCurveTo(quadPointX, quadPointY, endPointX, endPointY);
ctx.moveTo(endPointX - (arrowWidth \* Math.sin(arrowAngle - Math.PI / 6)),
endPointY - (arrowWidth * Math.cos(arrowAngle - Math.PI / 6)));
ctx.lineTo(endPointX, endPointY);
ctx.lineTo(endPointX - (arrowWidth \* Math.sin(arrowAngle + Math.PI / 6)),
endPointY - (arrowWidth * Math.cos(arrowAngle + Math.PI / 6)));
ctx.stroke();
ctx.closePath();
// GOOD PRACTICE -> restore the context as we saved it at the beginning
// of the function
ctx.restore();
}
```

CSS

```
#myCanvas {
border: 1px solid black;
}
```

<h4>HTML<h4>

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Curved arrows</title>
</head>
<body>
<canvas id="myCanvas" width="250" height="150"></canvas>
</body>
</html>
```

Source code of the function that draws a curved arrow:

```
1.  function drawCurvedArrow(startPointX, startPointY,
2.                           endPointX, endPointY,
3.                           quadPointX, quadPointY,
4.                           lineWidth,
5.                           arrowWidth,
6.                           color) {
7.      // BEST PRACTICE: the function changes color and lineWidth -&gt; save context!
8.      ctx.save();
9.  
10.     ctx.strokeStyle = color;
11.     ctx.lineWidth = lineWidth;
12.  
13.     // angle of the end tangeant, useful for drawing the arrow head
14.     var arrowAngle = Math.atan2(quadPointX - endPointX, quadPointY - endPointY) + Math.PI;
15.  
16.     // start a new path
17.     ctx.beginPath();
18. 
19.     // Body of the arrow
20.     ctx.moveTo(startPointX, startPointY);
21.     ctx.quadraticCurveTo(quadPointX, quadPointY, endPointX, endPointY);
22. 
23.     // Head of the arrow
24.     ctx.moveTo(endPointX - (arrowWidth \* Math.sin(arrowAngle - Math.PI / 6)),
25.                endPointY - (arrowWidth \* Math.cos(arrowAngle - Math.PI / 6)));
26.  
27.     ctx.lineTo(endPointX, endPointY);
28.  
29.     ctx.lineTo(endPointX - (arrowWidth \* Math.sin(arrowAngle + Math.PI / 6)),
30.                endPointY - (arrowWidth \* Math.cos(arrowAngle + Math.PI / 6)));
31.  
32.     ctx.stroke();
33.     ctx.closePath();
34. 
35.     // BEST PRACTICE -&gt; restore the context as we saved it at the beginning
36.     // of the function
37.     ctx.restore();
38. }
```

This function takes as parameters the start and end points, the control point of the curve, the arrow width, the width of the arrow head.

It computes the angle of the arrow at its endpoint (*line 14*) in order to compute the rotated endpoints of the two lines of the arrow head *(lines 24* and *29*).

Notice that once again, as we modify the context properties (color, lineWidth) in the body of the function, we save and restore the context at the beginning / end of the function.

<h3 id="ch3-4-12">3.4.12 Bézier curves</h3>

<h4>Introduction</h4>

Bézier curves are interesting. They are mostly used for drawing &quot;S&quot; shapes or asymmetric curves.

<!------------------------------------------------------------------------------------------------>
<!----------- 161.  (xxx) ------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image161.jpeg?raw=true"
   alt="Bezier curve in S"
   width="35%">
&nbsp;
<br/>

(image taken from [SitePoint](https://blogs.sitepointstatic.com/examples/tech/canvas-curves/bezier-curve.html))

Bézier curves are defined by a context point, like quadratic curves, two control points that define two tangents, and an ending point.

The first part of the curve is tangential to the imaginary line defined by the context point and the first control point. The second part of the curve is tangential to the imaginary line defined by the second control point and the ending point.

<!------------------------------------------------------------------------------------------------>
<!----------- 162. bezier curve control points (xxx) ------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image162.png?raw=true"
   alt="Bezier curve control points"
   width="65%" />
&nbsp;
<br/>

(Picture taken from the [HTML5 Canvas Tutorials](https://www.html5canvastutorials.com/tutorials/html5-canvas-bezier-curves/) Web site)

The best way to understand how they work is to check out one of these interactive applications:

-   [Canvas Bézier Curve Example](https://blogs.sitepointstatic.com/examples/tech/canvas-curves/bezier-curve.html)

-   [IvanK Lib graphics demos](http://lib.ivank.net/?p=demos&d=bezier)

-   Nice video tutorial: [Bézier curves under the hood](https://vimeo.com/106757336)

### Typical usage of Bézier curves

Source code:

```
1.  ctx.moveTo(contextX, contextY);
2.  context.bezierCurveTo(controlX1, controlY1, controlX2, controlY2, endX, endY);
3.  // Optional : set lineWidth and stroke color
4.  context.lineWidth = 5;
5.  context.strokeStyle = "#0000ff";
6.  // Draw!
7.  ctx.stroke();
```

## Examples

#### Example #1

Try this:

<!------------------------------------------------------------------------------------------------>
<!----------- 163.  (xxx) ------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image163.png?raw=true"
   alt=""
   width="65%">
&nbsp;
<br/>

<h4>HTML</h4>

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Bézier curve - Example #1</title>
</head>
<body>
<canvas id="myCanvas1" height = 400 width="800"&gt;Your browser does not support the canvas tag.</canvas>
<script type="text/javascript">
var canvas=document.querySelector('#myCanvas1');
var context=canvas.getContext('2d');
context.beginPath();
context.moveTo(100, 20);
// TRY uncommenting these lines !
//context.lineTo(200, 80);
//context.quadraticCurveTo(230, 200, 250, 20);
context.bezierCurveTo(290, -40, 200, 200, 400, 100);
//context.lineTo(500, 90);
// TRY TO UNCOMMENT THIS LINE
//context.closePath();
context.lineWidth = 5;
context.strokeStyle = "#0000ff";
context.stroke();
</script>
</body>
</html>
```

Code source:

```
1.  context.beginPath();
2.  
3.  context.moveTo(100, 20);
4.  context.bezierCurveTo(290, -40, 200, 200, 400, 100);
5.  
6.  context.lineWidth = 5;
7.  context.strokeStyle = &quot;#0000ff&quot;;
8.  context.stroke();
```

#### Example #2: path with bezier curve, quadratic curve and line in the same, closed path

Try this:

<!------------------------------------------------------------------------------------------------>
<!----------- 164.  (xxx) ------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image164.png?raw=true"
   alt=" "
   width="85%">
&nbsp;
<br/>

HTML

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Path with Bézier curve, quadratic curve and line in the same, closed path - Example #2</title>
</head>
<body>
<canvas id="myCanvas1 height = 400 width="800">Your browser does not support the canvas tag.</canvas>
<script type="text/javascript">
var canvas=document.querySelector('#myCanvas1');
var context=canvas.getContext('2d');
context.beginPath();
context.moveTo(100, 20);
context.lineTo(200, 160);
context.quadraticCurveTo(230, 200, 250, 120);
context.bezierCurveTo(290, -40, 300, 200, 400, 150);
context.lineTo(500, 90);
// TRY TO COMMENT THIS LINE
context.closePath();
context.lineWidth = 5;
context.strokeStyle = "#0000ff";
context.stroke();
</script>
</body>
```

Extract from source code:

```
1.  context.beginPath();
2.  
3.  context.moveTo(100, 20);
4.  
5.  context.lineTo(200, 160);
6.  context.quadraticCurveTo(230, 200, 250, 120);
7.  context.bezierCurveTo(290, -40, 300, 200, 400, 150);
8.  context.lineTo(500, 90);
9.  
10. // TRY COMMENTING THIS LINE OUT
11. context.closePath();
12. context.lineWidth = 5;
13. context.strokeStyle = &quot;#0000ff&quot;;
14. context.stroke();
```

In this example we use the closePath() method to draw a line between the last path point and the first path point (*line 11*), so that the drawing looks like a pair of goggles.

Note how the different parts are linked together and make a &quot;path&quot;:
<!------------------------------------------------------------------------------------------------>
<!------------------------------ 165. (xxx) -------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image165.png?raw=true"
   alt="Path composition explained"
   width="85%">
&nbsp;
<br/>

### Interesting, interactive tool for generating code that draws Bézier curves

This Bézier tool (&quot;HTML5 &lt;canvas&gt; bezierCurveTo command generator&quot;) is available [online](https://www.victoriakirst.com/beziertool/): try it!

<h3 id="ch3-5-1">3.5.1 Canvas Context: Colors</h3>

In previous examples, we saw how to set the current color using the strokeStyle and fillStyle properties of the canvas context object.

Let&apos;s look at color in a little more detail, and see how we can use gradients or patterns/textures/images (in other words: fill shapes or fill the outline of the shapes with some images that repeat themselves).

### Colors and transparency

You can use [the same syntax for colors that is supported by CSS3](https://www.w3.org/TR/css3-color/). The next lines show possible values/syntaxes.

```
1.  ctx.strokeStyle = 'red';
2.  ctx.fillStyle = "#00ff00";
3.  ctx.strokeStyle = "rgb(0, 0, 255)";
4.  ctx.fillStyle = "rgba(0, 0, 255, 0.5)";
```

Note that:

-   All values are strings;

-   *Line 4* defines a &quot;transparent color&quot;, the &quot;a&quot; of &quot;rgba&quot; means &quot;alpha channel&quot;. Its value is between 0 and 1, where 0 means &quot;completely transparent&quot; and 1 means &quot;opaque&quot;.

Here is an example that shows how to draw different filled rectangles in blue, with different levels of transparency:
<!------------------------------------------------------------------------------------------------>
<!------------------------------ 166. example (xxx) -------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center" width="100%">
<img src="./images/image166.png?raw=true"
   width="85%"
   alt="Example" />
</p>

<h4>HTML</h4>

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Colors and transparency</title>
<style>
#myCanvas {
border: 1px solid black;
}
</style>
<script>
var canvas, ctx;
function init() {
// This function is called after the page is loaded
// 1 - Get the canvas
canvas = document.getElementById('myCanvas');
// 2 - Get the context
ctx=canvas.getContext('2d');
// 3 - we can draw
drawSomething();
}
function drawSomething() {
// set the global context values
ctx.fillStyle='rgba(0, 0, 255, 0.2)';
// Draw the two filled red rectangles
ctx.fillRect(150, 20, 200, 100);
ctx.fillRect(100, 50, 200, 100);
ctx.fillStyle = "blue";
ctx.fillRect(50, 100, 200, 100);
}
</script>
</head>
<body onload="init();">
<canvas id="myCanvas" width="400" height="220">
Your browser does not support the canvas tag.
</canvas>
</body>
</html>
```

<h3 id="ch3-5-2">3.5.2 Canvas Context: Linear Gradients</h3>

It is possible to define the stroke or the fill style as a &quot;gradient&quot;, a set of interpolated colors, like in this example below:

<!------------------------------------------------------------------------------------------------>
<!------------------------------ 167. example (xxx) -------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center" width="100%">
<img src="./images/image167.png?raw=true"
   width="85%"
   alt="Example" />
</p>

<h4>JS</h4>

```
var canvas, ctx, grdFrenchFlag;
function init() {
// Good practice 1: set global vars canvas, ctx, gradients, etc here
canvas = document.querySelector(&apos;#myCanvas1&apos;);
ctx = canvas.getContext(&apos;2d&apos;);
// The gradient we create is also a global variable, we
// will be able to reuse it for drawing different shapes
// in different functions
grdFrenchFlag = ctx.createLinearGradient(0, 0, 300, 0);
// Try adding colors with first parameter between 0 and 1
grdFrenchFlag.addColorStop(0, &quot;blue&quot;);
grdFrenchFlag.addColorStop(0.5, &quot;white&quot;);
grdFrenchFlag.addColorStop(1, &quot;red&quot;);
draw();
}
function draw() {
ctx.fillStyle = grdFrenchFlag;
ctx.fillRect(0, 0, 300, 200);
}
```

<h4>HTML</h4>

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Linear gradients</title>
<style>
#myCanvas1 {
border: 1px solid black;
}
</style>
</head>
<body onload="init();">
<canvas id="myCanvas1" width="300" height=200>Your browser does not support the canvas tag.</canvas>
</body>
</html>
```

**A linear gradient is seen as an &quot;invisible&quot; rectangle in which a set of colors are interpolated along a line.**

The gradient becomes visible when we draw shapes on top of the invisible gradient, and when the fillStyle or strokeStyle property has for value this gradient.

### How to create gradients

There are 3 steps:

#### Step #1: define a linear gradient

Syntax: 

1.  ctx.createLinearGradient(x0,y0,x1,y1);

\... where the (x0, y0) and (x1, y1) parameters define &quot;the direction of the gradient&quot; (as a vector with a starting and an ending point). This direction is an invisible line along which the colors that compose the gradient will be interpolated.

Let&apos;s see an example:

1.  grdFrenchFlag = ctx.createLinearGradient(0, 0, 300, 0);

This line defines the direction of the gradient: a virtual, invisible line that goes from the top left corner of the canvas (0, 0) to the top right corner of the canvas (300, 0). The interpolated colors will propagate along this line. 

If this gradient is going to be reused by different functions, it is good practice to create/initialize it in a function called when the page is loaded and to store it in a global variable.

#### Step #2: add a number of &quot;color stops&quot; to this gradient

We will add a set of &quot;colors&quot; and &quot;stops&quot; to this gradient. The stops go from 0 (beginning of the virtual line defined just above), to 1 (end of the virtual line). A color associated with a value of 0.5 will be right in the middle of the virtual line.

Here is an example that corresponds to an interpolated version of the French flag, going from blue to white, then to red, with proportional intervals. We define three colors, blue at position 0, white at position 0.5 and red at position 1:

1.  grdFrenchFlag.addColorStop(0, &quot;blue&quot;);

2.  grdFrenchFlag.addColorStop(0.5, &quot;white&quot;);

3.  grdFrenchFlag.addColorStop(1, &quot;red&quot;);

#### Step 3: draw some shapes

First, let&apos;s set the fillStyle or strokeStyle of the context with this gradient, then let&apos;s draw some shapes &quot;on top of the gradient&quot;.

In our example, the gradient corresponds to an invisible rectangle that fills the canvas. If we draw a rectangle of the canvas size, it should be filled with the entire gradient:

1.  ctx.fillStyle = grdFrenchFlag;

2.  ctx.fillRect(0, 0, 300, 200);

The result is shown in the [above pen](https://codepen.io/w3devcampus/pen/WNpPZVO): a big rectangle that fills the whole canvas, with colors going from blue (left) to white (middle) to red (right).

### Examples

#### Example #1: changing the direction of the gradient

If you modify the source code that defines the direction of the gradient as follows\...

1.  grdFrenchFlag = ctx.createLinearGradient(0, 0, 300, 200);

\... then you will define a gradient that goes from the top left corner of the canvas to the bottom right of the canvas. Let&apos;s see what it does:

![](./images/image168.png){width="6.5in" height="2.061111111111111in"}

#### Example #2: drawing shapes that do not cover the whole gradient

Instead of drawing a filled rectangle that covers the whole surface of the canvas, let&apos;s draw several smaller rectangles:

![](./images/image169.png){width="6.5in" height="2.075in"}

Note that the canvas has its default background color where we did not draw anything. And where we have drawn rectangles, we can see &quot;through&quot; and the colors from the gradient are visible.

Here is the code that draws the checkboard:

1.  ctx.fillStyle = grdFrenchFlag;

2.  ctx.fillRect(0, 0, 50, 50);

3.  ctx.fillRect(100, 0, 50, 50);

4.  ctx.fillRect(200, 0, 50, 50);

5.  ctx.fillRect(50, 50, 50, 50);

6.  ctx.fillRect(150, 50, 50, 50);

7.  ctx.fillRect(250, 50, 50, 50);

8.  ctx.fillRect(0, 100, 50, 50);

9.  ctx.fillRect(100, 100, 50, 50);

10. ctx.fillRect(200, 100, 50, 50);

11. ctx.fillRect(50, 150, 50, 50);

12. ctx.fillRect(150, 150, 50, 50);

13. ctx.fillRect(250, 150, 50, 50);

This code is rather ugly isn&apos;t it? It would have been better  to use a loop\...

Here is function that draws a chessboard:

1.  // n = number of cells per row/column

2.  function drawCheckboard(n) {

3.      ctx.fillStyle = grdFrenchFlag;

4.  

5.      var l = canvas.width;

6.      var h = canvas.height;

7.   

8.      var cellWidth = l / n;

9.      var cellHeight = h / n;

10. 

11.     for(i = 0; i &lt; n; i++) {

12.        for(j = i % 2; j &lt; n; j++) {

13.           ctx.fillRect(cellWidth\*i, cellHeight\*j, cellWidth, cellHeight);

14.        }

15.     }

16. }

The two loops (*lines 11-15*) draw only one cell out of two (see the j = i % 2 at *line 12*). i is the column number and if the column is odd or even, either we draw or we do not draw a rectangle.

This code is much more complex than the previous one, taking 16 lines instead of 13, but is much more powerful. Try to call the function with a value of 10, 20, or 2\... 

![](./images/image170.png){width="6.5in" height="2.075in"}

JS

var canvas, ctx, grdFrenchFlag;

function init() {

// Good practice 1: set global vars canvas, ctx, gradients, etc here

canvas = document.querySelector(&apos;#myCanvas1&apos;);

ctx = canvas.getContext(&apos;2d&apos;);

// The gradient we create is also a global variable, we

// will be able to reuse it for drawing different shapes

// in different functions

grdFrenchFlag = ctx.createLinearGradient(0, 0, 300, 200);

// Try adding colors with first parameter between 0 and 1

grdFrenchFlag.addColorStop(0, &quot;blue&quot;);

grdFrenchFlag.addColorStop(0.5, &quot;white&quot;);

grdFrenchFlag.addColorStop(1, &quot;red&quot;);

drawCheckboard(10);

}

// n = number of cells per row/column

function drawCheckboard(n) {

ctx.fillStyle = grdFrenchFlag;

ctx.lineWidth=10;

var l = canvas.width;

var h = canvas.height;

var cellWidth = l / n;

var cellHeight = h / n;

for(i = 0; i &lt; n; i++) {

for(j = i % 2; j &lt; n; j+=2) {

ctx.fillRect(cellWidth\*i, cellHeight\*j, cellWidth, cellHeight);

}

}

}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Drawing shapes that do not cover the whole gradient - Example #2 bis&lt;/title&gt;

&lt;style&gt;

#myCanvas1 {

border: 1px solid black;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas1&quot; width=&quot;300&quot; height=200&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

#### Example #3: drawing outlined shapes with gradients

Just as we used fillStyle and fillRect for drawing rectangles filled with a gradient, we can also use strokeStyle and strokeRect in order to draw wireframed rectangles. In the next example, which is just a variation of the previous one, we have used the lineWidth property to set the outline of the rectangles at 5 pixels:

![](./images/image171.png){width="6.5in" height="2.040277777777778in"}

JS

var canvas, ctx, grdFrenchFlag;

function init() {

// Good practice 1: set global vars canvas, ctx, gradients, etc here

canvas = document.querySelector(&apos;#myCanvas1&apos;);

ctx = canvas.getContext(&apos;2d&apos;);

// The gradient we create is also a global variable, we

// will be able to reuse it for drawing different shapes

// in different functions

grdFrenchFlag = ctx.createLinearGradient(0, 0, 300, 200);

// Try adding colors with first parameter between 0 and 1

grdFrenchFlag.addColorStop(0, &quot;blue&quot;);

grdFrenchFlag.addColorStop(0.5, &quot;white&quot;);

grdFrenchFlag.addColorStop(1, &quot;red&quot;);

drawCheckboard(5);

}

// n = number of cells per row/column

function drawCheckboard(n) {

ctx.strokeStyle = grdFrenchFlag;

ctx.lineWidth=10;

var l = canvas.width;

var h = canvas.height;

var cellWidth = l / n;

var cellHeight = h / n;

for(i = 0; i &lt; n; i++) {

for(j = i % 2; j &lt; n; j+=2) {

ctx.strokeRect(cellWidth\*(i), cellHeight\*j, cellWidth, cellHeight);

}

}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Drawing outlined shapes with gradients - Example #3&lt;/title&gt;

&lt;style&gt;

#myCanvas1 {

border: 1px solid black;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas1&quot; width=&quot;300&quot; height=200&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

Extract from source code:

1.  function drawCheckboard(n) {

2.      **ctx.strokeStyle = grdFrenchFlag;**

3.  **    ctx.lineWidth=10;**

4.      \...

5.      for(i = 0; i &lt; n; i++) {

6.          for(j = i % 2; j &lt; n; j++) {

7.              ctx.**stroke**Rect(cellWidth\*i, cellHeight\*j, cellWidth, cellHeight);

8.          }

9.      }

10. }

#### Example #4: what happens if we define a gradient smaller than the canvas?

Let&apos;s go back to the very first example on this page - the one with the blue-white-red interpolated French flag. This time we will define a smaller gradient. Instead of going from (0, 0) to (300, 0), it will go from (100, 0) to (200, 0), while the canvas remains the same (width=300, height=200).

1.  grdFrenchFlag = ctx.createLinearGradient(**100, 0, 200, 0**);

Like in the first example we will draw a filled rectangle that is the same size as the canvas:

![](./images/image172.png){width="6.5in" height="2.0541666666666667in"}

JS

var canvas, ctx, grdFrenchFlag;

function init() {

// Good practice 1: set global vars canvas, ctx, gradients, etc here

canvas = document.querySelector(&apos;#myCanvas1&apos;);

ctx = canvas.getContext(&apos;2d&apos;);

// The gradient we create is also a global variable, we

// will be able to reuse it for drawing different shapes

// in different functions

grdFrenchFlag = ctx.createLinearGradient(100, 0, 200, 0);

// Try adding colors with first parameter between 0 and 1

grdFrenchFlag.addColorStop(0, &quot;blue&quot;);

grdFrenchFlag.addColorStop(0.5, &quot;white&quot;);

grdFrenchFlag.addColorStop(1, &quot;red&quot;);

draw();

}

function draw() {

ctx.fillStyle = grdFrenchFlag;

ctx.fillRect(0, 0, 300, 200);

}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Defining a gradient smaller than the canvas - Example #4&lt;/title&gt;

&lt;style&gt;

#myCanvas1 {

border: 1px solid black;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas1&quot; width=&quot;300&quot; height=200&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

We notice that &quot;before&quot; the gradient starts, the first color of the gradient is repeated without any interpolation (columns 0-100 are all blue), then we &quot;see through&quot; and the gradient is drawn (columns 100-200), then the last color of the gradient is repeated without any interpolation (columns 200-300 are red).

#### Example #5: what happens if we define a gradient bigger than the canvas?

Nothing special; we will &quot;see through the drawn shapes&quot;, and the parts of the gradient that are located in the canvas area will be shown. You can try this example that defines a gradient twice the size of the canvas: 

1.  grdFrenchFlag = ctx.createLinearGradient(0, 0, **600, 400**);

And if we draw the same rectangle with the canvas size, here is the result:

![](./images/image173.png){width="6.5in" height="2.088888888888889in"}

##### JS

var canvas, ctx, grdFrenchFlag;

function init() {

// Good practice 1: set global vars canvas, ctx, gradients, etc here

canvas = document.querySelector(&apos;#myCanvas1&apos;);

ctx = canvas.getContext(&apos;2d&apos;);

// The gradient we create is also a global variable, we

// will be able to reuse it for drawing different shapes

// in different functions

grdFrenchFlag = ctx.createLinearGradient(0, 0, 600, 400);

// Try adding colors with first parameter between 0 and 1

grdFrenchFlag.addColorStop(0, &quot;blue&quot;);

grdFrenchFlag.addColorStop(0.5, &quot;white&quot;);

grdFrenchFlag.addColorStop(1, &quot;red&quot;);

draw();

}

function draw() {

ctx.fillStyle = grdFrenchFlag;

ctx.fillRect(0, 0, 300, 200);

}

##### HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Defining a gradient bigger than the canvas - Example #5&lt;/title&gt;

&lt;style&gt;

#myCanvas1 {

border: 1px solid black;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas1&quot; width=&quot;300&quot; height=200&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

The red color is beyond the bottom right corner\.... we see only the top left quarter of the gradient.

#### Example #6: drawing shapes that share the same gradient as a whole

This time, we would like to draw the chessboard with the gradient in each cell. How can we do this with one single gradient?

We can&apos;t! At least we can&apos;t without recreating it for each cell!

It suffices to create a new gradient before drawing each filled rectangle, and set it with the starting and ending point of its direction/virtual line accordingly to the rectangle coordinates. Try this:

![](./images/image174.png){width="6.5in" height="2.0819444444444444in"}

##### JS

> var canvas, ctx, grdFrenchFlag;
>
> function init() {
>
> // Good practice 1: set global vars canvas, ctx, gradients, etc here
>
> canvas = document.querySelector(&apos;#myCanvas1&apos;);
>
> ctx = canvas.getContext(&apos;2d&apos;);
>
> drawCheckboard(5);
>
> }
>
> function setGradient(x, y, width, height) {
>
> grdFrenchFlag = ctx.createLinearGradient(x, y, width, height);
>
> grdFrenchFlag.addColorStop(0, &quot;blue&quot;);
>
> grdFrenchFlag.addColorStop(0.5, &quot;white&quot;);
>
> grdFrenchFlag.addColorStop(1, &quot;red&quot;);
>
> ctx.fillStyle = grdFrenchFlag;
>
> }
>
> // n = number of cells per row/column
>
> function drawCheckboard(n) {
>
> var l = canvas.width;
>
> var h = canvas.height;
>
> var cellWidth = l / n;
>
> var cellHeight = h / n;
>
> for(i = 0; i &lt; n; i+=2) {
>
> for(j = 0; j &lt; n; j++) {
>
> var x = cellWidth\*(i+j%2);
>
> var y = cellHeight\*j;
>
> setGradient(x, y, x+cellWidth, y+cellHeight);
>
> ctx.fillRect(x, y, cellWidth, cellHeight);

##### HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Drawing shapes that share the same gradient as a whole - Example #6&lt;/title&gt;

&lt;style&gt;

#myCanvas1 {

border: 1px solid black;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas1&quot; width=&quot;300&quot; height=200&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

Extract from source code:

> function setGradient(x, y, width, height) {
>
>     grdFrenchFlag = ctx.createLinearGradient(x, y, width, height);
>
>     grdFrenchFlag.addColorStop(0, &quot;blue&quot;);
>
>     grdFrenchFlag.addColorStop(0.5, &quot;white&quot;);
>
>     grdFrenchFlag.addColorStop(1, &quot;red&quot;);
>
>     // set the new gradient to the current fillStyle
>
>     ctx.fillStyle = grdFrenchFlag;
>
> }
>
>  
>
> // n = number of cells per row/column
>
> function drawCheckboard(n) {
>
>    var l = canvas.width;
>
>    var h = canvas.height;
>
>  
>
>    var cellWidth = l / n;
>
>    var cellHeight = h / n;
>
>    for(i = 0; i &lt; n; i+=2) {
>
>      for(j = 0; j &lt; n; j++) {
>
>         var x = cellWidth\*(i+j%2);
>
>         var y = cellHeight\*j;
>
>         setGradient(x, y, x+cellWidth, y+cellHeight);
>
>         ctx.fillRect(x, y, cellWidth, cellHeight);
>
>      }
>
>    }
>
> }

We wrote a function setGradient(startX, startY, endX, endY) that creates a gradient and set the fillStyle context property so that any filled shape drawn will have this gradient.

In the drawCheckBoard(\...) function we call it just before drawing rectangles. In this way, each rectangle is drawn using its own gradient.

<h3 id="ch3-5-3">3.5.3 Canvas Context: Radial Gradients</h3>

Radial gradients are for creating gradients that propagate/interpolate colors along circles instead of propagating/interpolating along a virtual line, like linear gradients.

Here is an example of a radial gradient that interpolates the color of the rainbow:

![](./images/image175.png){width="6.5in" height="2.095138888888889in"}

<h4>JS</h4>
```
> var canvas, ctx, grd;
> function init() {
> // Good practice 1: set global vars canvas, ctx, gradients, etc here
> canvas = document.querySelector(&apos;#myCanvas1&apos;);
> ctx = canvas.getContext(&apos;2d&apos;);
> grd = ctx.createRadialGradient(150, 100, 30, 150, 100, 100);
> grd.addColorStop(0, &quot;red&quot;);
> grd.addColorStop(0.17, &quot;orange&quot;);
> grd.addColorStop(0.33, &quot;yellow&quot;);
> grd.addColorStop(0.5, &quot;green&quot;);
> grd.addColorStop(0.666, &quot;blue&quot;);
> grd.addColorStop(1, &quot;violet&quot;);
> draw();
> }
> function draw() {
> ctx.fillStyle = grd;
> ctx.fillRect(0, 0, 300, 200);
> }
```

<h4>HTML</h4>
```
> <!DOCTYPE html>
> &lt;html lang=&quot;en&quot;&gt;
> &lt;head&gt;
> &lt;meta charset=&quot;utf-8&quot;&gt;
> &lt;title&gt;Radial gradients&lt;/title&gt;
> &lt;style&gt;
> #myCanvas1 {
> border: 1px solid black;
> }
> &lt;/style&gt;
> &lt;/head&gt;
> &lt;body onload=&quot;init();&quot;&gt;
> &lt;canvas id=&quot;myCanvas1&quot; width=&quot;300&quot; height=200&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;
> &lt;/body&gt;
> &lt;/html&gt;
```

The gradient is defined as follows:

```
1.  var grd = context.**createRadialGradient(150, 100, 30, 150, 100, 100);**
2.  grd.addColorStop(0, &quot;red&quot;);
3.  grd.addColorStop(0.17, &quot;orange&quot;);
4.  grd.addColorStop(0.33, &quot;yellow&quot;);
5.  grd.addColorStop(0.5, &quot;green&quot;);
6.  grd.addColorStop(0.666, &quot;blue&quot;);
7.  grd.addColorStop(1, &quot;violet&quot;);
8.  
9.  context.fillStyle = grd;
```

The method from the context object createRadialGradient(cx1, cy1, radius1, cx2, cy2, radius2) takes as the first three parameters the &quot;starting&quot; circle of the gradient, and as the three last parameters, the &quot;ending circle&quot;.

In the above example, the gradients starts at a circle located at (150, 100), with a radius of 30, and propagates to a circle with the same center as the first (150, 100), but with a bigger radius of 100, as shown below:

![radial gradient](./images/image176.jpeg){width="4.041666666666667in" height="2.8020833333333335in"}

We added color stops using a method similar to that used for linear gradients.

### What happens if the circles are not located at the same place?

You get some nice effects; here we set the second circle&apos;s center 60 pixels to the right of the first circle&apos;s center (cx = 210 instead of 150):

1.  grd = ctx.createRadialGradient(150, 100, 30, **210**, 100, 100);

Here is the result:

![](./images/image177.png){width="6.5in" height="2.0541666666666667in"}

<h4>JS</h4>
```
var canvas, ctx, grd;
function init() {
// Good practice 1: set global vars canvas, ctx, gradients, etc here
canvas = document.querySelector(&apos;#myCanvas1&apos;);
ctx = canvas.getContext(&apos;2d&apos;);
grd = ctx.createRadialGradient(150, 100, 30, 210, 100, 100);
grd.addColorStop(0, &quot;red&quot;);
grd.addColorStop(0.17, &quot;orange&quot;);
grd.addColorStop(0.33, &quot;yellow&quot;);
grd.addColorStop(0.5, &quot;green&quot;);
grd.addColorStop(0.666, &quot;blue&quot;);
grd.addColorStop(1, &quot;violet&quot;);
draw();
}
function draw() {
ctx.fillStyle = grd;
ctx.fillRect(0, 0, 300, 200);
}
```

HTML
```
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;Radial gradients with offset circles&lt;/title&gt;
&lt;style&gt;
#myCanvas1 {
border: 1px solid black;
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body onload=&quot;init();&quot;&gt;
&lt;canvas id=&quot;myCanvas1&quot; width=&quot;300&quot; height=200&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;
&lt;/body&gt;
&lt;/html&gt;
```

### What happens if the gradient is smaller or larger than the shapes we draw?

A gradient is an invisible shape on the screen: the radial gradient is made of two circles: an inner and an outer circle. Between these two circles, colors are interpolated.

We call the &quot;first color&quot; the color defined for the inner circle, the &quot;last color&quot; the last color of the gradient, that corresponds to the outer circle:

-   The color inside the first circle will be the first color. In our example above, the first color is red: and the small circle of the gradient in our example is filled in red!

-   The color outside the outer circle will be the last color of the gradient - which is not interpolated. The last color in our example is purple, and it fills the rest of the filled rectangle area &quot;after&quot; the external circle of the gradient.

-   The colors between the two circles will be interpolated.

<h3 id="ch3-5-4">3.5.4 Canvas Context: Patterns/Textures</h3>

### Principle

The principle of &quot;pattern&quot; drawing is based on repeating an image (if the image is smaller than the surface of the shape you are going to draw) for filling the surface of objects to be drawn (either filled or stroked).

To illustrate this principle, in the next examples, we are going to draw rectangles using a pattern.

There are a few steps we have to take before doing this:

1.  **Create a JavaScript image object**

    1.  var imageObj = new Image();

```

```
1.  **Define a callback function that will be called once the image has been fully loaded** in memory; we cannot draw before the image has been loaded.

    1.  imageObj.onload = function(){

    2.  \...

    3.  }

```
<!-- -->
```
1.  **Set the source of this image to the URL of the pattern**:

    1.  imageObj.src = &quot;https://www.myserver.com/myRepeatablePattern.png&quot;;

```

```
1.  **Create a pattern object from the loaded image:**\
    As soon as step 3 is executed, an HTTP request is sent in background by the browser, and when the image is loaded in memory, the callback defined at step 2 is called. We create a pattern object inside, from the loaded image:

    1.  // callback called asynchronously, after the src attribute of imageObj is set

    2.  imageObj.onload = function(){ 

    3.      // We enter here when the image is loaded, we create a pattern object.

    4.      // It is good practice to set this as a global variable, easier to share

    5.      **pattern1 = ctx.createPattern(imageObj, &quot;repeat&quot;);**

    6.  };

```

```
1.  **Inside the callback function (or inside a function called from inside the callback) ,we can finally draw**:

    1.  // callback called asynchronously, after the src attribute of imageObj is set

    2.  imageObj.onload = function(){

    3.      pattern1 = ctx.createPattern(imageObj, &quot;repeat&quot;);

    4.  

    5.  **    // Draw a textured rectangle**

    6.  **    ctx.fillStyle = pattern1;**

    7.  **    ctx.fillRect(10, 10, 500, 800);**

    8.  };

###  Examples

#### Example #1: draw two rectangles with a pattern (one filled, one stroked)

Here we have two rectangles drawn using a pattern (an image that can be repeated along the X and Y axis). The first is a filled rectangle while the second is &quot;stroked&quot; with a lineWidth of 20 pixels:

![](./images/image178.png){width="6.5in" height="2.0631944444444446in"}

JS
```
var canvas, ctx, pattern1;
function init() {
canvas = document.querySelector(&apos;#myCanvas&apos;);
ctx = canvas.getContext(&apos;2d&apos;);
// We need 1) to create an empty image object, 2) to set a callback function
// that will be called when the image is fully loaded, 3) to create a
// pattern object, 4) to set the fillStyle or the strokeStyle property of
// the context with this pattern, 5) to draw something
// WE CANNOT DRAW UNTIL THE IMAGE IS FULLY LOADED -&gt; draw from inside the
// onload callback only !
// Allocate an image
var imageObj = new Image();
// callback called asynchronously, after the src attribute of imageObj is set
imageObj.onload = function(){
// We enter here only when the image has been loaded by the browser
// Pattern creation using the image object
// Instead of &quot;repeat&quot;, try different values : repeat-x, repeat-y,
// or no-repeat, You may draw larger shapes in order to see
// different results
// It is a good practice to leave this as a global variable if it
// will be reused by other functions
pattern1 = ctx.createPattern(imageObj, &quot;repeat&quot;);
// Draw a textured rectangle
ctx.fillStyle = pattern1;
ctx.fillRect(10, 10, 200, 200);
// And a wireframe one
ctx.lineWidth=20;
ctx.strokeStyle=pattern1;
ctx.strokeRect(230, 20, 150, 100);
};
// This will tell the browser to send an asynchronous request.
// When the browser will get an answer, the callback above will be called
imageObj.src = &quot;https://mainline.i3s.unice.fr/mooc/pattern1.jpg&quot;;
}
```

HTML
```
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;Drawing two rectangles with a pattern - Example #1&lt;/title&gt;
&lt;/head&gt;
&lt;body onload=&quot;init();&quot;&gt;
&lt;canvas id=&quot;myCanvas&quot; width=&quot;500&quot; height=&quot;400&quot;&gt;
Your browser does not support the canvas tag. &lt;/canvas&gt;
&lt;/body&gt;
&lt;/html&gt;
```
JavaScript source code:
```
1.  var canvas, ctx, pattern1;
2.   
3.  function init() {
4.     canvas = document.querySelector(&apos;#myCanvas&apos;);
5.     ctx = canvas.getContext(&apos;2d&apos;);
6.  
7.     // We need 1) to create an empty image object, 2) to set a callback function
8.     // that will be called when the image is fully loaded, 3) to create a
9.     // pattern object, 4) to set the fillStyle or the strokeStyle property of
10.    // the context with this pattern, 5) to draw something
11.    **// WE CANNOT DRAW UNTIL THE IMAGE IS FULLY LOADED -&gt; draw from inside the**
12. **   // onload callback only !**
13. 
14. 
15.    // 1 - Allocate an image
16.    var imageObj = new Image();
17.  
18.    // 2 - callback called asynchronously, after the src attribute of imageObj
19.    // is set
20.    imageObj.onload = function(){
21.       // We enter here only when the image has been loaded by the browser
22.       // 4 - Pattern creation using the image object
23.       // Instead of &quot;repeat&quot;, try different values : repeat-x, repeat-y,
24.       // or no-repeat, You may draw larger shapes in order to see
25.       // different results
26.       // It is good practice to leave this as a global variable if it
27.       // will be reused by other functions
28. 
29.       pattern1 = ctx.createPattern(imageObj, &quot;repeat&quot;);
30. 
31.       // 5 - Draw things. Here a textured rectangle
32.       ctx.fillStyle = pattern1;
33.       ctx.fillRect(10, 10, 200, 200);
34. 
35.       // \... And a wireframe one
36.       ctx.lineWidth=20;
37.       ctx.strokeStyle=pattern1;
38.       ctx.strokeRect(230, 20, 150, 100);
39.   };
40. 
41.   // 3 - Send the request to load the image
42.   // Setting the src attribute will tell the browser to send an asynchronous
43.   // request.
44.   // When the browser gets an answer, the callback above will be called
45.   imageObj.src = &quot;https://mainline.i3s.unice.fr/mooc/pattern1.jpg&quot;;
46. }
```

#### Example 2: the repeatability of a pattern

To &quot;better&quot; see the repeatability of the pattern, here is the same example with a 1000x1000 pixel wide canvas:

![](./images/image179.png){width="6.5in" height="2.0631944444444446in"}

JS
```
var canvas, ctx, pattern1;
function init() {
canvas = document.querySelector(&apos;#myCanvas&apos;);
ctx = canvas.getContext(&apos;2d&apos;);
// We need 1) to create an empty image object, 2) to set a callback function
// that will be called when the image is fully loaded, 3) to create a
// pattern object, 4) to set the fillStyle or the strokeStyle property of
// the context with this pattern, 5) to draw something
// WE CANNOT DRAW UNTIL THE IMAGE IS FULLY LOADED -&gt; draw from inside the
// onload callback only !
// Allocate an image
var imageObj = new Image();
// callback called asynchronously, after the src attribute of imageObj is set
imageObj.onload = function(){
// We enter here only when the image has been loaded by the browser
// Pattern creation using the image object
// Instead of &quot;repeat&quot;, try different values : repeat-x, repeat-y,
// or no-repeat, You may draw larger shapes in order to see
// different results
// It is a good practice to leave this as a global variable if it
// will be reused by other functions
pattern1 = ctx.createPattern(imageObj, &quot;repeat&quot;);
// Draw a textured rectangle
ctx.fillStyle = pattern1;
ctx.fillRect(10, 10, 500, 800);
// And a wireframe one
ctx.lineWidth=50;
ctx.strokeStyle=pattern1;
ctx.strokeRect(650, 20, 300, 800);
};
// This will tell the browser to send an asynchronous request.
// When the browser will get an answer, the callback above will be called
imageObj.src = &quot;https://mainline.i3s.unice.fr/mooc/pattern1.jpg&quot;;
}
```

HTML
```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Repeatability of a pattern - Example #2</title>
</head>
<body onload="init();">
<canvas id="myCanvas" width="1000" height="1000">
Your browser does not support the canvas tag. </canvas>
</body>
</html>
```
You can change the way the pattern is repeated by modifying the second parameter of this method:
1.  pattern1 = ctx.createPattern(imageObj, &quot;**repeat**&quot;);

Please try: repeat-x, repeat-y or no-repeat as acceptable values. Just change this line in the online example and you will see live results.

<h3 id="ch3-5-5">3.5.5 A Multiple Image Loader</h3>

### Draw with multiple patterns? We need to load all of them before drawing! 

Below are 4 rectangles drawn with 4 different patterns.

![4 rectangles drawn with different patterns](./images/image180.jpeg){width="3.78125in" height="3.78125in"}

We said earlier that we cannot draw before the image used by a pattern is loaded. This can become rapidly complicated if we need to draw using multiple patterns. We need a way to load all images and then, *only when all images have been loaded, start drawing*.

JavaScript is an asynchronous language. When you set the src attribute of an image, then an asynchronous request is sent by the browser, and then after a while, the onload callback is called\... The difficult part to understand for those who are not familiar with JavaScript is that these requests are done in parallel and we do not know when, and in what order, the images will be loaded.

**The solution is to use a multiple image loader that counts the loaded images and calls a function you pass when done!**

The trick is to have an array of URLs that will be used by our multiple image loader, and have the onload callback called once per image loaded, so we can count the number of images effectively loaded.

When all images have been loaded, we call a callback function that has been passed to our loader.

The complete example code that produces the result shown at the beginning of this page is the following:

![](./images/image181.png){width="6.5in" height="2.0701388888888888in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;A multiple image loader&lt;/title&gt;

&lt;style&gt;

#myCanvas {

border: 1px solid black;

}

&lt;/style&gt;

&lt;script&gt;

var canvas, ctx;

// List of images to load, we used a JavaScript object instead of

// an array, so that named indexes (aka properties)

// can be used -&gt; easier to manipulate

var imagesToLoad = {

flowers: &apos;https://i.ibb.co/4NN9Sgn/flowers.jpg&apos;,

lion: &apos;https://i.ibb.co/3NyqKnY/lion.jpg&apos;,

blackAndWhiteLys: &apos;https://i.ibb.co/VNLVpcL/final.jpg&apos;,

tiledFloor:

&apos;https://i.ibb.co/Dt6txmG/repeatable-Pattern.jpg&apos;

};

function loadImages(imagesToBeLoaded, drawCallback) {

var imagesLoaded = {};

var loadedImages = 0;

var numberOfImagesToLoad = 0;

// get num of sources

for(var name in imagesToBeLoaded) {

numberOfImagesToLoad++;

}

for(var name in imagesToBeLoaded) {

imagesLoaded&lbrack;name&rbrack; = new Image();

imagesLoaded&lbrack;name&rbrack;.onload = function() {

if(++loadedImages &gt;= numberOfImagesToLoad) {

drawCallback(imagesLoaded);

} // if

}; // function

imagesLoaded&lbrack;name&rbrack;.src = imagesToBeLoaded&lbrack;name&rbrack;;

} // for

} // function

function init() {

// This function is called after the page is loaded

// 1 - Get the canvas

canvas = document.getElementById(&apos;myCanvas&apos;);

// 2 - Get the context

ctx=canvas.getContext(&apos;2d&apos;);

loadImages(imagesToLoad, function(imagesLoaded) {

patternFlowers = ctx.createPattern(imagesLoaded.flowers, &apos;repeat&apos;);

patternLion = ctx.createPattern(imagesLoaded.lion, &apos;repeat&apos;);

patternBW = ctx.createPattern(imagesLoaded.blackAndWhiteLys, &apos;repeat&apos;);

patternFloor = ctx.createPattern(imagesLoaded.tiledFloor, &apos;repeat&apos;);

drawRectanglesWithPatterns();

});

}

function drawRectanglesWithPatterns() {

ctx.fillStyle=patternFloor;

ctx.fillRect(0,0,200,200);

ctx.fillStyle=patternLion;

ctx.fillRect(200,0,200,200);

ctx.fillStyle=patternFlowers;

ctx.fillRect(0,200,200,200);

ctx.fillStyle=patternBW;

ctx.fillRect(200,200,200,200);

}

&lt;/script&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;

Your browser does not support the canvas tag.

&lt;/canvas&gt;

&lt;/body&gt;

Define the list of images to be loaded:

1.  // List of images to load, we used a JavaScript object instead of

2.  // an array, so that named indexes (aka properties)

3.  // can be used -&gt; easier to read

4.  var imagesToLoad = {

5.       flowers: &apos;https://i.ibb.co/4NN9Sgn/flowers.jpg&apos;,

6.       lion: &apos;https://i.ibb.co/3NyqKnY/lion.jpg&apos;,

7.       blackAndWhiteLys: &apos;https://i.ibb.co/VNLVpcL/final.jpg&apos;,

8.       tiledFloor:

9.        &apos;https://i.ibb.co/Dt6txmG/repeatable-Pattern.jpg&apos;

10. };

Notice that instead of using a traditional array, we defined this list as a JavaScript object, with properties whose names will be easier to manipulate (flowers, lion, tiledFloor, etc.).

### The image loader function

1.  function loadImages(imagesToBeLoaded, drawCallback) {

2.       var imagesLoaded = {};

3.       var loadedImages = 0;

4.       var numberOfImagesToLoad = 0;

5.  

6.       // get num of images to load

7.       for(var name in imagesToBeLoaded) {

8.           numberOfImagesToLoad++;

9.       }

10. 

11.      for(var name in imagesToBeLoaded) {

12.          imagesLoaded&lbrack;name&rbrack; = new Image();

13. 

14.          imagesLoaded&lbrack;name&rbrack;.onload = function() {

15.              if(++loadedImages &gt;= numberOfImagesToLoad) {

16.                  drawCallback(imagesLoaded);

17.              } // if

18.          }; // function

19.          imagesLoaded&lbrack;name&rbrack;.src = imagesToBeLoaded&lbrack;name&rbrack;;

20.       } // for

21. } // function

**Explanations:**

-   This function takes as a parameter the list of images to be loaded, and a drawCallback function that will be called only once all images have been loaded. This callback takes as a parameter a new object that is the list of images that have been loaded (see *line 16*).

-   We first count the number of images to load (*lines 7-9*), then for each image to be loaded we create a new JavaScript image object (*line 12*) and set its src attribute (*line 19*) - this will start to load the image.

-   When an image comes in, the onload callback is called (*line 14*) and inside, we increment the number of images loaded (*line 15*) and test if this number is &gt;=  the total number of images that should be loaded. If this is the case, the callback function is called (*line 16*).

### Example of use of this loader

1.  loadImages(imagesToLoad, function(imagesLoaded) {

2.      patternFlowers = ctx.createPattern(imagesLoaded.flowers, &apos;repeat&apos;);

3.      patternLion    = ctx.createPattern(imagesLoaded.lion, &apos;repeat&apos;);

4.      patternBW = ctx.createPattern(imagesLoaded.blackAndWhiteLys, &apos;repeat&apos;);

5.      patternFloor   = ctx.createPattern(imagesLoaded.tiledFloor, &apos;repeat&apos;);

6.  

7.      drawRectanglesWithPatterns();

8.  });

**Explanations:**

-   *Line 1* is the call to the image loader, the first parameter is the list of images to be loaded, while the second parameter is the callback function that will be called once all images have been loaded.

-   *Lines 2-5*: in this callback we create patterns from the loaded images (note the use of the property names imagesLoaded.flowers, etc. that makes the code easier to read).

-   *Line 7*: then we call a function that will draw the rectangles. 

Here is the function:

1.  function drawRectanglesWithPatterns() {

2.      ctx.fillStyle=patternFloor;

3.      ctx.fillRect(0,0,200,200);

4.  

5.      ctx.fillStyle=patternLion;

6.      ctx.fillRect(200,0,200,200);

7.  

8.      ctx.fillStyle=patternFlowers;

9.      ctx.fillRect(0,200,200,200);

10.  

11.     ctx.fillStyle=patternBW;

12.     ctx.fillRect(200,200,200,200);

13. }

### 3.5.6 Drawing Shadows

### Context properties to draw with shadows

![a green shadowed rectangle](./images/image182.jpeg){width="2.5625in" height="1.4583333333333333in"}

There are 4 properties of the canvas context that are useful for indicating that we want to draw shapes with shadows:

1.  shadowColor: color to use for shadows,

2.  shadowBlur: blur level for shadows,

3.  shadowOffsetX: horizontal distance of the shadow from the shape,

4.  shadowOffsetY: vertical distance of the shadow from the shape

### Examples

#### Example #1: simple shadows

![](./images/image183.png){width="6.5in" height="2.0770833333333334in"}

JS

var canvas, ctx;

function init() {

canvas = document.getElementById(&apos;myCanvas&apos;);

ctx = canvas.getContext(&apos;2d&apos;);

setShadow();

// first green filled rectangle

ctx.fillStyle = &quot;#22FFDD&quot;; // rectangle color

ctx.fillRect(20, 20, 200, 100);

// second stroked rectangle

ctx.strokeStyle = &quot;purple&quot;; // rectangle color

ctx.lineWidth=10;

ctx.strokeRect(20, 150, 200, 100);

}

function setShadow() {

ctx.shadowColor = &quot;Grey&quot;; // color

ctx.shadowBlur = 20; // blur level

ctx.shadowOffsetX = 15; // horizontal offset

ctx.shadowOffsetY = 15; // vertical offset

}

HTML

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Simple shadows - Example #1</title>
</head>
<body onload = init();>
<canvas id="myCanvas" width="400" height =800>
Your browser does not support the canvas tag.</canvas>
</body>
</html>
```

<h4>JavaScript source code:</h4>

```
1.  var canvas, ctx;
2.  
3.  function init() {
4.      canvas = document.getElementById(&apos;myCanvas&apos;);
5.      ctx = canvas.getContext(&apos;2d&apos;);
6.  
7.      // call to a function that will set the 4 context properties for shadows
8.      setShadow();
9.      // all drawings that will occur will cast shadows
10. 
11.     // first green filled rectangle
12.     ctx.fillStyle = &quot;#22FFDD&quot;; 
13.     ctx.fillRect(20, 20, 200, 100);
14. 
15.     // second stroked rectangle
16.     ctx.strokeStyle = &quot;purple&quot;; 
17.     ctx.lineWidth=10;
18.     ctx.strokeRect(20, 150, 200, 100);
19. }
20.  
21. // We define the 4 properties in a dedicated function, for clarity
22. function setShadow() {
23.     ctx.shadowColor = &quot;Grey&quot;;    // color
24.     ctx.shadowBlur = 20;         // blur level
25.     ctx.shadowOffsetX = 15;      // horizontal offset
26.     ctx.shadowOffsetY = 15;      // vertical offset
27. }
```

**Explanations:**

-   *Lines 21-27*: we set the 4 properties that define shadows in a dedicated function, for better clarity.

-   *Line 8*: we called this function once before drawing the rectangles.

-   *Lines 11-18*: we draw a filled and a stroked rectangle. Both rectangles cast shadows.

#### Example #2: unwanted shadows!

Let&apos;s take a [previous example](https://codepen.io/w3devcampus/pen/YzZBxmO), the one that draws a filled circle with an outline. And, let&apos;s add a shadow to it using the following code:

```
1.  ...
2.  ctx.beginPath();
3.  
4.  // Add to the path a full circle (from 0 to 2PI)
5.  ctx.arc(centerX, centerY, radius, 0, 2\*Math.PI, false);
6.  
7.  // With path drawing you can change the context
8.  // properties until a call to stroke() or fill() is performed
9.  ctx.fillStyle = &quot;lightBlue&quot;;
10. 
11. **// add shadows before drawing the filled circle**
12. **addShadows();**
13. 
14. // Draws the filled circle in light blue
15. ctx.fill();
16. 
17. // Prepare for the outline
18. ctx.lineWidth = 5;
19. ctx.strokeStyle = &quot;black&quot;;
20. 
21. // draws the path AGAIN (the circle), this
22. // time in wireframe
23. ctx.stroke();
24. 
25. // Notice we only once called context.arc()! And drew it twice
26. // with different styles
27. \...
28.  
29. function** addShadows()** {
30.     ctx.shadowColor = &quot;Grey&quot;; // color
31.     ctx.shadowBlur = 20;      // blur level
32.     ctx.shadowOffsetX = 15;   // horizontal offset
33.     ctx.shadowOffsetY = 15;   // vertical offset
34. }
```

And here is the result:


![](./images/image184.png){width="6.5in" height="2.0701388888888888in"}

<h4>HTML</h4>

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Unwanted shadows - Example #2</title>
<style>
body {
margin: 0px;
padding: 0px;
}
#myCanvas {
border: 1px solid #9C9898;
}
</style>
<script>
var canvas, ctx;
window.onload = function(){
canvas = document.getElementById("myCanvas");
ctx = canvas.getContext("2d");
var centerX = canvas.width / 2;
var centerY = canvas.height / 2;
var radius = 70;
ctx.beginPath();
// Add to the path a full circle (from 0 to 2PI)
ctx.arc(centerX, centerY, radius, 0, 2*Math.PI, false);
// With path drawing you can change the context
// properties until a call to stroke() or fill() is performed
ctx.fillStyle = "lightBlue";
// add shadows before drawing the filled circle
addShadows();
// Draws the filled circle in light blue
ctx.fill();
// Prepare for the outline
ctx.lineWidth = 5;
ctx.strokeStyle = &quot;black&quot;;
// draws AGAIN the path (the circle), this
// time in wireframe
ctx.stroke();
// Notice we called context.arc() only once ! And drew it twice
// with different styles
};
function addShadows() {
ctx.shadowColor = "Grey"; // color
ctx.shadowBlur = 20; // blur level
ctx.shadowOffsetX = 15; // horizontal offset
ctx.shadowOffsetY = 15; // vertical offset
}
</script>
</head>
<body>
<canvas id="myCanvas" width="578" height="200">
</canvas>
</body>
</html>
```

Ah, indeed, the call to ctx.fill() casts a shadow, but the call to ctx.stroke(), that paints the whole path again, casts a shadow too, and this time the outline produces an unwanted shadow\... How can we avoid this effect, while using the same technique for drawing the path?

The trick is to save the context before setting the shadow properties, then draw the filled circle, then restore the context (to its previous state: without shadows), then draw the outlined circle by calling ctx.stroke().

Correct version of the code:

```
1.  ...
2.  // save the context before setting shadows and drawing the filled circle
3.   ctx.save();
4.  
5.  // With path drawing you can change the context
6.  // properties until a call to stroke() or fill() is performed
7.   ctx.fillStyle = "lightBlue";
8.  
9.  // add shadows before drawing the filled circle
10.  addShadows();
11. 
12. // Draws the filled circle in light blue
13.  ctx.fill();
14. 
15. // restore the context to its previous saved state
16.  ctx.restore();
17. ...
```

And here is the final result:

![](./images/image185.png){width="6.5in" height="2.0631944444444446in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Unwanted shadows disappear- Example #2 bis&lt;/title&gt;

&lt;style&gt;

body {

margin: 0px;

padding: 0px;

}

#myCanvas {

border: 1px solid #9C9898;

}

&lt;/style&gt;

&lt;script&gt;

var canvas, ctx;

window.onload = function(){

canvas = document.getElementById(&quot;myCanvas&quot;);

ctx = canvas.getContext(&quot;2d&quot;);

var centerX = canvas.width / 2;

var centerY = canvas.height / 2;

var radius = 70;

ctx.beginPath();

// Add to the path a full circle (from 0 to 2PI)

ctx.arc(centerX, centerY, radius, 0, 2\*Math.PI, false);

// save the context before setting shadows and drawing the filled circle

ctx.save();

// With path drawing you can change the context

// properties until a call to stroke() or fill() is performed

ctx.fillStyle = &quot;lightBlue&quot;;

// add shadows before drawing the filled circle

addShadows();

// Draws the filled circle in light blue

ctx.fill();

// restore the context to its previous saved state

ctx.restore();

// Prepare for the outline

ctx.lineWidth = 5;

ctx.strokeStyle = &quot;black&quot;;

// draws AGAIN the path (the circle), this

// time in wireframe

ctx.stroke();

// Notice we called context.arc() only once ! And drew it twice

// with different styles

};

function addShadows() {

ctx.shadowColor = &quot;Grey&quot;; // color

ctx.shadowBlur = 20; // blur level

ctx.shadowOffsetX = 15; // horizontal offset

ctx.shadowOffsetY = 15; // vertical offset

}

&lt;/script&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;578&quot; height=&quot;200&quot;&gt;

&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

### 3.5.7 Styling Lines

Several context properties can be used to set the thickness of the shape outlines, the way line end caps are drawn, etc.

They apply to all shapes that are drawn in path mode (lines, curves, arcs) and some also apply to rectangles.

### Examples of line styles

#### Example #1: changing the line thickness

We have seen this before. This is done by changing the value (in pixels) of the lineWidth property of the context:

1.  **ctx.lineWidth = 10;** // set the thickness of every shape drawn in stroke/wireframe mode to 10 pixels

Here is a complete example where we draw with a lineWidth of 20 pixels:

![](./images/image186.png){width="6.5in" height="2.0701388888888888in"}

Source code:

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;

3.    &lt;head&gt;

4.      &lt;meta charset=&quot;utf-8&quot;&gt;

5.      &lt;title&gt;A simple example of lineWidth property use&lt;/title&gt;

6.  

7.    &lt;/head&gt;

8.    &lt;body&gt;

9.      &lt;canvas id=&quot;myCanvas&quot; width=&quot;500&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

10.     &lt;script&gt;

11.       var canvas = document.getElementById(&apos;myCanvas&apos;);

12.       var ctx = canvas.getContext(&apos;2d&apos;);

13.  

14. // first path

15.       ctx.moveTo(20, 20);

16.       ctx.lineTo(100, 100);

17.       ctx.lineTo(100, 0);

18.  

19.  

20. // second part of the path

21.       ctx.moveTo(120, 20);

22.       ctx.lineTo(200, 100);

23.       ctx.lineTo(200, 0);

24.  

25. // indicate stroke color + draw first part of the path

26.       ctx.strokeStyle = &quot;#0000FF&quot;;

27. // Current line thickness is 20 pixels

28.       ctx.lineWidth = 20;

29.       ctx.stroke();

30.  

31. // Draws a rectangle

32.       ctx.strokeRect(230, 10, 100, 100);

33.       &lt;/script&gt;

34.  

35.     &lt;/body&gt;

36. &lt;/html&gt;

#### Example #2: changing the end caps of a line

The lineCap property of the context indicates the way line end caps are rendered. Possible values are butt (default), round, square (from top to bottom in the next illustration). Note that a value of &quot;round&quot; or &quot;square&quot; makes the lines slightly longer than the default value &quot;butt&quot;.

![line cap values](./images/image187.png){width="2.09375in" height="1.3958333333333333in"}

Try this:

![](./images/image188.png){width="6.5in" height="2.0701388888888888in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Changing the end caps of a line - Example #2&lt;/title&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;500&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script&gt;

var canvas = document.getElementById(&apos;myCanvas&apos;);

var ctx = canvas.getContext(&apos;2d&apos;);

// first path

ctx.moveTo(20, 20);

ctx.lineTo(100, 100);

ctx.lineTo(100, 30);

// second part of the path

ctx.moveTo(120, 20);

ctx.lineTo(200, 100);

ctx.lineTo(200, 30);

// indicate stroke color + draw first part of the path

ctx.strokeStyle = &quot;#0000FF&quot;;

// Current line thickness is 20 pixels

ctx.lineWidth = 20;

// Try different values : butt, square, round

ctx.lineCap = &quot;round&quot;;

ctx.stroke();

// Draws a rectangle

ctx.strokeRect(230, 10, 100, 100);

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Note that in this example, the rectangle is not affected. It has no line ends visible - all its sides meet. However, the next property we&apos;re going to look at will have an effect on rectangles!

#### Example #3: setting the type of corner when two lines meet

The lineJoin property of the context indicates the way corners are rendered, when two lines meet. Possible values are miter (the default) for creating sharp corners, round, or bevel for &quot;cut corners&quot;.

Try this:

![](./images/image189.png){width="6.5in" height="2.0909722222222222in"}

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Setting the type of corner when two lines meet - Example #3&lt;/title&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;500&quot;&gt;Your browser does not support the canvas tag.&lt;/canvas&gt;

&lt;script&gt;

var canvas = document.getElementById(&apos;myCanvas&apos;);

var ctx = canvas.getContext(&apos;2d&apos;);

// first path

ctx.moveTo(20,20);

ctx.lineTo(100, 100);

ctx.lineTo(100,30);

// second part of the path

ctx.moveTo(120,20);

ctx.lineTo(200, 100);

ctx.lineTo(200,30);

// indicate stroke color + draw first part of the path

ctx.strokeStyle = &quot;#0000FF&quot;;

// Current line thickness is 20 pixels

ctx.lineWidth = 20;

// Try different values : miter(default), bevel, round

ctx.lineJoin=&quot;round&quot;;

ctx.stroke();

// Draws a rectangle

ctx.strokeRect(230, 10, 100, 100);

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

#### Example #4: specific case of lineJoin=&quot;miter&quot;, the miterLimit property, a way to avoid looooooong corners!

The miterLimit property value corresponds to the maximum miter length: the distance between the inner corner and the outer corner where two lines meet. When the angle of a corner between two lines gets smaller, the miter length grows and can become too long.

In order to avoid this situation, we can set the miterLimit property of the context to a threshold value. If the miter length exceeds the miterLimit value, then the corner will be rendered as if the lineJoin property had been set to &quot;bevel&quot; and the corner will be &quot;cut&quot;.

![miterLimit property shown with 3 different angles, we see that the part tha goes out of the angle can become very long](./images/image190.gif){width="2.0520833333333335in" height="1.0416666666666667in"}

You can try an interactive example here:

![](./images/image191.png){width="6.5in" height="2.0770833333333334in"}

In the example, try different values for the miterLimit property. You&apos;ll see that the way the corners are rendered changes at values around 2 and 3.

### 4.1.1 Video Intro -- Module 4

1:17 video explaining animation.

### 4.2.1 Animation Techniques

In order to perform an animation, we need to:

1.  Clear the content of the canvas: this can be done using the ctx.clearRect(0, 0, canvasWidth, canvasHeight) method;

2.  Draw some shapes: use any of the drawing methods we have seen so far;

3.  Move the shapes: modify the position and/or orientation, size and color of the shapes;

4.  Repeat (go to step 1).

These are the basic steps for animating objects in a canvas. The order of the steps can be changed (i.e. you can move the shapes before drawing them), but, the principle is the same: **clear-draw-move-repeat**.

Step 1 could be avoided if you redraw the whole canvas content during step 2.

### Before HTML5

Even before HTML5 and the introduction of the canvas element, people created HTML games. They used CSS backgrounds inside &lt;div&gt; elements, and used to change the CSS top, left, width and height properties of the divs to animate graphic images on the screen.

During the late 1990s and early 2000s, JavaScript became increasingly popular. The community created a first &apos;umbrella term&apos; describing a collection of technologies used together to create interactive and animated Web sites - [DHTML (Dynamic HTML)](https://en.wikipedia.org/wiki/Dynamic_HTML). For example, check the [games developed at this time by Brent Silby](https://def-logic.com/) (they all use DHTML).

![A mario like DHTML game](./images/image192.png){width="2.3541666666666665in" height="1.9166666666666667in"}

For animation, the setInterval(function, ms) and setTimeout(function, ms) methods were the only solutions. Both methods take a function as the first parameter, and a number of milliseconds as the second parameter.

The only difference is that the code provided to setInterval will run every n milliseconds whereas the code in setTimeout will run only once after n milliseconds (meaning that we will have to repeat a call to setTimeout at step 4 above).

### After HTML5

The methods described above are now completed by a new method that comes with multiple advantages: the requestAnimationFrame API.

We will compare the old methods with the new one, and implement the same  example with each of them to highlight the differences.

### 4.2.2 Basic Animation Techniques

Below is the example shown in the video, with source code:

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Animation&lt;/title&gt;

&lt;style&gt;

#myCanvas {

border: 1px solid black;

}

&lt;/style&gt;

&lt;script&gt;

var canvas, ctx;

var rectangleX = 0;

var colors = &lbrack;&apos;red&apos;, &apos;blue&apos;, &apos;green&apos;&rbrack;;

var currentColor = 0;

var speed = 3;

function init() {

// This function is called after the page is loaded

// 1 - Get the canvas

canvas = document.getElementById(&apos;myCanvas&apos;);

// 2 - Get the context

ctx=canvas.getContext(&apos;2d&apos;);

// 3 - we can draw

//setInterval(animate, 100);

//setTimeout(animate, 100);

requestAnimationFrame(animate);

setInterval(changeColor, 1000);

}

function animate() {

// - 1 clear canvas

ctx.clearRect(0, 0, canvas.width, canvas.height);

// 2 - draw a red rectangle

ctx.fillRect(rectangleX,0,80,100);

// 3 - move the shapes

rectangleX = rectangleX +speed;

if((rectangleX+80 &gt; 200) \|\| (rectangleX &lt;= 0)){

speed = -speed;

}

// Call again the anilate function after 100ms

//setTimeout(animate, 100);

requestAnimationFrame(animate);

}

function changeColor() {

ctx.fillStyle= colors&lbrack;currentColor%3&rbrack;;

currentColor += 1;

// Comment next line if you do not want to change the speed at

// each bounce

speed += Math.sign(speed)\*1;

console.log(&quot;speed = &quot; + speed)

}

&lt;/script&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;200&quot; height=&quot;200&quot;&gt;

Your browser does not support the canvas tag.

&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

**Errata**: in the video, we use speed +=1; in order to increment the speed of the rectangle each time it bounces (in the changeColor() function). This is not correct as speed can be negative. The online example fixes this by using speed += Math.sign(speed) \* 1; instead this will add +1 or -1 depending on the sign of speed.

### 4.2.3 Animating Using setInterval()

The setInterval(\...) function is still popular on the Web, and even though this is not the recommended way to do 60 frames/second canvas animation, it is worth understanding how it works.

Syntax: setInterval(function, ms);

The setInterval(\...) function calls another function or evaluates an expression at specified intervals of time (in milliseconds), and returns the unique id of the action. You can always stop it by calling the clearInterval(id) function with the interval identifier as an argument.

### Basic example that shows how to animate a DIV using the DOM API

This is how pre-HTML5 games were written. Before the introduction of the canvas element, developers made games using div elements. By changing their background color, top and left CSS positions, it was possible to animate characters in games. The animation was created by calling repeatedly a function that did the drawing, using the JavaScript setInterval or setTimeout functions.

Please try this example that moves/animates a div using setInterval:

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;setInterval for animation&lt;/title&gt;

&lt;style&gt;

#animatedDIV {

position:absolute;

background-color:red;

color:white;

height:100px;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;button onclick=&quot;start()&quot;&gt;Start animation&lt;/button&gt;

&lt;button onclick=&quot;stop()&quot;&gt;Stop animation&lt;/button&gt;

&lt;div&gt;

&lt;div id=&quot;animatedDIV&quot;&gt;Animated DIV :-)&lt;/div&gt;

&lt;/div&gt;

&lt;script&gt;

var elm = document.getElementById(&quot;animatedDIV&quot;);

var requestId;

var x = 0;

function render(time) {

elm.style.left = x++ + &quot;px&quot;;

}

function start() {

requestId = setInterval(render, 10);

}

function stop() {

if (requestId) {

clearInterval(requestId);

}

}

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Extract from the source code:

1.  &lt;body&gt;

2.     &lt;div id=&quot;animatedDIV&quot;&gt;Animated DIV :-)&lt;/div&gt;

3.  

4.     &lt;button onclick=&quot;start()&quot;&gt;Start animation&lt;/button&gt;

5.     &lt;button onclick=&quot;stop()&quot;&gt;Stop animation&lt;/button&gt;

6.  

7.     &lt;script&gt;

8.         var elm = document.getElementById(&quot;animatedDIV&quot;);

9.         var requestId;

10.        var x = 0;

11. 

12.        function render(time) {

13.            elm.style.left = x++ + &quot;px&quot;;

14.        }

15. 

16.        function start() {

17.            **requestId = setInterval(render, 10);**

18.        }

19. 

20.        function stop() {

21.            if (requestId) {

22.                **clearInterval(requestId);**

23.            }

24.        }

25.     &lt;/script&gt;

26. &lt;/body&gt;

Here, we define a &lt;div&gt; element, (see the online source code for the CSS properties involved), and we use the setInterval method (*line 17*) to call every 10ms the render() method that will just increment the position of this element. Notice that since we&apos;re using the DOM, the horizontal position of the div is modified by changing its left CSS property.

The call to setInterval returns an id we can use to stop the animation, by calling clearInterval (*line 22*).

### Animate a monster in a canvas, using setInterval

We use the drawMonster() function:

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;setInterval and monster animation&lt;/title&gt;

&lt;style&gt;

&lt;style&gt;

#myCanvas {

border: 1px solid black;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;

Your browser does not support the canvas tag.

&lt;/canvas&gt;

&lt;p&gt;

&lt;button onclick=&quot;start()&quot;&gt;Start animation&lt;/button&gt;

&lt;button onclick=&quot;stop()&quot;&gt;Stop animation&lt;/button&gt;

&lt;script&gt;

var canvas, ctx;

var monsterX=100, monsterY=100, monsterAngle=0;

function init() {

// This function is called after the page is loaded

// 1 - Get the canvas

canvas = document.getElementById(&apos;myCanvas&apos;);

// 2 - Get the context

ctx=canvas.getContext(&apos;2d&apos;);

}

function animationLoop() {

// 1 - Clear the canvas

ctx.clearRect(0, 0, canvas.width, canvas.height);

// 2 Draw the monster using variables for pos, angle, etc.

drawMonster(monsterX, monsterY, monsterAngle, &apos;green&apos;, &apos;yellow&apos;);

// 3 Move the monster (change pos, angle, size, etc.)

monsterX += 10;

monsterX %= canvas.width

monsterAngle+= 0.01;

}

function drawMonster(x, y, angle, headColor, eyeColor) {

// GOOD PRACTICE : SAVE CONTEXT AND RESTORE IT AT THE END

ctx.save();

// Moves the coordinate system so that the monster is drawn

// at position (x, y)

ctx.translate(x, y);

ctx.rotate(angle)

// head

ctx.fillStyle=headColor;

ctx.fillRect(0,0,200,200);

// eyes

ctx.fillStyle=&apos;red&apos;;

ctx.fillRect(35,30,20,20);

ctx.fillRect(140,30,20,20);

// interior of eye

ctx.fillStyle=eyeColor;

ctx.fillRect(43,37,10,10);

ctx.fillRect(143,37,10,10);

// Nose

ctx.fillStyle=&apos;black&apos;;

ctx.fillRect(90,70,20,80);

// Mouth

ctx.fillStyle=&apos;purple&apos;;

ctx.fillRect(60,165,80,20);

// GOOD PRACTICE !

ctx.restore();

}

function start() {

// Start the animation loop, change 20 for bigger values

requestId = setInterval(animationLoop, 20);

}

function stop() {

if (requestId) {

clearInterval(requestId);

}

}

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Source code:

1.  &lt;body onload=&quot;init();&quot;&gt;

2.      &lt;canvas id=&quot;myCanvas&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;

3.          Your browser does not support the canvas tag.

4.      &lt;/canvas&gt;

5.      &lt;p&gt;

6.      &lt;button onclick=&quot;start()&quot;&gt;Start animation&lt;/button&gt;

7.      &lt;button onclick=&quot;stop()&quot;&gt;Stop animation&lt;/button&gt;

8.  

9.      &lt;script&gt;

10.         var canvas, ctx;

11.         var monsterX=100, monsterY=100, monsterAngle=0;

12. 

13.         function init() {

14.             // This function is called after the page is loaded

15.             // 1 - Get the canvas

16.             canvas = document.getElementById(&apos;myCanvas&apos;);

17.             // 2 - Get the context

18.             ctx=canvas.getContext(&apos;2d&apos;);

19.         }

20. 

21.         function animationLoop() {

22.             // 1 - Clear the canvas

23.             ctx.clearRect(0, 0, canvas.width, canvas.height);

24. 

25.             // 2 Draw the monster using variables for pos, angle, etc.

26.            drawMonster(monsterX, monsterY, monsterAngle, &apos;green&apos;, &apos;yellow&apos;);

27. 

28.            // 3 Move the monster (change pos, angle, size, etc.)

29.            monsterX += 10;

30.            monsterX %= canvas.width

31.            monsterAngle+= 0.01;

32.         }

33. 

34.         function drawMonster(x, y, angle, headColor, eyeColor) {

35.         // BEST PRACTICE: SAVE CONTEXT AND RESTORE IT AT THE END

36.         ctx.save();

37. 

38.         // Moves the coordinate system so that the monster is drawn

39.         // at position (x, y)

40.         ctx.translate(x, y);

41.         ctx.rotate(angle)

42. 

43.         // head

44.         ctx.fillStyle=headColor;

45.         ctx.fillRect(0,0,200,200);

46.         \...

47. 

48.         // BEST PRACTICE!

49.         ctx.restore();

50.      }

51. 

52.      function start() {

53.          // Start the animation loop, change 20 for bigger values

54.          **requestId = setInterval(animationLoop, 20);**

55.      }

56. 

57.      function stop() {

58.          if (requestId) {

59.              **clearInterval(requestId);**

60.          }

61.      }

62. &lt;/script&gt;

63. &lt;/body&gt;

**Explanations:**

-   *Lines 52-61*: The code for launching and stopping the animation is similar to that from the previous example.

```
<!-- -->
```
-   *Lines 34-50*: The code that draws the monster is that which we saw earlier when we presented the 2D transformations. Best practice is to save and restore the context at the beginning and end of each function that changes the context.

```
<!-- -->
```
-   *Lines 21-32*: **The most interesting part is the animation loop** that implements the basic animation steps: *clear-draw-move*. In order to make a shape &quot;movable&quot;, we use some &quot;state variables&quot; for its position and angle, and we modify them at each iteration (*lines 29-32*). We will see later on how to modify the value of these variables on user interactions (keyboard, mouse, etc.).

### Problems with setInterval

While the above example works, there are several reasons not to use setInterval for doing smooth animations.

#### Running several animations simultaneously

The setInterval function may become hard to debug, particularly if you run several animations simultaneously. For example, if you have two intervals, one running every 100 milliseconds, the other every second, and if you want to debug the second one, the first one will constantly be run at regular intervals, making step by step debugging really difficult.

#### A single animation may be interrupted by itself to become two simultaneous animations

setInterval will execute the function passed as first parameter every n milliseconds regardless of when the function was last called or how long the function takes to execute. If the function takes longer than the interval, then setInterval might queue too many function executions back to back when the interval is too short, leading to unpredictable results. 

***BEST PRACTICE**: AVOID using setInterval for animating in a canvas,*\
*except for trivial cases (change a color every second).*

### 4.2.4 Animating Using setTimeout()

One thing you should always remember about using setInterval: if we set number of milliseconds at - let's say 20ms - it will call our game loop function EACH 20ms, *even if the previous one is not yet finished*. This may lead to many problems (incomplete rendering, etc.).

That&apos;s where we can use another function: 

-   setTimeout(function, ms);

This function works like setInterval(\...) with one difference: it calls your function ONCE and *AFTER a given amount of time*.

### Example of the monster animated in a canvas with setTimeout

Check the example below (click on start animation):

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Monster animated in a canvas with setTimeout&lt;/title&gt;

&lt;style type=&quot;text/css&quot;&gt;

canvas {

border:1px solid black;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;

Your browser does not support the canvas tag.

&lt;/canvas&gt;

&lt;p&gt;

&lt;button onclick=&quot;start()&quot;&gt;Start animation&lt;/button&gt;

&lt;button onclick=&quot;stop()&quot;&gt;Stop animation&lt;/button&gt;

&lt;script&gt;

var canvas, ctx;

var monsterX=100, monsterY=100, monsterAngle=0;

function init() {

// This function is called after the page is loaded

// 1 - Get the canvas

canvas = document.getElementById(&apos;myCanvas&apos;);

// 2 - Get the context

ctx=canvas.getContext(&apos;2d&apos;);

}

function animationLoop() {

// 1 - Clear

ctx.clearRect(0, 0, canvas.width, canvas.height);

// 2 Draw

drawMonster(monsterX, monsterY, monsterAngle, &apos;green&apos;, &apos;yellow&apos;);

// 3 Move

monsterX += 10;

monsterX %= canvas.width

monsterAngle+= 0.01;

// call again mainloop after 20ms

requestId = setTimeout(animationLoop, 20);

}

function drawMonster(x, y, angle, headColor, eyeColor) {

// GOOD PRACTICE : SAVE CONTEXT AND RESTORE IT AT THE END

ctx.save();

// Moves the coordinate system so that the monster is drawn

// at position (x, y)

ctx.translate(x, y);

ctx.rotate(angle)

// head

ctx.fillStyle=headColor;

ctx.fillRect(0,0,200,200);

// eyes

ctx.fillStyle=&apos;red&apos;;

ctx.fillRect(35,30,20,20);

ctx.fillRect(140,30,20,20);

// interior of eye

ctx.fillStyle=eyeColor;

ctx.fillRect(43,37,10,10);

ctx.fillRect(143,37,10,10);

// Nose

ctx.fillStyle=&apos;black&apos;;

ctx.fillRect(90,70,20,80);

// Mouth

ctx.fillStyle=&apos;purple&apos;;

ctx.fillRect(60,165,80,20);

// GOOD PRACTICE !

ctx.restore();

}

function start() {

// Start the animation loop, change 20 for bigger

// values

requestId = setTimeout(animationLoop, 20);

}

function stop() {

if (requestId) {

clearTimeout(requestId);

}

}

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

This is similar to the previous example except that we called setTimeout(function, delay) instead of setInterval(function, period). **As setTimeout runs the function passed as the first parameter only once, we also have to call it at the end of the loop**.

Extract from source code:

1.  function animationLoop() {

2.     // 1 - Clear

3.     ctx.clearRect(0, 0, canvas.width, canvas.height);

4.  

5.     // 2 Draw

6.     drawMonster(monsterX, monsterY, monsterAngle, &apos;green&apos;, &apos;yellow&apos;);

7.  

8.     // 3 Move

9.     monsterX += 10;

10.    monsterX %= canvas.width

11.    monsterAngle+= 0.01;

12. 

13.    **// call mainloop again after 20ms**

14.    **requestId = setTimeout(animationLoop, 20);**

15. }

16.  

17. function start() {

18.    // Start the animation loop, change 20 for bigger

19.    // values

20.    **requestId = setTimeout(animationLoop, 20);**

21. }

22. 

23. function stop() {

24.    if (requestId) {

25.       **clearTimeout(requestId);**

26.    }

27. }

This function is certainly more suitable for doing graphic animation, such as for writing an HTML5 game. It will never interrupt an ongoing animation, even if the instructions inside the animation loop take too long.

### Problems with setInterval() and setTimeout()

setTimeout does not &quot;wait&quot;  during the timeout period. It lets the rest of the JavaScript code run. It schedules a new call to the function passed as first parameter with a timer running in the background. This might cause it to take slightly longer than the expected timeout period to start executing. 

This problem also occurs with setInterval, the timing is not &quot;very&quot; reliable. If you plan to run a function every 20ms, and if you measure precisely the real timing, sometimes you will discover big differences between what is scheduled and what is performed. This is because these methods were designed a long time ago, when high precision timers and 60 frames per second animation were not an option.

Here comes the [requestAnimationFrame API,](https://www.w3.org/TR/html51/webappapis.html#animation-frames) a very good companion to the canvas API!

***BEST PRACTICE**: AVOID using setTimeout for animating in a canvas, except for trivial cases.*

***For 60 frames/second animation, use requestAnimationFrame!***

### 4.2.5 The requestAnimationFrame API

The best way to make animation at 60 frames per second: requestAnimationFrame!

The requestAnimationFrame(animationLoop) is very similar to setTimeout:

-   **It targets 60 frames/s**: requestAnimationFrame asks the browser to schedule a call to the animationLoop function passed as parameter in 1/60th of a second (equivalent to 16.6ms). Keep in mind that most monitors cannot display more than 60 frames per second (FPS). Note that whether humans can tell the difference among high frame rates depends on the application, most games are acceptable above 30 FPS, and virtual reality might require 75 FPS to achieve a natural feel. Some gaming monitors go up to 144 FPS (pro players in e-sport train themselves at Counter Strike with a 150 frames/s rate).

-   **It calls the function only ONCE**, so if you want a continuous animation, like with setTimeout, you need to call again requestAnimationFrame at the end of the animationLoop function.

It has, however, several advantages over setInterval and setTimeout:

-   **The scheduling is much more accurate:** if the code inside the function can be executed in less than 16.6ms, then the average error between the scheduled time and the real time will be much smaller than with the old functions.

-   **High resolution timer**: even if this difference is small, the function that is called after 16.6ms has an extra parameter that is a high resolution time, very useful for writing games that do[ time-based animation](https://blog.sklambert.com/using-time-based-animation-implement/). Time-based animation will be studied in detail in the HTML5 Part 2 course at W3Cx. It is a technique that comprises measuring the amount of time elapsed between two frames, then computing the distance in pixels to move objects on screen so that the visible speed for a human eye remains constant, even if the frame rate is not.

-   **Multiple animations are merged**: browsers can bundle animations happening at the same time into a single paint redraw (thus happening faster/with less CPU cycles), solving the problems that can occur with simultaneous setInterval calls.

-   **CPU/GPU optimization, battery saved on mobiles**:  if the JavaScript execution is occurring in a tab/window which is not visible, it doesn't have to be drawn. However the animation loop is still executed (objects will be moved, not drawn). This is the same when a mobile phone or tablet screen is black or if the application is put in background.

### Typical use

You will note that  requestAnimationFrame(function) is used like setTimeout(function, delay). A call to requestAnimationFrame just asks the browser to call the function passed as a parameter ONCE, **and the target delay is fixed**, and corresponds to a 60 frames/s frame rate (16.6ms). Notice that an id is used for stopping an animation with cancelAnimationFrame(id). 

Source code:
```
1.  &lt;body onload=&quot;init();&quot;&gt;
2.  &lt;script&gt;
3.  var canvas, ctx;
4.  
5.  function init() {
6.     // This function is called after the page is loaded
7.     // 1 - Get the canvas
8.     canvas = document.getElementById(&apos;myCanvas&apos;);
9.     // 2 - Get the context
10.    ctx=canvas.getContext(&apos;2d&apos;);
11. 
12.    // 3 - start the animation
13.    startAnimation();
14. }
15.  
16.  **var id;**
17.  function animationLoop(timeStamp) {
18.    // 1 - Clear
19.    ctx.clearRect(0, 0, canvas.width, canvas.height);
20.    // 2 Draw
21.    drawShapes(\...);
22.    // 3 Move
23.    moveShapes(\...);
24.    // call mainloop  again after 16.6ms (corresponds to 60 frames/second)
25.    **id = requestAnimationFrame(animationLoop);**
26. }
27.  
28.  function startAnimation() {
29.    **id = requestAnimationFrame(animationLoop);**
30. }
31.  function stopAnimation() {
32.    if (id) {
33.       **cancelAnimationFrame(id);**
34.    }
35. }
36. &lt;/script&gt;
37. &lt;/body&gt;
```

<h4>Example: animate the monster with requestAnimationFrame</h4>

Check the example below:

Source code extract - please compare with the previous example that used setInterval():
```
1.  function animationLoop(timeStamp) {
2.      // 1 - Clear
3.      ctx.clearRect(0, 0, canvas.width, canvas.height);
4.   
5.      // 2 - Draw
6.      drawMonster(monsterX, monsterY, monsterAngle, &apos;green&apos;, &apos;yellow&apos;);
7.   
8.      // 3 - Move
9.      monsterX += 10;
10.     monsterX %= canvas.width
11.     monsterAngle+= 0.01;
12.  
13.     **// call mainloop again after 16.6 ms (60 frames/s)**
14.     **requestId = requestAnimationFrame(animationLoop);**
15. }
16. 
17. function start() {
18.     **// Start the animation loop, targets 60 frames/s, this**
19. **    // calls animationLoop only ONCE!**
20.     **requestId = requestAnimationFrame(animationLoop);**
21. }
22. 
23. function stop() {
24.     if (requestId) {
25.         **cancelAnimationFrame(requestId);**
26.     }
27. }
```

Notice that calling requestAnimationFrame(animationLoop) at* line 19*, and after that from within the loop at line 14, asks the browser to call the animationLoop function so that the delta between calls will be **as close as possible to 16.6ms  (this corresponds to 1/60th of a second)**.

### Is the 16.6ms delay really accurate? Can we trust it?

This target may be hard to reach if:

-   The animation loop content is too complex,

-   The target device that runs the animation is a low end phone or an old computer,

-   The scheduler may be a bit late or a bit in advance (even if this kind of error is much smaller with requestAnimationFrame than with setInterval or setTimeout).

Many HTML5 games perform what we call a &quot;time-based animation&quot;. For this, we need an accurate timer that will tell us the elapsed time between each animation frame.

Depending on this time, we can compute the distances that must be achieved by each object on the screen in order to move at a constant speed (for a human eye), independently of the CPU or GPU of the computer or mobile device that is running the game.

The timeStamp parameter of the animationLoop function (*line 1* in the above code) is useful for exactly that: it gives a high resolution time. By measuring deltas between two consecutive calls of the animationLoop, we will know exactly, with a sub-millisecond accuracy, the elapsed time between two frames.

Using time-based animation, and more generally, using the canvas element for writing HTML5 games, is part of the W3Cx HTML5 Apps and Games course.

Current [support](https://caniuse.com/requestanimationframe) is really good and all modern browsers support this API.

### 4.3.1 Events: Input and Output

In JavaScript, we treat events made by users as an input, and we manipulate the DOM structure as an output. Most of the time in games/animations, we will change state variables of moving objects, such as position or speed of an alien ship, and the animation loop will take care of these variables to move the objects.

The events are called *DOM events*, and we use the *DOM JavaScript API* to create *event handlers*.

### There are three ways to manage events in the DOM structure

#### First method: declare event handlers in the HTML code

You will often find this in examples on the Web:
```
1.  &lt;div id=&quot;someDiv&quot; **onclick=&quot;alert(&apos;clicked!&apos;);&quot;**&gt;
2.      content of the div
3.  &lt;/div&gt;
```

Note: this is not the recommended way to handle events, even if it&apos;s very easy to use. Mixing the &apos;visual layer&apos; (HTML) and the &apos;logic layer&apos; (JavaScript) in one place is ok for small examples (we have used this in some examples in this course) but is not the recommended way for full scale applications where a clean separation is best.

#### Second method: add an event handler to an HTML element in JavaScript

Here is an example:

1.  document.getElementById(&apos;someDiv&apos;).onclick = function(evt) {

2.    alert(&apos;clicked!&apos;);

3.  }

This method is fine, but  you will not be able to attach several listener functions. If you need to do this, the preferred version is the next one.

#### Third method: register a callback to the event listener with the addEventListener method

This is how we do it:
```
1.  document.getElementById(&apos;someDiv&apos;).addEventListener(&apos;click&apos;, function(evt) {
2.      alert(&apos;clicked!&apos;);
3.  }, false);
```

The third parameter is not important for now, just set it to false, or simply do not add a third parameter.

### The DOM event that is passed to the event listener function

When you create an EventListener and attach it to an element,  an event object will be passed as a parameter to your callback, just like this:

1.  element.addEventListener(&apos;click&apos;, function(**event**) {

2.     **// now you can use the event object inside the callback**

3.  }, false);

Depending on the type of event you are listening to, we will use different properties from the event object in order to get useful information like: &quot;what keys have been pressed down?&quot;, &quot;what is the position of the mouse cursor?&quot;, &quot;which mouse button is down?&quot;, etc.

Let&apos;s see next how to deal with the keyboard and the mouse. In the [W3Cx HTML5 Apps and Games](https://www.edx.org/course/html5-apps-and-games) course, we look at additional APIs such as [the gamePad API](https://www.w3.org/TR/gamepad/) for using USB or wireless gamepads/joysticks/game controllers.

### Source code for the knowledge check 4.3.1

[Online example on JS Bin](http://jsbin.com/korele/edit)
```
1.  <!DOCTYPE html>
2.  <html lang="en">
3.  <head>
4.  <meta charset="utf-8">
5.  <title>Click on button</title>
6.  </head>
7.  <body>
8.     <button id="myButton">Click me!</button>
9.  <script>
10.    var button = document.getElementById('myButton');
11.    // Define a click listener on the button
12.    button.addEventListener('click', processClick;**
13. 
14.    // callback
15.    function processClick(event) {
16.       console.log("Button clicked");
17. 
18.       // What is the event parameter?
19.    }
20. </script>
21. </body>
22. </html>
```
### 

<h3 id="4-3-2">4.3.2 Keyboard Interaction, Key Events</h3>

When you listen to keyboard related events (keydown, keyup or keypressed), the event parameter passed to the listener function will contain the code of the key that fired the event. Then it is possible to test what key has been pressed or released, like this:
```
1.  window.addEventListener(&apos;keydown&apos;, function(event) {
2.     if (**event.keyCode === 37**) {
3.       //left arrow was pressed
4.     }
5.  }, false);
```
At *line 2*, the value &quot;37&quot; is the key code that corresponds to the left arrow. It might be difficult to know the correspondences between real keyboard keys and codes, so here are handy pointers:

-   Try key codes with this [interactive test page](http://www.asquare.net/javascript/tests/KeyCode.html)

-   And find a list of keyCodes in this [CSS Tricks article](https://css-tricks.com/snippets/javascript/javascript-keycodes/#keycode-values))

### Examples

#### Example #1: adding a key listener to the window object

A lot of people think that the canvas element is not able to get key events. Many examples on the Web handle key events on canvas by adding a listener to the window object directly, like this:

![](./images/image193.png){width="6.5in" height="2.05625in"}

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Adding a key listener to the window object - Example #1&lt;/title&gt;

&lt;style&gt;

#myCanvas {

border: 1px solid black;

}

&lt;/style&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;p&gt;

This example shows how to handle key events in a canvas by adding a key listener to the window object. Like that, all key press in the document will trigger the event listener function.&lt;/p&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;350&quot; height=&quot;200&quot;&gt;

&lt;/canvas&gt;

&lt;script&gt;

var canvas;

function init() {

// This will work when you press a key, anywhere on the document

window.addEventListener(&apos;keydown&apos;, handleKeydown, false);

}

function handleKeydown(e){

alert(&apos;keycode: &apos;+e.keyCode);

return false;

};

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Code source extract:

1.  &lt;canvas id=&quot;myCanvas&quot; width=&quot;350&quot; height=&quot;200&quot;&gt;

2.  &lt;/canvas&gt;

3.   

4.  &lt;script&gt;

5.  

6.  function init() {

7.      **// This will work when you press a key, anywhere on the document**

8.      **window.addEventListener(&apos;keydown&apos;, handleKeydown, false);**

9.  }

10.  

11.  

12. function handleKeydown(e){

13.     alert(&apos;keycode: &apos;+e.keyCode);

14.     return false;

15. };

16. &lt;/script&gt;

Indeed this solution works well if you write a game, and want to detect events wherever the mouse cursor is, and without worrying about what HTML element has the focus, etc\...

#### Example #2: moving the monster with the keyboard

![](./images/image194.png){width="6.5in" height="2.0770833333333334in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Moving the monster with the keyboard - Example #2&lt;/title&gt;

&lt;style type=&quot;text/css&quot;&gt;

canvas {

border:1px solid black;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;

Your browser does not support the canvas tag.

&lt;/canvas&gt;

&lt;p&gt;

&lt;script&gt;

var canvas, ctx;

var monsterX=100, monsterY=100, monsterAngle=0;

var incrementX = 0;

function init() {

// This function is called after the page is loaded

// 1 - Get the canvas

canvas = document.getElementById(&apos;myCanvas&apos;);

// 2 - Get the context

ctx=canvas.getContext(&apos;2d&apos;);

// 3 add key listeners to the window element

window.addEventListener(&apos;keydown&apos;, handleKeydown, false);

window.addEventListener(&apos;keyup&apos;, handleKeyup, false);

// 4 - start the animation

requestId = requestAnimationFrame(animationLoop);

}

function handleKeydown(evt) {

if (evt.keyCode === 37) {

//left key

incrementX = -1;

} else if (evt.keyCode === 39) {

// right key

incrementX = 1;

}

}

function handleKeyup(evt) {

incrementX = 0;

}

function animationLoop() {

// 1 - Clear

ctx.clearRect(0, 0, canvas.width, canvas.height);

// 2 Draw

drawMonster(monsterX, monsterY, monsterAngle, &apos;green&apos;, &apos;yellow&apos;);

// 3 Move

monsterX += incrementX;

// call again mainloop after 16.6 ms (60 frames/s)

requestId = requestAnimationFrame(animationLoop);

}

function drawMonster(x, y, angle, headColor, eyeColor) {

// GOOD PRACTICE : SAVE CONTEXT AND RESTORE IT AT THE END

ctx.save();

// Moves the coordinate system so that the monster is drawn

// at position (x, y)

ctx.translate(x, y);

ctx.rotate(angle)

// head

ctx.fillStyle=headColor;

ctx.fillRect(0,0,200,200);

// eyes

ctx.fillStyle=&apos;red&apos;;

ctx.fillRect(35,30,20,20);

ctx.fillRect(140,30,20,20);

// interior of eye

ctx.fillStyle=eyeColor;

ctx.fillRect(43,37,10,10);

ctx.fillRect(143,37,10,10);

// Nose

ctx.fillStyle=&apos;black&apos;;

ctx.fillRect(90,70,20,80);

// Mouth

ctx.fillStyle=&apos;purple&apos;;

ctx.fillRect(60,165,80,20);

// GOOD PRACTICE !

ctx.restore();

}

function start() {

// Start the animation loop, targets 60 frames/s

requestId = requestAnimationFrame(animationLoop);

}

function stop() {

if (requestId) {

cancelAnimationFrame(requestId);

}

}

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Code:

1.  &lt;script&gt;

2.  var canvas, ctx;

3.  var** monsterX=100**, monsterY=100, monsterAngle=0;

4.  var** incrementX = 0**;

5.  

6.  function init() {

7.      // This function is called after the page is loaded

8.   

9.      // 1 - Get the canvas

10.     canvas = document.getElementById(&apos;myCanvas&apos;);

11.  

12.     // 2 - Get the context

13.     ctx=canvas.getContext(&apos;2d&apos;);

14.  

15.     **// 3 add key listeners to the window element**

16.     **window.addEventListener(&apos;keydown&apos;, handleKeydown, false);**

17.     **window.addEventListener(&apos;keyup&apos;, handleKeyup, false);**

18. 

19.     // 4 - start the animation

20.     requestId = requestAnimationFrame(animationLoop);

21. }

22. 

23. function** handleKeydown(evt)** {

24.     if (**evt.keyCode === 37**) {

25.        **//left key**

26.        **incrementX = -1;**

27.     } else if (**evt.keyCode === 39**) {

28.        **// right key**

29.        **incrementX = 1;**

30.     }

31. }

32. function** handleKeyup(evt)** {

33.     **incrementX = 0;**

34. }

35. 

36. function animationLoop() {

37.     // 1 - Clear

38.     ctx.clearRect(0, 0, canvas.width, canvas.height);

39.  

40.     // 2 Draw

41.     drawMonster(monsterX, monsterY, monsterAngle, &apos;green&apos;, &apos;yellow&apos;);

42.  

43.     **// 3 Move**

44.     **monsterX += incrementX;**

45.  

46.     // call again mainloop after 16.6 ms (60 frames/s)

47.     requestId = requestAnimationFrame(animationLoop);

48. }

49. &lt;/script&gt;

#### Example #3: what if I want to listen to key events only in my canvas?

If you add a key listener to a canvas element, the problem is that it will get events only when it has the focus. And by default, it will never have the focus!

The tabindex attribute of the canvas element makes it focusable. Without it, it will never get the focus!

The trick is to declare the canvas like this:

1.  &lt;canvas id=&quot;myCanvas&quot; width=&quot;350&quot; **tabindex=&quot;1&quot;** height=&quot;200&quot;&gt;

2.  &lt;/canvas&gt;

And we force the canvas to get the focus with:

1.  canvas=document.getElementById(&apos;myCanvas&apos;);

2.  \...

3.  **canvas.focus();**

Now, if we try an example with the above canvas declaration, we show when an HTML element has the focus: a border is added to it.

![](./images/image195.png){width="6.5in" height="2.0909722222222222in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Listening to key events only in the canvas - Example #3&lt;/title&gt;

&lt;style type=&quot;text/css&quot;&gt;

canvas {

border:1px solid black;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

This example shows how to handle key events in a canvas by adding a key listener to the canvas object (see the blue border around the canvas\... it shows that the canvas has the focus. Try to click outside of the canvas: it will lose the focus).

&lt;p&gt;

If you don&apos;t want a border to appear when you click on the canvas, set its style to outline: none

&lt;/p&gt;

&lt;p&gt;Press a key when the canvas has the focus: an alert will display the keycode of the key you pressed. Problem: if the canvas looses the focus, key press are no more detected\...&lt;/p&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;350&quot; tabindex=&quot;1&quot; height=&quot;200&quot;&gt;

&lt;/canvas&gt;

&lt;script&gt;

var canvas;

function init() {

canvas=document.getElementById(&apos;myCanvas&apos;);

// This will work only if the canvas has the focus

canvas.addEventListener(&apos;keydown&apos;, handleKeydown, false);

// We can set the focus on the canvas like that:

//canvas.focus();

// \... but it will stop working if we click somewhere else

// in the document

}

function handleKeydown(e){

alert(&apos;keycode: &apos;+e.keyCode);

return false;

};

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Note that the line that forces the focus to the canvas is commented by default. Try to click on the canvas, then press a key, then click out of the canvas, then press a key: this time nothing happens!

![a border appears when the canvas has the focus](./images/image196.jpeg){width="4.927083333333333in" height="2.9479166666666665in"}

Extract from the code:

1.  var canvas;

2.  

3.  function init() {

4.       canvas=document.getElementById(&apos;myCanvas&apos;);

5.   

6.       // This will work only if the canvas has the focus

7.       **canvas.addEventListener(&apos;keydown&apos;, handleKeydown, false);**

8.  

9.       **// We can set the focus on the canvas like this:**

10.      **//canvas.focus();**

11. 

12.      // \... but it will stop working if we click somewhere else

13.      // in the document

14. }

15.  

16.  

17. function handleKeydown(e){

18.      alert(&apos;keycode: &apos;+e.keyCode);

19.      return false;

20. };

*Line 10* is useful to initially set the focus on the canvas, but this trick will not work if we click somewhere else in the HTML page.

#### Example #4: a better way: set the focus when the mouse cursor enters the canvas

A better way to manage key events on a canvas is to set the focus when the mouse is over the canvas, and to un-focus it otherwise.

Here is a modified version of the &quot;move monster example&quot; seen earlier. This time, you move the monster with the left and right arrow only when the mouse cursor is over the canvas. We added two mouse event listeners on the canvas: one for the mouseenter event and the other for the mouseout event.

When the mouse enters the canvas we call canvas.focus() to set the focus to the canvas, and when the mouse cursor goes out of the canvas, we call canvas.blur() to unset the focus.

![](./images/image197.png){width="6.5in" height="2.0770833333333334in"}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Setting the focus when the mouse cursor enters the canvas - Example #4&lt;/title&gt;

&lt;style type=&quot;text/css&quot;&gt;

canvas {

border:1px solid black;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body onload=&quot;init();&quot;&gt;

&lt;canvas id=&quot;myCanvas&quot; tabindex=&quot;1&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;

Your browser does not support the canvas tag.

&lt;/canvas&gt;

&lt;p&gt;

&lt;script&gt;

var canvas, ctx;

var monsterX=100, monsterY=100, monsterAngle=0;

var incrementX = 0;

function init() {

// This function is called after the page is loaded

// 1 - Get the canvas

canvas = document.getElementById(&apos;myCanvas&apos;);

// 2 - Get the context

ctx=canvas.getContext(&apos;2d&apos;);

// 3 add key listeners to the window element

canvas.addEventListener(&apos;keydown&apos;, handleKeydown, false);

canvas.addEventListener(&apos;keyup&apos;, handleKeyup, false);

canvas.addEventListener(&apos;mouseenter&apos;, setFocus, false);

canvas.addEventListener(&apos;mouseout&apos;, unsetFocus, false);

// 4 - start the animation

requestId = requestAnimationFrame(animationLoop);

}

function setFocus(evt) {

canvas.focus();

};

function unsetFocus(evt) {

canvas.blur();

incrementX = 0; // I added this line

};

function handleKeydown(evt) {

if (evt.keyCode === 37) {

//left key

incrementX = -1;

} else if (evt.keyCode === 39) {

// right key

incrementX = 1;

}

}

function handleKeyup(evt) {

incrementX = 0;

}

function animationLoop() {

// 1 - Clear

ctx.clearRect(0, 0, canvas.width, canvas.height);

// 2 Draw

drawMonster(monsterX, monsterY, monsterAngle, &apos;green&apos;, &apos;yellow&apos;);

// 3 Move

monsterX += incrementX;

// call again mainloop after 16.6 ms (60 frames/s)

requestId = requestAnimationFrame(animationLoop);

}

function drawMonster(x, y, angle, headColor, eyeColor) {

// GOOD PRACTICE : SAVE CONTEXT AND RESTORE IT AT THE END

ctx.save();

// Moves the coordinate system so that the monster is drawn

// at position (x, y)

ctx.translate(x, y);

ctx.rotate(angle)

// head

ctx.fillStyle=headColor;

ctx.fillRect(0,0,200,200);

// eyes

ctx.fillStyle=&apos;red&apos;;

ctx.fillRect(35,30,20,20);

ctx.fillRect(140,30,20,20);

// interior of eye

ctx.fillStyle=eyeColor;

ctx.fillRect(43,37,10,10);

ctx.fillRect(143,37,10,10);

// Nose

ctx.fillStyle=&apos;black&apos;;

ctx.fillRect(90,70,20,80);

// Mouth

ctx.fillStyle=&apos;purple&apos;;

ctx.fillRect(60,165,80,20);

// GOOD PRACTICE !

ctx.restore();

}

function start() {

// Start the animation loop, targets 60 frames/s

requestId = requestAnimationFrame(animationLoop);

}

function stop() {

if (requestId) {

cancelAnimationFrame(requestId);

}

}

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;

Code:

1.  function init() {

2.     // This function is called after the page is loaded

3.     // 1 - Get the canvas

4.     canvas = document.getElementById(&apos;myCanvas&apos;);

5.     // 2 - Get the context

6.     ctx=canvas.getContext(&apos;2d&apos;);

7.  

8.     // 3 - Add key listeners to the window element

9.     canvas.addEventListener(&apos;keydown&apos;, handleKeydown, false);

10.    canvas.addEventListener(&apos;keyup&apos;, handleKeyup, false);

11. 

12.    canvas.addEventListener(&apos;mouseenter&apos;, setFocus, false);

13.    canvas.addEventListener(&apos;mouseout&apos;, unsetFocus, false);

14. 

15.    // 4 - Start the animation

16.    requestId = requestAnimationFrame(animationLoop);

17. }

18. 

19. function setFocus(evt) {

20.     canvas.focus();

21. };

22. 

23. 

24. function unsetFocus(evt) {

25.    canvas.blur();

26.    incrementX = 0; // stop the monster if the mouse exists the canvas

27. };

The third parameter (false) of *lines 12* and *13* means &quot;we do not want to propagate the event to the ancestors of the canvas in the DOM.&quot; 

### 4.3.3 Mouse Interaction, Mouse Events

Detecting mouse events in a canvas is quite straightforward: you add an event listener to the canvas, and the browser invokes that listener when the event occurs.

The example below is about listening to mouseup and mousedown events (when a user presses or releases any mouse button):

1.  canvas.addEventListener(&apos;mousedown&apos;, function (evt) {

2.  // do something with to the mousedown event

3.  });

The event received by the listener function will be used for getting the button number or the coordinates of the mouse cursor. Before looking at different examples, let&apos;s look at the different event types we can listen to.

### The different mouse events

![Mouse events illustrated](./images/image198.png){width="3.6145833333333335in" height="2.6354166666666665in"}

We saw in the last example how to detect the mouseenter and mouseout events.

There are other events related to the mouse:

-   mouseleave: similar to mouseout, fired when the mouse leaves the surface of the element. The difference between mouseleave and mouseout is that mouseleave does not fire when the cursor moves over descendant elements, and mouseout is fired when the element moved is outside of the bounds of the original element or is a child of the original element.

-   mouseover: the mouse cursor is moving over the element that listens to that event. A mouseover event occurs on an element when you are over it - *coming from either its child OR parent element*, but a mouseenter event only occurs when the mouse *moves from the parent element to the child element*.

-   mousedown: fired when a mouse button is pressed.

-   mouseup: fired when a mouse button is released.

-   mouseclick: fired after a mousedown and a mouseup have occured.

-   mousemove: fired while the mouse moves over the element. Each time the mouse moves, a new event is fired, unlike with mouseover or mouseenter, where only one event is fired.

### The tricky part: accurately getting the mouse position relative to the canvas

When you listen to any of the above events, the event object (we call it a &quot;DOM event&quot;), passed to the listener function, has properties that correspond to the mouse coordinates: clientX and clientY.

However, these are what we call &quot;window coordinates&quot;. Instead of being relative to the canvas itself, they are relative to the window (the page).

Most of the time you need to work with the mouse position relative to the canvas, not to the window, so you must convert the coordinates between the window and the canvas. This will take into account the position of the canvas, and the CSS properties that may affect the canvas position (margin, etc.).

Fortunately, there exists a method for getting the position and size of any element in the page: getBoundingClientRect().

Play with the example below that show the problem:

![](./images/image199.png){width="4.0in" height="2.4978882327209098in"}

JS

var canvas, ctx, mousePos, mouseButton;

window.onload = function init() {

canvas = document.getElementById(&apos;myCanvas&apos;);

ctx = canvas.getContext(&apos;2d&apos;);

canvas.addEventListener(&apos;mousemove&apos;, function (evt) {

mousePos = getMousePos(canvas, evt);

var message = &apos;Mouse position: &apos; + mousePos.x + &apos;,&apos; + mousePos.y;

writeMessage(canvas, message);

}, false);

canvas.addEventListener(&apos;mousedown&apos;, function (evt) {

mouseButton = evt.button;

var message = &quot;Mouse button &quot; + evt.button + &quot; down at position: &quot; + mousePos.x + &apos;,&apos; + mousePos.y;

writeMessage(canvas, message);

}, false);

canvas.addEventListener(&apos;mouseup&apos;, function (evt) {

var message = &quot;Mouse up at position: &quot; + mousePos.x + &apos;,&apos; + mousePos.y;

writeMessage(canvas, message);

}, false);

};

function writeMessage(canvas, message) {

ctx.save();

ctx.clearRect(0, 0, canvas.width, canvas.height);

ctx.font = &apos;18pt Calibri&apos;;

ctx.fillStyle = &apos;black&apos;;

ctx.fillText(message, 10, 25);

ctx.restore();

}

function getMousePos(canvas, evt) {

// necessary to take into account CSS boudaries

var rect = canvas.getBoundingClientRect();

return {

x: evt.clientX - rect.left,

y: evt.clientY - rect.top

};

}

CS

canvas {

border:1px solid black

}

HTML

&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;

&lt;meta charset=&quot;utf-8&quot;&gt;

&lt;title&gt;Mouse event - Good code&lt;/title&gt;

&lt;style&gt;

body {

margin: 20px;

padding: 0px;

}

&lt;/style&gt;

&lt;/head&gt;

&lt;body&gt;

This is a canvas:&lt;p&gt;&lt;/p&gt;

&lt;canvas id=&quot;myCanvas&quot; width=&quot;578&quot; height=&quot;200&quot;&gt;&lt;/canvas&gt;

&lt;/body&gt;

&lt;/html&gt;

function getMousePos(canvas, evt) {

   **// necessary to take into account CSS boundaries**

   **var rect = canvas.getBoundingClientRect();**

   return {

      x: evt.clientX **- rect.left,**

      y: evt.clientY **- rect.top**

   };

}

WRONG code:

1.  \...

2.  canvas.addEventListener(&apos;mousemove&apos;, function (evt) {

3.      mousePos = getMousePos(canvas, evt);

4.      var message = &apos;Mouse position: &apos; + mousePos.x + &apos;,&apos; + mousePos.y;

5.      writeMessage(canvas, message);

6.  }, false);

7.   

8.  \...

9.  function getMousePos(canvas, evt) {

10.    // WRONG!!!

11.    return {

12.       x: evt.clientX,

13.       y: evt.clientY

14.    };

15. }

Here is the result, when the mouse is approximately at the top left corner of the canvas:

![bad mouse coords](./images/image200.jpeg){width="6.5in" height="2.1791666666666667in"}

GOOD version of the code:

![](./images/image201.png){width="4.0in" height="2.4978882327209098in"}

function getMousePos(canvas, evt) {

   **// necessary to take into account CSS boundaries**

   **var rect = canvas.getBoundingClientRect();**

   return {

      x: evt.clientX **- rect.left,**

      y: evt.clientY **- rect.top**

   };

}

Result (the cursor is approximately at the top left corner):

![mouse at zero zero](./images/image202.jpeg){width="3.0in" height="1.6956528871391077in"}

### How to display the mouse position, and the mouse button that has been pressed or released

This example uses the previous function for computing the mouse position correctly. It listens to mousemove, mousedown and mouseup events, and shows how to get the mouse button number using the evt.button property.

![](./images/image203.png){width="4.0in" height="2.4978882327209098in"}

![mouse event example](./images/image204.jpeg){width="5.0in" height="1.8146380139982503in"}

Extract from source code:

```
1.  var canvas, ctx, mousePos, mouseButton;
2.   
3.  window.onload = function init() {
4.      canvas = document.getElementById(&apos;myCanvas&apos;);
5.      ctx = canvas.getContext(&apos;2d&apos;);
6.   
7.      **canvas.addEventListener(&apos;mousemove&apos;, function (evt) {**
8.          **mousePos = getMousePos(canvas, evt);**
9.          var message = &apos;Mouse position: &apos; + mousePos.x + &apos;,&apos; + mousePos.y;
10.         writeMessage(canvas, message);
11.     }, false);
12.  
13.     **canvas.addEventListener(&apos;mousedown&apos;, function (evt) {**
14.         **mouseButton = evt.button;**
15.         var message = &quot;Mouse button &quot; + evt.button + &quot; down at position: &quot; + mousePos.x + &apos;,&apos; + mousePos.y;
16.         writeMessage(canvas, message);
17.     }, false);
18.  
19.     **canvas.addEventListener(&apos;mouseup&apos;, function (evt) {**
20.         var message = &quot;Mouse up at position: &quot; + mousePos.x + &apos;,&apos; + mousePos.y;
21.         writeMessage(canvas, message);
22.     }, false);
23. };
24.   
25. function writeMessage(canvas, message) {
26.    ctx.save();
27.    ctx.clearRect(0, 0, canvas.width, canvas.height);
28.    ctx.font = &apos;18pt Calibri&apos;;
29.    ctx.fillStyle = &apos;black&apos;;
30.    ctx.fillText(message, 10, 25);
31.    ctx.restore();
32. }
33.  
34. function getMousePos(canvas, evt) {
35.    // necessary to take into account CSS boudaries
36.    var rect = canvas.getBoundingClientRect();
37.    return {
38.       x: evt.clientX - rect.left,
39.       y: evt.clientY - rect.top
40.    };
41. }
```

<h4>More examples</h4>

<h4>Example #1: move the monster with the mouse, rotate it when a mouse button is pressed</h4>

This example shows an animation at 60 frames/s using requestAnimationFrame, were the monster is drawn at the mouse position, and if a mouse button is pressed, the monster starts rotating around its center. If we release the mouse button, the rotation stops:

![](./images/image205.png){width="4.0in" height="2.56540135608049in"}

Code:

```
var canvas, ctx;
var monsterX=100, monsterY=100, monsterAngle=0;
var incrementX = 0;
var incrementAngle =0;
var mousePos;

function init() {
    ...
    // 3bis - Add mouse listeners
    **canvas.addEventListener(&apos;mousemove&apos;, handleMousemove, false);**
    **canvas.addEventListener(&apos;mousedown&apos;, handleMousedown, false);**
    **canvas.addEventListener(&apos;mouseup&apos;, handleMouseup, false);**
    // 4 - Start the animation
    requestId = requestAnimationFrame(animationLoop);
}
function** handleMousemove**(evt) {
    **// The mousePos will be taken into account in the animationLoop**
    **mousePos = getMousePos(canvas, evt);**
}
function handleMousedown(evt) {
   **// the increment on the angle will be**
   **// taken into account in the animationLoop**
   **incrementAngle = 0.1;**
}
function** handleMouseup(evt)** {
    **incrementAngle = 0;  // stops the rotation**
}
function getMousePos(canvas, evt) {
 ... // same as before
}
...
function animationLoop() {
   // 1 - Clear
   ctx.clearRect(0, 0, canvas.width, canvas.height);
   // 2 - Draw
   drawMonster(monsterX, monsterY, monsterAngle, &apos;green&apos;, &apos;yellow&apos;);
   // 3 - Move
   if(mousePos !== undefined) { // test necessary, maybe the mouse is not yet on canvas
      **monsterX = mousePos.x;**
      **monsterY = mousePos.y;**
      **monsterAngle += incrementAngle;**
   }
   ...
   // call again mainloop after 16.6 ms (60 frames/s)
   requestId = requestAnimationFrame(animationLoop);
}
```

This example shows one very important good practice when doing animation and interaction: if you want to achieve a smooth animation, set the state variables 60 times/s inside the animation loop (lines 45-49), depending on increments you set in event listeners (lines 23-31).

<h4>Example #2: draw in a canvas as if you were using a pencil</h4>

![](./images/image206.png){width="4.0in" height="2.56540135608049in"}

Source code:

```
...
<script>
var canvas, ctx, previousMousePos;
...

function drawLineImmediate(x1, y1, x2, y2) {
    // a line is a path with a single draw order
    // we need to do this in this example otherwise
    // at each mouse event we would draw the whole path
    // from the beginning. Remember that lines
    // normally are only usable in path mode
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
}
function handleMouseMove(evt) {
     var mousePos = getMousePos(canvas, evt);
     // Let&apos;s draw some lines that follow the mouse pos
     if (!started) {
         previousMousePos = mousePos; // get the current mouse position
         started = true;
     } else {
         // We need to have two consecutive mouse positions before drawing a line
         drawLineImmediate(previousMousePos.x, previousMousePos.y,
                           mousePos.x,         mousePos.y);
         previousMousePos = mousePos;
     }
}
 window.onload = function () {
   ...
   started = false;
   canvas.addEventListener(&apos;mousemove&apos;, handleMouseMove, false);
};
</script>
```

We had to define a variable started=false; as we cannot draw any line before the mouse moved (we need at least two consecutive positions). This is done in the test at *line 21*.

#### Example #3: same as example #2 but we draw only when a mouse button is pressed

<!------------------------------------------------------------------------------------------------>
<!----------- 207.  (xxx) ------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image207.png?raw=true"
   alt=""
   width="45%">
&nbsp;
<br/>

We just added mouseup and  mousedown listeners, extract from the source code:

```
1.  function handleMouseMove(evt) {
2.       var mousePos = getMousePos(canvas, evt);
3.   
4.       // Let's draw some lines that follow the mouse pos
5.       if (painting) {
6.           drawLineImmediate(previousMousePos.x, previousMousePos.y,
7.                             mousePos.x,         mousePos.y);
8.           previousMousePos = mousePos;
9.       }
10. }
11. 
12. function clicked(evt) {
13.     previousMousePos = getMousePos(canvas, evt);
14.     painting = true;
15. }
16.  
17. function released(evt) {
18.     painting = false;
19. }
20.  
21.  window.onload = function () {
22.     canvas = document.getElementById(&apos;myCanvas&apos;);
23.     ctx = canvas.getContext(&apos;2d&apos;);
24.     painting = false;
25.  
26.     canvas.addEventListener(&apos;mousemove&apos;, handleMouseMove, false);
27.     canvas.addEventListener(&apos;mousedown&apos;, clicked);
28.     canvas.addEventListener(&apos;mouseup&apos;, released);
29. };
```

<h3>4.3.4 Responsive Canvas</h3>

Resizing a canvas can be tricky if we don&apos;t know a few rules that might not be easily guessed:

-   Changing the width or height property of a canvas in JavaScript erases its content and resets its context,

-   Using percentages (%) in the CSS width and height properties of a canvas *does not change its number of pixels/resolution*[.] Instead, it scales the existing pixels without erasing the content, giving a blurry effect when a canvas becomes larger, for example.

Before looking at how best to handle canvas resizing, let&apos;s see some examples below:

### Examples

#### Example #1: changing the size of a canvas on the fly erases its content!

<!------------------------------------------------------------------------------------------------>
<!----------- 208.  (xxx) ------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image208.png?raw=true"
   alt=" "
   width="45%">
&nbsp;
<br/>

Code:

```
1.  <script>
2.  ...
3.  function resizeCanvas() {
4.       **canvas.width = 300;**
5.  }
6.   
7.  </script>
8.  ...
9.  <button **onclick="resizeCanvas();**">
10.     Click this button to resize the canvas and erase it!
11. </button>
```

<h4>Example #2 : resize a canvas using CSS width and height properties with percentages</h4>

This time we are using a similar example as above, but we removed the button for resizing it, and we set the size of the canvas to 100x100 pixels. Instead of drawing inside, we draw two lines that join the diagonals.

<!------------------------------------------------------------------------------------------------>
<!----------- 209.  (xxx) ------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image209.png?raw=true"
   alt=""
   width="65%">
&nbsp;
<br/>

Then, we added this CSS rule:

<!------------------------------------------------------------------------------------------------>
<!----------- 210. (xxx) ------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image210.png?raw=true"
   alt=" "
   width="45%">
&nbsp;
<br/>

It&apos;s the same example as before, just adding this CSS code:

```
1.  <style>
2.      #myCanvas {
3.         border: 1px solid black;
4.         width:100%
5.      }
6.  </style>
```

And the result shows clearly that the resolution is still the same, only the pixels are bigger!

<b><i>BEST PRACTICE: never use CSS percentages on a canvas width or height!</i></b>

<h4>Example #3: a responsive canvas using a resize listener +  a parent element</h4>

This is the trick to create a really responsive canvas:

1.  Embed it in a &lt;div&gt; or in any parent container,

2.  Use CSS with percentages on the width and the height CSS properties <b>of the parent,</b>

3.  Use a resize listener on the  parent of the canvas,

4.  Change the width and height properties of the canvas [from the JavaScript resize listener function] (content will be erased),

5.  Redraw the content, scaled accordingly to the size of the parent.

Yep, this is not a straightforward process\...

<!------------------------------------------------------------------------------------------------>
<!----------- 211. div and canvas inside; div has css width=100% and height=50% (xxx) ------------>
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image211.jpeg?raw=true"
   alt="DIV and canvas inside: div has css width=100% and height=50%"
   width="65%">
&nbsp;
<br/>

<b>HTML code:</b>

```
1.  <div id="parentDiv">
2.      <canvas id="myCanvas" width="100" height="100" ></canvas>
3.  </div>
```

<b>CSS code:</b>

```
1.  <style>
2.      #parentDiv {
3.          width:100%;
4.          height:50%;
5.          margin-right: 10px;
6.          border: 1px solid red;
7.      }
8.   
9.      canvas {
10.        border: 2px solid black;
11.     }
12. </style>
```

<b>JavaScript code for the resize event listener:</b>

```
1.  function init() {
2.     ...
3.     // IMPORTANT: there is NO WAY to listen to a DIV's resize
4.     // listen to the window instead.
5.     window.addEventListener('resize',     
6.                              resizeCanvasAccordingToParentSize, false);
7.     ...
8.  }
9.   
10. function resizeCanvasAccordingToParentSize() {
11.      // adjust canvas size, take parent's size, this erases content
12.      canvas.width = divcanvas.clientWidth;
13.      canvas.height = divcanvas.clientHeight;
14.      ...
15.      // draw something, taking into account the new canvas size
16. }
```

See the complete example that corresponds to the above code:

<!------------------------------------------------------------------------------------------------>
<!------------------------------------- 212.  (xxx) -------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image212.png?raw=true"
   alt=" "
   width="55%" />
&nbsp;
<br/>

<h4>Example #4: the same example with the monster</h4>

<!------------------------------------------------------------------------------------------------>
<!------------------------------------- 213. (xxx) -------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image213.png?raw=true"
   alt=" "
   width="55%" />
&nbsp;
<br/>

When the canvas is resized, its width became smaller than the monster&apos;s size. We **scale** down the monster (using ctx.scale!)

The code is very similar to the previous example, we just replaced drawDiagonals() by drawMonster(\...), and we added a test in the drawMonster(\...) function for scaling the monster if it&apos;s bigger than the canvas width (look at *lines 10-16*), this is a common trick:

```
1.  function drawMonster(x, y, angle, headColor, eyeColor) {
2.       // GOOD PRACTICE: SAVE CONTEXT AND RESTORE IT AT THE END
3.       ctx.save();
4.  
5.       // Moves the coordinate system so that the monster is drawn
6.       // at position (x, y)
7.       ctx.translate(x, y);
8.       ctx.rotate(angle);
9.  
10.      // Adjust the scale of the monster (200x200) if the canvas
11.      // is too small
12.      if(canvas.width < 200) {
13.          var scaleX = canvas.width/200;
14.          var scaleY = scaleX;
15.      }
16.      ctx.scale(scaleX, scaleY);
17. 
18.      // head
19.      ctx.fillStyle=headColor;
20.      ctx.fillRect(0,0,200,200);
21.      ...
22. }
```

<h3>4.3.5 Advanced Canvas</h3>

The canvas API is a &quot;big beast&quot;, and we have presented all the essential techniques for drawing and animating. However, we could not fit everything in this course. Exotic features that are rarely used by developers, or advanced techniques that require more than 20 lines of JavaScript, have been put aside for [the W3Cx HTML5 Apps and Games course](https://www.edx.org/course/html5-apps-and-games).

In that course, you will learn:

<ul>
<li>Techniques useful for writing HTML5 games**: time-based animation, advanced user interactions (detecting multiple keys plus mouse plus gamepad plus touch events all at the same time in a single version of the code), sprite based animation, collision detection, particle animation;</li><br/>
<li>Pixel-level operations:** special FX like blue-screen videos and augmented reality;</li><br/>
<li>And many other things, such as**: masking/clipping, stacking canvases in layers, composition modes, saving and restoring canvas contents, saving canvas content to disk client-side, drawing a canvas into a canvas, etc.</li><br/>
</ul>

<h4>Examples studied in the HTML5 Apps and Games course</h4>

<ul>
<li>Small game framework / object oriented JavaScript / advanced event handling / collision detection / time based animation** - see [example online](https://jsbin.com/jifutoj/1/edit?html,js,console,output).</li>
<li>Sprite based animation**: like this [one](https://jsbin.com/libakum/1/edit?html,js,console,output) (this is ugly code to demonstrate the principle - in the course we develop a clean, sprite animation framework). Use the arrow keys after clicking in the canvas. It&apos;s better to try in standalone mode (click on the small black arrow in the top right of the JSBin window).</li><br/>
</ul>

<!------------------------------------------------------------------------------------------------>
<!------------------------------------- 214. sprite sheet (xxx) -------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image214.png?raw=true"
   alt="Sprite sheet"
   width="35%" />
&nbsp;
<br/>

<h3>5.1.1 Video Intro - Module 5</h3>

Congratulations! You made it to module 5.

Welcome this time to the wonderful world of HTML5 forms.

There have been no improvements since 1997 to HTML forms.

HTML5 this time comes with a set of new input fields for entering dates, colors, entering phone numbers, URLs, and so on.

New attributes related to form validation have also been introduced, and they are related to a new build-in validation system that make things easier than before without the need to use JavaScript.

However, JavaScript validation API is also available for people who would like to write their own customized validation system.

These additions are very handy when used on mobile devices but raised many critics from Web designers, mainly related to their desktop implementations.

The course discusses all the cases and recommend solutions and good practices. Of course, like usual, many examples will be provided that you can run directly this time in the course pages, but also as standalone examples hosted on the JS Bin Web site. If you try to modify them or creates your own examples, please share in the discussion forums as usual. Have fun!

<h3>5.2.1 Introduction</h3>

With HTML5, forms, which had shown little improvement since 1997, evolved considerably.  To achieve this, Web developers relied on many popular JavaScript frameworks for validating input formats, providing various input GUIs, such as calendars for dates, sliders, etc. Frameworks such as jQueryUI, Dojo, and Sencha, all provide a widget set for improving forms. Furthermore, it was time to take into account the specifics of mobile web applications, where the GUI of a date chooser cannot be the same as a 400x400 pixel wide calendar on a desktop. Contextual virtual keyboards provided the way forward on smartphones and tablets thanks to Apple, Google and others.

HTML5 took all this into account and thus provides:
<ul>
<li>A set of input fields that include a validation API and visual feedback, contextualized keyboards, etc. Of course the look and feel depends on the web browser&apos;s implementations, but the HTML5 forms specification introduced 13 new &lt;input type=\.../&gt; fields:  email, tel, color, url, date, datetime, datetime-local, month, week, time, range, number and search.</li><br/>
<li>Built-in validation system: JavaScript API for custom validation, CSS pseudo classes that are useful for changing an input field style depending on the validity of the input.</li><br/>
<li>Other goodies, such as the option to set an input field out of a &lt;form&gt;, new elements such as &lt;datalist&gt; for autocompletion, &lt;output&gt; for feedback, etc.</li><br/>
</ul>

Examples of contextual keyboards are shown above; they differ depending on the type of  &lt;input&gt; fields in the &lt;form&gt;. \
In the examples, we can see: email, URL, and phone number. Look at the different keyboard layouts. The last picture is a date picker from an IOS phone.

<h4>External resources:</h4>

-   From the specification: [Forms](https://html.spec.whatwg.org/multipage/forms.html)

-   From MDN&apos;s Web Docs: [&lt;form&gt;](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form)

<h3>5.2.2 Example</h3>

There is a lot of course content covered this week, and before we get into all the details of the elements and attributes introduced by HTML5, we suggest playing with running examples of full featured forms.

This example was created by a learner (by Mels Le N.) from a previous version of this course.\
It uses the geolocation API presented in Module 6 for auto-filling the address input fields.

Feel free to look at the source code in the [online example](https://jsbin.com/sivula/edit):

<!------------------------------------------------------------------------------------------------>
<!------------------------------------- 215.  (xxx) -------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image215.png?raw=true"
   alt=" "
   width="45%" />
&nbsp;
<br/>

<h3>5.2.3 Input Elements and Attributes</h3>

<h4>Live coding video 1: using input elements as widgets to control a Web application</h4>

&lt;here&gt;

<h4>Live coding video 2: creating GUI elements dynamically</h4>

&lt;and here&gt;

Input elements, in particular the elements introduced by HTML5, can be used as widgets to control the behavior of a Web application. In this situation, they do not need to be inside a &lt;form&gt; element. We just bind event listeners to them and we use them as client-side widgets.

<h4>Examples</h4>

GUI: Graphical User Interface

<h4>Example #1: choose the color, line width and speed of an animation</h4>

-   [Bouncing rectangle without GUI](https://jsbin.com/ciwefo/1/edit?html,css,output)

-   [Bouncing rectangle with GUI](https://jsbin.com/newojij/1/edit?html,css,output) (see screenshot at the top right of this page)

#### Example #2: data visualization control

-   [Simple chart without a GUI](https://jsbin.com/UxuCOPa/3/edit?html,js,output)

-   [Simple chart with a GUI](https://jsbin.com/gesive/edit?html,js,console,output) (see screenshot on the right)

-   [Final version with different types of charts and a GUI](https://jsbin.com/ralonem/1/edit?html,js,output)  (see screenshot below)

<h3>5.2.4 Best Practices</h3>

<h4>Live coding video 3: HTML5 forms - best practices</h4>

&lt;here&gt;

The example used in the video is available [online at JSBin](https://jsbin.com/jagodi/edit?html,css,output). A screenshot of the resulted form is shown on the right.

Forms are a way to get user input which is sent to a remote server. This section of the course focuses on the HTML5 additions to forms, and as such will only cover the client-side part.

On the server side, you may have PHP, Java, C#, Ruby, Python, etc. components. There are several ways to collect server-side data from a form in a Web page: REST Web services, servlets, Microsoft ASP pages, etc.

On the client side, the forms indicate to which server and how the data should be sent,  using the action and method attributes respectively. A &lt;button type=&quot;submit&quot;&gt; or an &lt;input type=submit&gt; field is used to submit the form content.

For example: &lt;form action=&quot;myServerCode.php&quot; method=&quot;POST&quot;&gt;\...&lt;/form&gt;. Here, we set the URL of the server side code (myServerCode.php), and the HTTP method that will be used by the browser for sending the form content (POST).

Another approach is to use JavaScript for sending the form content with [Ajax](https://en.wikipedia.org/wiki/Ajax_(programming)). This is covered in W3Cx HTML5 Apps and Games course.

This week, let&apos;s study the elements and attributes offered by HTML5, as well the HTML5 form validation API. 

The example shown in the video shows some best practices for writing accessible forms and does some basic layout using CSS.

The following additional example shows the same best practices but presents a more complete form with CSS rules to make a nice layout. See it [online](https://jsbin.com/zubitex/1/edit?html,output), and illustrated with the screenshot below. It is adapted from [this very good MDN&apos;s article &quot;How to structure a web form&quot;](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Forms/How_to_structure_an_HTML_form).

<!------------------------------------------------------------------------------------------------>
<!------------------------------------- 212. form layout example -------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image212.jpeg?raw=true"
   alt="Form layout example"
   width="35%" />
&nbsp;
<br/>

<h3 id="ch5-3-1">5.3.1 Accessible Forms</h3>

Forms are commonly used to enable user interaction in Web sites and Web applications. For example, they are used for login, registering, commenting, and purchasing.

Since HTML5 provides functionalities to assist with accessibility, developers should make a concerted effort to mark up Web based forms. The following two guidelines are to give you a good start to make your forms accessible:

1.  For every form field, ensure that a descriptive **label** is provided and use the &lt;label&gt; element to identify each form control.

2.  For larger or complex forms, use the &lt;fieldset&gt; and &lt;legend&gt; elements to respectively **group and associate** related form controls.

Examples for each of these two basic guidelines are given in the following pages.

### Further reading

The WAI Web site hosts a [Forms tutorial](https://www.w3.org/WAI/tutorials/forms/) where to find all guidelines to follow in order to make your forms truly accessible: labeling controls, grouping controls, form instructions, validating input, user notifications, multi-page forms, and custom controls.

### 5.3.2 Why is this Important?

Forms can be visually and cognitively complex and difficult to use. Accessible forms are easier to use for everyone, including people with disabilities.

-   **People with cognitive disabilities** can better understand the form and how to complete it, as making forms accessible improves the layout structure, instructions, and feedback.

-   **People using speech input** can use the labels via voice commands to activate controls and move the focus to the fields that they need to complete.

-   **People with limited dexterity** benefit from large clickable areas that include the labels, especially for smaller controls, such as radio buttons and checkboxes.

-   **People using screen readers** can identify and understand form controls more easily because they are associated with labels, field sets, and other structural elements.

### 5.3.3 Labeling Controls

### Labels need to describe the purpose of the form control

Form fields and other form controls usually have visible labels, such as &quot;E-mail Address:&quot; as the label for a text field (see figure below).

![form label text](./images/image217.png){width="2.5208333333333335in" height="0.3020833333333333in"}

When these labels are marked up correctly, people can interact with them using only the keyboard, using voice input, and using screen readers. Also, the label itself becomes clickable, which enables a person who has difficulty clicking on small radio buttons or checkboxes to click anywhere on the label text.

### Associating labels explicitly

Whenever possible, use the label element to explicitly associate text with form elements. The for attribute of the label must exactly match the id of the form control. 

#### Example #1

Click on the label, not on the input field to see the effect.

Top of Form

First name:![](./images/image218.wmf)

Source code:

Bottom of Form

1.  &lt;label for=&quot;first_name&quot;&gt;Your First Name&lt;/label&gt;

2.  &lt;input id=&quot;first_name&quot; type=&quot;text&quot; name=&quot;fname&quot;/&gt;

#### Example #2

Note that you can also include the &lt;input&gt; element inside the &lt;label&gt;\...&lt;/label&gt; element, and also add a &lt;span lang=&quot;en&quot;&gt; for example, to indicate the language used in the label. Sometimes, [nesting labels and inputs can also make CSS styling easier and produce better results with screen readers](https://developer.mozilla.org/en-US/docs/Learn/Forms/How_to_structure_a_web_form#The_%3Clabel%3E_element).

Source code (with &lt;input&gt; inside the &lt;label&gt;):

1.  **&lt;label for=&quot;first_name&quot;&gt;&lt;span lang=en&quot;&gt;**Your First Name**&lt;/span&gt;**

2.  &lt;input id=&quot;first_name&quot; type=&quot;text&quot; name=&quot;fname&quot;/&gt;

3.  **&lt;/label&gt;**

#### Example #3

Click on the label &quot;Subscribe to newsletter&quot; to see what this does.

Top of Form

First name:![](./images/image218.wmf)\
Subscribe to newsletter![](./images/image219.wmf)

Source code:

Bottom of Form

1.  &lt;label for=&quot;firstname&quot;&gt;First name:&lt;/label&gt;

2.  &lt;input type=&quot;text&quot; name=&quot;firstname&quot; id=&quot;firstname&quot;&gt;&lt;br&gt;

3.  

4.  &lt;label for=&quot;subscribe&quot;&gt;Subscribe to newsletter&lt;/label&gt;

5.  &lt;input type=&quot;checkbox&quot; name=&quot;subscribe&quot; id=&quot;subscribe&quot;&gt;

### Labeling buttons

The label of a &lt;button&gt; element is set inside the element and can include markup. This allows advanced accessibility hints to be included, such as marking up language change. Example: &lt;button&gt;Mon &lt;span lang=&quot;fr&quot;&gt;bouton&lt;/span&gt;&lt;/button&gt;,for a button with a label in French.

When using the &lt;input&gt; element to create buttons, the label is set in the value attribute of the element. Example: &lt;input type=&quot;submit&quot; value=&quot;Please submit&quot;&gt;, renders a button.

Source code for the &quot;Submit&quot; and &quot;Cancel&quot; buttons example:

1.  &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;

2.  &lt;button type=&quot;button&quot;&gt;Cancel&lt;/button&gt;

3.   

4.  &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;

5.  &lt;input type=&quot;button&quot; value=&quot;Cancel&quot;&gt;

These give the same results:

*Lines 1 and 2* render as:\
Submit Cancel\
\
\... while li*nes 3 and 4* render as:\
![](./images/image220.wmf) 

### Labeling text areas

Enter your address:\
![](./images/image221.wmf)

Source code:

1.  &lt;label for=&quot;address&quot;&gt;Enter your address:&lt;/label&gt;&lt;br&gt; &lt;textarea id=&quot;address&quot; name=&quot;addresstext&quot;&gt;&lt;/textarea&gt;

### 5.3.4 Grouping Controls

Groupings of form controls, typically groups of related checkboxes and radio buttons, sometimes require a higher level description. Grouping related form controls makes forms more understandable for all users, as related controls are easier to identify.

### Associating related controls with fieldset

Grouping needs to be carried out visually and in the code, for example, by using the &lt;fieldset&gt; and &lt;legend&gt; elements to associate related form controls. The &lt;fieldset&gt; identifies the entire grouping and &lt;legend&gt; identifies the grouping&apos;s descriptive text.

#### Example #1: radio buttons

In the example below, there are three radio buttons that allow the user to choose an output format. Radio button groups should always be grouped using &lt;fieldset&gt;.

Top of Form

Output format![](./images/image222.wmf)Text file\
\
![](./images/image222.wmf)CSV file\
\
![](./images/image222.wmf)HTML file

Bottom of Form

Source code:

1.  &lt;fieldset&gt;

2.  &lt;legend&gt;Output format&lt;/legend&gt;

3.  &lt;div&gt;

4.  &lt;input type=&quot;radio&quot; name=&quot;format&quot; id=&quot;txt&quot; value=&quot;txt&quot; checked&gt;

5.  &lt;label for=&quot;txt&quot;&gt;Text file&lt;/label&gt;

6.  &lt;/div&gt;

7.  &lt;div&gt;

8.  &lt;input type=&quot;radio&quot; name=&quot;format&quot; id=&quot;csv&quot; value=&quot;csv&quot;&gt;

9.  &lt;label for=&quot;csv&quot;&gt;CSV file&lt;/label&gt;

10. &lt;/div&gt;

11. &lbrack;...&rbrack;

12. &lt;/fieldset&gt;

#### Example #2: checkboxes

In the example below, there are three checkboxes that are all part of an opt-in function for receiving different types of information.

Top of Form

I want to receive

![](./images/image219.wmf)The weekly newsletter

![](./images/image219.wmf)Offers from the company

![](./images/image219.wmf)Offers from associated companies

Bottom of Form

Source code:

1.  &lt;fieldset&gt;

2.  &lt;legend&gt;I want to receive&lt;/legend&gt;

3.  &lt;div&gt;

4.  &lt;input type=&quot;checkbox&quot; name=&quot;newsletter&quot; id=&quot;check_1&quot;&gt;

5.  &lt;label for=&quot;check_1&quot;&gt;The weekly newsletter&lt;/label&gt;

6.  &lt;/div&gt;

7.  &lbrack;...&rbrack;

8.  &lt;/fieldset&gt;

### Associating related controls with WAI-ARIA

WAI-ARIA provides a grouping role that functions similarly to fieldset and legend. For example, a div element can have role=group to indicate that the contained elements are members of a group.

WAI-ARIA roles are very important in the accessibility world, and we invite you to see an example provided in the [associated WAI tutorial](https://www.w3.org/WAI/tutorials/forms/grouping/#associating-related-controls-with-wai-aria). See also this MDN&apos;s article about about [WAI-ARIA roles](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles).

### 5.4.1 Input Types

In this section, we briefly present the input types, attributes, and elements related to the forms that came with HTML5. Details are given later, illustrated by multiple interactive examples.

Compared to HTML4, HTML5 introduced 13 new input types, covering most of the needs of  Web developers. HTML5 packages some of the &quot;form best practices&quot; in its specification. Web browsers providing native implementation give a boost in performance, and reduce the size of JavaScript embedded in complex Web pages.

MDN&apos;s Web docs [article on &lt;input&gt; types](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#%3Cinput%3E_types) lists all input types and highlights those that came with HTML5.

Now, let&apos;s play with some of these input types and attributes.

![HTML4 old HTML5 new](./images/image223.jpeg){width="2.0in" height="1.5972222222222223in"}

### 5.4.2 "color"

For years, we used hundreds of lines of JavaScript for selecting colors. Now, it&apos;s bundled in the browser!

Here is how it looks on some mobile devices:

![HTML5 input type=color on an android phone](./images/image224.jpeg){width="4.0in" height="3.0in"}

### Typical use

Inserting a color chooser is as simple as:

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;&lt;head&gt;\...&lt;/head&gt;

3.  &lt;body&gt;

4.      Choose a color : **&lt;input type=&quot;color&quot; value=&quot;#FF00FF&quot;/&gt;**

5.  &lt;/body&gt;

6.  &lt;/html&gt;

*Note*: In this chapter we are simplifying the examples, as we usually embed input elements in a &lt;form&gt;\...&lt;/form&gt;.

Try &lt;input type=&quot;color&quot;&gt; online with this[ JSBin example](https://jsbin.com/cajuzob/1/edit?html,output). Or do it here in your browser: just click on the purple square below : 

Here is the result on Google Chrome (works with other browsers too, though the *look and feel* may differ):

![input type=color in google chrome](./images/image225.jpeg){width="4.0in" height="3.2051695100612423in"}

#### Example: changing the background color of the page

The &lt;input type=&quot;color&quot;&gt; can fire change or input events. Here is an example that changes the background color of the page when a color is chosen. [Try it online at JSBin](https://jsbin.com/jozuter/1/edit?html,css,js,console,output).

![change background color of the body](./images/image226.jpeg){width="4.0in" height="3.6217300962379704in"}

Source code:

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;/head&gt;

3.  &lt;body&gt;

4.    Select a color : &lt;input type=&quot;color&quot; id=&quot;colorChooser&quot;/&gt;

5.    &lt;script&gt;

6.       var colorInputField = document.querySelector(&quot;#colorChooser&quot;);

7.  

8.       **colorInputField.addEventListener(&apos;input&apos;, function(evt) {**

9.  **          document.body.style.backgroundColor = this.value;**

10. **      }, false);**

11. **&lt;/script&gt;**

12. &lt;/body&gt;

13. &lt;/html&gt;

### Offer a limited choice of colors

By default, the color selector offers many options that may either frighten some users or just not be appropriate for the purpose of the application. 

*Good news*: it is possible to restrict the choices, and also simplify the user interface, by using a &lt;datalist&gt; with some &lt;option&gt; elements inside. 

Example: click the black rectangle on the right:  . The following should be displayed:

![restricted choice of color](./images/image227.jpeg){width="3.0in" height="1.872483595800525in"}

[Online example at JSBin](https://jsbin.com/lahapu/edit?html,output)

Source code extract:

1.  &lt;input type=&quot;color&quot; value=&quot;#333333&quot; **list=&quot;colors&quot;**&gt;

2.  

3.  &lt;datalist **id=&quot;colors&quot;**&gt;

4.       &lt;option&gt;#0000FF&lt;/option&gt;

5.       &lt;option&gt;#00FF00&lt;/option&gt;

6.       &lt;option&gt;#FF0000&lt;/option&gt;

7.  &lt;/datalist&gt;

Note that the id of the &lt;datalist&gt; element should be the same as the value of the list attribute of the input field.

### What are the main problems with this element?

The main criticism that Web designers make about this element is related to its default appearance being strongly dependent on the browser and its underlying operating system. Changing the *look and feel* is not possible, except with the use of the options we saw in the previous sections of this page. This problem is also true for other input elements that renders as complex widgets, like &lt;input type=&quot;date&quot;&gt; and its variants.

Another problem is that there is no way to control where the dialog that contains the color chooser will appear - no positioning via CSS or JavaScript is possible. The specification does not say anything about how to position it over the page, thus the result is vendor specific.

The solution proposed by the W3C and its contributors is called *Web Components*, a new approach for designing HTML5 widgets, that is covered in the W3Cx HTML5 Apps and Games course.

### 5.4.3 "date"

For years, date and time pickers in HTML forms made Web developers rely heavily on JavaScript based widgets. The process is simpler in HTML5, which provides a special control to handle this specific kind of data natively.

Below are a few screenshots of the HTML5 date picker on several mobile devices. Note that the native date pickers of the operating systems are used:

![date picker 1](./images/image228.png){width="2.0in" height="3.0in"}![date picker 2 on mobile](./images/image229.jpeg){width="1.0in" height="1.778261154855643in"}![date picker 3 on mobile](./images/image230.png){width="3.0in" height="1.734491469816273in"}

The problem is different on a desktop. While it&apos;s great to have native support for a date picker, Web developers would sometimes prefer 100% control over the *look and feel* of the date picker widget. For this purpose, the solution undoubtedly lies with the new [Web Components](https://webcomponents.org/) (a way to make custom reusable widgets in HTML/CSS/JS), to be detailed in the W3Cx HTML5 Apps and Games course

Why don&apos;t you try it yourself? Just click on this input field:    

With Firefox, it shows this date picker widget:

![Firefox desktop date picker](./images/image231.png){width="2.0in" height="1.5789468503937008in"}

On non-supported browsers, it defaults to an &lt;input type=&quot;text&quot;&gt; input field.

### Typical use of &lt;input type=&quot;date&quot;&gt;

#### Default use

The default usage is something like:

1.  &lt;label for=&quot;birthday&quot;&gt;Choose birthday party date: &lt;/label&gt;

2.  &lt;input type=&quot;date&quot; id=&quot;birthday&quot;&gt;

Result:             Choose birthday party date:      

Most of the time you will add other attributes to give some restrictions (choose a date in the past, in the future, only on a Saturday, etc.).

#### Restrict choice to an interval of dates: attributes min, max and value

The &lt;input type=&quot;date&quot;&gt; comes with several useful attributes. In particular the value, min and max attributes are used to propose a default date, a min and a max date, or for defining an interval of acceptable values.

Try this example: just click the next input field: , or [try it online on JSBin](https://jsbin.com/faluta/1/edit?html,output) if you want to tweak the source code: 

![input type = date with min and max attributes. This will render two non selectable areas (dates before min and dates after max). Only the dates between min and max are selectable in the displayed calendar.](./images/image232.jpeg){width="4.0in" height="2.2641021434820647in"}

Source code:

1.  \...

2.  &lt;input type=&quot;date&quot;

3.       id=&quot;birthdayParty&quot;

4.       **value=&quot;2015-06-20&quot;**

5.       **min=&quot;2015-06-20&quot;**

6.       **max=&quot;2015-06-30&quot;**&gt;

7.  \...

#### Choosing one day in a given week, etc. with the step: attribute

Using the value attribute for setting a date, and using step=7 for example, will make acceptable only the day of the week that corresponds to the value&apos;s day (e.g.: only Mondays). Using step=2 will make acceptable only every other day, etc.

Example: we want to celebrate birthday parties only on Saturdays, [check this on JSBin](https://jsbin.com/hudafo/1/edit?html,output)! (screenshot from Chrome).

![use of the step attribute, select only saturdays](./images/image233.png){width="4.0in" height="2.1055555555555556in"}

Extract from source code:

1.  &lt;input type=&quot;date&quot;

2.      id=&quot;birthdayParty&quot;

3.      value=&quot;2015-06-20&quot;

4.      min=&quot;2015-06-20&quot;

5.      max=&quot;2015-06-30&quot;

6.      **step=&quot;7&quot;**&gt;

#### Combining with the &lt;datalist&gt; element to restrict the choice of possible values

[Online example at JSBin](https://jsbin.com/gezawe/1/edit?html,output) (screenshot from Chrome).

![restrict choices using a datalist element](./images/image234.jpeg){width="4.0in" height="1.4850426509186352in"}

Extract from source code:

> &lt;input type=&quot;date&quot;
>
>     id=&quot;birthdayParty&quot;
>
>     list=&quot;birthdayPartyPossibleDates&quot;
>
>     value=&quot;2015-06-20&quot;&gt;
>
> &lt;datalist id=&quot;birthdayPartyPossibleDates&quot;&gt;
>
>      &lt;option label=&quot;Best for me&quot;&gt;2015-06-20&lt;/option&gt;
>
>      &lt;option label=&quot;Ok for me too &quot;&gt;2015-06-27&lt;/option&gt;
>
>      &lt;option label=&quot;This one is a sunday, hmmm&quot;&gt;2015-06-28&lt;/option&gt;
>
> &lt;/datalist&gt;

**The list attribute of the input element must match the id attribute of the datalist element.**

**If you use the min, max, or step attributes with a list attribute, it may filter the restricted list even more.** Check [this example on JSBin](https://jsbin.com/gucuxon/1/edit?html,output) (tested with Google Chrome), that has a restricted list of three elements, one of which is filtered because it is not in in the min/max range.

### Responding to date changes, trying date/time and other variants

#### Listening to the input event

Here is [an interactive example at JSBin](https://jsbin.com/ganipuv/edit?html,output) where you can change the type of date/time chooser. It also shows how to listen to the input event when a date/time is chosen.

##### Source code:

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;&lt;head&gt;\...&lt;/head&gt;

3.  &lt;body&gt;

4.  Testing the new date input field.&lt;p&gt;

5.  Choose a date/time : &lt;input type=&quot;date&quot; id=&quot;date&quot; /&gt;&lt;/p&gt;

6.  &lt;p&gt;

7.  You picked: &lt;span id=&quot;pickedDate&quot;&gt;&lt;/span&gt;

8.  &lt;/p&gt;

9.  After you have tried the first example, change the value of the &quot;type&quot; attribute to:

10. &lt;ul&gt;

11. &lt;li&gt;datetime&lt;/li&gt;

12. &lt;li&gt;datetime-local&lt;/li&gt;

13. &lt;li&gt;time&lt;/li&gt;

14. &lt;li&gt;week&lt;/li&gt;

15. &lt;li&gt;month&lt;/li&gt;

16. &lt;/ul&gt;

17. And see the result.

18. &lt;script&gt;

19. var field = document.querySelector(&quot;#date&quot;);

20. var result = document.querySelector(&quot;#pickedDate&quot;);

21. field.oninput = function(evt) {

22. var date = this.value;

23. pickedDate.innerHTML = &quot;&lt;b&gt;&quot;+date+&quot;&lt;/b&gt;&quot;;

24. }

25. &lt;/script&gt;

26. &lt;/body&gt;

27. &lt;/html&gt;

*Lines 20-26* show how we can detect a date change using JavaScript.

#### Checking if the chosen date is in the past or in the future using the valueAsDate property

The object returned to the input event handler has a useful property named valueAsDate. This is a JavaScript date object that can be compared to other JavaScript date objects, in particular to the date of the day we can get with var date = new Date();

[The following example at JSBin](https://jsbin.com/renevaf/edit?html,output) shows how to ascertain whether a date is in the past or in the future: 

![date in the past, it&apos;s ok](./images/image235.jpeg){width="4.0in" height="2.7547003499562557in"}

While if we enter a date in the future:

![date in the future: bad](./images/image236.jpeg){width="3.0in" height="1.482557961504812in"}

Extract from source code:

1.  &lt;body&gt;

2.  &lt;label for=&quot;birthDate&quot;&gt;Enter your birth date: &lt;/label&gt;&lt;p&gt;

3.  **&lt;input type=&quot;date&quot; id=&quot;birthDate&quot; &gt;**

4.  &lt;p&gt;

5.  You picked: &lt;span id=&quot;pickedDate&quot;&gt;&lt;/span&gt;&lt;p&gt;

6.  &lt;span id=&quot;pastFuture&quot;&gt;&lt;/span&gt;

7.  &lt;/p&gt;

8.  &lt;script&gt;

9.  var field = document.querySelector(&quot;#birthDate&quot;);

10. var result = document.querySelector(&quot;#pickedDate&quot;);

11. var pastFuture = document.querySelector(&quot;#pastFuture&quot;);

12. **field.oninput **= function(evt) {

13. **var date = this.value;**

14. pickedDate.innerHTML = &quot;&lt;b&gt;&quot;+date+&quot;&lt;/b&gt;&quot;;

15. **if(date.valueAsDate &lt;= new Date())** {

16. pastFuture.style.color = &apos;green&apos;;

17. pastFuture.innerHTML = &quot;&lt;b&gt;Date in the past, ok!&lt;/b&gt;&quot;

18. } else {

19. pastFuture.style.color = &apos;red&apos;;

20. pastFuture.innerHTML = &quot;&lt;b&gt;Date in the future, you&apos;re not even born!&lt;/b&gt;&quot;

21. }

22. }

23. &lt;/script&gt;

24. &lt;/body&gt;

*Lines 17-23* show how we can compare the date picked in the calendar widget with the current date. Note that we can compare any given dates using JavaScript. To check that the chosen date is before 2000 we would do this:

> if(this.valueAsDate &lt;= new Date(2000,1,1)) {
>
> \...
>
> }
>
> &lt;input type=&quot;datetime&quot;&gt;, &quot;week&quot;, &quot;month&quot;, &quot;datetime-local&quot;, etc.

The HTML5 specification indicates that we can use &lt;input type=&quot;date&quot;&gt; and &lt;input type=&quot;time&quot;&gt; while for some years (before the specification became a frozen standard in October 2014), other variants were also present, such as type=datetime, datetime-local, month and week.

[Here is an interactive example at JSBin](https://jsbin.com/supope/1/edit) where you can change the type of date chooser and try all the different possible values for the type attribute of date pickers.

Some screenshots from Opera desktops and Safari IOS:

&lt;input type=&quot;time&quot;&gt;:

![time](./images/image237.png){width="3.03125in" height="0.4270833333333333in"}

![input type=time safari IOS](./images/image238.png){width="2.0in" height="3.0in"}

&lt;input type=&quot;datetime&quot;&gt;
<!------------------------------------------------------------------------------------------------>
<!--------------- 239.  (xxx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center" width="100%">
<img src="./images/image239.png?raw=true"
   width="20%"
   alt="Screenshot showing on the left the webcam video stream, and on the right the same stream recorded and playable in a HTML video element" />
</p>

<!------------------------------------------------------------------------------------------------>
<!--------------- 240.  (xxx) ------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center" width="100%">
<img src="./images/image240.png?raw=true"
   width="20%"
   alt="Input type=datetime on Safari IOS" />
</p>

```
&lt;input type=&quot;datetime-local&quot;&gt;
![datetime-local example](./images/image241.png){width="2.0in" height="1.8679866579177602in"}
&lt;input type=&quot;week&quot;&gt;:
![week](./images/image242.jpeg){width="4.0in" height="1.2696576990376203in"}
&lt;input type=&quot;month&quot;&gt;:
![month](./images/image243.jpeg){width="4.0in" height="1.4222222222222223in"}
![input type=month safari IOS](./images/image244.png){width="2.0in" height="3.0in"}
```

<h3 id="ch5-4-4">5.4.4 "e-mail", "tel", "URL", and "search"</h3>

Let&apos;s study 4 input types: email&quot;, &quot;tel&quot;, &quot;URL&quot; and &quot;search&quot;.

&lt;input type=&quot;email&quot;&gt;

This input type is relatively straightforward to use. In mobile applications, this new input type pops up a keyboard layout adapted to email input. Note the &quot;@&quot; key, the &quot;.&quot; key, etc.

![contextual mobile keyboard for entering an email address](./images/image245.jpeg){width="2.0in" height="3.0in"}

This input type is very interesting as it provides default validation behaviors:

If the value entered looks like an email address (contains a &quot;@&quot;\...), the field is *valid*, and gets the pseudo CSS class  :valid

If the value entered does not contain an &quot;@&quot;, and does not look like an email address, the field is *invalid* and gets the pseudo CSS class :invalid

See the next example to see this in action. More details will be presented in a later section dedicated to form validation.

Typical use:

[Online example at CodePen](https://codepen.io/w3devcampus/pen/aWXKWR)

![](./images/image246.png){width="3.0in" height="1.9131353893263343in"}

Try it on your browser:                         Enter your email: 

```
1.  <!DOCTYPE html>
2.  <html lang="en">
3.  <head>
4.  <meta charset="utf-8">
5.  <title>Example of input type=email</title>
6.  <style>
7.  input:invalid {
8.  background-color:pink;
9.  }
10. </style>
11. </head>
12. <body>
13. <label for="email">Enter your email </label>
14. <input type="email" id="email">
15. </body>
16. </html>
```

Note the CSS rule that turns the background color of the email input field to pink if a user enters an invalid address (*lines 7-8*). Also note that the validation is based only on matching a regular expression (the address should contain a &quot;@&quot;,  a &quot;.&quot;, etc.). It does not check if the address is an existing one.

&lt;input type=&quot;tel&quot;&gt;

This input field is really useful on smartphones and tablets, as it makes the browser pop up a keyboard layout suitable for entering phone numbers:

![mobile keyboard 1 for input type=tel](./images/image247.png){width="2.0in" height="1.6131386701662291in"}![other mobile keyboard for input type=tel](./images/image248.png){width="2.0in" height="1.4700853018372704in"}

This input type is often used with the new placeholder and pattern attributes that are detailed in another section of this course. It is supported by all recent major Web browsers, on mobile devices and desktops.

[Online example on CodePen](https://codepen.io/w3devcampus/pen/Njozvd)

![](./images/image249.png){width="3.0in" height="1.9131353893263343in"}

Try it in your browser (we used the same CSS for changing the background-color when the input value is invalid):

Enter a telephone number: 

<h4>Source code:</h4>
```
1.  <!DOCTYPE html>
2.  <html lang="en">
3.  <head>
4.  <meta charset=&quot;utf-8&quot;&gt;
5.  <title>Example of input type=tel&lt;/title&gt;
6.  <style&gt;
7.  input:invalid {
8.  background-color:pink;
9.  }
10. </style>
11. </head>
12. <body>
13. <label for="tel">Enter a telephone number:</label&gt;
14. <input type="tel" id="tel"
15. placeholder="(555) 555-5555"
16. pattern="^(?d{3})?[-s]\\d{3}&lbrack;-\\s&rbrack;\\d{4}.\*?\\)&quot;/&gt;
17. </body>
18. </html>
```

&lt;input type=&quot;URL&quot;&gt; 

This input field is really useful on smartphones and tablets, as it makes the browser pop up a keyboard layout suitable for entering URLs:

![mobile keyboard for entering URLs](./images/image250.png){width="2.0in" height="1.6934306649168853in"}

This field is also compatible with *the validation API* (more on this in another section).

Here is an online example that shows the use of the placeholder and pattern attributes for entering only URLs that start with ftp:// or https://

Or try it here in your browser:

Enter a URL (default validation): 

Enter a URL (custom validation, must start with http, https or ftp): 

<h4>Source code:</h4>
```
1.  &lt;!DOCTYPE html&gt;
2.  &lt;html lang=&quot;en&quot;&gt;
3.  &lt;head &gt;
4.  &lt;meta charset=&quot;utf-8&quot;&gt;
5.  &lt;title&gt;Example of input type=url&lt;/title&gt;
6.  &lt;style&gt;
7.  input:invalid {
8.  background-color: lightPink;
9.  }
10. &lt;/style&gt;
11. &lt;/head&gt;
12. &lt;body&gt;
13. &lt;label for=&quot;url1&quot;&gt;Enter a URL (default validation):&lt;/label&gt;
14. &lt;input type=&quot;url&quot; id=&quot;url1&quot;/&gt;
15. &lt;p&gt;
16. &lt;label for=&quot;url2&quot;&gt;Enter a URL (custom validation, must start with http, https or ftp):&lt;/label&gt;
17. &lt;input id=&quot;url2&quot; type=&quot;url&quot; placeholder=&quot;https://www.domain.com&quot;
18. pattern=&quot;(http\|https\|ftp)\\:\\/\\/&lbrack;a-zA-Z0-9\\-\\.\\/&rbrack;\*&quot;/&gt;&lt;p&gt;
19. &lt;/body&gt;
20. &lt;/html&gt;
```

*Lines 16-17* show the use of a pattern attribute with a JavaScript regexp that accepts only URLs starting with http, https or ftp. More details on the pattern attribute are given in the section that presents the new HTML5 form attributes.

&lt;input type=&quot;search&quot;&gt;

The search type is used for search fields (i.e., for a search engine). A search field behaves like a regular text field, except that it may provide some feedback GUI for stopping the current request and emptying the search field, or it may provide a drop-down list of recent search results.

The specification does not state what the GUI should look like, so current implementations show variations in the look and feel.

![input type=search rendered on a smartphone](./images/image251.jpeg){width="4.0in" height="3.0098293963254594in"}

<h4>Typical use:</h4>
```
> &lt;label for=&quot;search1&quot;&gt;Simple search: &lt;/label&gt;
> &lt;input type=search id=&quot;search1&quot;&gt;
> &lt;p&gt;
> &lt;label for=&quot;search2&quot;&gt;Search with attribute &lt;code&gt;results=5&lt;/code&gt; (try with Safari): &lt;/label&gt;
> &lt;input type=search id=&quot;search2&quot; results=5&gt;
```

Results on Chrome and Opera desktop - notice the small cross on the right when one enters a value:

![input type=search in google chrome and opera](./images/image252.jpeg){width="4.0in" height="0.6690912073490813in"}

Same example with Safari desktop, this time the second line with an attribute results=5 shows a small icon on the left:

![input type=search on safari](./images/image253.jpeg){width="4.0in" height="1.0114063867016623in"}

Example that shows a drop down list of recent searches (Safari screenshot borrowed from [this excellent site about HTML5 forms that is worth reading](https://www.wufoo.com/html5/types/5-search.html)):

![example 2 of input type=search on safari, shows recent results](./images/image254.png){width="2.0in" height="2.62711832895888in"}

Source code for the knowledge check below
```
1.  &lt;!DOCTYPE html&gt;
2.  &lt;html&gt;
3.  &lt;head&gt;
4.  &lt;meta charset=&quot;utf-8&quot;&gt;
5.  &lt;title&gt;Example of input type=email&lt;/title&gt;
6.  &lt;style&gt;
7.  input:? {
8.  background-color:pink;
9.  }
10. input:?? {
11. background-color:lightGreen;
12. }
13. &lt;/style&gt;
14. &lt;/head&gt;
15. &lt;body&gt;
16. &lt;label for=&quot;email&quot;&gt;Enter your email:&lt;/label&gt;
17. &lt;input type=&quot;email&quot; id=&quot;email&quot;&gt;
18. &lt;/body&gt;
19. &lt;/html&gt;
```

<h3 id="ch5-4-5">5.4.5 "number"</h3>

This input field is useful for entering numerical values (integer or float), but not for entering zip codes. On desktop implementations and on some mobile implementations, it provides a user interface with small vertical arrows for incrementing/decrementing the current value, while on mobiles it will display a numeric keyboard.

For zip codes, a &lt;input type=&quot;text&quot; pattern=&quot;\...\...&quot;&gt; is preferable. See examples given in the pattern attribute section of this course.

Example: **&lt;input type=&quot;number&quot; value=&quot;25&quot; min=&quot;0&quot; step=&quot;5&quot; max=&quot;500&quot;/&gt;**

Screenshot example taken with a mobile device :

![numeric keyboard on safari IOS](./images/image255.png){width="2.0in" height="1.3413659230096238in"}

Examples on desktop (the width will be adjusted depending on the min and max attributes):

![input type=number example](./images/image256.jpeg){width="3.25in" height="0.4791666666666667in"}

Typical usage

&lt;input type=&quot;number&quot; value=&quot;25&quot; min=&quot;0&quot; step=&quot;5&quot; max=&quot;500&quot;/&gt;

This field accepts specific attributes max, min, step, value (default displayed value). 

This input type is very interesting as it provides default validation behaviors:

If the value entered using a keyboard is not a valid number, or is not in the range defined by the min and max attributes, the field is *invalid* and gets the pseudo CSS class :invalid.

If the difference between the value you enter and min is a multiple of step, then it gets the CSS pseudo class :valid , otherwise it will be *invalid*. Example: if min=1 and step=5, the field will be valid with value=1, 6, 11, 16 etc. if min=0, with value=0, 5, 10, 15 etc.

**WARNING 1**: **Using a step attribute with an integer value will make the arrows increment/decrement the current value with the step value, and [make the input field valid only when ]the difference between the value you enter and min is a multiple of step. **

**WARNING 2: by default, omitting the step attribute is equivalent to step=&quot;1&quot;, [so for entering float values, it is necessary to use step=&quot;any&quot; or step equal to a floating point value such as step=&quot;0.1&quot;].**\
\
**With step=&quot;any&quot;, floating point values are valid, but vertical arrows will increment/decrement the value by one. If step=&quot;0.1&quot;, arrows will increment/decrement by 0.1, etc.**

[Online example in CodePen](https://codepen.io/w3devcampus/pen/GJrQzP):  (try changing the attribute values, use step=&quot;any&quot; and try float values, etc).

![](./images/image257.png){width="4.0in" height="2.550847550306212in"}

Or, do it here in your browser (Manually enter a value that is not in the range, or not a multiple of 5, try the up and down arrows, etc.):

Quantity (between 0 and 500, should be a multiple of 5 otherwise it&apos;s invalid): 

<h4>Source code:</h4>
```
1.  &lt;!DOCTYPE html&gt;
2.  \....
3.  &lt;style&gt;
4.  #number:invalid {
5.  background-color:pink;
6.  **}**
7.  #number:valid {
8.  background-color:lightGreen;
9.  **}**
10. </style>
11. </head>
12. <body>
13. Example of <code><input type=number></code>:<p>
14. <label for="number">Quantity (between 0 and 500, should be a multiple of 5 otherwise it&apos;s invalid): &lt;/label&gt;
15. <input type=&quot;number&quot; id=&quot;number&quot; value=&quot;25&quot; min=&quot;0&quot; step=&quot;5&quot; max=&quot;500&quot;/&gt;
16. <p&gt;
17. Change the different values for attributes step, max, min, value. Don&apos;t forget to try step=&quot;any&quot; for float values\...
18. </body&gt;
19. </html&gt;
```

<h3 id="ch5-4-6">5.4.6 "range"</h3>

![zipper with funny label input type=range](./images/image258.jpeg){width="5.0in" height="1.498931539807524in"}

This input type renders as a slider. It accepts the same attributes as the &lt;input type=&quot;number&quot;&gt; : min, max, step and value.

Example of rendering on a desktop:

![input type=range](./images/image259.jpeg){width="3.0in" height="0.8983048993875765in"}

And on mobile devices:

![ios range input](./images/image260.png){width="2.0in" height="3.0in"}![input type=range android](./images/image261.jpeg){width="2.0in" height="3.5555555555555554in"}

<h4>Typical use</h4>

The basic use is to specify at least the value, min and max attributes, and eventually the step attribute, too:

&lt;input id=&quot;slider6&quot; type=&quot;range&quot; min=&quot;0&quot; max=&quot;10&quot; step=&quot;2&quot; value=&quot;5&quot;&gt;

But most of the time, you will need a visual feedback that shows the current value selected by the slider.

[This online example on CodePen](https://codepen.io/w3devcampus/pen/BRMVGW) shows how to add a visual feedback using a very short JavaScript function and an &lt;output&gt; element. Just click and drag the small cursor of the slider (or use up and down arrow keys when the field has the focus):

![](./images/image262.png){width="5.0in" height="3.1885586176727907in"}

<h4>Source code:</h4>
```
1.  &lt;!DOCTYPE html&gt;
2.  &lt;html lang=&quot;en&quot;&gt;
3.  &lt;head&gt;
4.  &lt;meta charset=&quot;utf-8&quot;&gt;
5.  &lt;title&gt;Example of input type=tel&lt;/title&gt;
6.  &lt;style&gt;
7.  #rangeValue1 {
8.  border:1px solid black;
9.  padding:2px;
10. }
11. &lt;/style&gt;
12. &lt;script&gt;
13. window.onload = function() {
14. // Called when the page is loaded, for displaying initial value in the output
15. printValue(&apos;slider1&apos;,&apos;rangeValue1&apos;);
16. }
17. function printValue(sliderId, outputId) {
18. var x = document.getElementById(outputId);
19. var y = document.getElementById(sliderId);
20. x.value = y.value;
21. }
22. &lt;/script&gt;
23. &lt;/head&gt;
24. &lt;body&gt;
25. &lt;form &gt;
26. &lt;label for=&quot;slider1&quot;&gt;Select a value:&lt;/label&gt;
27. &lt;input id=&quot;slider1&quot; type=&quot;range&quot;
28. min=&quot;100&quot; max=&quot;500&quot; step=&quot;10&quot; value=&quot;150&quot;
29. oninput=&quot;printValue(&apos;slider1&apos;,&apos;rangeValue1&apos;)&quot;/&gt;
30. &lt;output id=&quot;rangeValue1&quot;&gt;&lt;/output&gt;
31. &lt;/form&gt;
32. &lt;br/&gt;
33. Play with attributes: value, min, max, step\...
34. &lt;/body&gt;
35. &lt;/html&gt;
```

<h4>Snapping behavior and the step attribute</h4>

![jumps + steps](./images/image263.jpeg){width="3.1041666666666665in" height="1.4791666666666667in"}

When you click and drag the slider, it &quot;jumps&quot; to some snap points corresponding to the integer values of the range defined by the min and max attributes. The &quot;size of the jumps&quot; depends on the value of the step attribute.

Try these examples in your browser and look at their behavior:

value=5 min=0, max=10 step=1:  

value=12 min=10, max=50 step=4:  

Note that in the previous example, the default value displayed is 14, not 12 (the value just above min plus an integer step value). 12 is not possible so it&apos;s been &quot;snapped&quot; to 14.

value=5 min=0, max=10 step=&quot;0.5&quot;:  

In the previous example, it&apos;s necessary to add quotes for setting step=&quot;0.5&quot; (while HTML5 authorizes not using quotes for setting integer values to attributes).

value=5 min=0, max=10 step=&quot;any&quot;:  

**WARNING**: Using a step attribute with an integer value will make the slider jump corresponding to the step value. By default, omitting the step attribute is equivalent to step=&quot;1&quot;.\
So, for accepting float values, it is necessary to use step=&quot;any&quot;, or step equal to a floating point value, such as step=&quot;0.5&quot;.

Adding &quot;ticks&quot; to the range slider using a &lt;datalist&gt; element

![complicated ticks on a rule](./images/image264.jpeg){width="4.416666666666667in" height="1.375in"}

Using the &lt;datalist&gt; element, it&apos;s possible to display &quot;ticks&quot; above the range slider, at given positions.
```
1.  &lt;label for=&quot;slider2&quot;&gt;value=5 min=0, max=10 step=1, ticks at 2, 4, 6, 8 and 10:&lt;/label&gt;
2.  &lt;input id=&quot;slider2&quot; type=&quot;range&quot;
3.  list=&quot;ticks2&quot;
4.  min=&quot;0&quot; max=&quot;10&quot; step=&quot;1&quot; value=&quot;5&quot;/&gt;
5.  &lt;datalist id=ticks2&gt;
6.  &lt;option&gt;0&lt;/option&gt;
7.  &lt;option&gt;2&lt;/option&gt;
8.  &lt;option&gt;4&lt;/option&gt;
9.  &lt;option&gt;6&lt;/option&gt;
10. &lt;option&gt;8&lt;/option&gt;
11. &lt;option&gt;10&lt;/option&gt;
12. &lt;/datalist&gt;
```

<h4>Try the sliders below:</h4>

value=5 min=0, max=10 step=1, ticks at 2, 4, 6, 8 and 10:  

value=20 min=10, max=50 step=5, ticks at 0, 10, 20, 30, 40 and 50:  

value=5 min=0, max=10 step=&quot;0.5&quot;, ticks at 0, 0.5, 1, 2, 4, 8:  

value=5 min=0, max=10 step=&quot;any&quot;, ticks at 0, 5 and 10:  

<h4>External resources</h4>

-   You can use CSS for &quot;standard&quot; styling (size, color, background color, etc.) . However, some custom attributes are available. Check [this article from CSS tricks](https://css-tricks.com/styling-cross-browser-compatible-range-inputs-css/).

-   A script that automatically generates ticks, depending on the min, max and step attributes (Codepen from Dudley Storey): [Auto-Generated HTML5 range input Ticks](https://codepen.io/dudleystorey/pen/Klnzy)

-   From CSS{Portal}, a CSS generator help you style the html input range tag, very easy to use: [Style Input Range](https://www.cssportal.com/style-input-range/)

+----------------------------------------------------------------------------------+---------------------------------------+
| ### **HTML4**                                                                    | ### **HTML5**                         |
+==================================================================================+=======================================+
| -   **name**                                                                     | -   **form**                          |
|                                                                                  |                                       |
| -   **disabled\***                                                               | -   **readonly**                      |
|                                                                                  |                                       |
| -   **type**                                                                     | -   **autocomplete**                  |
|                                                                                  |                                       |
| -   **maxlength**                                                                | -   **autofocus**                     |
|                                                                                  |                                       |
| -   **readonly**                                                                 | -   **list**                          |
|                                                                                  |                                       |
| -   **size**                                                                     | -   **pattern**                       |
|                                                                                  |                                       |
| -   **value**                                                                    | -   **required\***                    |
|                                                                                  |                                       |
| -   **alt**                                                                      | -   **placeholder**                   |
|                                                                                  |                                       |
| -   **src**                                                                      | -   **multiple**                      |
|                                                                                  |                                       |
| -   **height**                                                                   | -   **list**                          |
|                                                                                  |                                       |
| -   **width**                                                                    | -   **min**                           |
|                                                                                  |                                       |
| -   **checked\***                                                                | -   **max**                           |
|                                                                                  |                                       |
| -   **align \*\***                                                               | -   **step**                          |
|                                                                                  |                                       |
|                                                                                  | -   **formaction**                    |
|                                                                                  |                                       |
|                                                                                  | -   **formenctype**                   |
|                                                                                  |                                       |
|                                                                                  | -   **formmethod**                    |
|                                                                                  |                                       |
|                                                                                  | -   **formtarget**                    |
|                                                                                  |                                       |
|                                                                                  | -   **formnovalidate**                |
+----------------------------------------------------------------------------------+---------------------------------------+
| \*   pseudoclasses CSS target with :disabled and :checked or :required selectors |                                       |
|                                                                                  |                                       |
| \*\* align is deprecated, CSS rules should be used instead                       |                                       |
+----------------------------------------------------------------------------------+---------------------------------------+

-   MDN&apos;s Web Docs: [&lt;input type=range&gt;](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/range)

<h3>5.5.1 Form Attributes</h3>

In this chapter, we go over the form attributes that have been introduced by HTML5.

![html5 form attributes](./images/image265.jpeg){width="2.5in" height="1.8730883639545057in"}

We have already seen the use of pseudo CSS classes used together with the input field and form validation (pattern attribute, input:invalid CSS rule). We also briefly looked at the use of the placeholder attributes for displaying a helper message in the input field.

In this section, we cover the rest of the form attributes and provide further examples of using the previously discussed attributes. 

In another part of the course, about form validation and visual feedback using CSS, we examine some of the most useful attributes in even greater detail.

<h3 id="ch5-5-2">>5.5.2 form</h3>

This attribute is useful for putting input fields outside the form itself. The form attribute of an external input field must share the same value as the id of the form the field belongs to. This is useful when using &lt;fieldset&gt; elements for making the page/form layout easier.

<h4>Typical use</h4>

[Try this interactive example in CodePen](http://codepen.io/w3devcampus/pen/jmdpyv),  or try it directly in your browser:

Enter your name (field outside the form): ![](./images/image266.wmf)

<h4>Top of Form</h4>

Choose optionFree registering![](./images/image219.wmf)Premium![](./images/image219.wmf) Send form

Bottom of Form

Source code:

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;

3.    &lt;head&gt;

4.      &lt;meta charset=&quot;utf-8&quot;&gt;

5.      &lt;title&gt;Example of input type=tel&lt;/title&gt;

6.   

7.    &lt;/head&gt;

8.    &lt;body&gt;

9.      &lt;label for=&quot;yourName&quot;&gt;Enter your name:&lt;/label&gt;

10.     &lt;input type=&quot;text&quot; id=&quot;yourName&quot; name=&quot;yourName&quot; form=&quot;form1&quot;/&gt;

11.     &lt;p&gt;

12.     &lt;form id=&quot;form1&quot; action=&quot;sumit.php&quot; method=&quot;post&quot;&gt;

13.       &lt;fieldset&gt;

14.         &lt;legend&gt;Choose option&lt;/legend&gt;

15.         &lt;label for=&quot;free&quot;&gt;Free registering&lt;/label&gt;

16.         &lt;input type=&quot;checkbox&quot; id=&quot;free&quot;/&gt;

17.         &lt;label for=&quot;premium&quot;&gt;Premium&lt;/label&gt;

18.         &lt;input type=&quot;checkbox&quot; id=&quot;premium&quot;/&gt;

19. 

20.         &lt;button type=&quot;submit&quot;&gt;Send form&lt;/button&gt;

21.       &lt;/fieldset&gt;

22.     &lt;/form&gt;

23.   &lt;/body&gt;

24. &lt;/html&gt;

*Lines 12* and *22* shows the form attribute. Make sure that its value matches the id of the form!

<h3 id="5-5-3">5.5.3 autocomplete</h3>

This attribute applies either to the &lt;form&gt; element or on individual &lt;input&gt; elements. It specifies when input fields must autocomplete the user&apos;s input based on the user&apos;s typing history. 

Possible values of this attribute: on/off.


![on off funny picture](./images/image267.jpeg){width="1.6354166666666667in" height="1.2291666666666667in"}

If applied to the &lt;form&gt; element, all input fields attached to the form (inside or linked to it using the form attribute), will have auto-completion set by default to the value of the autocomplete attribute of the form.

This default behavior can be overridden by setting it individually to any input field inside. In other words: it is possible to have autocomplete &quot;on&quot; for the form, and &quot;off&quot; for specific input fields, or vice-versa.

Sometimes this autocomplete behavior is disabled by default in some Web browsers, and will need to be adjusted in the preferences/settings. 

This attribute targets most input types (those that allow typing in them).

### Typical use

![example of use of the autocomplete attribute](./images/image268.jpeg){width="4.0in" height="2.9568482064741906in"}

Try it in your browser here:

Top of Form

Examples of use of the autocomplete attributeEnter your email (autocomplete=off, this overrides the form&apos;s autocomplete=on attribute):

Enter your address (autocomplete=on by inheritance of the form&apos;s autocomplete=on attribute):

Submit

Bottom of Form

To see auto-completion in action: enter something in both fields and submit the form. Then enter the same thing: you will see that only the second input field offers auto-completion.

Source code extract:

1.  &lt;form submit=&quot;test.php&quot; method=&quot;post&quot; **autocomplete=&quot;on&quot;**&gt;

2.      \...

3.      &lt;label for=&quot;address&quot;&gt;Enter your address (autocomplete off, **overrides the**

4.             **form&apos;s autocomplete=on attribute**):&lt;/label&gt;

5.      &lt;input type=&quot;text&quot; id=&quot;address&quot; **autocomplete=&quot;off&quot;**&gt;

6.      &lt;p&gt;

7.      &lt;label for=&quot;address1&quot;&gt;Enter your address (**autocomplete on by inheritance** of

8.             the form&apos;s autocomplete=on attribute):&lt;/label&gt;

9.      &lt;input type=&quot;text&quot; id=&quot;address1&quot;&gt;

10.     &lt;p&gt;

11.     &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;

12.     \...

13. &lt;/form&gt;

### 5.5.4 autofocus

This attribute is useful for transferring the focus to a field other than the first field in a page/form (by default the first input field has the focus).

*Attention*: there must not be more than one element in the document with the autofocus attribute specified!

This example below illustrates the use of the autofocus attribute: the focus is put on the second input field of the page. It also shows the use of  required, placeholder and pattern attributes.

The required attribute makes the input field invalid if kept empty. 

Here is the result in your browser:

Top of Form

Example of use of the autofocus attributeThis is an input field:![](./images/image266.wmf)

Enter at least 6 chars, max 9 chars (this field has the autofocus attribute):![](./images/image218.wmf)

Bottom of Form

**Notice that the focus in on the second input field, thanks to the autofocus attribute.**

Extract from source code:

1.  &lt;form&gt;

2.      \...

3.      &lt;input type=&quot;text&quot; id=&quot;test&quot;/&gt;&lt;p&gt;

4.      \...

5.      &lt;input id=&quot;name&quot; name=&quot;inputName&quot;

6.             placeholder=&quot;6 to 9 chars please\...&quot;

7.             pattern=&quot;\\w{6,9}&quot;

8.             required

9.             **autofocus**

10.            type=&quot;text&quot;/&gt;

11.     \...

12. &lt;/form&gt;

### Note about Boolean attributes syntax

**Important: **: For &quot;Boolean&quot; attributes, such as autofocus, required, optional, etc., you are able to either write autofocus=&quot;autofocus&quot;, or just use the attribute name &quot;autofocus&quot; without setting a value.

Read [these explanations](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#boolean-attributes) for a complete description of the syntax of Boolean attributes.

### Source code for the knowledge check 5.5.4

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;

3.  &lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;

4.  &lt;title&gt;Example for a knowledge check&lt;/title&gt;

5.  &lt;/head&gt;

6.  &lt;body&gt;

7.  &lt;form&gt;

8.     &lt;label for=&quot;studentID&quot;&gt;Student ID (disabled field, cannot type in it): &lt;/label&gt;

9.     &lt;input type=&quot;text&quot; value=&quot;S134356&quot; id=&quot;studentID&quot; disabled/&gt;&lt;p&gt;

10. 

11.    &lt;label for=&quot;name&quot;&gt;First name: &lt;/label&gt;

12.    &lt;input type=&quot;text&quot; id=&quot;firstName&quot;

13.           placeholder=&quot;John&quot;

14.           autofocus

15.    /&gt;

16. 

17.    &lt;label for=&quot;lastName&quot;&gt;Last name: &lt;/label&gt;

18.    &lt;input type=&quot;text&quot; id=&quot;lastName&quot;

19.           placeholder=&quot;Smith&quot;

20.           autofocus

21.    /&gt;

22. &lt;/form&gt;

23. &lt;/body&gt;

24. &lt;/html&gt;

### 5.5.5 list

This attribute works together with the new &lt;datalist&gt; element we already studied when we saw the color and date input fields.

This attribute&apos;s value must match the id of a &lt;datalist&gt; element. It is useful for providing local auto-completion to some input fields, or for restricting the possible values on some others like &lt;input type=date&gt; or &lt;input type=color&gt;.

Here is a small code extract from a more complete example shown in the section about the new &lt;datalist&gt; element (see next unit).

Please try it in your  browser (Type &quot;F&quot;, &quot;E&quot;, &quot;O&quot;, C&quot; etc., or just click inside the field and use the drop down menu). Note that you can also enter any value; if it does not start with one of these letters it will be accepted but will not trigger auto-completion.

Top of Form

List attributePreferred browser![](./images/image269.wmf) ![](./images/image270.wmf)

Bottom of Form

Source code extract:

```
1.  <form>
2.      ...
3.      <input **list="browsers"** id="mybrowser" />
4.  
5.      <datalist **id="browsers"**>
6.         <option value="Internet Explorer">
7.         <option value="Firefox">
8.         <option value="Chrome">
9.         <option value="Opera">
10.        <option value="Safari">
11.     </datalist>
12. ...
13. </form>
```

At *lines 3* and *5*, the value of the list attribute of the input field must match the one of the id of the &lt;datalist&gt; element.

### 5.5.6 pattern

The pattern attribute enables the validation of the user&apos;s input on the fly (also at submission time), based on **regular expressions**. It applies to the text, search, url, tel, email, and password input types. 

The pattern attribute follows the syntax of [JavaScript regular expressions](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions). 

A **must read**: a good catalog of ready-to-go patterns is available at html5pattern.com, an excellent Web site that proposes plenty of JavaScript patterns for the pattern attribute of HTML5 forms. The left hand menu proposes categorized patterns for [postal codes](http://html5pattern.com/Postal_Codes), [dates](http://html5pattern.com/Dates), [phones](http://html5pattern.com/Phones), etc. 

You can also try [this online JavaScript RegExps tester](https://regex101.com/#javascript), and follow [this tutorial about &quot;using JavaScript RegExps&quot;](https://regexone.com/) that has step by step exercises and explanations.

![html5patterns.com screenshot that shows a menu on the left with categories and patterns on the right](./images/image271.jpeg){width="4.020833333333333in" height="2.4895833333333335in"}

### Typical use

Just add a pattern attribute with a value that is the JavaScript regular expression that must match the entire string entered in the field. Note that the empty string is valid by default (except if the required attribute is used - this makes empty fields invalid).

It&apos;s best practice to systematically add a title attribute with a value that indicates what constitutes a valid entry.** More on this in the section of this course dedicated to form validation.

```
1.  <input type="text" name="country_code"
2.         pattern="[A-Za-z]{3}"
3.         title="3 letter country code"
4.  />
```

### Examples

#### Example #1

Try this [online example at JSBin ](https://jsbin.com/xeyuqux/1/edit?html,output)or directly in your browser below:

Please enter a 3 letter country code (green = valid, pink = invalid): ![](./images/image266.wmf)

With the previous example, until the value of the input field is equal to 3 alphabetic characters, the field is invalid.

As seen in the previous examples, we used some CSS pseudo classes for automatically setting the background-color of the input field as we type.

Complete source code:

```
1.  <!DOCTYPE html>
2.  <html lang="en">
3.  <head>
4.  <meta charset="utf-8">
5.  <title>Example of the pattern attribute</title>
6.  <style>
7.      input:invalid {
8.          background-color: lightPink;
9.      }
10.     input:valid {
11.         background-color: lightGreen;
12.     }
13. </style>
14. </head>
15. <body>
16.   <label for="code">Please enter a 3 letter country code:</label>
17.   <input type="text" name="country_code"
18.          pattern="[A-Za-z]{3}"
19.          title="3 letter country code"
20.          id="code"/>
21. </body>
22. </html>
```

#### Example #2: mixing several other attributes with the pattern attribute

Try this [example online](https://jsbin.com/bozudeg/1/edit?html,output) or in your browser below:

Attributes used: placeholder (for displaying a ghost example value), pattern, required (empty field = invalid)\...

Enter a pseudo (6-12 characters): ![](./images/image218.wmf)

Complete source code:

```
1.  <!DOCTYPE html>
2.  <html lang="en">
3.  <head> <meta charset="utf-8">
4.    <title>Example of use of new HTML5 input field attributes</title>
5.    <style>
6.        input:focus:invalid { background-color: lightPink;}
7.        input:valid { background-color:lightGreen; }
8.        input:required {border: 2px solid red; }
9.        input:optional {border: 2px solid green; }
10.   </style>
11. </head>
12. <body>
13. <p>Attributes used: placeholder (for displaying a ghost example value), pattern, required (empty = invalid)...
14. <p>
15. <label for="inputID">Enter a pseudo (6-12 characters): </label>
16. <input id="inputID" name="Name"
17.        placeholder="Name"
18.        pattern="w{6,12}"
19.        required
20.        title="6-12 characters allowed please"
21.        type="text" />
22. </body>
23. </html>
```

#### Example #3: an &lt;input type=&quot;url&quot;&gt; element with a pattern attribute allowing only certain protocols

[Online example at JSBin ](https://jsbin.com/nulahey/1/edit?html,output)or try it in your browser:

Enter the URL of your repository (http, https or ftp): 

Source code extract:

1.  &lt;input

2.      id=&quot;website&quot;

3.      name=&quot;url&quot;

4.      type=&quot;url&quot;

5.      placeholder=&quot;http://www.domain.com&quot;

6.      title=&quot;http, https or ftp allowed&quot;

7.      **pattern=&quot;(http\|https\|ftp)\\:\\/\\/&lbrack;a-zA-Z0-9\\-\\.\\/&rbrack;\*&quot;**

8.  /&gt;

### 5.5.7 min, max and step

These attributes are useful for several input types such as number, range, date and  time (and other variants).

The min and max attributes are used to set ranges to input fields that accept numerical values or a date/time.

**Their detailed use with these input fields have already been explained in section 5.4 of this course dedicated to these particular input field types.**

Typical use

1.  &lt;input id=&quot;mydate&quot; name=&quot;mydate&quot;

2.         type=&quot;date&quot;

3.        ** min=&quot;2012-01-01&quot;**

4.         **max=&quot;2013-01-01&quot;**

5.         value=&quot;2012-01-01&quot;

6.  /&gt;

7.   

8.  &lt;input name=&quot;time&quot; id=&quot;time&quot; type=&quot;time&quot;

9.          **min=&quot;09:00&quot;**

10.         **max=&quot;17:00&quot;**

11.         value=&quot;12:00&quot;

12. /&gt;

13.  

14. &lt;input id=&quot;range&quot; name=&quot;range&quot; type=&quot;range&quot; **min=&quot;0&quot; max=&quot;100&quot; step=&quot;5&quot;**/&gt;

### 5.5.8 multiple

The multiple attribute is used with email and file input types. It&apos;s a Boolean attribute, so here are the different syntax possibilities:

-   &lt;input type=&quot;email\|file&quot; multiple&gt;

-   &lt;input type=&quot;email\|file&quot; multiple=&quot;multiple&quot;&gt;

-   &lt;input type=&quot;email\|file&quot; multiple=&quot;&quot;&gt;

With &lt;input type=&quot;email&quot;&gt;

With the &lt;input type=&quot;email&quot;&gt;, this attribute enables the user to enter *a set of addresses, separated by a comma* instead of a single address. Entering several addresses will keep the input field *valid*.

[Online example at JSBin ](https://jsbin.com/mexirif/1/edit?html,output)

Or try it below in your browser: type in a list of email addresses separated by a comma, then look at the input field background color (pink = invalid, green = valid), and then submit:

This form uses: &lt;input type=&quot;email&quot; name=&quot;myemail&quot; **multiple**&gt;

Top of Form

With the multiple attributeEnter several email addresses: Submit

Bottom of Form

This form does not use the multiple attribute:

Top of Form

Without the multiple attributeEnter several email addresses: Submit

Bottom of Form

Complete source code:
```
1.  &lt;!DOCTYPE html&gt;
2.  &lt;html lang=&quot;en&quot;&gt;
3.     &lt;head&gt;
4.        &lt;meta charset=&quot;utf-8&quot;&gt;
5.        &lt;title&gt;Jsbin&lt;/title&gt;
6.        &lt;style&gt;
7.           input:invalid {
8.           background-color: lightPink;
9.           }
10.          input:valid {
11.          background-color: lightGreen;
12.          }
13.          fieldset {
14.          border:1px solid;
15.          padding:20px;
16.          }
17.       &lt;/style&gt;
18.    &lt;/head&gt;
19. 
20.    &lt;body&gt;
21.       &lt;p&gt;This form uses: &lt;code&gt;&lt;input type=&quot;email&quot; name=&quot;myemail&quot; &lt;b&gt;multiple&lt;/b&gt;&gt;&lt;/code&gt;&lt;/p&gt;
22. 
23.       &lt;form&gt;
24.          &lt;fieldset&gt;
25.             &lt;legend&gt;With the multiple attribute &lt;/legend&gt;
26.             &lt;label&gt;Enter several email addresses: &lt;/label&gt;
27.             &lt;input type=&quot;email&quot; name=&quot;myemail&quot; title=&quot;you can enter multiple emails addresses, separated by a comma&quot; multiple/&gt;
28.             &lt;button&gt;Submit&lt;/button&gt;
29.          &lt;/fieldset&gt;
30.       &lt;/form&gt;
31.    &lt;p&gt;
32.       &lt;p&gt;This form does not use the multiple attribute:&lt;/p&gt;
33. 
34.       &lt;form&gt;
35.          &lt;fieldset&gt;
36.             &lt;legend&gt;Without the multiple attribute &lt;/legend&gt;
37.             &lt;label&gt;Enter several email addresses: &lt;/label&gt;
38.             &lt;input type=&quot;email&quot; name=&quot;myemail&quot; title=&quot;only one address please!&quot;/&gt;
39.             &lt;button&gt;Submit&lt;/button&gt;
40.          &lt;/fieldset&gt;
41.       &lt;/form&gt;
42.    &lt;p&gt;
43.       Type in a list of email addresses separated by a comma. Look at the input field background color (pink = invalid, green = valid), try to submit. &lt;/p&gt;
44.    &lt;/body&gt;
45. &lt;/html&gt;
46.  
```

**Best practice:  add a title attribute indicating what you expect as a valid entry** (*lines 25* and *38*). If you enter bad values and submit, you will see in the error message the string value of the title attribute.

With &lt;input type=&quot;file&quot;&gt;

With this type of input field, multiple files can be chosen (whereas before HTML5, only a single file could be chosen).

Typical use: &lt;input type=file multiple&gt;

Try these in your browser, look at the small variations (text in the buttons, messages):

Example with &lt;input type=file multiple&gt;

                    Select one or more files: 

Example without the multiple attribute:

                    Select only one file: 

Use the standard key modifiers (shift, control, command) for selecting multiple files when the file chooser dialog popup.

### 5.5.9 a warning

In the following pages, we present a set of rarely used attributes introduced by HTML5. 

You might just glance at them and/or try the examples. The next pages cover their usage and you are welcome to use them for future reference (for those of you who like to cover the topics completely).

### 5.5.10 formaction and formmethod

These attributes are targeted to the &lt;input type=&quot;submit&quot;&gt; input fields. They are rarely used.
```
1.  <input type="submit"
2.  formaction="preview.php" formmethod="get" value="Preview">
```

When you use an &lt;input type=&quot;submit&quot;&gt; field with the formaction attribute, the action attribute value of the form is overridden. The form will be submitted to the URL / value of the formaction attribute of the  &lt;input type=&quot;submit&quot;&gt; field.

The formmethod attribute does the same with the POST/GET method attribute of the form. If an &lt;input type=&quot;submit&quot;&gt; has a formmethod attribute, it overrides the value of the method attribute of the form.

### Typical use
```
1.  <form action="post.php" method="post">
2.       <input type="submit"
3.              formaction="preview.php" formmethod="get"
4.              value="Preview">
5.       <input type="submit" value="Send">
6.  </form>
```

*Line 3* overrides the values set in *line 1*. 

### Examples

Here are two online examples at JSBin:

-   [Example 1](https://jsbin.com/tequkak/2/edit?html,output) 

-   [Example 2](https://jsbin.com/tequkak/2/edit?html,output)

The first shows a form with two submit buttons: 

-   the first button submits to the default URL specified by the action attribute of the form,

-   the second button submits to another action specified by its formaction attribute.
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![](./images/image272.png){width="4.0in" height="1.6570155293088364in"}

The second example shows a form with two submit buttons:

-   the first button submits using a GET,

-   the second button using a POST:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![](./images/image273.png){width="4.0in" height="1.4247790901137358in"}

### 5.5.11 formnovalidate

The formnovalidate attribute is targeted to the &lt;input type=&quot;submit&quot;&gt; input fields. This attribute is rarely used, so there will be no questions about it in the end of the week&apos;s exercises.

This atrribute allows the submission of a form even if it contains  *invalid* fields. For example:  a form that has an &lt;input type=&quot;email&quot;&gt; field or a field required and which are not filled. 

In general, such forms have two submit buttons, one with the formnovalidate attribute set to a non null value and one without.

Typical use ([online example at JSBin](https://jsbin.com/doceje/1/edit?html,output)):

1.  &lt;form action=&quot;form.php&quot;&gt;

2.     &lt;fieldset&gt;

3.       &lt;legend&gt;Example of formnovalidate attribute&lt;/legend&gt;

4.       &lt;label for=&quot;email&quot;&gt;E-mail:&lt;/label&gt;

5.       &lt;input type=&quot;email&quot; name=&quot;email&quot; id=&quot;email&quot;/&gt;&lt;br&gt;

6.       &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;&lt;br&gt;

7.       **&lt;input type=&quot;submit&quot;**

8.              **formnovalidate** 

9.              **value=&quot;Submit without validation&quot; /&gt;**

10. &lt;/fieldset&gt;

11. &lt;/form&gt;

### 5.5.12 formtarget

The formtarget attribute is targeted to the &lt;input type=&quot;submit&quot;&gt; input fields. This attribute is rarely used.

This attribute&apos;s value indicates where the response from the form submission should be displayed. 

### Typical use

1.  &lt;input type=&quot;submit&quot;

2.         **formtarget=&quot;\_blank&quot;**

3.         value=&quot;Submit but show results in a new window/tab&quot;&gt;

Possible values for the formtarget attributes are:

-   \_blank: the response is displayed in a new window or tab

-   \_self: the response is displayed in the same frame (this is default)

-   \_parent: the response is displayed in the parent frame

-   \_top: the response is displayed in the full body of the window

-   framename: the response is displayed in a named iframe

### Complete example

[Online example at JSBin ](https://jsbin.com/godice/2/edit?html,output)or try it in your browser below:

Top of Form

Given name: ![](./images/image269.wmf)\
Family name: ![](./images/image269.wmf)\
<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![](./images/image274.wmf) ![](./images/image275.wmf)

Source code:

1.  &lt;form action=&quot;defaultAction.php&quot;&gt;

2.       &lt;label for=&quot;givenName&quot;&gt;Given name:&lt;/label&gt;

3.       &lt;input type=&quot;text&quot; name=&quot;givenName&quot; id=&quot;givenName&quot;&gt;&lt;br&gt;

4.       &lt;label for=&quot;familyName&quot;&gt;Family name:&lt;/label&gt;

5.       &lt;input type=&quot;text&quot; name=&quot;familyName&quot; id=&quot;familyName&quot;&gt;&lt;br&gt;

6.       &lt;input type=&quot;submit&quot; value=&quot;Submit as usual&quot;&gt;

7.       &lt;input type=&quot;submit&quot;

8.             **formtarget=&quot;\_blank&quot;**

9.             value=&quot;Submit but show results in a new window/tab&quot;&gt;

10. &lt;/form&gt;

### 5.5.13 formenctype

A word about the enctype attribute of the &lt;form&gt; element

The enctype attribute existed before HTML5. It is often used together with forms that contain file input fields. For sending files to a remote server, we use **&quot;*multipart*&quot; forms**. This special encoding of forms needs to be specified using the enctype attribute, as shown in the example below:

[Online example at JSBin](https://jsbin.com/magexat/3/edit?html,output):

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;

3.    &lt;head&gt;

4.      &lt;meta charset=&quot;utf-8&quot;&gt;

5.      &lt;title&gt;Jsbin&lt;/title&gt;

6.    &lt;/head&gt;

7.    &lt;body&gt;

8.      &lt;form action=&quot;default.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;

9.        Given name: &lt;input type=&quot;text&quot; name=&quot;gname&quot;&gt;&lt;br&gt;

10.       Family name: &lt;input type=&quot;text&quot; name=&quot;fname&quot;&gt;&lt;br&gt;

11.       &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;

12.     &lt;/form&gt;

13.   &lt;/body&gt;

14. &lt;/html&gt;

Note that when you send form content using Ajax, this attribute is not needed, as you will specify the type of data sent to the remote server in JavaScript, using the [FormData object](https://developer.mozilla.org/en-US/docs/Web/API/FormData/Using_FormData_Objects).

### As an attribute of the &lt;input type=&quot;submit&quot; enctype=\...&gt; element

Since HTML5, this attribute can also be used in &lt;input type=&quot;submit&quot;&gt; input fields.

If an &lt;input type=&quot;submit&quot;&gt; field has this attribute, then, **when submitted using method=POST**, the browser will send the form content encoded with the method specified by the formenctype attribute. And this overrides the value of the enctype attribute specified in the &lt;form enctype=\...&gt; element (or its default value, if not present).

### Typical use

1.  &lt;form action=&quot;defaultAction.php&quot;&gt;

2.     \...

3.     **&lt;input type=&quot;submit&quot; formenctype=&quot;multipart/form-data&quot;**

4.            **value=&quot;Submit as Multipart/form-data&quot;&gt;**

5.  &lt;/form&gt;

The possible values for this field are:

-   application/x-www-form-urlencoded: all characters are escaped/encoded before submission, for example, spaces become &quot;+&quot;, accentuated characters are transformed into hexadecimal, etc.

-   multipart/form-data: encoding is not done. Usually we use this value for submitting binary data such as images, files, etc.

-   text/plain: some encoding is done on standard characters like space (that becomes a &quot;+&quot;), nothing is done for special characters.

### Example

[Try this online example at JSBin](https://jsbin.com/lokukam/4/edit?html,output)

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![example of use of the formenctype attribute](./images/image276.png){width="4.0in" height="1.2413790463692038in"}

Source code:

```
1.  <!DOCTYPE html>
2.  <html lang="en">
3.    <head>
4.      <meta charset="utf-8">
5.      <title&gt;Jsbin</title>
6.    </head>
7.    <body>
8.      <form action="defaultAction.php" method="post"
9.        enctype="application/x-www-form-urlencoded">
10.       <label for="givenName">Given name:</label>
11.       <input type="text" name="givenName" id="givenName"><br>
12.       <label for="familyName">Family name:</label>
13.       <input type="text" name="familyName" id="familyName"><br>
14.       <input type="submit" value="Submit">
15.       <input type="submit"
16.         formenctype="multipart/form-data"
17.         value="Submit as Multipart/form-data">
18.     </form>
19.     <p><b>Note:</b> The formenctype attribute is not supported by all browsers.</p>
20.   </body>
21. </html>
```

<h4>Explanations and how to see the difference between the two kinds of formenctype values</h4>

If you run [this example in the JSBin](https://jsbin.com/lokukam/4/edit?html,output) standalone mode (click the black arrow on the top right of the output tab, in JSBin), you should see this:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![js bin screenshot of the above example](./images/image277.png){width="5.0in" height="2.931089238845144in"}

Then, open the devtools and go to the &quot;Network&quot; tab, click on the POST request. Once done, click on the right on the &quot;Header&quot; tab to see the HTTP headers, and scroll down, you should see the form-data entries in the header, like in this screenshot:


<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![](./images/image278.png){width="5.0in" height="3.4780982064741908in"}

And if you start again and click on the left submit button, the one without the formenctype attribute, you should see that the form content has been submitted &quot;normally&quot; (default value is &quot;urlencoded&quot;, spaces are replaced by &quot;+&quot;, etc.). Here is a screenshot of what you should see:

<h3 id="ch5-6">5.6.1 HTML5 Forms Elements</h3>

Let&apos;s look at the HTML5 elements related to forms (specifically: &lt;datalist&gt;, &lt;output&gt;, &lt;meter&gt;  and &lt;progress&gt; elements).

+-------------------------------------------+-----------------------------------+
| HTML4                                     | HTML5                             |
+===========================================+===================================+
| -   &lt;form&gt;                              | -   &lt;datalist&gt;                  |
|                                           |                                   |
| -   &lt;fieldset&gt;                          | -   &lt;output&gt;                    |
|                                           |                                   |
| -   &lt;legend&gt;                            | -   &lt;meter&gt;                     |
|                                           |                                   |
| -   &lt;textarea&gt;                          | -   &lt;progress&gt;                  |
|                                           |                                   |
| -   &lt;label&gt;                             | -   &lt;keygen&gt; \*                 |
|                                           |                                   |
| -   &lt;select&gt;                            |                                   |
|                                           |                                   |
| -   &lt;option&gt;                            |                                   |
|                                           |                                   |
| -   &lt;optgroup&gt;                          |                                   |
|                                           |                                   |
| -   &lt;input&gt;                             |                                   |
|                                           |                                   |
| -   &lt;button&gt;                            |                                   |
+-------------------------------------------+-----------------------------------+
| \* Not really useful for most developers. |                                   |
+-------------------------------------------+-----------------------------------+

<h3>5.6.2 <output></h3>

The output element represents the result of a computation or user action. You can see it as a &quot;specialized &lt;div&gt; or &lt;span&gt;&quot; for displaying interactive results.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![example of output element use](./images/image279.jpeg){width="3.0in" height="0.7894739720034996in"}

Typical use / interactive examples

[Do not hesitate to play with the source code of these examples online at JSBin](https://jsbin.com/yuvani/1/edit?html,output).

<h4>Example #1</h4>

```
1.  <form oninput="o.value=a.valueb.value">
2.       <input type="number" name="a" id="a" value="2"> x
3.       <input type="number" name="b" id="b" value="3"> =
4.       <output for="a b" name="o">6</output>
5.  </form>
```

The oninput event handler directly uses the &lt;output&gt; element using the value of its name attribute.

Result (do change the input field values):

Top of Form

 x  = 6

**Explanations about the attributes specific to the &lt;output&gt; element:**

-   for: a space-separated list containing the elements&apos; ids whose values went into the calculation.

-   name: the name of the element.

-   form:  associates the &lt;output&gt; element with its form owner. The value must be the id of a form in the same document. This allows you to place an &lt;output&gt; element outside of the &lt;form&gt; with which it is associated.

<h4>Example #2</h4>

Top of Form

50 + =

Bottom of Form

Source code:

```
1.  &lt;form &gt;
2.     &lt;input name=&quot;a&quot; value=&quot;50&quot; type=&quot;range&quot;
3.            oninput=&quot;x.value = a.valueAsNumber + b.valueAsNumber;
4.            y.value = this.value;&quot;/&gt;
5.     &lt;output id=&quot;y&quot;&gt;50&lt;/output&gt; +
6.     &lt;input name=&quot;b&quot; value=&quot;50&quot; type=&quot;number&quot; /&gt; =
7.     &lt;output name=&quot;x&quot; id=&quot;x&quot; for=&quot;a b&quot;&gt;&lt;/output&gt;
8.  &lt;/form&gt;
```

HTML5 has introduced new input field properties: valueAsNumber and valueAsDate.The last example is similar to the previous one except that we use an addition instead of a multiplication.

As input field values are considered as strings by JavaScript, using x.value = a.value + b.value would result in a string concatenation instead of an addition. That&apos;s why we use the valueAsNumber property.

This is why we used the valueAsNumber property also introduced by HTML5 for some input fields such as &lt;input type=&quot;range&quot;&gt; and &lt;input type=&quot;number&quot;&gt;, we also encountered the valueAsDate properties when we studied &lt;input type=&quot;date&quot;&gt;.

<h3 id="ch5-6-3">5.6.3 <meter></h3>

The &lt;meter&gt; element displays colored bars to represent numeric values.

It can be useful to display a colored gauge to show disk usage, to highlight the relevance of a query result, or the fraction of a voting population that favours a particular candidate, etc. This element is often used with the &lt;input type=&quot;range&quot;&gt; field as an instant feedback indicator.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![picture of a meter example](./images/image280.jpeg){width="5.0in" height="0.8374792213473315in"}

The &lt;meter&gt; element should not be used to indicate progress. You should instead use a &lt;progress&gt; element.

### Typical use

1.  Storage space used: **&lt;meter value=75 min=0 low=20 high=80 max=100 optimum=50&gt;&lt;/meter&gt;**

The &lt;meter&gt; element uses the easy-to-understand value, min, max, low, high and optimum attributes. The optimum attribute, along with min, low, high and max attributes will affect the color of the bar, and of course the constraint min &lt; low &lt; high &lt; max should be respected.

More explanations about the colors and the meaning of the optimum attribute will come further in this lesson.

### Interactive example

[Try the next example online at JSBin](https://jsbin.com/jumahox/1/edit?html,output) or just play with it in your browser by dragging the slider below:

&lt;meter value=75 min=0 low=20 high=80 max=100 optimum=19&gt;&lt;/meter&gt;

Grades:  

Source code of the example:

1.  &lt;p&gt;Grades: **&lt;meter id=&quot;meter2&quot; value=&quot;75&quot; min=&quot;0&quot; low=&quot;20&quot; high=&quot;80&quot; max=&quot;100&quot;&gt;&lt;/meter&gt;**

2.  

3.  &lt;input min=&quot;0&quot; max=&quot;100&quot; value=&quot;75&quot; id=&quot;meter2range&quot;

4.         oninput=&quot;effect(&apos;meter2&apos;, &apos;meter2range&apos;)&quot; type=&quot;range&quot;&gt;

5.  &lt;output id=&quot;meter2val&quot; for=&quot;meter2range&quot;&gt;&lt;/output&gt;&lt;/p&gt;

6.  &lt;script&gt;

7.  function effect(meter, meterrange) {

8.       var currVal = document.getElementById(meterrange).value;

9.       document.getElementById(meter).value = currVal;

10.      document.getElementById(meter+ &quot;val&quot;).innerHTML = currVal;

11. }

12. &lt;/script&gt;

**Explanations:**

![The link between the slider (an &lt;input type=range&gt;) and the meter element is done using an input event handler (oninput=&quot;effect(\...)&quot; line 4. The effect JavaScript function will change the current value of the &lt;meter&gt; element (line 9) and update the displayed html content of the &lt;output&gt; element (line 10)](./images/image281.jpeg){width="6.5in" height="2.1131944444444444in"}

The link between the slider (an &lt;input type=range&gt;) and the meter element is done using an input event handler (oninput=&quot;effect(\...)&quot;) at li*ne 4*.

The effect JavaScript function will change the current value of the &lt;meter&gt; element (*line 9*) and update the displayed html content of the &lt;output&gt; element (*line 10*).

The color of the gauge changes depending on the attribute&apos;s values

The optimum attribute indicates the optimal numeric value and gives an indication where along the range is considered preferable. Just think of the &lt;meter&gt; ranges as follows:

-   Range 1: between min and low

-   Range 2: between low and high

-   Range 3: between high and max

\... and depending on the value you set to optimum attribute, one of the ranges above becomes the &quot;good (optimum)&quot; range.

So in the previous example, with the value of the optimum attribute set to 19, a number between min and low (not inclusive), the Range 1 (between min=0 and low=20) becomes the &quot;good (optimum)&quot; range (displayed in green), the Range 3 (between high=80 and max=100) becomes the &quot;bad&quot; (displayed in red color) range, and the Range 2, in the middle, will be displayed in yellow (not optimum, not bad).

So, a &lt;meter&gt; element used for displaying blood pressure might be a good candidate for setting the optimum value to &quot;Range 2&quot;, and a &lt;meter&gt; element used for displaying memory usage might be a good candidate for setting the optimum value to &quot;Range 1&quot;, meaning that a low memory usage is &quot;good&quot;.

### External resources

-   From MDN&apos;s Web  Docs: [The HTML Meter element](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meter)

-   Good blog post: [How to use and style the meter element](https://www.hongkiat.com/blog/style-html5-meter/)

### 5.6.4 &lt;progress&gt;

The &lt;progress&gt; element is similar to &lt;meter&gt; but it is used for progress bars (i.e., the percentage of a file being uploaded, etc.):

1.  &lt;progress id=pr value=50 min=0 max=100&gt;

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![picture of a funny progress meme syaing &apos;Every mistake you make is progress&apos;](./images/image282.jpeg){width="0.9479166666666666in" height="1.0625in"}

Gives:  

The browser calculates the percentage corresponding to the value, min and max attributes and adjusts the length of the progress bar accordingly.

If no value attribute is set, the progress bar will display an &quot;indeterminate look&quot;, that may slightly vary among different browser implementations. 

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![indeterminate progress bar screenshot](./images/image283.jpeg){width="5.052083333333333in" height="0.6354166666666666in"}

Typical use

[Here is an online example at JSBin](https://jsbin.com/hebiju/edit?html,output), or try it below in your browser:  

This example uses some JavaScript to simulate a download progress by changing in real time the value attribute.

The progress below is defined like this:

&lt;progress id=pr value=100 max=1000&gt;

Download progress: 

Source code:

1.  Download progress: **&lt;progress id=pr value=100 min=0 max=1000&gt;&lt;/progress&gt;**

2.  &lt;script&gt;

3.     var i=0;

4.     setInterval(function () {

5.         i = (i+1) %1000;

6.         document.getElementById(&apos;pr&apos;).value = i;

7.     },1);

8.  &lt;/script&gt;

### 5.6.5 &lt;datalist&gt;

The &lt;datalist&gt; form element is useful for linking a list of choices to an input element.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![example of datalist for autocompletion](./images/image284.png){width="2.8854166666666665in" height="1.5729166666666667in"} ![Another example of use of datalist](./images/image285.png){width="2.8958333333333335in" height="0.625in"}

We have already seen this element in action with different &lt;input&gt; elements, such as &lt;input type=&quot;color&quot;&gt;, &lt;input type=&quot;date&quot;&gt;, or &lt;input type=&quot;range&quot;&gt;.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![restricted choice of color](./images/image227.jpeg){width="1.5520833333333333in" height="0.96875in"}![restrict choices using a datalist element](./images/image286.jpeg){width="6.260416666666667in" height="2.625in"}![example of datalist for sliders ticks](./images/image287.jpeg){width="6.5in" height="0.45416666666666666in"}

It is often &quot;linked&quot; to input fields either for restricting the value set that can be proposed  (i.e., restricted set of colors or possible dates, or for displaying slider ticks, as shown above), **but it may also be used in a more general way, for providing client-side auto-completion without the need to use JavaScript.**

It works with the new list attribute of input fields introduced by HTML5. **The id of the &lt;datalist&gt; must match the value of the list attribute in the input field. A datalist can be shared by several input fields. **It suffices that their list attribute matches the id of the datalist element.

The input field is related to the datalist that will propose auto-completion based on &lt;datalist&gt; values.

### Typical use for auto-completion

Here is an [online example at JSBin](https://jsbin.com/tiqexel/1/edit?html,output), or try it here in your browser (type the name of your favorite browser):

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![](./images/image288.png){width="6.5in" height="0.58125in"}

Source code of this example:

1.  &lt;form action=&quot;demo_form.asp&quot; method=&quot;get&quot;&gt;

2.       &lt;input **list=&quot;browsers&quot;** name=&quot;browser&quot; /&gt;

3.  

4.       &lt;datalist **id=&quot;browsers&quot;**&gt;

5.           &lt;option value=&quot;Internet Explorer&quot;&gt;

6.           &lt;option value=&quot;Firefox&quot;&gt;

7.           &lt;option value=&quot;Chrome&quot;&gt;

8.           &lt;option value=&quot;Opera&quot;&gt;

9.           &lt;option value=&quot;Safari&quot;&gt;

10.      &lt;/datalist&gt;

11.      &lt;input type=&quot;submit&quot; /&gt;

12. &lt;/form&gt;

As you can see at l*ines 2* and *4*, the id and list attributes match. The &lt;datalist&gt; element is wrapped around a set of  &lt;option&gt; that are available for selection by another form control (in this example the input field from *line 2*).

### 5.7.1 Introduction

In this section of the course, we will look at CSS pseudo classes that are useful for giving instant feedback when the user&apos;s input is not valid. We will also look at the new JavaScript API introduced by HTML5 for validating forms and form elements.

In the following pages, we will first illustrate the concept of form validation with the &lt;input type=&quot;email&quot;/&gt; field. It can be generalized to all kind of input types, such as url, number, etc. Some form attributes, such as pattern,  will also affect input field validity!

Form validation is [supported](https://caniuse.com/#feat=form-validation) by all modern browsers.

### 5.7.2 Automate Visual Feedback While Typing

Most modern browsers propose default behavior for validating input fields and forms.

The built-in validation system that comes with HTML5 automatically adds a CSS pseudo class to all input fields. Invalid fields (i.e. a badly worded email address in an &lt;input type=&quot;email&quot;&gt; input field), will inherit the :invalid pseudo class, valid fields will inherit the :valid pseudo class.

A first step to improve your HTML form is to add some CSS rules to your input fields. This adds visual feedback to the validity of input fields values - while the user is typing - such as changing the color of the border of input fields, or green/red icons on the right of the field, as shown in the small picture at the top right of this page.

Also, at the time of submitting the form, some extra messages may be displayed as pop up text bubbles.

![bubble message example](./images/image289.png){width="3.3020833333333335in" height="1.2916666666666667in"}The default bubble message and visual feedback differ from one implementation to another, but they may be customized, with some limitations that will be explained later.

For example, browsers may provides default feedback on the input field&apos;s border (red = invalid, green = ok). This default behavior can be overridden by CSS rules as illustrated in the section about new input type attributes. 

### Examples

#### Example #1: styling &quot;required&quot;, &quot;valid&quot; and&quot; invalid&quot; fields using CSS3 pseudo-classes

Here is an [online example at JSBin](https://jsbin.com/palifuy/edit?html,output), or try it below in your browser:

Top of Form

Type invalid values and submit form to see the resultE-mail: \
Homepage (URL): \
Phone number: \
Submit form

**Bottom of Form**

**Source code extract:**

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;

3.    &lt;head&gt;

4.      &lt;meta charset=&quot;utf-8&quot;&gt;

5.      &lt;title&gt;CSS3 pseudo-classes for form validation visual feedback&lt;/title&gt;

6.      &lt;style&gt;

7.   

8.        input:invalid { background-color: lightPink;}

9.        input:valid { background-color:lightGreen; }

10.       input:required {border: 2px solid red;}

11.       input:optional {border: 2px solid green;}

12.       fieldset {

13.         border:1px solid;

14.         padding:20px;

15.         }

16.       .formLabel { display: inline-block; width: 140px; text-align: right; }

17.     &lt;/style&gt;

18.   &lt;/head&gt;

19.   &lt;body&gt;

20.  

21.     &lt;form&gt;

22.         &lt;fieldset&gt;

23.           &lt;legend&gt;Type invalid values and see the result&lt;/legend&gt;

24.           &lt;label for=&quot;myEmail&quot; class=&quot;formLabel&quot;&gt;E-mail:&lt;/label&gt; &lt;input type=&quot;email&quot; id=&quot;myEmail&quot; required/&gt;&lt;br&gt;

25.           &lt;label for=&quot;myURL&quot; class=&quot;formLabel&quot;&gt;Homepage (URL):&lt;/label&gt; &lt;input type=&quot;url&quot; id=&quot;myURL&quot; required/&gt;&lt;br&gt;

26.           &lt;label for=&quot;myPhone&quot; class=&quot;formLabel&quot;&gt;Phone number:&lt;/label&gt; &lt;input type=&quot;tel&quot; id=&quot;myPhone&quot; pattern=&quot;&lbrack;0-9&rbrack;{3}-?&lbrack;0-9&rbrack;{3}-?&lbrack;0-9&rbrack;{4}&quot;        placeholder=&quot;e.g. 416-555-1234&quot; required/&gt;&lt;br&gt;

27.           &lt;button&gt;Submit form&lt;/button&gt;&lt;br /&gt;

28.         &lt;/fieldset&gt;

29.     &lt;/form&gt;

30.   &lt;p&gt;

31.  

32.   &lt;/body&gt;

33. &lt;/html&gt;

34.  

Try the online example with different Web browsers, both with and without the CSS rules. See the differences between FireFox/Chrome/Opera in the default visual feedback behavior. Don&apos;t worry: all default behavior can be overridden if you provide your own CSS rules.

**Best practice:  We recommend that you ALWAYS provide default CSS rules that give visual feedback to the user&apos;s input.**

Example #2: add CSS transitions + an icon/marker to the right of the input fields

Try this [online example at JSBin](https://jsbin.com/zaxije/2/edit) or try it here in your browser. This example adds a small icon that changes depending on the validity of the input field:

Top of Form

Type invalid values and see the resultE-mail: \
Homepage (URL): \
Phone number: \
Submit form

**Bottom of Form**

**Source code extract:**

1.  .myForm input:focus {

2.    ** padding-right:70px;**

3.  }

4.  .myForm input {

5.    ** transition: padding .25s;**

6.  }

7.  

8.  .myForm **input:required:valid **{

9.     background:url(&apos;https://i.imgur.com/BJolppS.png&apos;) no-repeat right top;

10. }

11. .myForm **input:required **{

12.    background:url(&apos;https://i.imgur.com/7pIN7wz.png&apos;) no-repeat right top;

13. }

This time, we just added an attribute class=&quot;myForm&quot; to our form, in order to avoid interfering with the other examples on this page, and we tweaked the CSS rules a little.

The rule at *line 1* says that any time we click on an input field, it will enlarge itself to the right, while the rule at *line 4* will make it animated.

The rules at *lines 8* and 1*1* target the input fields with a required attribute. They will change the background by displaying a small green or red icon, corresponding to the valid/invalid status of the input field.

### Use the title attribute for specifying a custom message

You can simply use the input&apos;s title attribute to provide a message for pattern-mismatches, and more generally for all validation errors. This solution is really neat and doesn&apos;t require JavaScript!

Try the [online example at JSBin](https://jsbin.com/locedoy/1/edit?html,output), or try it here in your browser (type invalid values and look at the custom messages):

Top of Form

Type invalid values and see the result, this time with custom messages! E-mail: \
Homepage (URL): \
Phone number: \
Submit form

**Bottom of Form**

**Extract from source code:**

```
1.  <form class="myForm">
2.    <fieldset>
3.      <legend&gt;Type invalid values and see the result</legend&gt;
4.      <label for="myEmail" class="formLabel">E-mail:</label>
5.      <input type="email" id="myEmail"
6.             **title="You don't know what an email address looks like, do you?"**
7.             required/><br>
8.  ...
9.      <button>Submit form</button><br />
10.   </fieldset>
11. </form>
```

*Beware* that browser implementations may differ. Chrome, Opera will display the title attribute value in error message bubbles when the form is submitted, while Safari and FireFox (desktop and mobile) will simply ignore it.

You must also take care of the different languages, otherwise you will get error message bubbles that show some parts in the local language, and the message from the title attribute &quot;as is&quot;.

Google Chrome on a French desktop computer:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![Chrome shows native error message localized and the title attribute content as is](./images/image290.jpeg){width="6.5in" height="2.3944444444444444in"}

Same example on FireFox, the title attribute is ignored:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![same example on firefox, the title attribute is ignored](./images/image291.jpeg){width="6.447916666666667in" height="2.1041666666666665in"}

**The built-in validation system is an improvement on what existed before HTML5 (i.e., nothing), but additional work is required if you want fully localized, hand-made validation feedback.**\
\
**We will show solutions in the last section of this week&apos;s course.**

### 5.7.3 JavaScript Form Validation API

There is a JavaScript API for form validation. This API will let you use your own validation algorithm (i.e. check that you have entered the same password in two different input fields), and customize error messages. Also, together with some HTML/CSS/JavaScript you will be able to make your own message bubbles.

### Typical use

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
[Example of password checking at JSBin](https://jsbin.com/hovato/1/edit?html,output),  be careful to try this example in JS Bin standalone mode (click the small black arrow on the top right of the output tab).

Or you may try it here in your browser:

Top of Form

Example use of the validation API, enter different passwords and submit Password: ![](./images/image266.wmf)

Repeat password: ![](./images/image218.wmf)

Submit

Bottom of Form

Extract from source code:

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;

3.    &lt;head&gt;

4.      &lt;meta charset=&quot;utf-8&quot;&gt;

5.      &lt;title&gt;Example of using the validation API&lt;/title&gt;

6.      &lt;style&gt;

7.        .myForm input:invalid { background-color: lightPink;}

8.        .myForm input:valid { background-color:lightGreen; }

9.        .myForm input:required {border: 2px solid red;}

10.       .myForm input:optional {border: 2px solid green;}

11.       .myForm label { display: inline-block; width: 140px; text-align: right; }

12.     &lt;/style&gt;

13.   &lt;/head&gt;

14.   &lt;body&gt;

15.     &lt;form class=&quot;myForm&quot;&gt;

16.       &lt;fieldset&gt;

17.         &lt;legend&gt;Example use of the validation API&lt;/legend&gt;

18.         &lt;label for=&quot;password1&quot; &gt;Password:&lt;/label&gt; &lt;input type=&quot;password&quot; id=&quot;password1&quot; oninput=&quot;checkPasswords()&quot; required&gt;

19.         &lt;p&gt;

20.         &lt;label for=&quot;password2&quot;&gt;Repeat password:&lt;/label&gt; &lt;input type=&quot;password&quot; id=&quot;password2&quot; oninput=&quot;checkPasswords()&quot; required&gt;

21.         &lt;p&gt;

22.         &lt;button&gt;Submit&lt;/button&gt;

23.       &lt;/fieldset&gt;

24.     &lt;/form&gt;

25.  

26.   &lt;script&gt;

27.   function checkPasswords() {

28.     var password1 = document.getElementById(&apos;password1&apos;);

29.     var password2 = document.getElementById(&apos;password2&apos;);

30.     if (password1.value != password2.value) {

31.       password2.setCustomValidity(&apos;Passwords non identiques&apos;);

32.      } else {

33.         password2.setCustomValidity(&apos;&apos;);

34.       }

35.     }

36.   &lt;/script&gt;

37.   &lt;/body&gt;

38. &lt;/html&gt;

**Explanations:**

The validity API proposes a setCustomValidity() method available on input DOM objects. This method allows you to customize error messages. It takes a string parameter. When this string is empty, the element is considered *valid*, when the string is not empty, the field is *invalid* and the validation error message displayed in the bubble will be equal to that string.

At *lines 18* and *20* we added an input event listener: each time a key is typed, the checkPasswords() function is called.

*Lines 28* and *29* get the input fields&apos; values, and* lines 30-35* check if the passwords are the same and set the validity of the field using the validation API&apos;s method setCustomValidity(error_message).

## 5.7.4 The validity property of input fields

The validity property of input fields helps to get error details when the field is *invalid*. This property tests the different types of validation error.

Here is how to get the validity property of an input field:

1.  var input = document.getElementById(&apos;IdOfField&apos;);

2.  

3.  var validityState_object =** input.validity;**

The possible values for the validity property are: 

-   valueMissing 

-   typeMismatch

-   patternMismatch

-   tooLong

-   rangeUnderflow 

-   rangeOverflow

-   stepMismatch

-   valid 

-   customError

Here is [an example at JSBin that shows how to test the different types of validation errors](https://jsbin.com/nalaxeg/1/edit?html,output), or you may try it here in your browser (enter bad values, too big, too small, enter invalid characters, etc.):

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![](./images/image292.png){width="6.5in" height="0.7840277777777778in"}

**Source code:**

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;

3.  \...

4.  &lt;body&gt;

5.  

6.  &lt;script&gt;

7.  function validate() {

8.       var input = document.getElementById(&apos;b&apos;);

9.      ** var validityState_object = input.validity;**

10.  

11.      if(validityState_object.valueMissing) {

12.          input.setCustomValidity(&apos;Please set an age (required)&apos;);

13.      } else if (validityState_object.rangeUnderflow) {

14.          input.setCustomValidity(&apos;Your value is too low&apos;);

15.      } else if (validityState_object.rangeOverflow) {

16.          input.setCustomValidity(&apos;Your value is too high&apos;);

17.      } else if (validityState_object.typeMismatch) {

18.          input.setCustomValidity(&apos;Type mismatch&apos;);

19.      } else if (validityState_object.tooLong) {

20.          input.setCustomValidity(&apos;Too long&apos;);

21.      } else if (validityState_object.stepMismatch) {

22.          input.setCustomValidity(&apos;stepMismatch&apos;);

23.      } else if (validityState_object.patternMismatch) {

24.          input.setCustomValidity(&apos;patternMismatch&apos;);

25.      } else {

26.          input.setCustomValidity(&apos;&apos;);

27.      }

28. }

29. &lt;/script&gt;

30. &lt;form class=&quot;myForm&quot;&gt;

31. &lt;label for=&quot;b&quot;&gt;Enter a value between 10 and 20: &lt;/label&gt;

32.  

33. &lt;input type=&quot;number&quot; name=&quot;text&quot; id=&quot;b&quot; min=&quot;10&quot; max=&quot;20&quot;

34.         required **oninput=&apos;validate();&apos;**/&gt;

35. &lt;button&gt;Submit&lt;/button&gt;

36. &lt;/form&gt;

37. 

38. &lt;/body&gt;

39. &lt;/html&gt;

### The validationMessage property

It is also possible to get the validation error message, using the validationMessage property of input fields.

1.  var input = document.getElementById(&apos;b&apos;);

2.   

3.  console.log(&quot;Validation message = &quot; +** input.validationMessage**);

This is useful for making custom error messages. More about this topic in the next section of the course.

## 5.7.5 Changing the default behavior

Custom validation: changing the default behavior, aggregating error messages, removing bubbles, etc.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![](./images/image293.png){width="3.5in" height="1.7576082677165354in"}

#### Criticism of the default behavior of HTML5 built-in validation

The techniques we have seen so far for enhancing HTML forms are powerful and provide interesting features, but are also criticized by Web developers:

-   Browser support is still not 100% complete (Safari and Internet Explorer still lack several important features),

-   It is not possible to aggregate error messages.  On submission, browsers show an error bubble next to the first invalid field, and there is no built-in way to *display all error messages for all invalid fields at the same time*,

-   You cannot style the bubbles.

**However, the validation API gives enough power to make your own validation behavior, overriding the default when necessary.**

Here is [an adaptation of work presented at the developer.telerik.com Web site](https://www.telerik.com/blogs/building-html5-form-validation-bubble-replacements).  This link is really worth reading, as it presents different approaches and gives external references for those who would like to go further.

### Example that shows aggregation of error messages + overriding default behavior

Try the [online example at JSBin,](https://jsbin.com/povekur/1/edit?html,output) or try it here in your browser: enter invalid values and submit with one or two invalid fields.

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![](./images/image294.png){width="6.5in" height="1.7381944444444444in"}

**Complete source code:**

1.  &lt;!DOCTYPE html&gt;

2.  &lt;html lang=&quot;en&quot;&gt;

3.  &lt;head&gt;

4.     &lt;meta charset=&quot;utf-8&quot;&gt;

5.     &lt;title&gt;Aggregating error messages&lt;/title&gt;

6.     &lt;style&gt;

7.         input:invalid { background-color: lightPink;}

8.         input:valid { background-color:lightGreen; }

9.         input:required {border: 2px solid red;}

10.        input:optional {border: 2px solid green;}

11.  

12.        .error-messages {

13.            display: none;

14.            margin: 0 10px 15px 10px;

15.            padding: 8px 35px 8px 30px;

16.            color: #B94A48;

17.            background-color: #F2DEDE;

18.            border: 2px solid #EED3D7;

19.            border-radius: 4px;

20.        }

21.        fieldset {

22.           border:1px solid;

23.           padding:20px;

24.        }

25.     &lt;/style&gt;

26. &lt;/head&gt;

27. &lt;body&gt;

28. &lt;form&gt;

29.      &lt;fieldset&gt;

30.          &lt;legend&gt;Submit with one or two invalid fields&lt;/legend&gt;

31. 

32.          &lt;ul class=&quot;error-messages&quot;&gt;&lt;/ul&gt;

33. 

34.          &lt;label for=&quot;name&quot;&gt;Name:&lt;/label&gt;

35.          &lt;input id=&quot;name&quot; name=&quot;name&quot; required&gt;

36.          &lt;p&gt;

37.          &lt;label for=&quot;email&quot;&gt;Email:&lt;/label&gt;

38.          &lt;input id=&quot;email&quot; name=&quot;email&quot; type=&quot;email&quot; required&gt;

39.          &lt;p&gt;

40.          &lt;button&gt;Submit&lt;/button&gt;

41.      &lt;/fieldset&gt;

42. &lt;/form&gt;

43.  

44. &lt;script&gt;

45.     function replaceValidationUI(form) {

46.        // Suppress the default bubbles

47.           form.addEventListener(&quot;invalid&quot;, function (event) {

48.           event.preventDefault();

49.        }, true);

50.  

51.        // Support Safari, iOS Safari, and the Android browser --- each of which

52.        // do not prevent form submissions by default

53.        form.addEventListener(&quot;submit&quot;, function (event) {

54.           if (!this.checkValidity()) {

55.              event.preventDefault();

56.           }

57.        });

58.  

59.        // Container that holds error messages. By default it has a CSS

60.        // display:none property

61.        var errorMessages = form.querySelector(&quot;.error-messages&quot;);

62.  

63.        var submitButton = form.querySelector(&quot;button:not(&lbrack;type=button&rbrack;),

64.                                               input&lbrack;type=submit&rbrack;&quot;);

65.  

66.        submitButton.addEventListener(&quot;click&quot;, function (event) {

67.            var invalidFields = form.querySelectorAll(&quot;input:invalid&quot;);

68.            var listHtml = &quot;&quot;;

69.            var errorMessagesContainer = form.querySelector(&quot;.error-messages&quot;);

70.            var label;

71.  

72.            // Get the labels&apos; values of their name attributes + the validation error

73.            // message of the corresponding input field using the validationMessage

74.            // property of input fields

75.            // We build a list of &lt;li&gt;\...&lt;/li&gt; that we add to the error message container

76.            for (var i = 0; i &lt; invalidFields.length; i++) {

77.                label = form.querySelector(&quot;label&lbrack;for=&quot; + invalidFields&lbrack; i &rbrack;.id + &quot;&rbrack;&quot;);

78.                listHtml += &quot;&lt;li&gt;&quot; +

79.                            label.innerHTML +

80.                            &quot; &quot; +

81.                            invalidFields&lbrack; i &rbrack;.validationMessage +

82.                            &quot;&lt;/li&gt;&quot;;

83.            }

84.  

85.            // Update the list with the new error messages

86.            errorMessagesContainer.innerHTML = listHtml;

87.  

88.            // If there are errors, give focus to the first invalid field and show

89.            // the error messages container by setting its CSS property display=block

90.            if (invalidFields.length &gt; 0) {

91.               invalidFields&lbrack; 0 &rbrack;.focus();

92.               errorMessagesContainer.style.display = &quot;block&quot;;

93.            }

94.        });

95.    }

96.  

97.    // Replace the validation UI for all forms

98.    var forms = document.querySelectorAll(&quot;form&quot;);

99. 

100.    for (var i = 0; i &lt; forms.length; i++) {

101.        replaceValidationUI(forms&lbrack; i &rbrack;);

102.    }

103. &lt;/script&gt;

104. &lt;/body&gt;

105. &lt;/html&gt;

Explanations:

-   *Line 32*: we added an empty unnumbered list (&lt;ul&gt;..&lt;/ul&gt;) to the form, with the CSS class=&quot;error-messages&quot;. We will use this class attribute for styling, and hiding by default, the error messages using CSS (see lines *12-20*, *line 13* hides the messages by default).

-   *Lines 97-102* look at all forms in the document and call a function that will replace the default validation behavior for all of them: the replaceValidationUI(form) function.

-   This function first disables all default behavior (no more display of bubbles during form submission), this is done at *lines 45-57*.

-   *Line 66*: we add a click listener to the submit button of the current form.

-   *Line 67* gets all invalid input fields for that form,

-   *Lines 76-83*: For each invalid field, we get the value of the name attribute of the corresponding label, we also get the validation error message, and we build a list item(&lt;li&gt;\...&lt;/li&gt;).

-   *Line 86*: Then we add this list element (a formatted error message corresponding to an invalid input field) to the error message container.

-   *Lines 90-93*: The focus is given to the first invalid field that shows an error message.

<h3 id="6-1-1">6.1.1 Video Intro -- Module 6</h3>

Final week!

Congratulations to all of you. Here, it's summer and it&apos;s hot, it&apos;s time to get holidays, but before that we need to finish the course. I&apos;m talking from the very nice park of the University of Nice in the south of France where I work. And I want you to be as happy as I am today to teach you this final week. We will look this time at the HTML5 persistence, notably at the HTML5 cache that is useful for creating Web sites and Web applications that work offline. We will also study the web storage API that is useful for saving and restoring data on the client side directly in browser.

It can be useful for setting some preferences for Web application, or for remembering what you typed in a form, for example. We will also look at another form of persistence using the file API. This JavaScript API is quite simple and can be used together with file choosers.

For example, you choose some pictures, some images you want to send to a server and using this API you can visualize them directly in the page before sending them to the server.

Finally, we will look at the geolocation API that is useful for locating the person that is using the browser. So you can provide a customized service that take into account the geolocation, or you can also display the position of the person in a map, we will see example that work with Google Map and with OpenStreetMap. Another classic use is automatic filling of the address input fields in a form.

Instead of typing the zip code, entering the city, entering the country, you can guess that automatically and propose the form that is already filled with the address. I really enjoyed teaching you this HTML5 basic course and I&apos;m looking forward to meeting you the next HTML5 part-2 course that would address more advanced topics

<h3 id="6-1-2">6.1.2 HTML5 JavaScript APIs</h3>

We have already studied some of the HTML5 JavaScript APIs, including:

-   The canvas API,

-   The form validation API,

-   The audio and video elements API, the getUserMedia API (also related to audio and video elements),

However, HTML5 also comes with several APIs that are not directly related to HTML elements, namely: the Orientation API; the Geolocation API; most APIs related to client-side persistence; the Web Storage API; the Web Workers API; and some other APIs that are not in the HTML5 specification, but are related to it, such as the GamePad API, the Web Audio API, etc.

This week, we will look at some of the most useful APIs. Others will be covered in the [W3C HTML5 Apps and Games course](https://www.edx.org/course/html5-apps-and-games):

-   **The &quot;Web Storage&quot; API, sort of &quot;super cookies&quot;, for storing pairs of key/values client side.** This API is useful for enabling Web sites to save/restore their state, or for writing *serverless* applications. You will see a small contact manager that stores its data locally, without the need for a remote Web server.

-   **The File API, that enables Web applications to work with local files**. For example, a picture editor, or ./images player that can work with your music and video files - the ones on your phone or your hard disk! With this API you will also be able to preview image files directly in your page - there is no need to send them to a remote server.

> ![you are here sign](./images/image295.jpeg){width="3.125in" height="1.6354166666666667in"}

-   **The Geolocation API for obtaining data such as longitude, latitude, altitude (when available), and speed**. You will learn how to write applications in combination with interactive maps. You will also learn how to guess the address of a user, for example for pre-filling a registration form with the city, country, and zip code that corresponds with the current location.

## 6.2.1 The Web storage API

The Web storage API introduces &quot;two related mechanisms, similar to HTTP session cookies, for storing structured data on the client side&quot;.

Indeed, Web Storage provides two interfaces - sessionStorage and localStorage - whose main difference is data longevity. This specification defines an API for persistent data storage of key-value pair data in Web clients.

**With localStorage the data will remain until it is deleted, whereas with sessionStorage the data is erased when the tab/browser is closed.**

For convenience, we will mainly illustrate the localStorage object. Just change &quot;local&quot; to &quot;session&quot; and it should work (this time with a session lifetime).

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![key value pairs](./images/image296.png){width="1.7291666666666667in" height="1.6979166666666667in"}

### Simple key-value stores, one per domain (following the same origin policy)!

localStorage is a simple key-value store, in which the keys and values are strings. There is only one store per domain. This functionality is exposed through the globally available localStorage object. The same applies to sessionStorage.

**Example:**

1.  // Using localStorage

2.  

3.  // store data

4.  localStorage.lastName = &quot;Bunny&quot;;

5.  localStorage.firstName = &quot;Bugs&quot;;

6.  localStorage.location = &quot;Earth&quot;;

7.  

8.  // retrieve data

9.  var lastName = localStorage.lastName;

10. var firstName = localStorage.firstName;

11. var location = localStorage.location;

This data is located in a store attached to the origin of the page. We created[ a JSBin example in which we included the above code](https://jsbin.com/povuqa/1/edit).

Once opened in your browser, the JavaScript code is executed. With the browser dev. tools, we can check what has been stored in the localStorage for this domain:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![example of localStorage](./images/image297.jpeg){width="6.5in" height="5.430555555555555in"}

Here is a view of the devtools. In more recent versions of Google Chrome, the &quot;Resources&quot; tab is named &quot;Applications&quot;:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![dev tools can be used to show what is in the local storage](./images/image298.jpeg){width="6.5in" height="6.209027777777778in"}

### Differences with cookies?

Cookies are also a popular way to store key-value pairs. Web Storage, however, is a more powerful technique than cookies. The main difference is in size limits: cookies are limited to a few KBytes whereas Web Storage may extend to several MBytes. Also cookies generate additional HTTP request traffic (whether to request a Web page, an image, a stylesheet, a JavaScript file, etc.).

Objects managed by Web Storage are no longer carried on the network and HTTP, and are easily accessible (read, change and delete) from JavaScript, using the Web Storage API.

### External resources

-   From W3C&apos;s specification: [The W3C Web Storage API recommendation](https://www.w3.org/TR/webstorage/)

-   An Interesting article on Web.dev: [Storage for the Web](https://web.dev/storage-for-the-web/)

-   From MDN&apos;s Web Docs: [Web Storage API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API)

### 6.2.2 Example 1

You can start filling this form and come back another day and complete it. It doesn&apos;t matter if you closed your browser before coming back. The form never loses what you entered, even if you reload the page, or press &quot;backspace&quot; by mistake. **This form auto saves/restores its content**.

In this example, we use the most simple way to use localStorage:

-   **Save with the localStorage.key = value syntax. **For example, localStorage.firstName = &apos;Michel&apos; will save the value &quot;Michel&quot; with the access key being &apos;firstName&apos;

-   **Restore with the var value = localStorage.key syntax**. For example, var fn = localStorage.firstName; will set fn with the value &apos;Michel&apos; if this value has been previously saved as in the example from the line above.

### Saving the form content on the fly

Open this [online example at JSBin](https://jsbin.com/pulurir/edit?html,js,output), and use F12 or cmd-alt-i (Mac OS) to look at the dev. tools. As you type in the different input fields, their content is updated in the localStorage.

We just added input event listeners to each input field. For example, in order to save the first name input field&apos;s content, we just added:

1.  oninput=&quot;localStorage.firstName=this.value;&quot;

Where firstName in red is the key and this.value the current value of the input field.

![As we are filing a form text input type, its content is saved in local storage. The image shows the httml coe of the input type, that as a oninput=&apos;localStorage.firstName = this.value&quot;. Devtools are open on the &quot;Applications&quot; tab and show the LocalStorage content. It has the same value as what has been typed in the form firstName field.](./images/image299.jpeg){width="6.5in" height="3.7506944444444446in"}

In the same way, we added an input listener to all the input fields in this example&apos;s form.

### Restoring the form content on page load/reload

This time, we want the form content to be restored on page load/reload. We will add a restoreFormContent() function in the JavaScript code that will be called each time the page is loaded. In this function, we will read the saved data and set the input fields&apos; values.

[Complete example on JSBin](https://jsbin.com/yivocuz/edit?html,js,output): enter data and press reload at any time. The form content is restored!

Source code extract (only addition to the previous example):

1.  // Called when the page is loaded

2.  window.onload = restoreFormContent;

3.   

4.  function restoreFormContent() {

5.     console.log(&quot;restoring form content from localStorage&quot;);

6.  

7.     if(localStorage.firstName !== undefined)

8.       document.getElementById(&quot;firstName&quot;).value = localStorage.firstName;

9.  

10.    if(localStorage.lastName !== undefined)

11.      document.getElementById(&quot;lastName&quot;).value = localStorage.lastName;

12. 

13.    if(localStorage.email !== undefined)

14.      document.getElementById(&quot;email&quot;).value = localStorage.email;

15.  

16.    if(localStorage.age !== undefined)

17.      document.getElementById(&quot;age&quot;).value = localStorage.age;

18. 

19.    if(localStorage.date !== undefined)

20.      document.getElementById(&quot;date&quot;).value = localStorage.date;

21. }

The tests at *lines 7, 10, 13*, etc., verify that data has been saved, before trying to restore it. Without these tests, it would put the &quot;undefined&quot; string as the value of input fields with no corresponding data to restore.

<h3>6.2.3 localStorage and sessionStorage</h3>

This time we will look at another example that uses new methods from the API:

-   localStorage.setItem(\...),

-   localStorage.getItem(\...),

-   localStorage.removeItem(\...),

-   localStorage.clear().

### Getting/setting values using the getItem(key) and setItem(key, value) methods

If you want to keep a simple counter of the number of times a given user has loaded your application, you can use the following code (just to show how to use setItem/removeItem methods):

1.  var counter = localStorage.getItem(&quot;count&quot;) \|\| 0;

2.  counter++;

3.  localStorage.setItem(&quot;count&quot;, counter);

As you can easily guess from the above, we use var value = getItem(key) to retrieve a key&apos;s value and setItem(key, value) to set it. This is similar to what we saw in the examples of the page above, except that this time:

-   ##### The key can contain spaces, for example we can write: localStorage.setItem(&quot;Instructor&apos;s name&quot;, &quot;Michel&quot;); and var name =  localStorage.getItem(&quot;Instructor&apos;s name&quot;);, while var name = localStorage.Instructor&apos;s name; will not work!

-   ##### In a loop or in an iterator, sometimes we need to set/get localStorage values using this syntax, for example: 
```
1.  var inputField = document.getElementById("firstName");
2.  saveInputFieldValue(inputField);
3.  ... 
4.  function saveInputFieldValue(field) {
5.      localStorage.setItem(field.id, field.value);
6.  }
```

### Deleting a key with removeItem(key), or all keys with clear()

Deleting a key can be performed through removeItem(). And if you wish to reset the entire store, simply call localStorage.clear().

Note that it will probably only be the rare occasion that you will want the entire store to be cleared by the user in production software (since that effectively deletes their entire data). However, it is a rather a common operation needed during development, since bugs may store faulty data the persistence of which can break your application, since the way you store data may evolve over time, or simply because you also need to test the experience of the user when first using the application.

One way of handling this is to add a user interface button that calls clear() when clicked, but you must then remember to remove it when you ship! The recommended approach  to use (whenever possible) is to simply open the dev. tool&apos;s console and type localStorage.clear() there --- it&apos;s safer and works just as well.

### Iterating local stores

Local stores (localStorage or sessionStorage) can also be iterated through in order to list all the content that they contain. The order is not guaranteed, but this may be useful at times (if only for debugging purposes!). The following code lists everything in the current store:
```
1.  for (var i = 0, n = localStorage.length; i &lt; n; i++) {
2.      var k = localStorage.**key(i)**;
3.      console.log(k + &quot;: &quot; +** localStorage&lbrack;k&rbrack;**); // get the ith value, the one with a key that is in the variable k.
4.  }
```

Students may note that something seems a bit off in the example above: instead of calling localStorage.getItem(k), we simply access localStorage&lbrack;k&rbrack;. Why? Because keys in the local store can also be accessed as if the store were a simple JavaScript object. So instead of localStorage.getItem(&quot;foo&quot;) and localStorage.setItem(&quot;foo&quot;, &quot;bar&quot;), one can write localStorage.foo and localStorage.foo = &quot;bar&quot;. Of course there are limitations to this mapping: any string can serve as a key, so that localStorage.getItem(&quot;one two three&quot;) works, whereas that string would not be a valid identifier after the dot (but it could still work as localStorage&lbrack;&quot;one two three&quot;&rbrack;).

### ![example with buttons that shown how to iterate on localStorage, clear it etc.](./images/image300.jpeg){width="4.072916666666667in" height="2.5729166666666665in"}

### Example that shows all the methods of the local storage API in action

[Online example at JSBin](https://jsbin.com/nedigi/edit?html,css,output), run it, then click on the first button to show all key/values in the localStorage. Open the URL in another tab, and see that the data is shared between tabs, as local stores are attached to an origin.

Then click on the second button to add data to the store, click on the third to remove data. Finally, the last one clears the whole data store.

Source code:
```
1.  &lt;!DOCTYPE html&gt;
2.  &lt;html lang=&quot;en&quot;&gt;
3.  &lt;head&gt;
4.  &lt;meta charset=utf-8 /&gt;
5.  &lt;title&gt;Example of localStorare API use&lt;/title&gt;
6.  &lt;script&gt;
7.     // Using localStorage
8.     var counter = localStorage.getItem(&quot;count&quot;) \|\| 0;
9.     counter++;
10.    localStorage.setItem(&quot;count&quot;, counter);
11. 
12.    function getCountValue() {
13.       // retrieve data
14.       document.querySelector(&quot;#counter&quot;).innerHTML = localStorage.count;
15.    }
16. 
17.    function seeAllKeyValuePairsStored() {
18.       // clear list first
19.       document.querySelector(&apos;#list&apos;).innerHTML=&quot;&quot;;
20. 
21.       for (var i = 0, n = localStorage.length; i &lt; n; i++) {
22.          var key = localStorage.key(i);
23.          var value = localStorage&lbrack;key&rbrack;;
24.          console.log(key + &quot;: &quot; + value);
25. 
26.          var li = document.createElement(&apos;li&apos;);
27.          li.innerHTML = key + &quot;: &quot; + value;
28.          document.querySelector(&apos;#list&apos;).insertBefore(li, null);
29.       }
30.    }
31. 
32.    function resetStore() {
33.         // erase all key values from store
34.         localStorage.clear();
35.         // reset displayed list too
36.        document.querySelector(&apos;#list&apos;).innerHTML=&quot;&quot;;
37.    }
38. 
39.    function addSomeData() {
40.       // store data
41.       localStorage.lastName = &quot;Buffa&quot;;
42.       localStorage.firstName = &quot;Michel&quot;;
43.       // refresh display
44.       seeAllKeyValuePairsStored();
45.    }
46. 
47.    function removeSomeData() {
48.       // store data
49.       localStorage.removeItem(&quot;lastName&quot;);
50.       localStorage.removeItem(&quot;firstName&quot;);
51.       // refresh display
52.       seeAllKeyValuePairsStored();
53.    }
54. &lt;/script&gt;
55. &lt;/head&gt;
56. &lt;body onload=&quot;getCountValue()&quot;&gt;
57.    &lt;h1&gt;Number of times this page has been seen on this browser: &lt;span id=&quot;counter&quot;&gt;&lt;/span&gt;&lt;/h1&gt;
58. 
59.    &lt;button onclick=&quot;seeAllKeyValuePairsStored()&quot;&gt;Show all key value pairs stored in localStorage&lt;/button&gt;&lt;br/&gt;
60.    &lt;output id=&quot;list&quot;&gt;&lt;/output&gt;
61.  
62.    &lt;button onclick=&quot;addSomeData()&quot;&gt;Add some data to the store&lt;/button&gt;&lt;br/&gt;
63.    &lt;button onclick=&quot;removeSomeData()&quot;&gt;Remove some data&lt;/button&gt;&lt;br/&gt;
64.    &lt;button onclick=&quot;resetStore()&quot;&gt;reset store (erase all key/value pairs)&lt;/button&gt;
65. &lt;/body&gt;
66. &lt;/html&gt;
```

 You can check in the Chrome dev. tools user interface that the content of the localStorage changes as you click on the buttons.

### 6.2.4 Example 2

Local stores are also useful for** saving/restoring user preferences** of Web Applications. For example, the JS Bin tool you have been using since the beginning of this course uses localStorage to store the list of tabs you open, and their width:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![example of preferences](./images/image301.jpeg){width="6.5in" height="4.3125in"}

This way, the next time you come back to JSBin, &quot;it will remember your last settings&quot;.

Another example is a guitar FX processor / amp simulator your instructor is writing with some of his students. It uses localStorage to save/restore presets values:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 00.  (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image000.jpeg?raw=true"
   alt=""
   width="35%">
&nbsp;
<br/>
![guitar fx processor uses localStorage](./images/image302.jpeg){width="6.5in" height="5.986111111111111in"}

### Save/restore preferences

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 303. animate rectangle with gui (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image303.jpeg?raw=true"
   alt="Animated Rectangle with GUI"
   width="35%">
&nbsp;
<br/>

Original example on JSBin:

we can change the color, size and speed of the animated rectangle. However, each time we come back to the page, default values are restored.

We would like to save the current values and find them back as they were when we come back to the page.

[Here is a modified example that saves/restores its state, you can try it at JSBin](https://jsbin.com/cebavo/edit?html,js,console,output). In this modified version of the animated rectangle example, you can set the color, size, speed, etc. And if you reload the page, the state of the different input field is restored, but also the internal variables. Check the source code in the JS Bin example and read the following explanations.

We used the same generic code for saving/restoring input fields&apos; values we saw in the first example that used localStorage. The only difference is that we renamed the two generic functions so that they correspond better to their role here (instead of saveFormContent we called the function restorePreferences).

The function initPreferences is executed when the page is loaded.

<h4>Source code extract:</h4>
```
> function initPreferences() {
>
>    console.log(&quot;Adding input listener to all input fields&quot;);
>
>    // add an input listener to all input fields
>
>    var listOfInputsInForm = document.querySelectorAll(&quot;input&quot;);
>
>    for(var i= 0; i &lt; listOfInputsInForm.length; i++) {
>
>       addInputListener(listOfInputsInForm&lbrack;i&rbrack;);
>
>    }
>
>    // restore preferences
>
>    restorePreferences();
>
>    applyGUIvalues(); // Use the input fields&apos; values we just restored to set internal 
>
>                      // size, incX, color, lineWidth variables
>
> }
>
>  
>
> function addInputListener(inputField) {
>
> // same as before
>
> }
>
>  
>
> function restorePreferences() {
>
> // same as old restoreFormContent
>
> }
>
>  
>
> function applyGUIvalues() {
>
>    // Check restored input field content to set the size of the rectangle
>
>    var sizeWidget = document.getElementById(&quot;size&quot;);
>
>    size = Math.sign(incX)\*parseInt(sizeWidget.value);
>
>    // also update the outline element&apos;s value
>
>    document.getElementById(&quot;sizeValue&quot;).innerHTML = size;
>
>    // Check restored input field content to set the color of the rectangle
>
>    var colorWidget = document.getElementById(&quot;color&quot;);
>
>    ctx.fillStyle = colorWidget.value;
>
>    // Check restored input field content to set the speed of the rectangle
>
>    var speedWidget = document.getElementById(&quot;speed&quot;);
>
>    incX = Math.sign(incX)\*parseInt(speedWidget.value);
>
>    // also update the outline element&apos;s value
>
>    document.getElementById(&quot;speedValue&quot;).innerHTML = Math.abs(incX);
>
>    // Check restored input field content to set the lineWidth of the rectangle
>
>    var lineWidthWidget = document.getElementById(&quot;lineWidth&quot;);
>
>    ctx.lineWidth = parseInt(lineWidthWidget.value);
>
> }
```

<h3 is="6-2-5">6.2.5 Example 3</h3>

[Online example at JSBin](https://jsbin.com/zowise/edit?html,js,output)

This time, using the setItem and getItem method we saw earlier in the course, we could write some generic functions for saving/restoring input fields&apos; content, without having advance knowledge about the number of fields in the form, their types, their ids, etc.

Furthermore, we removed all input listeners in the HTML, making it cleaner (no more oninput=&quot;localStorage.firstName = this.value;&apos;\...)

Define listeners + restore old values after the page is loaded, use generic functions

We start writing an init() function that is called when the page is loaded. This function will:

1.  Define input listeners for all input fields

2.  Restore the last saved value for each input field, if present.

<h4>Source code:</h4>
```
> // Called when the page is loaded
> window.onload = init;
>  
> function init() {
>    console.log(&quot;Adding input listener to all input fields&quot;);
>    // add an input listener to all input fields
>    var listOfInputsInForm = document.querySelectorAll(&quot;input&quot;);
>    for(var i= 0; i &lt; listOfInputsInForm.length; i++) {
>       addInputListener(listOfInputsInForm&lbrack;i&rbrack;);
>    }
>    // restore form content with previously saved values
>    restoreFormContent();
> }
```

And here is the addInputListener(inputField) function. It takes an input field as parameter and attaches an oninput listener to it, that will save the field&apos;s content each time a value is entered. The key will be the id of the input field (*line 3*):
```
> function addInputListener(inputField) {
>
>     inputField.addEventListener(&apos;input&apos;, function(event) {
>
>         localStorage.setItem(inputField.id, inputField.value);
>
>      }, false);
>
> }
```

Note that at *line 2*, we use addEventListener (that is not using the oninput property here). adddEventListener doesnot replace existing oninput definitions and keep all existing listeners unchanged.

##### Restore all input fields&apos; content using a generic function

We have seen how to save all input fields&apos; content on the fly. Now, let&apos;s see how we can restore saved values and update the form. This is done using the function restoreFormContent():
```
> function restoreFormContent() {
>    console.log(&quot;restoring form content from localStorage&quot;);
>    // get the list of all input elements in the form
>    var listOfInputsInForm = document.querySelectorAll(&quot;input&quot;);
>    // For each input element,
>    // - get its id (that is also the key for it&apos;s saved content
>    // in the localStorage)
>    // - get the value associated with the id/key in the local
>    // storage
>    // - If the value is not undefined, restore the value
>    // of the input field
>    for(var i= 0; i &lt; listOfInputsInForm.length; i++) {
>      var fieldToRestore = listOfInputsInForm&lbrack;i&rbrack;;
>      var id = fieldToRestore.id;
>      var savedValue = localStorage.getItem(id);
>      if(savedValue !== undefined) {
>         fieldToRestore.value = savedValue;
>      }
>    }
> }
```

In this function, we first get the list of input fields (*line 5*), then iterate on it (*line 14*). For each input field, we get its id, which value is the key in localStorage for the previous data saved for this field (*lines 15-16*). Then if the value is not undefined, we restore it by setting the value of the input field (*lines 19-20*).

These generic functions can be used in many different projects

Indeed, if you look carefully, you will see that these functions are really useful. You may easily embed them in your own projects, or perhaps adapt them for a particular need (i.e. for saving input type=&quot;checkboxes&quot; that work a bit differently), etc.

<h3 is="6-2-6">6.2.6 Size limitations, etc.</h3>

Few things to remember, from the Web storage specification:

-   User agents (browsers) should limit the total amount of space allowed for storage areas.

-   User agents may prompt the user when quotas are reached, allowing the user to grant more space to a site. This enables sites to store many user-created documents on the user&apos;s computer, for instance.

-   User agents should allow users to see how much space each domain is using.

-   A mostly arbitrary limit of five megabytes per origin is recommended (translation: give at least 5Mb per origin).

**In many cases, local storage is all that your application will need for saving/loading data on demand**. More complex ways to do it exist, such as IndexedDB, a No SQL database, that proposes transactions and usually comes with far more available space than local storage. IndexedDB usage is for advanced users and will be covered in the W3Cx HTML5 Apps and Games.

Additionally, there will be a limit on the amount of data that you can store there. Browsers enforce quotas that will prevent you from cluttering your users&apos; drives excessively. These quotas can vary from platform to platform, but are usually reasonably generous for simple cases (around 5MB), so **if you are careful not to store anything huge there, you should be fine.**

**Finally, keep in mind that this storage is not necessarily permanent.** Browsers are inconsistent in how they allow for it to be wiped, but in several cases it gets deleted with cookies --- which is logical when you think of how it can be used for tracking in a similar fashion.

For serious applications, you might want to synchronize existing data with the server on a regular basis, in order to avoid data loss (and in general, because users enjoy using the same service from multiple devices at once). This is a rather complex feat, and frameworks such as Firebase can help. Such techniques are beyond the scope of this course and will not be covered.

sessionStorage key/values instead of cookies?

Note that if all you need is to store session-based data in a manner that is more powerful than cookies, you can use the sessionStorage object which works in exactly the same way as localStorage, but the lifetime is limited to a single browser session (lifetime of your tab/window).

**Also note that in addition to being more convenient and capable of storing more data than cookies, it has the advantage of being scoped to a given browser tab (or similar execution context).**

**Cookies&apos; security drawback: **if a user has two tabs open to the same site, they will share the same cookies. Which is to say that if you are storing information about a given operation using cookies in one tab, that information will leak to the other side --- this can be confusing if the user is performing different tasks in each.

**By using sessionStorage, the data you store will be scoped and therefore not leak across tabs!**

<h3 is="6-2-7">6.2.7 Storing more than strings? Use JSON!</h3>

Storing strings is all well and good, but it quickly becomes limiting: you may want to store more complex data with at least a modicum of structure.

There are some simple approaches, such as creating your own minimal record format (e.g. a string with fields separated with a given character, using join() on store and split() upon retrieval) or using multiple keys (e.g. post_17_title, post_17_content, post_17_author, etc.). But these are really hacks. Thankfully, there&apos;s a better way,  JSON.stringify() and JSON.parse() methods.

[JSON](https://www.json.org/) provides a great way of encoding and decoding data that is a really good match for JavaScript. You have to be careful not to use circular data structures or non-serializable objects, but in the vast majority of cases, plugging JSON support into your local store is straightforward.

<h4>Typical usage</h4>
```
1.  locaStorage.key = JSON.stringify(object); // or\...
2.  localStorage.setItem(key, JSON.stringify(object));
```

Let&apos;s try a simple toy example ([online at JSBin](https://jsbin.com/ciricis/2/edit?html,console,output)).  The example below saves a JavaScript object in JSON, then restores it and checks that the object properties are still there!

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 304. json save/load in local storage (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image304.png?raw=true"
   alt="JSON Save/Load in local storage"
   width="65%">
&nbsp;
<br/>

<h4>Source code:</h4>
```
> <!DOCTYPE html>
> <html lang="en">
> <head>
> <meta charset=utf-8 />
> <title>Storing JSON Objects with Local Storage</title>
> <script>
>     var personObject= {'givenName': 'Michel', 'familyName': 'Buffa'};
>     // Store the object as a JSON String
>     localStorage.setItem('testObject', JSON.stringify(personObject));
>     // Retrieve the object from storage
>     var retrievedObject = JSON.parse(localStorage.getItem('testObject'));
>     console.log(retrievedObject.firstName + " " + retrievedObject.lastName);
>    // then you can use retrievedObject.givenName, retrievedObject.familyName...
> </script>
> </head>
> <body>
> </body>
> </html>
```

<h4>Explanations:</h4>

-   Line 7: we built a JavaScript object that contains a person.

-   Line 10: we store it in localStorage as a JSON string object, with a key equal to testObject.

-   Line 13: we restore it from localStorage as a string, and the JSON.parse methods turns it back into a JavaScript object.

-   Line 15: we print the values of the object properties.

<h4>Examples</h4>

<h4>Example #1: showing how we can save a form&apos;s content in JSON</h4>

[Online example on JSBin that saves in localStorage an array of contacts in JSON](https://jsbin.com/nejewiw/2/edit?html,js,console,output)

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 305. local storage json (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image305.png?raw=true"
   alt="localStorage JSON"
   width="65%">
&nbsp;
<br/>

##### Example #2: a form and a table that displays the contacts stored in localStorage

[Example on JSBin](https://jsbin.com/karoboj/3/edit?html,css,console,output) 

Add contacts using the form, see how the HTML table is updated. Try to reload the page: data are persisted in localStorage. 

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 306. serverless contact manager (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image306.jpeg?raw=true"
   alt="Serverless Contact Manager"
   width="65%">
&nbsp;
<br/>

Examine the localStorage:

<!------------------------------------------------------------------------------------------------>
<!----------------------------- 307. localStorage view in devtools shows the data (xx) ------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image307.png?raw=true"
   alt="localStorage view in devtools shows the data"
   width="65%">
&nbsp;
<br/>

The source code for this example is a bit long, and we suggest that you examine it in the JS Bin tool. We extensively commented it. It uses:

Well structured pages with the new elements seen during Module 1 (section, article, nav, aside, etc.)

HTML5 form elements with builtin and custom validation (the date cannot be in the past, the firstName and lastName fields do not accept &, #, ! or \$ characters), localStorage for saving / restoring an array of contacts in JSON.

It shows how to use the DOM API for dynamically updating the page content (build the HTML table from the array of contacts, add a new line when a new contact is submitted, etc.)

<h3 id="ch6-3-1">6.3.1 Introduction</h3>

The objective of this chapter is to provide an overview of the File API.

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 308. sound sample editor serverless (xxx) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image308.jpeg?raw=true"
   alt="sound sample editor serverless"
   width="45%">
&nbsp;

Before HTML5, file management was limited to multipart forms and to Ajax for sending/requesting files to/from a remote Web server.

Possible actions were limited, both for the developer and the user. However, HTML5 now comes with an API called &quot;File&quot; that holds features for accessing file metadata (name, size, type) from client-side JavaScript. The API also has methods for reading file contents directly in the browser. This is particularly interesting for displaying preview of images before uploading them, or - and this is much more interesting - for developing Web applications that work with local files without the need for a server.

Imagine a multimedia player that accesses (in read-only) your file system, reads your audio and video files, etc., such as the [Remo Music player](https://chrome.google.com/webstore/detail/remo-music-player/ajilpdcmebalpffmjjopcingplogifhb) below, or an application that edits the audio content of local mp3 files, for example, the [HYA-WAVE sound editor](https://wav.hya.io/#/fx) (screenshot above).

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 309. audio player that plays local files (xxx) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image309.jpeg?raw=true"
   alt="audio player that plays local files"
   width="45%">
&nbsp;

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 310. polarr photo editor uses the File API (xxx) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image310.jpeg?raw=true"
   alt="polarr photo editor uses the File API"
   width="45%">
&nbsp;

##### **External resources**

-   From W3C&apos;s specification: [File API](https://www.w3.org/TR/FileAPI/)

-   An article from Web.dev: [Read files in JavaScript](https://web.dev/read-files/)

-   MDN&apos;s Web Docs: [Using files from web applications](https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications)

<h3 id="ch6-3-2">6.3.2 Working with local files</h3>

Hi! Welcome for this second video of module 6, in which we will talk about the file Javascript API.

This is an API that has been designed for working with files on the client side in Javascript.

Before HTML5, there was no mean to know the the size, the name, the modification date of a file without sending it to a remote server. It was not possible also to read the content of a file, for example for previewing an image before uploading it into a remote server, or if you wanted to play a local audio file, or a video file without streaming and downloading it from a remote server. It was not possible.

I&apos;m going first to show you some example of server less applications. I mean applications

written using HTML, CSS and Javascript that do not rely on data located on a remote server.

For example, I can show you this. This is a wave. This is an audio file editor that works with local files. I open the page, and from here I can drop a music file directly. Let&apos;s go to get some music somewhere. Some AC/DC song! I can just drop the song and I can edit the song. I can play the song. I can cut, I can save locally, etc.

Another example is an application, a Chrome application that is also written using Web technologies but doesn&apos;t run using HTTP. So it&apos;s quite easy to write such applications, because there are regular Web applications using HTML, CSS and Javascript except that you&apos;ve got to package them for putting them on the Chrome store.

I&apos;m going first to show you a local audio file player that is called Remo.

I can just open files, choose one or several, open the files, I&apos;ve got a playlist and I can play the songs. Normally it works... yes, OK.

Finally, I&apos;m going to show you an image editor that has been written by one of the students from this course. This is an example of Instagram-like filters that have been written by \@GeorgianaB from the discussion forum. It&apos;s a regular Web application except that you can upload an image, a local image. Ok, no, this one is too small maybe. You can upload an image... it's me with a strange head ;) Then you can apply Instagram filters or add borders. You can even download the result to your local disk.

We saw how to do this when we look at the download attributes in Module 1.

All these examples work with local files. Let&apos;s go back to the course and now I&apos;m going to show you how we can, for example, read images using an input type=file like this.

Select several files, open, and look at the preview directly in the page.

So, here, I just read the files using the File API, I read them as what we call data URL and I created some img elements we added in the page.

First, before writing the application, I want to talk a little bit about data URLs.

So data URLs are strange set of characters like that ,and if you select them and paste them in the address bar you can see a small red icon. And you can use this everywhere where you would have use an http://URL. So if I use this image here, I can using it in JSBin for example, and if I add the image here I can see that the content of the image, the pixels, are encoded in the URL itself. How can you make such URLs? You&apos;ve got plenty of Web sites, look for data URL with a search engine and you&apos;ve got plenty of them.

The first one here is called DATAURL.net and it included 'Data URL Maker' so you can just open a file, any sort of file, here I take a JPG file and it will produce the data URL that corresponds. But you can also use with mp3 file, or mp4 file video or any sort of file encoding. This was to introduce this new sort of URL that maybe you've never heard about before. Now, how can we write this?

I&apos;m going to explain with the source code here because it&apos;s simpler.

After that I will code it live. What we do is that we use an input type=file for reading the files. We define an event listener that will call this function 'read files and display preview' once the user has chosen some files.

In this callback, we iterate, we&apos;ve got a 'for' loop, about the files. For each file, we build a file reader, that is a special object, that has a function called 'readAsDataURL', that will take a file descriptor as a parameter here.

When the file is read, because that can take some time if the file is big, then each file is read, the onload callback is executed. It&apos;s exactly the same principle we saw with images as reading an image can take some time. You can only work with that image in an onload callback. So, when we enter this function that means that one file has been read and we can get the content of the file through the event using the 'e.target.result' property. Each time I read a file I can get its content here and it&apos;s a data URL that contains all the pixels.

What we do in that example, is that we create a &lt;span&gt;. In the span with the innerHTML, we add an image that has for src attribute the content of the image we read as a data URL.

And finally, we just insert this image in the document and this is when we see it.

I&apos;m going to live code this one, maybe a simpler version so that you can see the different steps in real time. First, I add an 'input type=file multiple' for selecting multiple files. This is what&apos;s happening and here I can select several images. I&apos;m going to add an 'onchange' listener:

'onchange=readImagesAndPreview()'.

And I&apos;m going to pass the set of file descriptors that have been selected: 'this.files' is the correct way to send the selected files to a Javascript function.

Now, I&apos;m going to start writing some script. But before, I will add a space, let&apos;s say

'div id=thumbnails'. This is an empty container that will be used for inserting the preview of the images. Now I&apos;m going in the script part. In the script part, we&apos;re going to write this function 'readImagesAndPreview()' and it takes as parameter the files that will be sent. And here if I want just to read the first file I will just show you how it works. I create a reader object, like that, and I ask

the reader to 'readAsDataURL' the first file. What is happening is that this may take some time and I need to declare, before reading the files, a callback that will be code only once the file would have been read - 'reader.onload'

And here, what can I do with the file that has been read, I will create an image element.

So i created an image element, I set the source of this element with the file content that is in the 'e.target.value'. So I created an image. Then, I will add the image to the container here. I&apos;m going to declare the container here. How can I add an element: 'container.appendChild' and I add the image I created.

Let&apos;s try it, maybe I made some mistakes. I select several files, I open them and here, apparently, I make a small mistake.

Let&apos;s open an image and now read the image and I can see the preview.

If you look carefully, it&apos;s just a few lines of code.

So now I&apos;m going to show you how we could work with not only one single image, but several images. The trick consists in adding a 'for' loop.

We will iterate on the length of the file's variable here. If we got 3 files, we do 3

loops. I&apos;m going to define a variable called 'f' that will correspond to the current file. What we are going to read this time is the current file 'f'. So this loop here, will first read files, for each one we do read as data URL, when the file is read we enter the onload callback, we create an image with the result. I&apos;m going just to add some constraints on the size, because when I tried earlier I had big images that could not fit on the screen.

I constraint the width to 100px and the height will just follow.

Like this, let&apos;s try. If I select several pictures, two of them,

I can see the two pictures. If I select more, then I can see the whole set of pictures that are coming as previews. You can see that the number of lines of code is really small and this is quiet powerful. So if you want to write for example a Web site that will upload pictures, you can preview them, select them and then upload them.

I show you earlier the application by one of the students that can do Instagram like

filters, but you can also find some new on the Chrome store. I installed one that is called Polarr that is using HTML for all the functionalities. So you can just import a picture, let&apos;s say this one. Then you can select filters, you can do some corrections on it and so on, and finally you can export it and that&apos;s all.

All this here is HTML5, this is canvas, these are form elements we saw the last week, some canvas here, or image elements and so on.

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 311.  (xxx) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image311.png?raw=true"
   alt=""
   width="65%">
&nbsp;

<h4>Source code:</h4>

```
> <!DOCTYPE html>
> <html lang="en">
> <head>
> <meta charset="utf-8&quot;&gt;
> <title>Example of using readAsDataURL</title>
> </head>
> <body>
> <input type="file" multiple onchange="readImagesAndPreview(this.files);">
> <p>
> <div id="thumbnails"></div>
> <script>
>    var container = document.getElementById("thumbnails");
>    function readImagesAndPreview(files) {
>       for(var i=0; i < files.length; i++) {
>          var f = files&lbrack;i&rbrack;;
>          var reader = new FileReader();
>          reader.onload = function(e) {
>             var img = document.createElement("img");
>             img.src = e.target.result;
>             img.width = 100;
>             container.appendChild(img);
>          }
>          reader.readAsDataURL(f);
>      }
> }
>  </script>
> </body>
> </html>
```

<h3 id="ch6-3-3">6.3.3 Reading File Metadata</h3>

Imagine you have an input field like this:

1.  Select one or more files: &lt;input type=&quot;file&quot; id=&quot;input&quot;/&gt;

This renders as a &quot;select files&quot; or &quot;browse files&quot; button. If you select one file in the file chooser dialog that has popped up, before HTML5 you couldn&apos;t do anything with it in the client-side: no access from JavaScript. With the File API, you can read what we call &quot;file metadata&quot;: name, size, type and last modification date.

Look at the code below: the file API defines a files property on the DOM node corresponding to the &lt;input type=&quot;file&quot;\.../&gt; input field. This property is an array.

In the example below, we get in the selectedFile variable, the metadata related to the first selected file:

```
> var selectedFile = document.getElementById('input').files[0];
> // do something with selectedFile.name, selectedFile.size, selectedFile.type
> // selectedFile.lastModifiedDate
>
> \...
```

<h4>Examples</h4>

<h4>Example #1: read metadata of the first selected file</h4>

[Here is a complete example on JSBin](https://jsbin.com/terocu/edit?html,output) that uses the code above to get details about the first selected file. Please try it below on your browser (click on the button and choose one file):

<h4>Select one or more files:</h4>

-   File name:

-   File size:

-   File type:

-   File last modification date:

<h4>Complete source code:</h4>

```
> <!DOCTYPE html>
> <html lang="en">
> <head>
> <meta charset=utf-8 />
> <title>Reading file metadata</title>
> <script>
>      function displayFirstSelectedFileMetadata() {
>         var selectedFile = document.getElementById('input').files[0];
>         document.querySelector("#singleName").innerHTML = selectedFile.name;
>         document.querySelector("#singleSize").innerHTML = selectedFile.size + " bytes";
>         document.querySelector("#singleType").innerHTML = selectedFile.type;
>         document.querySelector("#singleDate").innerHTML = selectedFile.lastModifiedDate;
> }
> </script>
> </head>
> <body>
>    Select one or more files: <input type="file" id="input"
>                                     onchange="displayFirstSelectedFileMetadata();"/>
> <p>
> <ul>
>     <li>File name: <span id="singleName"></span></li>
>     <li>File size: <span id="singleSize"></span></li>
>     <li>File type: <span id="singleType"></span></li>
>     <li>File last modification date: <span id="singleDate"></span></li>
> </ul>
> </body>
> </html>
```

<h4>Example #2: display metadata of multiple files, use a filter on the file type</h4>

This example is a bit more complicated, as it will display details about all files selected (not only the first) and allows only images to be selected, using the accept attribute of the input field: &lt;input type=&quot;file&quot; accept=&quot;image/\*&quot;\.../&gt;.

<a href="https://jsbin.com/deboja/edit?html,output">Example on JSBin</a>, or try it in your browser: click on the button, and select multiple image files. Notice that in the file selector, files that are not images will be greyed and non selectable.

<h4>Select several images:</h4>

\...

<h4>Source code extract:</h4>

Select several images: &lt;input type=&quot;file&quot; accept=&quot;image/\*&quot; multiple onchange=&quot;filesProcess(this.files)&quot; name=&quot;selection&quot;/&gt;

```
<p>
<div id="result">...</div>
<script>
  function filesProcess(files) {
      var selection = "<table><tr><th>Name&lt;/th><th>Bytes</th><th>MIME Type</th>
                       <th>Last modified date</th></tr>";
      for(i=0; i<files.length ;i++){
          file = files[i];
          selection += "<tr><td>"+file.name+"</td><td style=&amp;amp;quot;text-align:right&amp;quot;>"
                    +file.size+"</td><td>"
                    +file.type+"</td><td> "+file.lastModifiedDate+"</td></tr>";
      }
      selection += &quot;&lt;/table&gt;&quot;;
      document.getElementById(&quot;result&quot;).innerHTML = selection;
  }
</script&gt;
```

<h4>Explanations:</h4>

<ul>
<li><i>Line1:</i> we used the multiple attribute to allow the selection of multiple files in the file chooser (using shift or control keys). The accept="image/"  attribute is a filter that restricts selection to images only. Finally, the onchange listener will call the filesProcess(...) function, passing as parameter the list of selected files for the current element (this.files).</li><br/>
<li><i>Lines 7 and 12:</i> we prepare the HTML code for building a &lt;table&gt; with the results.</li><br/>
<li><i>Line 10:</i> this for loop builds all the rows that compose the table, adding HTML code to the selection string variable. At the end of the loop, this variable contains all the HTML code that corresponds to the table of results.</li><br/>
<li><i>Line 18:</i> the table is added to the page. We use the innerHTML attribute of the DOM element corresponding to the &lt;div id=&quot;result&quot;&gt; in order to insert the table as its child in the DOM tree. As such, the table appears on the page dynamically.</li><br/>
</ul>

<h3 id="ch6-3-4">6.3.4 Blob and File</h3>

The [HTML5 File API specification](https://www.w3.org/TR/FileAPI/) introduces several interfaces:

-   the** [FileList](https://www.w3.org/TR/FileAPI/#filelist-section) **interface (we already met it: the files property is a FileList,

-   the[** File**](https://www.w3.org/TR/FileAPI/#file-section) interface that is useful for getting details about a file (the file variable in the for loop of the last example illustrates this),

-   the** [Blob](https://www.w3.org/TR/FileAPI/#blob-section)** interface helps read binary data (only) that is accessed slice by slice (as chunks of data, each one being a &quot;Blob&quot;),

-   and the** [FileReader](https://www.w3.org/TR/FileAPI/#APIASynch)** interface for reading file content (we will see how to use it in the next section of the course).

We will not use all of these interfaces, but let&apos;s explain the difference between Blob and File, as most of the methods exposed by the FileReader interface take indiscriminately a Blob or a File as parameter.

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 312. the blob movie poster (xxx) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image312.jpeg?raw=true"
   alt="The Blob Movie Poster"
   width="25%">
&nbsp;

<h4>The Blob object</h4>

**An object of type Blob is a structure that represents binary data available as read-only.** Most of the time, you will only encounter these objects when you handle files.

Blob objects have two properties, namely:size and type, which respectively retrieve the size in bytes of the data handled by the Blob and their MIME type.

<h4>The File object</h4>

**File objects are useful for manipulating\... files!** They inherit the properties and methods of Blob objects, and have two additional properties that are name, for the file name, and lastModifiedDate to get the date of the last modification of the file (in the form of a JavaScript Date object, obviously) .

Most of the time, we will work with File objects. Blob objects will have real interest when you download binary files using Ajax (see example below).

<h4>[Advanced]</h4>

If you are interested in seeing how Blob objects can be used, [here is an example &quot;as is&quot; that shows how to download an image using Xhr2](https://jsbin.com/jefitop/1/edit?html,output) (Xml Http Request version 2). The examples uses a &lt;progress&gt; element to show the download progress, and uses xhr.responseType = &apos;blob&apos;; to indicate that the file we are going to download is a binary file (a blob). Try the example, then comment the line with responseType=&apos;blob&apos;. In this case, you will notice that the image file is not properly decoded by the browser and is not displayed in the page. We explain Xhr2 in the [W3C HTML5 Apps and Games](https://www.edx.org/course/html5-apps-and-games) course.

<h3>6.3.5 Reading file content</h3>

In order to read the content of a file, different steps required. Let&apos;s see how to do it.

<h4>Typical use is made of three steps</h4>

<h4>Step #1: create a FileReader object</h4>

The file API proposes several methods for reading file content, each taken from the FileReader interface. Here is how you create a FileReader object:

1.  var reader = new FileReader();

<h4>Steps #2 and #3: first call a method of the FileReader object for reading the file content, then get the file content in an onload callback<h4>

There are three different methods available for reading a file&apos;s content: readAsText, readAsArrayBuffer for binary data and also as readAsDataURL (the content will be a URL you will use to set the src field of an &lt;img src=\...&gt;, &lt;audio&gt;, &lt;video&gt;, and also with all existing methods/properties that accept a URL).

All these methods take as a unique parameter a File object (for example, a file chosen by a user after clicking on a &lt;input type=file&gt; input field). Below, we use, as an example, the readAsText method:

```
> function readFileContent(f) {
>    // Executed last: called only when the file content is loaded, e.target.result is
>    // The content
>    reader.onload = function(e) {
>        var content = e.target.result;
>        // do something with the file content
>        console.log(&quot;File &quot; + f.name + &quot; content is: &quot; + content);
>    };
>    // Executed first: start reading the file asynchronously, will call the
>    // reader.onload callback only when the file is read entirely
>    reader.readAsText(f);
> }
```

The above code shows how a file can be read as text. The function is called, for example by clicking on the button corresponding to a &lt;input type=&quot;file&quot; id=&quot;file&quot;  onchange=&quot;readFileContent(this.files)&quot;/&gt;, and by choosing a file.

-   *Line 12* is executed first, and asks the Reader object to read the file f as text. As this takes some time, it&apos;s an asynchronous operation that will be executed by the browser in the background. When the file is read, the reader.onload callback function is called.

-   *Line 4* is executed after *line 12*, and is called only when the file content is available. This callback takes an event e as a unique parameter, and e.target.result is the file content.

Try a variation of the above code in your browser, that displays the file content in a text area. This example is detailed further in the course. Click and select a text file below:

Choose a text file:\

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 313.  (xxx) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image313.png?raw=true"
   alt=""
   width="45%">
&nbsp;

In the following pages, we look at different examples that read file contents as text, dataURL and binary.

<h3>6.3.6 Read file content as text</h3>

Let&apos;s start by reading a pure text file

##### **Examples**

##### Example #1: read a single file&apos;s content

[Example at JSBin](https://jsbin.com/xewemi/edit?html,output), or try it below in your browser:

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 314.  (xxx) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image314.png?raw=true"
   alt=""
   width="45%">
&nbsp;
<br/>

<h4>Complete source code:</h4>

```
1.  <!DOCTYPE html>
2.  <html lang="en">
3.  <head>
4.  <meta charset="utf-8">
5.  <title>Example of use of FileReader with a text file</title>
6.  </head>
7.  <body>
8.  <label for="files">Choose a text file:</label><input type="file" id="file"
9.                             onchange="readFileContent(this.files)"/><br/>
10. <p>
11. <textarea rows=15 cols=50 id="fileContent"></textarea>
12. 
13. <script>
14. function readFileContent(files) {
15.      console.log("In readFileContent");
16.      var reader = new FileReader();
17. 
18.     // Executed last: called when the file content is loaded, e.target.result is
19.     // The content
20.     reader.onload = function(e) {
21.         // display content in the textarea with id="fileContent"
22.         document.getElementById("fileContent").value=** e.target.result;**
23.     };
24. 
25.     console.log("Reading file:" + files[0].name);
26. 
27.     // Executed first: start reading the file asynchronously , will call the onload
28.     // callback when the file is read
29.     reader.readAsText(files[0]);
30. }
31. </script>
32. </body>
33. </html>
```

This example is the one at the end of the previous page. This time, we show the complete source code above. Remember that the instruction at *line 29* is executed first, then when the file is read, the browser will call asynchronously the onload callback at *line 20*.

##### Example #2: a variation of the previous one, using multiple files

[Example on JSBin](https://jsbin.com/zaheyu/edit?html,output), or try it below in your browser.\
This time, please select multiple text files (using shift for multiple selection):

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 315.  (xxx) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image315.png?raw=true"
   alt=""
   width="40%">
&nbsp;
<br/>

<h4>Source code:</h4>

```
1.  &lt;!DOCTYPE html&gt;
2.  &lt;html lang=&quot;en&quot;&gt;
3.  &lt;head&gt;
4.  &lt;meta charset=&quot;utf-8&quot;&gt;
5.  &lt;title&gt;Example of use of FileReader with a text file&lt;/title&gt;
6.  &lt;/head&gt;
7.  &lt;body&gt;
8.  &lt;label for=&quot;files&quot;&gt;Choose multiple text files:&lt;/label&gt;
9.  &lt;input type=&quot;file&quot; id=&quot;files&quot;
10.        multiple onchange=&quot;readFilesAndDisplayAsText(this.files);&quot;/&gt;&lt;br/&gt;
11. &lt;p&gt;
12. &lt;textarea rows=30 cols=50 id=&quot;filesContent&quot;&gt;&lt;/textarea&gt;
13. 
14. &lt;script&gt;
15. var filesContent = document.getElementById(&quot;filesContent&quot;);
16. 
17. function readFilesAndDisplayAsText(files) {
18.      console.log(&quot;dans read files&quot;);
19.      // Loop through the FileList
20.      for (var i = 0, f; f = files&lbrack;i&rbrack;; i++) {
21. 
22.          var reader = new FileReader();
23. 
24.          // Add an onload listener to the reader
25.          addOnLoadListener(reader, f.name);
26.          // start reading, will call the listener later, when the file f is read
27.          reader.readAsText(f);
28. 
29.      }
30. }
31. 
32. function addOnLoadListener(reader, name) {
33.      // Add an onload listener that will be able to print the name of the
34.      // file\...
35.      reader.onload = function(e) {
36.          filesContent.value += &quot;###### READING FILE &quot; + name + &quot; ######&quot;;
37.          filesContent.value += e.target.result;
38.      };
39. }
40. &lt;/script&gt;
41. &lt;/body&gt;
42. &lt;/html&gt;
```

##### **Explanations**:

This example is similar to the previous one, except that this time we read multiple files.

*Line 20:* this is the for loop that will iterate on the files object passed as parameter by the onchange listener declaration at *line 10.*

*Line 25:* instead of declaring the onload listener with a reader.onload =\... directly in the loop, this time we preferred to write a separate function that will do this. This technique is useful when you want the listener to work with extra variables computed in the loop (in our case, the name of the file).

<h4>About charter encoding</h4>

Note that you can optionally indicate the encoding of the file you are going to read (default is UTF-8):

1.  reader.readAsText(file, &apos;UTF-8&apos;);

2.  reader.readAsText(file, &apos;ISO-8859-1&apos;);

3.  \...

<h3 id="ch6-3-7">6.3.7 Read file content as binary</h3>

This method is rarely used, except for loading &quot;raw&quot; binary data. For images you would like to see in your HTML page using the &lt;img src= tag&gt; or for drawing in a canvas, or for audio and video files that you would like to play using the &lt;audio&gt; or &lt;video&gt; elements, it would be preferable to use the readAsDataURL method presented on the next page of the course.

readAsArrayBuffer is often used for purposes such as reading audio samples that should be loaded in memory and played using the WebAudio API, or for loading textures that you will use with WebGL for 3D animations.

##### Example: read a local audio file and play it with the WebAudio API

The WebAudio API is useful for reading audio sound samples from memory (no streaming), and has been designed for music application and games. This example shows how a local audio file can be read and played directly in the browser, without the need for a server!

[Example on JSBin](https://jsbin.com/xepexuy/1/edit?html,output) (does not work on IE, as it does not support the WebAudio API). We could not embed it here on the edX platform as it prevents code that uses Ajax to run in its pages.

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 316.  (xxx) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image316.png?raw=true"
   alt="Local audio player"
   width="55%">
&nbsp;
<br/>

Source code extract:

```
> // User selects file. Read it as an ArrayBuffer and pass to the API.
> var fileInput = document.querySelector(&apos;input&lbrack;type=&quot;file&quot;&rbrack;&apos;);
> fileInput.addEventListener(&apos;change&apos;, function(e) {
>    var reader = new FileReader();
>    reader.onload = function(e) {
>       initSound(e.target.result);
>    };
>    // THIS IS THE INTERESTING PART!
>    reader.readAsArrayBuffer(this.files&lbrack;0&rbrack;);
> }, false);
```

<b>Explanations:</b>

-   <i>Line 2:</i> we get a pointer to the file selector, the variable fileInput.

-   *Line 4: *we define a change listener. In this example, we use an anonymous function directly included in the listener definition (the listener is the function(e) {\...}).

-   *Line 11: *when a user chooses a file, the listener will be executed. Line 11 will start the reading of the file content, as a binary file (this is what readAsArrayBuffer means: read as binary!). Once the file will be entirely read, the onload callback will be asynchronously called by the browser.

-   *Line 7 *is the onload callback, executed when the file content is loaded in memory. We pass the file content to the initSound function (see JSBin example for complete source code) that uses WebAudio to decode it (it may be a compressed file - an mp3 for example - and WebAudio works only with uncompressed audio formats in memory), and to play it.

<h3>6.3.8 Read file content as dataURL</h3>

##### What is a data URL?

A data URL is a URL that includes type and content at the same time. It is useful, for example,  for in-lining images or videos in the HTML of a Web page (on mobile devices, this may speed up the loading of the page by reducing the number of HTTP requests).

Here is an example of a red square, as a data URL. Copy and paste it in the address bar of your browser, and you should see the red square:

data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==

This data URL in a browser address bar should look like this:

<!------------------------------------------------------------------------------------------------>
<!-------------------- 317. data url in address bar shows a red cirle (xxx) ---------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image317.jpeg?raw=true"
   alt="Data url in address bar shows a red circle"
   width="85%" />
&nbsp;
<br/>

If we set the src attribute of an image element &lt;img src=&quot;data:image/png\....&quot;&gt; with the data URL of the above screenshot, it will work exactly as if you used a URL that started with https://

In your browser, you will see a small red circle rendered by this source code:

```
> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA
>
> AAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO
>
> 9TXL0Y4OHwAAAABJRU5ErkJggg==" alt="Red square" width=50 height=50/>
```

And here is the result:
<!------------------------------------------------------------------------------------------------>
<!-------------------- 318.  (xxx) ---------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image318.png?raw=true"
   alt="image 318"
   width="15%" />
&nbsp;
<br/>

This dataURL format enables file content to be stored in a base64 format (as a string), and adds the MIME type specification of the content. The dataURL can therefore store a file as a URL readable with modern browsers. It is becoming more commonly used on the Web, especially for mobile applications, as inlining images reduces the number of HTTP requests and makes the Web page load faster.

You will find lots of Web sites and tools for generating dataURL from files, such as [Image to Data URI converter](https://ezgif.com/image-to-datauri) (screenshot below):

<!------------------------------------------------------------------------------------------------>
<!------------ 319. Online service that converts uploaded images to data uris... ----------------->
<!-------------- we see an image and its ascii encoded data uri version (xxx) -------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image319.jpeg?raw=true"
   alt="Online service that converts uploaded images to data uris...we see an image and its ascii encoded data uri version"
   width="55%" />
</p>

With the above example, you can copy and paste the characters on the left and use them with an &lt;img src=&quot;\...&quot;&gt;. Just set the src attribute with it!

Notice that you can encode any type of file as dataURL, but this format is most frequently used with ./images files (images, audio, video).

Example of HTML5 logo embedded in a document without any real image, just a dataURL and CSS:

<!------------------------------------------------------------------------------------------------>
<!- 320. screenshot of jsbin examle shows the html5 logo insterted before a div using css (xxx) -->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image317.jpeg?raw=true"
   alt="Data url in address bar shows a red circle"
   width="65%" />
&nbsp;
<br/>

<h4>Examples</h4>

<h4>Example #1: read images as data URL and display previews in the page</h4>

This first example is useful for forms that allow the user to select one or more pictures. Before sending the form, you might want to get a preview of the pictures in the HTML page. The reader.readAsDataUrl method is used for that.

[Example on JSBin](https://jsbin.com/laseye/edit?html,output) or try it below in your browser:

<!------------------------------------------------------------------------------------------------>
<!------------------------------ 332. preview of selected images --------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image332.png?raw=true"
   alt="Preview of Seleted Images"
   width="45%">
&nbsp;
<br/>

<h4>Preview of selected images:</h4>

<h4>Source code extract:</h4>

```
> <label for="files">Choose multiple files:</label>
> <input type="file" id="files" multiple
>         onchange="readFilesAndDisplayPreview(this.files);"/><br/>
> <p>Preview of selected images:</p>
> <output id="list"></output>
> <script>
>   function readFilesAndDisplayPreview(files) {
>     // Loop through the FileList and render image files as thumbnails.
>     for (var i = 0, f; f = files[i]; i++) {
>     // Only process image files.
>     if (!f.type.match('image.*')) {
>          continue;
>     }
>     var reader = new FileReader();
>  
>     //capture the file information.
>     reader.onload = function(e) {
>         // Render thumbnail. e.target.result = the image content
>         // as a data URL
>        // create a span with CSS class="thumb", for nicer layout
>        var span = document.createElement('span');
>        // Add an img src=... in the span, with src= the dataURL of
>        // the image
>        span.innerHTML = "<img class='thumb' src='" +
>                          e.target.result + "' alt='a picture'/>";
>        // Insert the span in the output id=list
>        document.getElementById('list').insertBefore(span, null);
>    };
>   // Read in the image file as a data URL.
>   reader.readAsDataURL(f);
>  }
> }
```

<h4>Explanations:</h4>

-   *Line 35:* starts the reading of the file f. When f is read, the onload callback will be called.

-   *Lines 25-31:* we build, using the DOM API, a &lt;span class=&quot;thumb&quot;&gt;\...&lt;/span&gt; and inside we add an &lt;img src=the data url&gt; element with its src attribute equal to the url of the image that has been read (the image content as dataURL is in e.target.result). Finally, at *line 31*, we insert the span in the document before the current children of the &lt;output id=&quot;list&quot;&gt; element (declared at *line 5*).

<h4>Example #2: read a single local image file and use it with drawImage in a canvas</h4>

[Try it on JSBin](https://jsbin.com/miciqu/edit?html,output)

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 322.  (xxx) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image322.jpeg?raw=true"
   alt="read image as dataURL and draw inside a canvas"
   width="55%">
&nbsp;
<br/>

*Errata*: the above screenshot says &quot;choose multiple files&quot;, but the example only works with a single file.

<h4>Source code extract:</h4>

```
> function drawImage(imageFile) {
>    var reader = new FileReader();
>  
>    //capture the file information.
>    reader.onload = function(e) {
>       // For drawing an image on a canvas we
>       // need an image object
>       var img = new Image();
>       // Even if the file has been read, decoding
>       // the dataURL format may take some time
>       // so we need to use the regular way of
>       // working with images: onload callback    
>       // that will be called after setting the src attribute
>       img.onload = function(e) {
>          // draw the image!
>          ctx.drawImage(img, 0, 0, 400, 400);
>       }
>       // e.target.result is the dataURL, so we set the
>       // src if the image with it. This will call
>       // asynchonously the onload callback
>       img.src= e.target.result;
>   };
>   // Read in the image file as a data URL.
>   reader.readAsDataURL(imageFile);
> }
> function readFileAndDraw(files) {
>     drawImage(files[0]);
> }
```

<h4>Explanations:</h4>

Remember how we worked with images on a canvas. We had to create an empty image object (*line 8*), set the src attribute of the image object (*line 23*), then use an image.onload callback (*line 15*), and we could only draw from inside the callback (*line 17*). This time, it&apos;s exactly the same, except that the URL comes from e.target.result in the reader.onload callback (*line 23*).

<h4>Example #3 (advanced): an instagram-like photo filter application</h4>

Another very impressive example, has been developed by \@GeorgianaB, a student of the first iteration of this course (see her [other creations/examples](https://codepen.io/giana/)). This Web application reads local image files, draws them into a canvas element and proposes different filters. This example is given &quot;as is&quot; for those of you who would like to go further. Just click on the link (or on the image below) and look at the source code.

[Try this example online on gitHub](https://gianablantin.github.io/CanvasFilters/).

<h4>Introduction</h4>

This chapter presents the new Geolocation API and illustrates its use with several examples.

<!------------------------------------------------------------------------------------------------>
<!-------------------------- 323.  (xxx) ----------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image323.png?raw=true"
   alt="W3C Geolocation icon"
   width="25%">
&nbsp;
<br/>

The Geolocation HTML5 JavaScript API is implemented by most modern Web browsers, and uses different means to get the current location: GPS, GSM/3G triangulation, Wifi, IP address, etc.

It is possible to prompt the user to activate the GPS (this is what most GPS navigation software does on mobile phones), or ask for a particular mean among those available. It is also possible to track the current position when it changes. This is useful for writing a navigation application or for tracking in real time the position of different participants in the case of an application that involves several persons at the same time (using WebSockets, for example).

[Browser support for the Geolocation API](https://caniuse.com/#feat=geolocation) is excellent, both on mobile and on desktop devices.

<h4>Typical use</h4>

```
> navigator.geolocation.getCurrentPosition(showPosition, onError);
>  
> function showPosition(position) {
>     console.log("latitude is: " + position.coords.latitude);
>     console.log("longitude is: " + position.coords.longitude);
> }
>  
> function onError(err) {
>     console.log("Could not get the position");
> }
```

[This online example at JSBin](https://jsbin.com/toyeley/1/edit?html,output) shows how to get the current longitude and latitude and display them in an HTML page. Try it below in your browser:

Click the button to get your coordinates:

Where am I ?

Note that the first time you execute this example, for privacy reasons, the browser will ask if you agree to share your position with the application.

Source code of this typical example:

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Basic example of use of the geolocation API</title>
</head>
<body>
<p id="msg">Click the button to get your coordinates:</p>
<button onclick="getLocation()">Where am I ?</button>
<script>
var displayCoords=document.getElementById("msg");
function getLocation() {
if (navigator.geolocation) {
navigator.geolocation.getCurrentPosition(showPosition);
} else {
displayCoords.innerHTML="Geolocation API not supported by your browser.";
}
}
function showPosition(position) {
displayCoords.innerHTML="Latitude: " + position.coords.latitude +
"<br />Longitude: " + position.coords.longitude;
}
</script>
</body>
</html>
```
<!------------------------------------------------------------------------------------------------>
<!------------------------------- 324. geolocation callback illustration (xxx) ---------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image324.jpeg?raw=true"
   alt="Geolocation Callback Illustration"
   width="55%" />
</p>

<b>Explanations:</b>

-   *Line 14* checks if the Web browser supports the geolocation API by testing the variable navigator.geolocation. If not null, then the geolocation API is supported.

-   *Line 15* calls navigator.geolocation.getCurrentPosition(showPosition) passing a callback function as a parameter (in this example we did not specify a callback in case of error). **When a current position is available, the callback function will be called asynchronously, and the input parameter of this callback function will be the current position,** like in the function showPosition(position) of the example.

-   *Line 22:* the position objects has a coords property that is the object that holds the longitude and the latitude.

<h4>External resources:</h4>

-   The W3C specification: [Geolocation API](https://www.w3.org/TR/geolocation-API/)

-   MDN&apos;s Web Docs: [Geolocation API](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API)

-   Browser support tables:

    -   on CanIuse: [Geolocation](https://caniuse.com/#feat=geolocation)

    -   on MDN: [Geolocation API](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API#Browser_compatibility)

<h3>6.4.2 The coords object properties</h3>

In the previous example, we used the coords property of the position passed as an input parameter to the callback function. This coords object has many properties:

<!------------------------------------------------------------------------------------------------>
<!------------------------------- 325.  (xxx) ---------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image325.png?raw=true"
   alt=" "
   width="85%" />
</p>

Not all these values may be available in all Web browsers. When one of these properties is null, it means that it is not available (often the case of the altitudeAccuracy)

<h3>6.4.3 Geolocation error codes</h3>

In the last example, we used the navigator.geolocation. getCurrentPosition(showPosition) with only one callback function (in the case of success), but it is also possible to pass a second parameter that is another callback function called in the case of error.

A slightly different version of the previous example [shows how to properly check against the different possible errors](https://jsbin.com/bafusik/edit?html,output). Try it, then turn your WiFi off or unplug your Ethernet cable (or turn off GPS and 3G/4G on a mobile phone). You should see an error message &quot;*Error during geolocation: Location could not be obtained though the available means*&quot;:

<!------------------------------------------------------------------------------------------------>
<!------------------------------- 326. geolocation error (xxx) ---------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image326.jpeg?raw=true"
   alt="Geolocation error"
   width="85%" />
</p>

<h3>Source code of the example:</h3>

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Basic example of use of the geolocation API</title>
</head>
<body>
<p id="msg">Click the button to get your coordinates:</p>
<button onclick="getLocation()">Where am I ?</button>
<script>
   var displayCoords=document.getElementById("msg");
   function getLocation() {
      if (navigator.geolocation) {
         navigator.geolocation.getCurrentPosition(showPosition, errorPosition);
      } else {
        displayCoords.innerHTML="Geolocation API not supported by your browser.";
      }
   }
   function showPosition(position) {
      displayCoords.innerHTML="Latitude: " + position.coords.latitude +
                               "&lt;br /&gt;Longitude: &quot; + position.coords.longitude;
   }
   function errorPosition(error) {
      var info = "Error during geolocation: ";
      switch(error.code) {
         case error.TIMEOUT:
            info += "Timeout !";
            break;
         case error.PERMISSION_DENIED:
            info += "Permission denied, geolocation could not be obtained...";
            break;
         case error.POSITION_UNAVAILABLE:
            info += "Location could not be obtained though the available means...";
            break;
         case error.UNKNOWN_ERROR:
            info += "Unknown error";
            break;
      }
      displayCoords.innerHTML = info;
    }
</script>
</body>
</html>
```

<h3>6.4.4 Tracking a position</h3>

In order to track the current position, the geolocation API provides a method similar to the getCurrentPosition(onSuccess, onError) named watchPosition(onSuccess, onError). 

When getCurrentPosition gives a position when called, watchPosition does the following:

-   It gets the callback function only when the current position changes. If you stay in the same location, the callback function won&apos;t be called regularly.

-   It returns an id so that you can use the clearWatch(id) method to stop the current tracking.

<h3>Typical use</h3>

> // get an id of the current tracking, the showPosition callback is like the one we saw in earlier examples.
>
> var watchPosId = navigator.geolocation.watchPosition(showPosition);
>
> \...
>
> // stop the tracking
>
> navigator.geolocation.clearWatch(watchPosId);

As a test, you may just try to change getCurrentPosition to watchPosition in the previous examples, and try this code using a mobile phone or tablet, walk for 20 meters and see the position changing.

<h3>Options available when using the geolocation API, in particular real time tracking</h3>

Several options are available when using HTML5 geolocation. We can pass a third parameter to the getCurrentPosition and watchPosition methods, that will hold one or several of the following options:

<!------------------------------------------------------------------------------------------------>
<!------------------------------- 327.  (4xx) ---------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image327.png?raw=true"
   alt="Example/Test OpenStreetMap"
   width="85%" />
</p>

<h3>Example of use</h3>

<h4>Source code:</h4>

```
// Just ask to turn GPS on, if available
navigator.geolocation.getCurrentPosition(onSuccess, onError,
                                     {enableHighAccuracy:true});
// maximumAge = 10 mins, the position can be cached for 10 mins,
// useful when in tunnels\...When the device tries to get
// a position, if it does not succeed, then go on error
// immediately
navigator.geolocation.getCurrentPosition(onSuccess, onError,
                                {maximumAge:600000, timeout:0});
// Position will never come from the cache (maximumAge: 0), and
// if after 0.1s the position could not be computed, then go on
// error
navigator.geolocation.getCurrentPosition(onSuccess, onError,
                                   {maximumAge:0, timeout:100});
// Ask for GPS, cache for 30s, 27s before going on error\...
watchId=navigator.geolocation.watchPosition(onSuccess, onError,
    {enableHighAccuracy:true, maximumAge:30000, timeout:27000});
```

Look for the explanations in the lines of comment.

<h3>6.4.5 Geolocation and maps</h3>

This section presents an example of how to get an interactive map, using [the Leaflet API for OpenStreetMap](https://leafletjs.com/reference-1.6.0.html), and gives links to more resources. Did you know that you can even get an estimation of a physical address from the longitude and latitude, using online Web services?

How to get a map centered on your longitude and latitude

<!------------------------------------------------------------------------------------------------>
<!------------------------------- 328. openstreetmap test (444) ---------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image328.png?raw=true"
   alt="Example/Test OpenStreetMap"
   width="85%" />
</p>

This example is just given &quot;as is&quot;, as there are so many possibilities for rendering a map with [the Leaflet API for OpenStreetMaps](https://leafletjs.com/reference-1.6.0.html). However, we think having such a basic example might be useful.

<!------------------------------------------------------------------------------------------------>
<!------------------------------- 329. openstreetmap test (444) ---------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image329.png?raw=true"
   alt="Example/Test OpenStreetMap"
   width="50%" />
</p>

<h4>JS</h4>

```
function getLocation(e) {
e.preventDefault();
if (!navigator.geolocation) {
alert("Browser doesn't support geolocation");
} else {
navigator.geolocation.getCurrentPosition(success, error);
}
}
// Get current position successfully
function success(position) {
var map, marker,
latitude = position.coords.latitude,
longitude = position.coords.longitude;
// Instance map using leaflet
map = L.map('map').setView([latitude, longitude], 13);
// Tile layer using key api at cloudmade.com
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
key: '760506895e284217a7442ce2efe97797',
styleId: 103288,
maxZoom: 16
}).addTo(map);
// Marker using leaflet
marker = L.marker([latitude, longitude]).addTo(map);
// Popup in leaflet
marker.bindPopup('<p>Your location</p>').openPopup();
}
// Get current position fail
function error() {
alert('Get current position fail. Please access codepen to get geolocation.');
}
```

<h4>CSS</h4>

```
html, body {
height: 100%
}
.map {
height: 300px;
}
.btn {
background-color: rgba(10, 10, 230, .5);
border: 0;
color: #fff;
padding: 10px;
text-shadow: 0 0 1px rgba(0, 0, 0, .3);
text-decoration: none;
margin: 0.5rem 0 1rem;
display: inline-block;
}
```

<h4>HTML</h4>

```
<html>
<head>
<meta charset="utf-8">
<title>OpenStreetMap Example</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
</head>
<body>
<button class="btn" onclick="getLocation(event)">Click to show your location with OpenStreetMap</button>
<div id="map" class="map"></div>
</body>
</html>
```

<h4>Source code extract:</h4>

<h4>HTML part:>/h4>

```
<html>
<head>
  <meta charset="utf-8">
>   <title>OpenStreetMap Example</title>
>   <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css">
>   <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
</head>
<body>
  <button class="btn" onclick="getLocation(event)">Click to show your location with OpenStreetMap</button>
  <div id="map" class="map"></div>
</body>
</html>
```

-   *Lines 5 and 6* are the required files to use the Leaflet API (this is the official name of the OpenStreetMaps API),

-   *Line 10* is the &lt;div&gt; container that will be used to display the interactive map

<h4>JavaScript part:</h4>

```css
function getLocation(e) {
  e.preventDefault();
  if (!navigator.geolocation) {
    alert("Browser doesn't support geolocation");
  } else {
    navigator.geolocation.getCurrentPosition(success, error);
  }
}
// Get current position successfully
function success(position) {
  var map, marker,
  latitude = position.coords.latitude,
  longitude = position.coords.longitude;
  // Instance map using leaflet
  map = L.map('map').setView([latitude, longitude], 13);
  // Tile layer using key api at cloudmade.com
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    key: '760506895e284217a7442ce2efe97797',
    styleId: 103288,
    maxZoom: 16
  }).addTo(map);
  // Marker using leaflet
  marker = L.marker([latitude, longitude]).addTo(map);
  // Popup in leaflet
  marker.bindPopup('<p>Your location</p>').openPopup();
}
// Get current position fail
function error() {
  alert('Get current position fail. Please access codepen to get geolocation.');
}
```

-   *Line 6* uses the [Geolocation API](https://www.w3.org/TR/geolocation-API/) to get the current position, in case of success it calls the success function, passing the location as parameter,

-   *Lines 13 and 14* show how to get the longitude and latitude properties from the location,

-   The rest is a basic use of the Leaflet API. Notice at *line 17* that &apos;map&apos; is the id of the &lt;div&gt; from the HTML part of the code.

<h3>6.4.6 Reverse geocoding</h3>

Different Web services can be used to get an address from longitude and latitude. Most are free of charge, but they will ask you to register an API key and enter your credit card number. If you send too many requests, you will be charged.Such a service is the [Google Reverse Geocoding JavaScript API](https://developers.google.com/maps/documentation/javascript/examples/geocoding-reverse). For those of you who are really interested to know how this API works, please read the Google documentation and tutorials.

There is also an interesting Leaflet plugin (an extension to Leaflet) based on the [Gisgraphy](https://www.gisgraphy.com/) (free open source framework) service, that comes with a [nice demo of reverse geocoding](https://services.gisgraphy.com/static/leaflet/index.html).

Let&apos;s see some examples of use.

Example #1: how to get a physical address from the longitude and latitude

Google reverse geocoding example (screenshot only) :

<!------------------------------------------------------------------------------------------------>
<!------------------------ 330. google reverse geocoding example (447) --------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image330.png?raw=true"
   alt="Gisgraphy"
   width="45%" />
</p>

Source code of this example (in order to run it, you need a Google API key, used at *line 6*).

```
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Js bin </title>
    <script src="https://maps.googleapis.com/maps/api/js?key=PUT_HERE_YOUR_API_KEY&v=3.exp&sensor=false"></script>
<script>
// p elements for displaying lat / long and address
var displayCoords, myAddress;
// used with the google apis
var geocoder;
var map;
var infowindow = new google.maps.InfoWindow();
var marker;
// Called when the page is loaded
function init() {
    displayCoords=document.getElementById("msg");
    myAddress = document.getElementById("address");
    geocoder = new google.maps.Geocoder();
    // In order to show something even before a user clicks on the button
    var latlng = new google.maps.LatLng(34.0144, -6.83);
    var mapOptions = {
       zoom: 8,
       center: latlng,
       mapTypeId: 'roadmap'
    }
    map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
} // end of init()
// Called when the button is clicked
function getLocation() {
    if (navigator.geolocation) {
       navigator.geolocation.getCurrentPosition(showPosition);
    } else {
       displayCoords.innerHTML="Geolocation API not supported by your browser.";
    }
}
// Called when a position is available
function showPosition(position) {
    displayCoords.innerHTML="Latitude: " + position.coords.latitude +
                            "<br />Longitude: " + position.coords.longitude;
    // Display the map
    showOnGoogleMap(new google.maps.LatLng(position.coords.latitude,       
                                           position.coords.longitude));
 }
 function showOnGoogleMap(latlng) {
   // Ask google geocoder for an address once we get a longitude and
   // a latitude. In fact, the reverse geocoder sends back an array of "guesses"
   // i.e. not just one address object, but several. Each entry in this array
   // has several properties such as street, city, etc. We use the "formatted_address"
   // one here, but it might be interesting to get the detailed properties in other
   // applications like a form with street, city, zip code etc.
   geocoder.geocode({'latLng': latlng},reverseGeocoderSuccess);
   function reverseGeocoderSuccess(results, status) {
     if (status == google.maps.GeocoderStatus.OK) {
        if (results[1]) {
           map.setZoom(11);
           marker = new google.maps.Marker({
                                position: latlng,
                                map: map
                        });
           infowindow.setContent(results[1].formatted_address);
           infowindow.open(map, marker);
           // Display address as text in the page
           myAddress.innerHTML="Adress: " + results[0].formatted_address; 
        } else {
           alert('No surface address found');
        }
      } else {
         alert('Geocoder failed due to: ' + status);
      }
    } // end of reverseGeocoderSuccess
} // end of showOnGoogleMap
</script>
</head>
<body onload="init()">
<title>HTML5 + Geolocalisation + Google Maps API Reverse Geocoding</title>
<p id="msg">Click the button to get your coordinates:</p>
<p id="address"></p>
<button onclick="getLocation()">Where am I ?</button>
<div id="map_canvas" style="width: 500px; height: 300px"></div>
</body>
</html>
```

Gisgraphy (free service) reverse geocoding example (screenshot only, click on it to see [the demo on the Gisgraphy website](https://services.gisgraphy.com/static/leaflet/index.html)):

<!------------------------------------------------------------------------------------------------>
<!------------------------------------ 331. gisgraphy (449) -------------------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image331.png?raw=true"
   alt="Gisgraphy"
   width="65%" />
</p>

<h4>Example #2: reverse geocoding + OpenStreetMap</h4>

Important note: these examples below rely on an external [GitHub resource](https://github.com/perliedman/leaflet-control-geocoder). No related questions are asked in this module&apos;s exerises or final exam.

Please, pan and zoom on the map and click. The longitude and latitude are computed from your click and a free reverse geocoding service is used to convert to a physical address.
<!------------------------------------------------------------------------------------------------>
<!------------------------ 332. reverse geocoding - openstreetmap (449) -------------------------->
<!------------------------------------------------------------------------------------------------>
<p align="center">
<img src="/images/image332.png?raw=true"
   alt="Reverse Geocoding - OpenStreetMap"
   width="65%" />
</p>

<h4>HTML</h4>

```
    <!DOCTYPE html>
    <html>
    <head>
    <title>Leaflet Control Geocoder</title>
    <meta charset="utf-8" />
    <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, maximum-scale=1"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet@latest/dist/leaflet-src.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <style type="text/css">
    body {
    margin: 0;
    }
    #map {
    position: absolute;
    width: 100%;
    height: 100%;
    }
    </style>
    </head>
    <body>
    <div id="map"></div>
    <script type="text/javascript">
    var map = L.map('map').setView([0, 0], 2);
    var geocoder = L.Control.Geocoder.nominatim();
    if (URLSearchParams && location.search) {
    // parse /?geocoder=nominatim from URL
    var params = new URLSearchParams(location.search);
    var geocoderString = params.get('geocoder');
    if (geocoderString && L.Control.Geocoder[geocoderString]) {
    console.log('Using geocoder', geocoderString);
    geocoder = L.Control.Geocoder[geocoderString]();
    } else if (geocoderString) {
    console.warn('Unsupported geocoder', geocoderString);
    }
    }
    var control = L.Control.geocoder({
    query: 'Moon',
    placeholder: 'Search here...',
    geocoder: geocoder
    }).addTo(map);
    var marker;
    setTimeout(function() {
    control.setQuery('Earth');
    }, 12000);
    L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    map.on('click', function(e) {
    console.log(e.latlng)
    geocoder.reverse(e.latlng, map.options.crs.scale(map.getZoom()), function(results) {
    var r = results[0];
    if (r) {
    if (marker) {
    marker
    .setLatLng(r.center)
    .setPopupContent(r.html || r.name)
    .openPopup();
    } else {
    marker = L.marker(r.center)
    .bindPopup(r.name)
    .addTo(map)
    .openPopup();
    }
    }
    });
    });
    </script>
    </body>
 </html>
```

<h4>Example #3: shows the address on the map, from your current longitude and latitude</h4>

<h4>HTML</h4>

```
   <!DOCTYPE html>
    <html>
    <head>
    <title>Leaflet Control Geocoder</title>
    <meta charset="utf-8" />
    <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, maximum-scale=1"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet@latest/dist/leaflet-src.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
 <style type="text/css">
 body {
 margin: 0;
 }
 #map {
 position: absolute;
 width: 100%;
 height: 100%;
 }
 </style>
 </head>
 <body>
 <div id="map"></div>
 <script type="text/javascript">
 var geocoder = L.Control.Geocoder.nominatim();
 var map, marker, latitude, longitude;
 function getLocation() {
 if (!navigator.geolocation) {
 alert("Browser doesn't support geolocation");
 } else {
 navigator.geolocation.getCurrentPosition(success, error);
 }
 }
 // Get current position successfully
 function success(position) {
 latitude = position.coords.latitude;
 longitude = position.coords.longitude;
 // Instance map using leaflet
 map = L.map('map').setView([latitude, longitude], 13);
 // Tile layer using key api at cloudmade.com
 L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
 key: '760506895e284217a7442ce2efe97797',
 styleId: 103288,
 maxZoom: 16
 }).addTo(map);
 // Marker using leaflet
 marker = L.marker([latitude, longitude]).addTo(map);
 // Popup in leaflet
 marker.bindPopup('<p></p>').openPopup();
 getPhysicalAddress({lat:latitude, lng:longitude});
 }
 // Get current position fail
 function error() {
 alert('Get current position fail. Please access codepen to get geolocation.');
 }
 var marker;
 function getPhysicalAddress(latlong) {
 geocoder.reverse(latlong, map.options.crs.scale(map.getZoom()), function(results) {
 var r = results[0];
 if (r) {
 if (marker) {
 marker
 .setLatLng(r.center)
 .setPopupContent(r.html || r.name)
 .openPopup();
 } else {
 marker = L.marker(r.center)
 .bindPopup(r.name)
 .addTo(map)
 .openPopup();
 }
 }
 });
 }
 getLocation();
 </script>
 </body>
 </html>
```

<h4>Example #4: use of geolocation, map and reverse geocoder in a HTML form</h4>

This is just a variation of the previous examples. We embedded the interactive map in a form, and we display the results of the reverse geocoder in a form field. This example might be useful if you want to pre-fill the address of a registration form, depending on the current location of the person who is registering.

Click on the Codepen logo (on the top right) so to run the [online example](https://codepen.io/w3devcampus/pen/MWKEJqM) (for security reasons the embedded version cannot run in this page):

<h4>HTML</h4>

```
 <!DOCTYPE html>
 <html>
 <head>
 <title>Gimmee My Location</title>
 <meta charset="utf-8" />
 <meta
 name="viewport"
 content="width=device-width, user-scalable=no initial-scale=1, maximum-scale=1"
 />
 <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css" />
 <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
 <script src="https://unpkg.com/leaflet@latest/dist/leaflet-src.js"></script>
 <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
 </head>
 <body onload="getLocation();">
 <h1>Example of the use of reverse geocoder in a form</h1>
 <form>
 <fieldset>
 <legend>Form example with map and address...</legend>
 <div id="map" style="width: 500px; height: 300px"></div>
 </fieldset>
 <fieldset>
 <legend>Surface address</legend>
 <input id="surfaceAddress" size=110 type="text">
 <fieldset>
 <form>
 <div id="map"></div>
 <script type="text/javascript">
 var geocoder = L.Control.Geocoder.nominatim();
 var map, marker, latitude, longitude;
 function getLocation() {
 if (!navigator.geolocation) {
 alert("Browser doesn't support geolocation");
 } else {
navigator.geolocation.getCurrentPosition(success, error);
 }
 }
 // Get current position successfully
 function success(position) {
 latitude = position.coords.latitude;
 longitude = position.coords.longitude;
 // Instance map using leaflet
 map = L.map('map').setView([latitude, longitude], 13);
 // Tile layer using key api at cloudmade.com
 L.tileLayer('https://{s}.tile.openstreetmap.org/{z}{x}{y}.png', {
 key: '760506895e284217a7442ce2efe97797',
 styleId: 103288,
 maxZoom: 16
 }).addTo(map);
 // Marker using leaflet
 marker = L.marker([latitude, longitude]).addTo(map);
 // Popup in leaflet
 marker.bindPopup('<p></p>').openPopup();
 getPhysicalAddress({lat:latitude, lng:longitude});
 }
 // Get current position fail
 function error() {
 alert('Get current position fail. Please access codepen to get geolocation.');
 }
 var marker;
 function getPhysicalAddress(latlong) {
 geocoder.reverse(latlong, 500000, function(results) {
 var r = results[0];
 console.log(r.name);
 document.querySelector("#surfaceAddress").value = r.name;
 if (r) {
 if (marker) {
 marker
 .setLatLng(r.center)
 .setPopupContent(r.html || r.name)
 .openPopup();
 } else {
 marker = L.marker(r.center)
 .bindPopup(r.name)
 .addTo(map)
 .openPopup();
 }
 }
 });
 }
 <script>
 </body>
 </html>
```

The end.

**[`^        back to top        ^`](#table-of-contents)**

<h3><b><i>07-12-2022 Fri 5:29pm</i></b></h3>
